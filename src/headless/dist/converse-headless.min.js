/*! For license information please see converse-headless.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.converse=t():e.converse=t()}(this,(()=>(()=>{var e,t,n,r,s={9494:(e,t,n)=>{"use strict";const r=n(7672),s=n(4817);e.exports={atob:r,btoa:s}},7672:e=>{"use strict";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function n(e){const n=t.indexOf(e);return n<0?void 0:n}e.exports=function(e){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");if((e=(e=`${e}`).replace(/[ \t\n\f\r]/g,"")).length%4==0&&(e=e.replace(/==?$/,"")),e.length%4==1||/[^+/0-9A-Za-z]/.test(e))return null;let t="",r=0,s=0;for(let i=0;i<e.length;i++)r<<=6,r|=n(e[i]),s+=6,24===s&&(t+=String.fromCharCode((16711680&r)>>16),t+=String.fromCharCode((65280&r)>>8),t+=String.fromCharCode(255&r),r=s=0);return 12===s?(r>>=4,t+=String.fromCharCode(r)):18===s&&(r>>=2,t+=String.fromCharCode((65280&r)>>8),t+=String.fromCharCode(255&r)),t}},4817:e=>{"use strict";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function n(e){if(e>=0&&e<64)return t[e]}e.exports=function(e){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");let t;for(e=`${e}`,t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return null;let r="";for(t=0;t<e.length;t+=3){const s=[void 0,void 0,void 0,void 0];s[0]=e.charCodeAt(t)>>2,s[1]=(3&e.charCodeAt(t))<<4,e.length>t+1&&(s[1]|=e.charCodeAt(t+1)>>4,s[2]=(15&e.charCodeAt(t+1))<<2),e.length>t+2&&(s[2]|=e.charCodeAt(t+2)>>6,s[3]=63&e.charCodeAt(t+2));for(let e=0;e<s.length;e++)void 0===s[e]?r+="=":r+=n(s[e])}return r}},8487:function(e,t,n){!function(e,t){"use strict";function n(e){return n.result?n.result:e&&"function"==typeof e.getSerializer?(n.result=e.getSerializer(),n.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function r(e,t){return t&&e.then((function(e){t(null,e)}),(function(e){t(e)})),e}function s(e,t){var n=this.getItem(e).then((function(t){return{key:e,value:t}}));return r(n,t),n}function i(e){var t=this;return new Promise((function(n,r){for(var i=[],o=0,a=e.length;o<a;o++)i.push(s.call(t,e[o]));Promise.all(i).then((function(e){for(var t={},r=0,s=e.length;r<s;r++){var i=e[r];t[i.key]=i.value}n(t)})).catch(r)}))}function o(){var e={};return this.iterate((function(t,n){e[n]=t})).then((function(){return e}))}function a(){return"undefined"!=typeof IDBKeyRange?IDBKeyRange:"undefined"!=typeof webkitIDBKeyRange?webkitIDBKeyRange:"undefined"!=typeof mozIDBKeyRange?mozIDBKeyRange:void 0}t="default"in t?t.default:t;var c=a();function u(e){e=e.slice();var t=this;function n(e,t){return e<t?-1:e>t?1:0}return new Promise((function(r,s){t.ready().then((function(){var i,o=t._dbInfo,a=o.db.transaction(o.storeName,"readonly").objectStore(o.storeName),u=e.sort(n),d=c.bound(e[0],e[e.length-1],!1,!1);if("getAll"in a)(i=a.getAll(d)).onsuccess=function(){var e=i.result;void 0===e&&(e=null),r(e)};else{i=a.openCursor(d);var l={},h=0;i.onsuccess=function(){var e=i.result;if(e){for(var t=e.key;t>u[h];)if(++h===u.length)return void r(l);if(t===u[h]){var n=e.value;void 0===n&&(n=null),l[t]=n,e.continue()}else e.continue(u[h])}else r(l)}}i.onerror=function(){s(i.error)}})).catch(s)}))}function d(e){var t=this;return new Promise((function(r,s){t.ready().then((function(){return n(t)})).then((function(n){var i=t._dbInfo;i.db.transaction((function(t){for(var o=new Array(e.length),a=0,c=e.length;a<c;a++)o[a]="?";t.executeSql("SELECT * FROM "+i.storeName+" WHERE (key IN ("+o.join(",")+"))",e,(function(e,t){for(var s={},i=t.rows,o=0,a=i.length;o<a;o++){var c=i.item(o),u=c.value;u&&(u=n.deserialize(u)),s[c.key]=u}r(s)}),(function(e,t){s(t)}))}))})).catch(s)}))}function l(e,t){var n,s=this;if(arguments.length&&null!==e){var a=s.driver();n=a===s.INDEXEDDB?u.apply(s,arguments):a===s.WEBSQL?d.apply(s,arguments):i.apply(s,arguments)}else n=o.apply(s);return r(n,t),n}function h(e){var t=Object.getPrototypeOf(e);t&&(t.getItems=l,t.getItems.indexedDB=function(){return u.apply(this,arguments)},t.getItems.websql=function(){return d.apply(this,arguments)},t.getItems.generic=function(){return i.apply(this,arguments)})}var f=h(t);e.localforageGetItems=l,e.extendPrototype=h,e.extendPrototypeResult=f,e.getItemsGeneric=i,Object.defineProperty(e,"__esModule",{value:!0})}(t,n(9483))},6293:(e,t,n)=>{var r;!function(){"use strict";var s={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function i(e){return function(e,t){var n,r,o,a,c,u,d,l,h,f=1,g=e.length,p="";for(r=0;r<g;r++)if("string"==typeof e[r])p+=e[r];else if("object"==typeof e[r]){if((a=e[r]).keys)for(n=t[f],o=0;o<a.keys.length;o++){if(null==n)throw new Error(i('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[o],a.keys[o-1]));n=n[a.keys[o]]}else n=a.param_no?t[a.param_no]:t[f++];if(s.not_type.test(a.type)&&s.not_primitive.test(a.type)&&n instanceof Function&&(n=n()),s.numeric_arg.test(a.type)&&"number"!=typeof n&&isNaN(n))throw new TypeError(i("[sprintf] expecting number but found %T",n));switch(s.number.test(a.type)&&(l=n>=0),a.type){case"b":n=parseInt(n,10).toString(2);break;case"c":n=String.fromCharCode(parseInt(n,10));break;case"d":case"i":n=parseInt(n,10);break;case"j":n=JSON.stringify(n,null,a.width?parseInt(a.width):0);break;case"e":n=a.precision?parseFloat(n).toExponential(a.precision):parseFloat(n).toExponential();break;case"f":n=a.precision?parseFloat(n).toFixed(a.precision):parseFloat(n);break;case"g":n=a.precision?String(Number(n.toPrecision(a.precision))):parseFloat(n);break;case"o":n=(parseInt(n,10)>>>0).toString(8);break;case"s":n=String(n),n=a.precision?n.substring(0,a.precision):n;break;case"t":n=String(!!n),n=a.precision?n.substring(0,a.precision):n;break;case"T":n=Object.prototype.toString.call(n).slice(8,-1).toLowerCase(),n=a.precision?n.substring(0,a.precision):n;break;case"u":n=parseInt(n,10)>>>0;break;case"v":n=n.valueOf(),n=a.precision?n.substring(0,a.precision):n;break;case"x":n=(parseInt(n,10)>>>0).toString(16);break;case"X":n=(parseInt(n,10)>>>0).toString(16).toUpperCase()}s.json.test(a.type)?p+=n:(!s.number.test(a.type)||l&&!a.sign?h="":(h=l?"+":"-",n=n.toString().replace(s.sign,"")),u=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",d=a.width-(h+n).length,c=a.width&&d>0?u.repeat(d):"",p+=a.align?h+n+c:"0"===u?h+c+n:c+h+n)}return p}(function(e){if(a[e])return a[e];var t,n=e,r=[],i=0;for(;n;){if(null!==(t=s.text.exec(n)))r.push(t[0]);else if(null!==(t=s.modulo.exec(n)))r.push("%");else{if(null===(t=s.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(t[2]){i|=1;var o=[],c=t[2],u=[];if(null===(u=s.key.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o.push(u[1]);""!==(c=c.substring(u[0].length));)if(null!==(u=s.key_access.exec(c)))o.push(u[1]);else{if(null===(u=s.index_access.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");o.push(u[1])}t[2]=o}else i|=2;if(3===i)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r.push({placeholder:t[0],param_no:t[1],keys:t[2],sign:t[3],pad_char:t[4],align:t[5],width:t[6],precision:t[7],type:t[8]})}n=n.substring(t[0].length)}return a[e]=r}(e),arguments)}function o(e,t){return i.apply(null,[e].concat(t||[]))}var a=Object.create(null);t.sprintf=i,t.vsprintf=o,"undefined"!=typeof window&&(window.sprintf=i,window.vsprintf=o,void 0===(r=function(){return{sprintf:i,vsprintf:o}}.call(t,n,t,e))||(e.exports=r))}()},7939:function(e,t,n){var r,s;!function(i,o){"use strict";e.exports?e.exports=o():void 0===(s="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=s)}(0,(function(e){"use strict";var t=e&&e.IPv6;return{best:function(e){var t,n,r=e.toLowerCase().split(":"),s=r.length,i=8;for(""===r[0]&&""===r[1]&&""===r[2]?(r.shift(),r.shift()):""===r[0]&&""===r[1]?r.shift():""===r[s-1]&&""===r[s-2]&&r.pop(),-1!==r[(s=r.length)-1].indexOf(".")&&(i=7),t=0;t<s&&""!==r[t];t++);if(t<i)for(r.splice(t,1,"0000");r.length<i;)r.splice(t,0,"0000");for(var o=0;o<i;o++){n=r[o].split("");for(var a=0;a<3&&("0"===n[0]&&n.length>1);a++)n.splice(0,1);r[o]=n.join("")}var c=-1,u=0,d=0,l=-1,h=!1;for(o=0;o<i;o++)h?"0"===r[o]?d+=1:(h=!1,d>u&&(c=l,u=d)):"0"===r[o]&&(h=!0,l=o,d=1);d>u&&(c=l,u=d),u>1&&r.splice(c,u,""),s=r.length;var f="";for(""===r[0]&&(f=":"),o=0;o<s&&(f+=r[o],o!==s-1);o++)f+=":";return""===r[s-1]&&(f+=":"),f},noConflict:function(){return e.IPv6===this&&(e.IPv6=t),this}}}))},3338:function(e,t,n){var r,s;!function(i,o){"use strict";e.exports?e.exports=o():void 0===(s="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=s)}(0,(function(e){"use strict";var t=e&&e.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;var r=e.lastIndexOf(".",t-1);if(r<=0||r>=t-1)return!1;var s=n.list[e.slice(t+1)];return!!s&&s.indexOf(" "+e.slice(r+1,t)+" ")>=0},is:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;if(e.lastIndexOf(".",t-1)>=0)return!1;var r=n.list[e.slice(t+1)];return!!r&&r.indexOf(" "+e.slice(0,t)+" ")>=0},get:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return null;var r=e.lastIndexOf(".",t-1);if(r<=0||r>=t-1)return null;var s=n.list[e.slice(t+1)];return s?s.indexOf(" "+e.slice(r+1,t)+" ")<0?null:e.slice(r+1):null},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return n}))},9988:function(e,t,n){var r,s,i;!function(o,a){"use strict";e.exports?e.exports=a(n(7562),n(7939),n(3338)):(s=[n(7562),n(7939),n(3338)],void 0===(i="function"==typeof(r=a)?r.apply(t,s):r)||(e.exports=i))}(0,(function(e,t,n,r){"use strict";var s=r&&r.URI;function i(e,t){var n=arguments.length>=1;if(!(this instanceof i))return n?arguments.length>=2?new i(e,t):new i(e):new i;if(void 0===e){if(n)throw new TypeError("undefined is not a valid argument for URI");e="undefined"!=typeof location?location.href+"":""}if(null===e&&n)throw new TypeError("null is not a valid argument for URI");return this.href(e),void 0!==t?this.absoluteTo(t):this}i.version="1.19.11";var o=i.prototype,a=Object.prototype.hasOwnProperty;function c(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function u(e){return void 0===e?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function d(e){return"Array"===u(e)}function l(e,t){var n,r,s={};if("RegExp"===u(t))s=null;else if(d(t))for(n=0,r=t.length;n<r;n++)s[t[n]]=!0;else s[t]=!0;for(n=0,r=e.length;n<r;n++){(s&&void 0!==s[e[n]]||!s&&t.test(e[n]))&&(e.splice(n,1),r--,n--)}return e}function h(e,t){var n,r;if(d(t)){for(n=0,r=t.length;n<r;n++)if(!h(e,t[n]))return!1;return!0}var s=u(t);for(n=0,r=e.length;n<r;n++)if("RegExp"===s){if("string"==typeof e[n]&&e[n].match(t))return!0}else if(e[n]===t)return!0;return!1}function f(e,t){if(!d(e)||!d(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function g(e){return e.replace(/^\/+|\/+$/g,"")}function p(e){return escape(e)}function m(e){return encodeURIComponent(e).replace(/[!'()*]/g,p).replace(/\*/g,"%2A")}i._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:i.preventInvalidHostname,duplicateQueryParameters:i.duplicateQueryParameters,escapeQuerySpace:i.escapeQuerySpace}},i.preventInvalidHostname=!1,i.duplicateQueryParameters=!1,i.escapeQuerySpace=!0,i.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,i.idn_expression=/[^a-z0-9\._-]/i,i.punycode_expression=/(xn--)/i,i.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,i.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,i.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,i.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},i.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,i.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,i.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},i.hostProtocols=["http","https"],i.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,i.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},i.getDomAttribute=function(e){if(e&&e.nodeName){var t=e.nodeName.toLowerCase();if("input"!==t||"image"===e.type)return i.domAttributes[t]}},i.encode=m,i.decode=decodeURIComponent,i.iso8859=function(){i.encode=escape,i.decode=unescape},i.unicode=function(){i.encode=m,i.decode=decodeURIComponent},i.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},i.encodeQuery=function(e,t){var n=i.encode(e+"");return void 0===t&&(t=i.escapeQuerySpace),t?n.replace(/%20/g,"+"):n},i.decodeQuery=function(e,t){e+="",void 0===t&&(t=i.escapeQuerySpace);try{return i.decode(t?e.replace(/\+/g,"%20"):e)}catch(t){return e}};var v,_={encode:"encode",decode:"decode"},y=function(e,t){return function(n){try{return i[t](n+"").replace(i.characters[e][t].expression,(function(n){return i.characters[e][t].map[n]}))}catch(e){return n}}};for(v in _)i[v+"PathSegment"]=y("pathname",_[v]),i[v+"UrnPathSegment"]=y("urnpath",_[v]);var b=function(e,t,n){return function(r){var s;s=n?function(e){return i[t](i[n](e))}:i[t];for(var o=(r+"").split(e),a=0,c=o.length;a<c;a++)o[a]=s(o[a]);return o.join(e)}};function w(e){return function(t,n){return void 0===t?this._parts[e]||"":(this._parts[e]=t||null,this.build(!n),this)}}function S(e,t){return function(n,r){return void 0===n?this._parts[e]||"":(null!==n&&(n+="").charAt(0)===t&&(n=n.substring(1)),this._parts[e]=n,this.build(!r),this)}}i.decodePath=b("/","decodePathSegment"),i.decodeUrnPath=b(":","decodeUrnPathSegment"),i.recodePath=b("/","encodePathSegment","decode"),i.recodeUrnPath=b(":","encodeUrnPathSegment","decode"),i.encodeReserved=y("reserved","encode"),i.parse=function(e,t){var n;return t||(t={preventInvalidHostname:i.preventInvalidHostname}),(n=(e=(e=e.replace(i.leading_whitespace_expression,"")).replace(i.ascii_tab_whitespace,"")).indexOf("#"))>-1&&(t.fragment=e.substring(n+1)||null,e=e.substring(0,n)),(n=e.indexOf("?"))>-1&&(t.query=e.substring(n+1)||null,e=e.substring(0,n)),"//"===(e=(e=e.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://")).replace(/^[/\\]{2,}/i,"//")).substring(0,2)?(t.protocol=null,e=e.substring(2),e=i.parseAuthority(e,t)):(n=e.indexOf(":"))>-1&&(t.protocol=e.substring(0,n)||null,t.protocol&&!t.protocol.match(i.protocol_expression)?t.protocol=void 0:"//"===e.substring(n+1,n+3).replace(/\\/g,"/")?(e=e.substring(n+3),e=i.parseAuthority(e,t)):(e=e.substring(n+1),t.urn=!0)),t.path=e,t},i.parseHost=function(e,t){e||(e="");var n,r,s=(e=e.replace(/\\/g,"/")).indexOf("/");if(-1===s&&(s=e.length),"["===e.charAt(0))n=e.indexOf("]"),t.hostname=e.substring(1,n)||null,t.port=e.substring(n+2,s)||null,"/"===t.port&&(t.port=null);else{var o=e.indexOf(":"),a=e.indexOf("/"),c=e.indexOf(":",o+1);-1!==c&&(-1===a||c<a)?(t.hostname=e.substring(0,s)||null,t.port=null):(r=e.substring(0,s).split(":"),t.hostname=r[0]||null,t.port=r[1]||null)}return t.hostname&&"/"!==e.substring(s).charAt(0)&&(s++,e="/"+e),t.preventInvalidHostname&&i.ensureValidHostname(t.hostname,t.protocol),t.port&&i.ensureValidPort(t.port),e.substring(s)||"/"},i.parseAuthority=function(e,t){return e=i.parseUserinfo(e,t),i.parseHost(e,t)},i.parseUserinfo=function(e,t){var n=e;-1!==e.indexOf("\\")&&(e=e.replace(/\\/g,"/"));var r,s=e.indexOf("/"),o=e.lastIndexOf("@",s>-1?s:e.length-1);return o>-1&&(-1===s||o<s)?(r=e.substring(0,o).split(":"),t.username=r[0]?i.decode(r[0]):null,r.shift(),t.password=r[0]?i.decode(r.join(":")):null,e=n.substring(o+1)):(t.username=null,t.password=null),e},i.parseQuery=function(e,t){if(!e)return{};if(!(e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var n,r,s,o={},c=e.split("&"),u=c.length,d=0;d<u;d++)n=c[d].split("="),r=i.decodeQuery(n.shift(),t),s=n.length?i.decodeQuery(n.join("="),t):null,"__proto__"!==r&&(a.call(o,r)?("string"!=typeof o[r]&&null!==o[r]||(o[r]=[o[r]]),o[r].push(s)):o[r]=s);return o},i.build=function(e){var t="",n=!1;return e.protocol&&(t+=e.protocol+":"),e.urn||!t&&!e.hostname||(t+="//",n=!0),t+=i.buildAuthority(e)||"","string"==typeof e.path&&("/"!==e.path.charAt(0)&&n&&(t+="/"),t+=e.path),"string"==typeof e.query&&e.query&&(t+="?"+e.query),"string"==typeof e.fragment&&e.fragment&&(t+="#"+e.fragment),t},i.buildHost=function(e){var t="";return e.hostname?(i.ip6_expression.test(e.hostname)?t+="["+e.hostname+"]":t+=e.hostname,e.port&&(t+=":"+e.port),t):""},i.buildAuthority=function(e){return i.buildUserinfo(e)+i.buildHost(e)},i.buildUserinfo=function(e){var t="";return e.username&&(t+=i.encode(e.username)),e.password&&(t+=":"+i.encode(e.password)),t&&(t+="@"),t},i.buildQuery=function(e,t,n){var r,s,o,c,u="";for(s in e)if("__proto__"!==s&&a.call(e,s))if(d(e[s]))for(r={},o=0,c=e[s].length;o<c;o++)void 0!==e[s][o]&&void 0===r[e[s][o]+""]&&(u+="&"+i.buildQueryParameter(s,e[s][o],n),!0!==t&&(r[e[s][o]+""]=!0));else void 0!==e[s]&&(u+="&"+i.buildQueryParameter(s,e[s],n));return u.substring(1)},i.buildQueryParameter=function(e,t,n){return i.encodeQuery(e,n)+(null!==t?"="+i.encodeQuery(t,n):"")},i.addQuery=function(e,t,n){if("object"==typeof t)for(var r in t)a.call(t,r)&&i.addQuery(e,r,t[r]);else{if("string"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===e[t])return void(e[t]=n);"string"==typeof e[t]&&(e[t]=[e[t]]),d(n)||(n=[n]),e[t]=(e[t]||[]).concat(n)}},i.setQuery=function(e,t,n){if("object"==typeof t)for(var r in t)a.call(t,r)&&i.setQuery(e,r,t[r]);else{if("string"!=typeof t)throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");e[t]=void 0===n?null:n}},i.removeQuery=function(e,t,n){var r,s,o;if(d(t))for(r=0,s=t.length;r<s;r++)e[t[r]]=void 0;else if("RegExp"===u(t))for(o in e)t.test(o)&&(e[o]=void 0);else if("object"==typeof t)for(o in t)a.call(t,o)&&i.removeQuery(e,o,t[o]);else{if("string"!=typeof t)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==n?"RegExp"===u(n)?!d(e[t])&&n.test(e[t])?e[t]=void 0:e[t]=l(e[t],n):e[t]!==String(n)||d(n)&&1!==n.length?d(e[t])&&(e[t]=l(e[t],n)):e[t]=void 0:e[t]=void 0}},i.hasQuery=function(e,t,n,r){switch(u(t)){case"String":break;case"RegExp":for(var s in e)if(a.call(e,s)&&t.test(s)&&(void 0===n||i.hasQuery(e,s,n)))return!0;return!1;case"Object":for(var o in t)if(a.call(t,o)&&!i.hasQuery(e,o,t[o]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(u(n)){case"Undefined":return t in e;case"Boolean":return n===Boolean(d(e[t])?e[t].length:e[t]);case"Function":return!!n(e[t],t,e);case"Array":return!!d(e[t])&&(r?h:f)(e[t],n);case"RegExp":return d(e[t])?!!r&&h(e[t],n):Boolean(e[t]&&e[t].match(n));case"Number":n=String(n);case"String":return d(e[t])?!!r&&h(e[t],n):e[t]===n;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},i.joinPaths=function(){for(var e=[],t=[],n=0,r=0;r<arguments.length;r++){var s=new i(arguments[r]);e.push(s);for(var o=s.segment(),a=0;a<o.length;a++)"string"==typeof o[a]&&t.push(o[a]),o[a]&&n++}if(!t.length||!n)return new i("");var c=new i("").segment(t);return""!==e[0].path()&&"/"!==e[0].path().slice(0,1)||c.path("/"+c.path()),c.normalize()},i.commonPath=function(e,t){var n,r=Math.min(e.length,t.length);for(n=0;n<r;n++)if(e.charAt(n)!==t.charAt(n)){n--;break}return n<1?e.charAt(0)===t.charAt(0)&&"/"===e.charAt(0)?"/":"":("/"===e.charAt(n)&&"/"===t.charAt(n)||(n=e.substring(0,n).lastIndexOf("/")),e.substring(0,n+1))},i.withinString=function(e,t,n){n||(n={});var r=n.start||i.findUri.start,s=n.end||i.findUri.end,o=n.trim||i.findUri.trim,a=n.parens||i.findUri.parens,c=/[a-z0-9-]=["']?$/i;for(r.lastIndex=0;;){var u=r.exec(e);if(!u)break;var d=u.index;if(n.ignoreHtml){var l=e.slice(Math.max(d-3,0),d);if(l&&c.test(l))continue}for(var h=d+e.slice(d).search(s),f=e.slice(d,h),g=-1;;){var p=a.exec(f);if(!p)break;var m=p.index+p[0].length;g=Math.max(g,m)}if(!((f=g>-1?f.slice(0,g)+f.slice(g).replace(o,""):f.replace(o,"")).length<=u[0].length||n.ignore&&n.ignore.test(f))){var v=t(f,d,h=d+f.length,e);void 0!==v?(v=String(v),e=e.slice(0,d)+v+e.slice(h),r.lastIndex=d+v.length):r.lastIndex=h}}return r.lastIndex=0,e},i.ensureValidHostname=function(t,n){var r=!!t,s=!1;if(!!n&&(s=h(i.hostProtocols,n)),s&&!r)throw new TypeError("Hostname cannot be empty, if protocol is "+n);if(t&&t.match(i.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(t).match(i.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_]')}},i.ensureValidPort=function(e){if(e){var t=Number(e);if(!(/^[0-9]+$/.test(t)&&t>0&&t<65536))throw new TypeError('Port "'+e+'" is not a valid port')}},i.noConflict=function(e){if(e){var t={URI:this.noConflict()};return r.URITemplate&&"function"==typeof r.URITemplate.noConflict&&(t.URITemplate=r.URITemplate.noConflict()),r.IPv6&&"function"==typeof r.IPv6.noConflict&&(t.IPv6=r.IPv6.noConflict()),r.SecondLevelDomains&&"function"==typeof r.SecondLevelDomains.noConflict&&(t.SecondLevelDomains=r.SecondLevelDomains.noConflict()),t}return r.URI===this&&(r.URI=s),this},o.build=function(e){return!0===e?this._deferred_build=!0:(void 0===e||this._deferred_build)&&(this._string=i.build(this._parts),this._deferred_build=!1),this},o.clone=function(){return new i(this)},o.valueOf=o.toString=function(){return this.build(!1)._string},o.protocol=w("protocol"),o.username=w("username"),o.password=w("password"),o.hostname=w("hostname"),o.port=w("port"),o.query=S("query","?"),o.fragment=S("fragment","#"),o.search=function(e,t){var n=this.query(e,t);return"string"==typeof n&&n.length?"?"+n:n},o.hash=function(e,t){var n=this.fragment(e,t);return"string"==typeof n&&n.length?"#"+n:n},o.pathname=function(e,t){if(void 0===e||!0===e){var n=this._parts.path||(this._parts.hostname?"/":"");return e?(this._parts.urn?i.decodeUrnPath:i.decodePath)(n):n}return this._parts.urn?this._parts.path=e?i.recodeUrnPath(e):"":this._parts.path=e?i.recodePath(e):"/",this.build(!t),this},o.path=o.pathname,o.href=function(e,t){var n;if(void 0===e)return this.toString();this._string="",this._parts=i._parts();var r=e instanceof i,s="object"==typeof e&&(e.hostname||e.path||e.pathname);e.nodeName&&(e=e[i.getDomAttribute(e)]||"",s=!1);if(!r&&s&&void 0!==e.pathname&&(e=e.toString()),"string"==typeof e||e instanceof String)this._parts=i.parse(String(e),this._parts);else{if(!r&&!s)throw new TypeError("invalid input");var o=r?e._parts:e;for(n in o)"query"!==n&&a.call(this._parts,n)&&(this._parts[n]=o[n]);o.query&&this.query(o.query,!1)}return this.build(!t),this},o.is=function(e){var t=!1,r=!1,s=!1,o=!1,a=!1,c=!1,u=!1,d=!this._parts.urn;switch(this._parts.hostname&&(d=!1,r=i.ip4_expression.test(this._parts.hostname),s=i.ip6_expression.test(this._parts.hostname),a=(o=!(t=r||s))&&n&&n.has(this._parts.hostname),c=o&&i.idn_expression.test(this._parts.hostname),u=o&&i.punycode_expression.test(this._parts.hostname)),e.toLowerCase()){case"relative":return d;case"absolute":return!d;case"domain":case"name":return o;case"sld":return a;case"ip":return t;case"ip4":case"ipv4":case"inet4":return r;case"ip6":case"ipv6":case"inet6":return s;case"idn":return c;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return u}return null};var E=o.protocol,A=o.port,x=o.hostname;o.protocol=function(e,t){if(e&&!(e=e.replace(/:(\/\/)?$/,"")).match(i.protocol_expression))throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return E.call(this,e,t)},o.scheme=o.protocol,o.port=function(e,t){return this._parts.urn?void 0===e?"":this:(void 0!==e&&(0===e&&(e=null),e&&(":"===(e+="").charAt(0)&&(e=e.substring(1)),i.ensureValidPort(e))),A.call(this,e,t))},o.hostname=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e){var n={preventInvalidHostname:this._parts.preventInvalidHostname};if("/"!==i.parseHost(e,n))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');e=n.hostname,this._parts.preventInvalidHostname&&i.ensureValidHostname(e,this._parts.protocol)}return x.call(this,e,t)},o.origin=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var n=this.protocol();return this.authority()?(n?n+"://":"")+this.authority():""}var r=i(e);return this.protocol(r.protocol()).authority(r.authority()).build(!t),this},o.host=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?i.buildHost(this._parts):"";if("/"!==i.parseHost(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},o.authority=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?i.buildAuthority(this._parts):"";if("/"!==i.parseAuthority(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},o.userinfo=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var n=i.buildUserinfo(this._parts);return n?n.substring(0,n.length-1):n}return"@"!==e[e.length-1]&&(e+="@"),i.parseUserinfo(e,this._parts),this.build(!t),this},o.resource=function(e,t){var n;return void 0===e?this.path()+this.search()+this.hash():(n=i.parse(e),this._parts.path=n.path,this._parts.query=n.query,this._parts.fragment=n.fragment,this.build(!t),this)},o.subdomain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,n)||""}var r=this._parts.hostname.length-this.domain().length,s=this._parts.hostname.substring(0,r),o=new RegExp("^"+c(s));if(e&&"."!==e.charAt(e.length-1)&&(e+="."),-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");return e&&i.ensureValidHostname(e,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(o,e),this.build(!t),this},o.domain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.match(/\./g);if(n&&n.length<2)return this._parts.hostname;var r=this._parts.hostname.length-this.tld(t).length-1;return r=this._parts.hostname.lastIndexOf(".",r-1)+1,this._parts.hostname.substring(r)||""}if(!e)throw new TypeError("cannot set domain empty");if(-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");if(i.ensureValidHostname(e,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=e;else{var s=new RegExp(c(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(s,e)}return this.build(!t),this},o.tld=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.lastIndexOf("."),s=this._parts.hostname.substring(r+1);return!0!==t&&n&&n.list[s.toLowerCase()]&&n.get(this._parts.hostname)||s}var i;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!n||!n.is(e))throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');i=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(i,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");i=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(i,e)}return this.build(!t),this},o.directory=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var n=this._parts.path.length-this.filename().length-1,r=this._parts.path.substring(0,n)||(this._parts.hostname?"/":"");return e?i.decodePath(r):r}var s=this._parts.path.length-this.filename().length,o=this._parts.path.substring(0,s),a=new RegExp("^"+c(o));return this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e)),e&&"/"!==e.charAt(e.length-1)&&(e+="/"),e=i.recodePath(e),this._parts.path=this._parts.path.replace(a,e),this.build(!t),this},o.filename=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("string"!=typeof e){if(!this._parts.path||"/"===this._parts.path)return"";var n=this._parts.path.lastIndexOf("/"),r=this._parts.path.substring(n+1);return e?i.decodePathSegment(r):r}var s=!1;"/"===e.charAt(0)&&(e=e.substring(1)),e.match(/\.?\//)&&(s=!0);var o=new RegExp(c(this.filename())+"$");return e=i.recodePath(e),this._parts.path=this._parts.path.replace(o,e),s?this.normalizePath(t):this.build(!t),this},o.suffix=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path)return"";var n,r,s=this.filename(),o=s.lastIndexOf(".");return-1===o?"":(n=s.substring(o+1),r=/^[a-z0-9%]+$/i.test(n)?n:"",e?i.decodePathSegment(r):r)}"."===e.charAt(0)&&(e=e.substring(1));var a,u=this.suffix();if(u)a=e?new RegExp(c(u)+"$"):new RegExp(c("."+u)+"$");else{if(!e)return this;this._parts.path+="."+i.recodePath(e)}return a&&(e=i.recodePath(e),this._parts.path=this._parts.path.replace(a,e)),this.build(!t),this},o.segment=function(e,t,n){var r=this._parts.urn?":":"/",s=this.path(),i="/"===s.substring(0,1),o=s.split(r);if(void 0!==e&&"number"!=typeof e&&(n=t,t=e,e=void 0),void 0!==e&&"number"!=typeof e)throw new Error('Bad segment "'+e+'", must be 0-based integer');if(i&&o.shift(),e<0&&(e=Math.max(o.length+e,0)),void 0===t)return void 0===e?o:o[e];if(null===e||void 0===o[e])if(d(t)){o=[];for(var a=0,c=t.length;a<c;a++)(t[a].length||o.length&&o[o.length-1].length)&&(o.length&&!o[o.length-1].length&&o.pop(),o.push(g(t[a])))}else(t||"string"==typeof t)&&(t=g(t),""===o[o.length-1]?o[o.length-1]=t:o.push(t));else t?o[e]=g(t):o.splice(e,1);return i&&o.unshift(""),this.path(o.join(r),n)},o.segmentCoded=function(e,t,n){var r,s,o;if("number"!=typeof e&&(n=t,t=e,e=void 0),void 0===t){if(d(r=this.segment(e,t,n)))for(s=0,o=r.length;s<o;s++)r[s]=i.decode(r[s]);else r=void 0!==r?i.decode(r):void 0;return r}if(d(t))for(s=0,o=t.length;s<o;s++)t[s]=i.encode(t[s]);else t="string"==typeof t||t instanceof String?i.encode(t):t;return this.segment(e,t,n)};var j=o.query;return o.query=function(e,t){if(!0===e)return i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof e){var n=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace),r=e.call(this,n);return this._parts.query=i.buildQuery(r||n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return void 0!==e&&"string"!=typeof e?(this._parts.query=i.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):j.call(this,e,t)},o.setQuery=function(e,t,n){var r=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof e||e instanceof String)r[e]=void 0!==t?t:null;else{if("object"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var s in e)a.call(e,s)&&(r[s]=e[s])}return this._parts.query=i.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},o.addQuery=function(e,t,n){var r=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return i.addQuery(r,e,void 0===t?null:t),this._parts.query=i.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},o.removeQuery=function(e,t,n){var r=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return i.removeQuery(r,e,t),this._parts.query=i.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},o.hasQuery=function(e,t,n){var r=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return i.hasQuery(r,e,t,n)},o.setSearch=o.setQuery,o.addSearch=o.addQuery,o.removeSearch=o.removeQuery,o.hasSearch=o.hasQuery,o.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},o.normalizeProtocol=function(e){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},o.normalizeHostname=function(n){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!n)),this},o.normalizePort=function(e){return"string"==typeof this._parts.protocol&&this._parts.port===i.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},o.normalizePath=function(e){var t,n=this._parts.path;if(!n)return this;if(this._parts.urn)return this._parts.path=i.recodeUrnPath(this._parts.path),this.build(!e),this;if("/"===this._parts.path)return this;var r,s,o="";for("/"!==(n=i.recodePath(n)).charAt(0)&&(t=!0,n="/"+n),"/.."!==n.slice(-3)&&"/."!==n.slice(-2)||(n+="/"),n=n.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),t&&(o=n.substring(1).match(/^(\.\.\/)+/)||"")&&(o=o[0]);-1!==(r=n.search(/\/\.\.(\/|$)/));)0!==r?(-1===(s=n.substring(0,r).lastIndexOf("/"))&&(s=r),n=n.substring(0,s)+n.substring(r+3)):n=n.substring(3);return t&&this.is("relative")&&(n=o+n.substring(1)),this._parts.path=n,this.build(!e),this},o.normalizePathname=o.normalizePath,o.normalizeQuery=function(e){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(i.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},o.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},o.normalizeSearch=o.normalizeQuery,o.normalizeHash=o.normalizeFragment,o.iso8859=function(){var e=i.encode,t=i.decode;i.encode=escape,i.decode=decodeURIComponent;try{this.normalize()}finally{i.encode=e,i.decode=t}return this},o.unicode=function(){var e=i.encode,t=i.decode;i.encode=m,i.decode=unescape;try{this.normalize()}finally{i.encode=e,i.decode=t}return this},o.readable=function(){var t=this.clone();t.username("").password("").normalize();var n="";if(t._parts.protocol&&(n+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(n+=e.toUnicode(t._parts.hostname),t._parts.port&&(n+=":"+t._parts.port)):n+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(n+="/"),n+=t.path(!0),t._parts.query){for(var r="",s=0,o=t._parts.query.split("&"),a=o.length;s<a;s++){var c=(o[s]||"").split("=");r+="&"+i.decodeQuery(c[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==c[1]&&(r+="="+i.decodeQuery(c[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}n+="?"+r.substring(1)}return n+=i.decodeQuery(t.hash(),!0)},o.absoluteTo=function(e){var t,n,r,s=this.clone(),o=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e instanceof i||(e=new i(e)),s._parts.protocol)return s;if(s._parts.protocol=e._parts.protocol,this._parts.hostname)return s;for(n=0;r=o[n];n++)s._parts[r]=e._parts[r];return s._parts.path?(".."===s._parts.path.substring(-2)&&(s._parts.path+="/"),"/"!==s.path().charAt(0)&&(t=(t=e.directory())||(0===e.path().indexOf("/")?"/":""),s._parts.path=(t?t+"/":"")+s._parts.path,s.normalizePath())):(s._parts.path=e._parts.path,s._parts.query||(s._parts.query=e._parts.query)),s.build(),s},o.relativeTo=function(e){var t,n,r,s,o,a=this.clone().normalize();if(a._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e=new i(e).normalize(),t=a._parts,n=e._parts,s=a.path(),o=e.path(),"/"!==s.charAt(0))throw new Error("URI is already relative");if("/"!==o.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(t.protocol===n.protocol&&(t.protocol=null),t.username!==n.username||t.password!==n.password)return a.build();if(null!==t.protocol||null!==t.username||null!==t.password)return a.build();if(t.hostname!==n.hostname||t.port!==n.port)return a.build();if(t.hostname=null,t.port=null,s===o)return t.path="",a.build();if(!(r=i.commonPath(s,o)))return a.build();var c=n.path.substring(r.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return t.path=c+t.path.substring(r.length)||"./",a.build()},o.equals=function(e){var t,n,r,s,o,c=this.clone(),u=new i(e),l={};if(c.normalize(),u.normalize(),c.toString()===u.toString())return!0;if(r=c.query(),s=u.query(),c.query(""),u.query(""),c.toString()!==u.toString())return!1;if(r.length!==s.length)return!1;for(o in t=i.parseQuery(r,this._parts.escapeQuerySpace),n=i.parseQuery(s,this._parts.escapeQuerySpace),t)if(a.call(t,o)){if(d(t[o])){if(!f(t[o],n[o]))return!1}else if(t[o]!==n[o])return!1;l[o]=!0}for(o in n)if(a.call(n,o)&&!l[o])return!1;return!0},o.preventInvalidHostname=function(e){return this._parts.preventInvalidHostname=!!e,this},o.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},o.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},i}))},7562:function(e,t,n){var r;e=n.nmd(e),function(s){t&&t.nodeType,e&&e.nodeType;var i="object"==typeof n.g&&n.g;i.global!==i&&i.window!==i&&i.self;var o,a=2147483647,c=36,u=1,d=26,l=38,h=700,f=72,g=128,p="-",m=/^xn--/,v=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=c-u,w=Math.floor,S=String.fromCharCode;function E(e){throw new RangeError(y[e])}function A(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function x(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+A((e=e.replace(_,".")).split("."),t).join(".")}function j(e){for(var t,n,r=[],s=0,i=e.length;s<i;)(t=e.charCodeAt(s++))>=55296&&t<=56319&&s<i?56320==(64512&(n=e.charCodeAt(s++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),s--):r.push(t);return r}function C(e){return A(e,(function(e){var t="";return e>65535&&(t+=S((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=S(e)})).join("")}function I(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function N(e,t,n){var r=0;for(e=n?w(e/h):e>>1,e+=w(e/t);e>b*d>>1;r+=c)e=w(e/b);return w(r+(b+1)*e/(e+l))}function O(e){var t,n,r,s,i,o,l,h,m,v,_,y=[],b=e.length,S=0,A=g,x=f;for((n=e.lastIndexOf(p))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&E("not-basic"),y.push(e.charCodeAt(r));for(s=n>0?n+1:0;s<b;){for(i=S,o=1,l=c;s>=b&&E("invalid-input"),((h=(_=e.charCodeAt(s++))-48<10?_-22:_-65<26?_-65:_-97<26?_-97:c)>=c||h>w((a-S)/o))&&E("overflow"),S+=h*o,!(h<(m=l<=x?u:l>=x+d?d:l-x));l+=c)o>w(a/(v=c-m))&&E("overflow"),o*=v;x=N(S-i,t=y.length+1,0==i),w(S/t)>a-A&&E("overflow"),A+=w(S/t),S%=t,y.splice(S++,0,A)}return C(y)}function k(e){var t,n,r,s,i,o,l,h,m,v,_,y,b,A,x,C=[];for(y=(e=j(e)).length,t=g,n=0,i=f,o=0;o<y;++o)(_=e[o])<128&&C.push(S(_));for(r=s=C.length,s&&C.push(p);r<y;){for(l=a,o=0;o<y;++o)(_=e[o])>=t&&_<l&&(l=_);for(l-t>w((a-n)/(b=r+1))&&E("overflow"),n+=(l-t)*b,t=l,o=0;o<y;++o)if((_=e[o])<t&&++n>a&&E("overflow"),_==t){for(h=n,m=c;!(h<(v=m<=i?u:m>=i+d?d:m-i));m+=c)x=h-v,A=c-v,C.push(S(I(v+x%A,0))),h=w(x/A);C.push(S(I(h,0))),i=N(n,b,r==s),n=0,++r}++n,++t}return C.join("")}o={version:"1.3.2",ucs2:{decode:j,encode:C},decode:O,encode:k,toASCII:function(e){return x(e,(function(e){return v.test(e)?"xn--"+k(e):e}))},toUnicode:function(e){return x(e,(function(e){return m.test(e)?O(e.slice(4).toLowerCase()):e}))}},void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r)}()},7484:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,n=36e5,r="millisecond",s="second",i="minute",o="hour",a="day",c="week",u="month",d="quarter",l="year",h="date",f="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,m={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},v=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},_={s:v,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),s=n%60;return(t<=0?"+":"-")+v(r,2,"0")+":"+v(s,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),s=t.clone().add(r,u),i=n-s<0,o=t.clone().add(r+(i?-1:1),u);return+(-(r+(n-s)/(i?s-o:o-s))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:u,y:l,w:c,d:a,D:h,h:o,m:i,s,ms:r,Q:d}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},y="en",b={};b[y]=m;var w="$isDayjsObject",S=function(e){return e instanceof j||!(!e||!e[w])},E=function e(t,n,r){var s;if(!t)return y;if("string"==typeof t){var i=t.toLowerCase();b[i]&&(s=i),n&&(b[i]=n,s=i);var o=t.split("-");if(!s&&o.length>1)return e(o[0])}else{var a=t.name;b[a]=t,s=a}return!r&&s&&(y=s),s||!r&&y},A=function(e,t){if(S(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new j(n)},x=_;x.l=E,x.i=S,x.w=function(e,t){return A(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var j=function(){function m(e){this.$L=E(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[w]=!0}var v=m.prototype;return v.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(x.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(g);if(r){var s=r[2]-1||0,i=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],s,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)):new Date(r[1],s,r[3]||1,r[4]||0,r[5]||0,r[6]||0,i)}}return new Date(t)}(e),this.init()},v.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},v.$utils=function(){return x},v.isValid=function(){return!(this.$d.toString()===f)},v.isSame=function(e,t){var n=A(e);return this.startOf(t)<=n&&n<=this.endOf(t)},v.isAfter=function(e,t){return A(e)<this.startOf(t)},v.isBefore=function(e,t){return this.endOf(t)<A(e)},v.$g=function(e,t,n){return x.u(e)?this[t]:this.set(n,e)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(e,t){var n=this,r=!!x.u(t)||t,d=x.p(e),f=function(e,t){var s=x.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return r?s:s.endOf(a)},g=function(e,t){return x.w(n.toDate()[e].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},p=this.$W,m=this.$M,v=this.$D,_="set"+(this.$u?"UTC":"");switch(d){case l:return r?f(1,0):f(31,11);case u:return r?f(1,m):f(0,m+1);case c:var y=this.$locale().weekStart||0,b=(p<y?p+7:p)-y;return f(r?v-b:v+(6-b),m);case a:case h:return g(_+"Hours",0);case o:return g(_+"Minutes",1);case i:return g(_+"Seconds",2);case s:return g(_+"Milliseconds",3);default:return this.clone()}},v.endOf=function(e){return this.startOf(e,!1)},v.$set=function(e,t){var n,c=x.p(e),d="set"+(this.$u?"UTC":""),f=(n={},n[a]=d+"Date",n[h]=d+"Date",n[u]=d+"Month",n[l]=d+"FullYear",n[o]=d+"Hours",n[i]=d+"Minutes",n[s]=d+"Seconds",n[r]=d+"Milliseconds",n)[c],g=c===a?this.$D+(t-this.$W):t;if(c===u||c===l){var p=this.clone().set(h,1);p.$d[f](g),p.init(),this.$d=p.set(h,Math.min(this.$D,p.daysInMonth())).$d}else f&&this.$d[f](g);return this.init(),this},v.set=function(e,t){return this.clone().$set(e,t)},v.get=function(e){return this[x.p(e)]()},v.add=function(r,d){var h,f=this;r=Number(r);var g=x.p(d),p=function(e){var t=A(f);return x.w(t.date(t.date()+Math.round(e*r)),f)};if(g===u)return this.set(u,this.$M+r);if(g===l)return this.set(l,this.$y+r);if(g===a)return p(1);if(g===c)return p(7);var m=(h={},h[i]=t,h[o]=n,h[s]=e,h)[g]||1,v=this.$d.getTime()+r*m;return x.w(v,this)},v.subtract=function(e,t){return this.add(-1*e,t)},v.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||f;var r=e||"YYYY-MM-DDTHH:mm:ssZ",s=x.z(this),i=this.$H,o=this.$m,a=this.$M,c=n.weekdays,u=n.months,d=n.meridiem,l=function(e,n,s,i){return e&&(e[n]||e(t,r))||s[n].slice(0,i)},h=function(e){return x.s(i%12||12,e,"0")},g=d||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(p,(function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return x.s(t.$y,4,"0");case"M":return a+1;case"MM":return x.s(a+1,2,"0");case"MMM":return l(n.monthsShort,a,u,3);case"MMMM":return l(u,a);case"D":return t.$D;case"DD":return x.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return l(n.weekdaysMin,t.$W,c,2);case"ddd":return l(n.weekdaysShort,t.$W,c,3);case"dddd":return c[t.$W];case"H":return String(i);case"HH":return x.s(i,2,"0");case"h":return h(1);case"hh":return h(2);case"a":return g(i,o,!0);case"A":return g(i,o,!1);case"m":return String(o);case"mm":return x.s(o,2,"0");case"s":return String(t.$s);case"ss":return x.s(t.$s,2,"0");case"SSS":return x.s(t.$ms,3,"0");case"Z":return s}return null}(e)||s.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(r,h,f){var g,p=this,m=x.p(h),v=A(r),_=(v.utcOffset()-this.utcOffset())*t,y=this-v,b=function(){return x.m(p,v)};switch(m){case l:g=b()/12;break;case u:g=b();break;case d:g=b()/3;break;case c:g=(y-_)/6048e5;break;case a:g=(y-_)/864e5;break;case o:g=y/n;break;case i:g=y/t;break;case s:g=y/e;break;default:g=y}return f?g:x.a(g)},v.daysInMonth=function(){return this.endOf(u).$D},v.$locale=function(){return b[this.$L]},v.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=E(e,t,!0);return r&&(n.$L=r),n},v.clone=function(){return x.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},m}(),C=j.prototype;return A.prototype=C,[["$ms",r],["$s",s],["$m",i],["$H",o],["$W",a],["$M",u],["$y",l],["$D",h]].forEach((function(e){C[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),A.extend=function(e,t){return e.$i||(e(t,j,A),e.$i=!0),A},A.locale=E,A.isDayjs=S,A.unix=function(e){return A(1e3*e)},A.en=b[y],A.Ls=b,A.p={},A}()},9434:(e,t,n)=>{var r={"./af.js":[5903,9210],"./am.js":[9911,5073],"./ar-dz.js":[7200,9406],"./ar-iq.js":[7719,2990],"./ar-kw.js":[2376,9897],"./ar-ly.js":[8540,3521],"./ar-ma.js":[6817,5313],"./ar-sa.js":[1573,485],"./ar-tn.js":[9339,8040],"./ar.js":[3939,6755],"./az.js":[8092,4963],"./be.js":[504,9478],"./bg.js":[9091,578],"./bi.js":[9149,2984],"./bm.js":[5287,2263],"./bn-bd.js":[4067,1351],"./bn.js":[5254,280],"./bo.js":[2502,9950],"./br.js":[8864,760],"./bs.js":[4502,9833],"./ca.js":[3646,102],"./cs.js":[8507,7400],"./cv.js":[6636,4481],"./cy.js":[8792,6740],"./da.js":[7427,2548],"./de-at.js":[3237,7175],"./de-ch.js":[6148,1679],"./de.js":[790,52],"./dv.js":[1794,5569],"./el.js":[5423,1606],"./en-au.js":[5109,5485],"./en-ca.js":[5105,4035],"./en-gb.js":[9517,6031],"./en-ie.js":[758,8129],"./en-il.js":[5805,3463],"./en-in.js":[8529,6898],"./en-nz.js":[302,8547],"./en-sg.js":[5941,1735],"./en-tt.js":[6183,6105],"./en.js":[5054,535],"./eo.js":[4990,5121],"./es-do.js":[3864,8758],"./es-mx.js":[7118,7416],"./es-pr.js":[3521,911],"./es-us.js":[6165,3208],"./es.js":[7763,3411],"./et.js":[9670,4153],"./eu.js":[6629,1396],"./fa.js":[6953,5544],"./fi.js":[7822,2130],"./fo.js":[9197,8745],"./fr-ca.js":[7989,7363],"./fr-ch.js":[4254,7952],"./fr.js":[6023,1910],"./fy.js":[3220,6376],"./ga.js":[7467,688],"./gd.js":[4855,5050],"./gl.js":[229,5818],"./gom-latn.js":[6312,825],"./gu.js":[7632,3623],"./he.js":[5418,9372],"./hi.js":[7573,8010],"./hr.js":[6257,7419],"./ht.js":[8889,5822],"./hu.js":[8562,8214],"./hy-am.js":[8242,5407],"./id.js":[3783,9513],"./is.js":[8980,1194],"./it-ch.js":[3706,6010],"./it.js":[5551,1880],"./ja.js":[6831,1107],"./jv.js":[2641,4305],"./ka.js":[6622,5186],"./kk.js":[2921,5206],"./km.js":[5567,2475],"./kn.js":[1113,7523],"./ko.js":[9132,3446],"./ku.js":[4888,7024],"./ky.js":[466,5055],"./lb.js":[1796,5215],"./lo.js":[8894,1204],"./lt.js":[8768,7899],"./lv.js":[953,631],"./me.js":[8066,145],"./mi.js":[8602,7454],"./mk.js":[1560,4951],"./ml.js":[4017,7679],"./mn.js":[4717,8618],"./mr.js":[5473,5600],"./ms-my.js":[7387,882],"./ms.js":[5742,9095],"./mt.js":[8477,9665],"./my.js":[2966,5166],"./nb.js":[9682,646],"./ne.js":[4149,9030],"./nl-be.js":[7496,3155],"./nl.js":[9182,1520],"./nn.js":[2722,7050],"./oc-lnc.js":[6159,7203],"./pa-in.js":[5914,5850],"./pl.js":[1987,1211],"./pt-br.js":[7548,5274],"./pt.js":[5001,265],"./rn.js":[123,4678],"./ro.js":[8146,8022],"./ru.js":[600,559],"./rw.js":[6509,3221],"./sd.js":[5437,1298],"./se.js":[772,1942],"./si.js":[7109,9333],"./sk.js":[5627,6783],"./sl.js":[2544,9625],"./sq.js":[8341,8603],"./sr-cyrl.js":[7101,3435],"./sr.js":[617,7390],"./ss.js":[4127,9238],"./sv-fi.js":[6421,9997],"./sv.js":[1876,9652],"./sw.js":[2030,9733],"./ta.js":[5596,7645],"./te.js":[5159,7714],"./tet.js":[9157,555],"./tg.js":[9928,2446],"./th.js":[2019,1729],"./tk.js":[5817,5256],"./tl-ph.js":[6513,9443],"./tlh.js":[7296,2814],"./tr.js":[3035,8665],"./tzl.js":[7797,2843],"./tzm-latn.js":[261,3933],"./tzm.js":[4722,4342],"./ug-cn.js":[313,6890],"./uk.js":[4144,1619],"./ur.js":[2957,9568],"./uz-latn.js":[8727,1110],"./uz.js":[7486,3153],"./vi.js":[7553,8073],"./x-pseudo.js":[5321,4423],"./yo.js":[4724,8692],"./zh-cn.js":[3852,9630],"./zh-hk.js":[2390,3755],"./zh-tw.js":[3901,6776],"./zh.js":[2009,8458]};function s(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],s=t[0];return n.e(t[1]).then((()=>n.t(s,23)))}s.keys=()=>Object.keys(r),s.id=9434,e.exports=s},8734:function(e){e.exports=function(){"use strict";return function(e,t){var n=t.prototype,r=n.format;n.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return r.bind(this)(e);var s=this.$utils(),i=(e||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,(function(e){switch(e){case"Q":return Math.ceil((t.$M+1)/3);case"Do":return n.ordinal(t.$D);case"gggg":return t.weekYear();case"GGGG":return t.isoWeekYear();case"wo":return n.ordinal(t.week(),"W");case"w":case"ww":return s.s(t.week(),"w"===e?1:2,"0");case"W":case"WW":return s.s(t.isoWeek(),"W"===e?1:2,"0");case"k":case"kk":return s.s(String(0===t.$H?24:t.$H),"k"===e?1:2,"0");case"X":return Math.floor(t.$d.getTime()/1e3);case"x":return t.$d.getTime();case"z":return"["+t.offsetName()+"]";case"zzz":return"["+t.offsetName("long")+"]";default:return e}}));return r.bind(this)(i)}}}()},5705:(e,t,n)=>{"use strict";var r,s,i=n.g.MutationObserver||n.g.WebKitMutationObserver;if(i){var o=0,a=new i(l),c=n.g.document.createTextNode("");a.observe(c,{characterData:!0}),r=function(){c.data=o=++o%2}}else if(n.g.setImmediate||void 0===n.g.MessageChannel)r="document"in n.g&&"onreadystatechange"in n.g.document.createElement("script")?function(){var e=n.g.document.createElement("script");e.onreadystatechange=function(){l(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},n.g.document.documentElement.appendChild(e)}:function(){setTimeout(l,0)};else{var u=new n.g.MessageChannel;u.port1.onmessage=l,r=function(){u.port2.postMessage(0)}}var d=[];function l(){var e,t;s=!0;for(var n=d.length;n;){for(t=d,d=[],e=-1;++e<n;)t[e]();n=d.length}s=!1}e.exports=function(e){1!==d.push(e)||s||r()}},2353:function(e,t){!function(n,r){var s=Array.prototype,i=Object.prototype,o=s.slice,a=i.hasOwnProperty,c=s.forEach,u={},d={forEach:function(e,t,n){var r,s,i;if(null!==e)if(c&&e.forEach===c)e.forEach(t,n);else if(e.length===+e.length){for(r=0,s=e.length;r<s;r++)if(r in e&&t.call(n,e[r],r,e)===u)return}else for(i in e)if(a.call(e,i)&&t.call(n,e[i],i,e)===u)return},extend:function(e){return this.forEach(o.call(arguments,1),(function(t){for(var n in t)e[n]=t[n]})),e}},l=function(e){if(this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages",debug:!1},this.options=d.extend({},this.defaults,e),this.textdomain(this.options.domain),e.domain&&!this.options.locale_data[this.options.domain])throw new Error("Text domain set to non-existent domain: `"+e.domain+"`")};function h(e){return l.PF.compile(e||"nplurals=2; plural=(n != 1);")}function f(e,t){this._key=e,this._i18n=t}l.context_delimiter=String.fromCharCode(4),d.extend(f.prototype,{onDomain:function(e){return this._domain=e,this},withContext:function(e){return this._context=e,this},ifPlural:function(e,t){return this._val=e,this._pkey=t,this},fetch:function(e){return"[object Array]"!={}.toString.call(e)&&(e=[].slice.call(arguments,0)),(e&&e.length?l.sprintf:function(e){return e})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),e)}}),d.extend(l.prototype,{translate:function(e){return new f(e,this)},textdomain:function(e){if(!e)return this._textdomain;this._textdomain=e},gettext:function(e){return this.dcnpgettext.call(this,r,r,e)},dgettext:function(e,t){return this.dcnpgettext.call(this,e,r,t)},dcgettext:function(e,t){return this.dcnpgettext.call(this,e,r,t)},ngettext:function(e,t,n){return this.dcnpgettext.call(this,r,r,e,t,n)},dngettext:function(e,t,n,s){return this.dcnpgettext.call(this,e,r,t,n,s)},dcngettext:function(e,t,n,s){return this.dcnpgettext.call(this,e,r,t,n,s)},pgettext:function(e,t){return this.dcnpgettext.call(this,r,e,t)},dpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},dcpgettext:function(e,t,n){return this.dcnpgettext.call(this,e,t,n)},npgettext:function(e,t,n,s){return this.dcnpgettext.call(this,r,e,t,n,s)},dnpgettext:function(e,t,n,r,s){return this.dcnpgettext.call(this,e,t,n,r,s)},dcnpgettext:function(e,t,n,r,s){var i;if(r=r||n,e=e||this._textdomain,!this.options)return(i=new l).dcnpgettext.call(i,void 0,void 0,n,r,s);if(!this.options.locale_data)throw new Error("No locale data provided.");if(!this.options.locale_data[e])throw new Error("Domain `"+e+"` was not found.");if(!this.options.locale_data[e][""])throw new Error("No locale meta information provided.");if(!n)throw new Error("No translation key found.");var o,a,c,u=t?t+l.context_delimiter+n:n,d=this.options.locale_data,f=d[e],g=(d.messages||this.defaults.locale_data.messages)[""],p=f[""].plural_forms||f[""]["Plural-Forms"]||f[""]["plural-forms"]||g.plural_forms||g["Plural-Forms"]||g["plural-forms"];if(void 0===s)c=0;else{if("number"!=typeof s&&(s=parseInt(s,10),isNaN(s)))throw new Error("The number that was passed in is not a number.");c=h(p)(s)}if(!f)throw new Error("No domain named `"+e+"` could be found.");return!(o=f[u])||c>o.length?(this.options.missing_key_callback&&this.options.missing_key_callback(u,e),a=[n,r],!0===this.options.debug&&console.log(a[h(p)(s)]),a[h()(s)]):(a=o[c])||(a=[n,r])[h()(s)]}});var g,p,m=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.format=function(n,r){var s,i,o,a,c,u,d,l=1,h=n.length,f="",g=[];for(i=0;i<h;i++)if("string"===(f=e(n[i])))g.push(n[i]);else if("array"===f){if((a=n[i])[2])for(s=r[l],o=0;o<a[2].length;o++){if(!s.hasOwnProperty(a[2][o]))throw m('[sprintf] property "%s" does not exist',a[2][o]);s=s[a[2][o]]}else s=a[1]?r[a[1]]:r[l++];if(/[^s]/.test(a[8])&&"number"!=e(s))throw m("[sprintf] expecting number but found %s",e(s));switch(null==s&&(s=""),a[8]){case"b":s=s.toString(2);break;case"c":s=String.fromCharCode(s);break;case"d":s=parseInt(s,10);break;case"e":s=a[7]?s.toExponential(a[7]):s.toExponential();break;case"f":s=a[7]?parseFloat(s).toFixed(a[7]):parseFloat(s);break;case"o":s=s.toString(8);break;case"s":s=(s=String(s))&&a[7]?s.substring(0,a[7]):s;break;case"u":s=Math.abs(s);break;case"x":s=s.toString(16);break;case"X":s=s.toString(16).toUpperCase()}s=/[def]/.test(a[8])&&a[3]&&s>=0?"+"+s:s,u=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",d=a[6]-String(s).length,c=a[6]?t(u,d):"",g.push(a[5]?s+c:c+s)}return g.join("")},n.cache={},n.parse=function(e){for(var t=e,n=[],r=[],s=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))r.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))r.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(n[2]){s|=1;var i=[],o=n[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(o)))throw"[sprintf] huh?";for(i.push(a[1]);""!==(o=o.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(o)))i.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(o)))throw"[sprintf] huh?";i.push(a[1])}n[2]=i}else s|=2;if(3===s)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";r.push(n)}t=t.substring(n[0].length)}return r},n}();l.parse_plural=function(e,t){return e=e.replace(/n/g,t),l.parse_expression(e)},l.sprintf=function(e,t){return"[object Array]"=={}.toString.call(t)?function(e,t){return t.unshift(e),m.apply(null,t)}(e,[].slice.call(t)):m.apply(this,[].slice.call(arguments))},l.prototype.sprintf=function(){return l.sprintf.apply(this,arguments)},(l.PF={}).parse=function(e){var t=l.PF.extractPluralExpr(e);return l.PF.parser.parse.call(l.PF.parser,t)},l.PF.compile=function(e){var t=l.PF.parse(e);return function(e){return!0===(n=l.PF.interpreter(t)(e))?1:n||0;var n}},l.PF.interpreter=function(e){return function(t){switch(e.type){case"GROUP":return l.PF.interpreter(e.expr)(t);case"TERNARY":return l.PF.interpreter(e.expr)(t)?l.PF.interpreter(e.truthy)(t):l.PF.interpreter(e.falsey)(t);case"OR":return l.PF.interpreter(e.left)(t)||l.PF.interpreter(e.right)(t);case"AND":return l.PF.interpreter(e.left)(t)&&l.PF.interpreter(e.right)(t);case"LT":return l.PF.interpreter(e.left)(t)<l.PF.interpreter(e.right)(t);case"GT":return l.PF.interpreter(e.left)(t)>l.PF.interpreter(e.right)(t);case"LTE":return l.PF.interpreter(e.left)(t)<=l.PF.interpreter(e.right)(t);case"GTE":return l.PF.interpreter(e.left)(t)>=l.PF.interpreter(e.right)(t);case"EQ":return l.PF.interpreter(e.left)(t)==l.PF.interpreter(e.right)(t);case"NEQ":return l.PF.interpreter(e.left)(t)!=l.PF.interpreter(e.right)(t);case"MOD":return l.PF.interpreter(e.left)(t)%l.PF.interpreter(e.right)(t);case"VAR":return t;case"NUM":return e.val;default:throw new Error("Invalid Token found.")}}},l.PF.extractPluralExpr=function(e){e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(e)||(e=e.concat(";"));var t,n=/nplurals\=(\d+);/,r=e.match(n);if(!(r.length>1))throw new Error("nplurals not found in plural_forms string: "+e);if(r[1],!((t=(e=e.replace(n,"")).match(/plural\=(.*);/))&&t.length>1))throw new Error("`plural` expression not found: "+e);return t[1]},l.PF.parser=(g={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(e,t,n,r,s,i,o){var a=i.length-1;switch(s){case 1:return{type:"GROUP",expr:i[a-1]};case 2:this.$={type:"TERNARY",expr:i[a-4],truthy:i[a-2],falsey:i[a]};break;case 3:this.$={type:"OR",left:i[a-2],right:i[a]};break;case 4:this.$={type:"AND",left:i[a-2],right:i[a]};break;case 5:this.$={type:"LT",left:i[a-2],right:i[a]};break;case 6:this.$={type:"LTE",left:i[a-2],right:i[a]};break;case 7:this.$={type:"GT",left:i[a-2],right:i[a]};break;case 8:this.$={type:"GTE",left:i[a-2],right:i[a]};break;case 9:this.$={type:"NEQ",left:i[a-2],right:i[a]};break;case 10:this.$={type:"EQ",left:i[a-2],right:i[a]};break;case 11:this.$={type:"MOD",left:i[a-2],right:i[a]};break;case 12:this.$={type:"GROUP",expr:i[a-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(e)}}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,n=[0],r=[null],s=[],i=this.table,o="",a=0,c=0,u=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var d=this.lexer.yylloc;function l(){var e;return"number"!=typeof(e=t.lexer.lex()||1)&&(e=t.symbols_[e]||e),e}s.push(d),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,f,g,p,m,v,_,y,b,w,S={};;){if(g=n[n.length-1],this.defaultActions[g]?p=this.defaultActions[g]:(null==h&&(h=l()),p=i[g]&&i[g][h]),void 0===p||!p.length||!p[0]){if(!u){for(v in b=[],i[g])this.terminals_[v]&&v>2&&b.push("'"+this.terminals_[v]+"'");var E="";E=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+b.join(", ")+", got '"+this.terminals_[h]+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(E,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:d,expected:b})}if(3==u){if(1==h)throw new Error(E||"Parsing halted.");c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,d=this.lexer.yylloc,h=l()}for(;!(2..toString()in i[g]);){if(0==g)throw new Error(E||"Parsing halted.");w=1,n.length=n.length-2*w,r.length=r.length-w,s.length=s.length-w,g=n[n.length-1]}f=h,h=2,p=i[g=n[n.length-1]]&&i[g][2],u=3}if(p[0]instanceof Array&&p.length>1)throw new Error("Parse Error: multiple actions possible at state: "+g+", token: "+h);switch(p[0]){case 1:n.push(h),r.push(this.lexer.yytext),s.push(this.lexer.yylloc),n.push(p[1]),h=null,f?(h=f,f=null):(c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,d=this.lexer.yylloc,u>0&&u--);break;case 2:if(_=this.productions_[p[1]][1],S.$=r[r.length-_],S._$={first_line:s[s.length-(_||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(_||1)].first_column,last_column:s[s.length-1].last_column},void 0!==(m=this.performAction.call(S,o,c,a,this.yy,p[1],r,s)))return m;_&&(n=n.slice(0,-1*_*2),r=r.slice(0,-1*_),s=s.slice(0,-1*_)),n.push(this.productions_[p[1]][0]),r.push(S.$),s.push(S._$),y=i[n[n.length-2]][n[n.length-1]],n.push(y);break;case 3:return!0}}return!0}},p=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parseError)throw new Error(e);this.yy.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.match+=e,this.matched+=e,e.match(/\n/)&&this.yylineno++,this._input=this._input.slice(1),e},unput:function(e){return this._input=e+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),r=0;r<n.length;r++)if(e=this._input.match(this.rules[n[r]]))return(t=e[0].match(/\n.*/g))&&(this.yylineno+=t.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:t?t[t.length-1].length-1:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],this.performAction.call(this,this.yy,this,n[r],this.conditionStack[this.conditionStack.length-1])||void 0;if(""===this._input)return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},performAction:function(e,t,n,r){switch(n){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return"INVALID"}},rules:[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}}};return e}(),g.lexer=p,g),e.exports&&(t=e.exports=l),t.Jed=l}()},3389:(e,t,n)=>{"use strict";var r=n(5705);function s(){}var i={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==s&&f(this,e)}function d(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function l(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return i.reject(e,t)}r===e?i.reject(e,new TypeError("Cannot resolve promise with itself")):i.resolve(e,r)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,i.reject(e,t))}function s(t){n||(n=!0,i.resolve(e,t))}var o=g((function(){t(s,r)}));"error"===o.status&&r(o.value)}function g(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}e.exports=u,u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(s);this.state!==c?l(n,this.state===a?e:t,this.outcome):this.queue.push(new d(n,e,t));return n},d.prototype.callFulfilled=function(e){i.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){l(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){i.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){l(this.promise,this.onRejected,e)},i.resolve=function(e,t){var n=g(h,t);if("error"===n.status)return i.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=a,e.outcome=t;for(var s=-1,o=e.queue.length;++s<o;)e.queue[s].callFulfilled(t)}return e},i.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},u.resolve=function(e){if(e instanceof this)return e;return i.resolve(new this(s),e)},u.reject=function(e){var t=new this(s);return i.reject(t,e)},u.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var o=new Array(n),a=0,c=-1,u=new this(s);for(;++c<n;)d(e[c],c);return u;function d(e,s){t.resolve(e).then((function(e){o[s]=e,++a!==n||r||(r=!0,i.resolve(u,o))}),(function(e){r||(r=!0,i.reject(u,e))}))}},u.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var o=-1,a=new this(s);for(;++o<n;)c=e[o],t.resolve(c).then((function(e){r||(r=!0,i.resolve(a,e))}),(function(e){r||(r=!0,i.reject(a,e))}));var c;return a}},9236:(e,t,n)=>{"use strict";"function"!=typeof n.g.Promise&&(n.g.Promise=n(3389))},3245:function(e,t){"undefined"!=typeof self&&self,function(e){"use strict";var t="localforage-driver-memory";function n(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function r(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(s){if("TypeError"!==s.name)throw s;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}var s=/^~~local_forage_type~([^~]+)~/,i=9,o=i+4,a=Object.prototype.toString;function c(e){var t=.75*e.length,n=e.length;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);for(var r=new ArrayBuffer(t),s=new Uint8Array(r),i=0,o=0;i<n;i+=4){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[i]),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[i+1]),u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[i+2]),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[i+3]);s[o++]=a<<2|c>>4,s[o++]=(15&c)<<4|u>>2,s[o++]=(3&u)<<6|63&d}return r}function u(e){for(var t=new Uint8Array(e),n="",r=0;r<t.length;r+=3)n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t[r]>>2],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&t[r])<<4|t[r+1]>>4],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&t[r+1])<<2|t[r+2]>>6],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t[r+2]];return t.length%3==2?n=n.substring(0,n.length-1)+"=":t.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function d(e,t){var n="";if(e&&(n=a.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===a.call(e.buffer))){var r=void 0,s="__lfsc__:";e instanceof ArrayBuffer?(r=e,s+="arbf"):(r=e.buffer,"[object Int8Array]"===n?s+="si08":"[object Uint8Array]"===n?s+="ui08":"[object Uint8ClampedArray]"===n?s+="uic8":"[object Int16Array]"===n?s+="si16":"[object Uint16Array]"===n?s+="ur16":"[object Int32Array]"===n?s+="si32":"[object Uint32Array]"===n?s+="ui32":"[object Float32Array]"===n?s+="fl32":"[object Float64Array]"===n?s+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(s+u(r))}else if("[object Blob]"===n){var i=new FileReader;i.onload=function(){var n="~~local_forage_type~"+e.type+"~"+u(this.result);t("__lfsc__:blob"+n)},i.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function l(e){if("__lfsc__:"!==e.substring(0,i))return JSON.parse(e);var t,n=e.substring(o),a=e.substring(i,o);if("blob"===a&&s.test(n)){var u=n.match(s);t=u[1],n=n.substring(u[0].length)}var d=c(n);switch(a){case"arbf":return d;case"blob":return r([d],{type:t});case"si08":return new Int8Array(d);case"ui08":return new Uint8Array(d);case"uic8":return new Uint8ClampedArray(d);case"si16":return new Int16Array(d);case"ur16":return new Uint16Array(d);case"si32":return new Int32Array(d);case"ui32":return new Uint32Array(d);case"fl32":return new Float32Array(d);case"fl64":return new Float64Array(d);default:throw new Error("Unkown type: "+a)}}function h(e){var t,r;if(null===e||"object"!=typeof e||"isActiveClone"in e)return e;var s=e instanceof Date?new Date(e):e.constructor();try{for(var i=n(Object.keys(e)),o=i.next();!o.done;o=i.next()){var a=o.value;Object.prototype.hasOwnProperty.call(e,a)&&(e.isActiveClone=null,s[a]=h(e[a]),delete e.isActiveClone)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return s}function f(e,t){return(e.name||t.name)+"/"+(e.storeName||t.storeName)+"/"}function g(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function p(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function m(e,t){var n=this;if(t=p.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}return{promise:e.name?new Promise((function(t){e.storeName?t(f(e,n._defaultConfig)):t(e.name+"/")})):Promise.reject("Invalid arguments"),callback:t}}function v(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}var _={bufferToString:u,deserialize:l,serialize:d,stringToBuffer:c},y={},b=function(){function e(e){this.kp=e,this.data={}}return e.resolve=function(t){return y[t]||(y[t]=new e(t)),y[t]},e.prototype.clear=function(){this.data={}},e.prototype.drop=function(){this.clear(),delete y[this.kp]},e.prototype.get=function(e){return this.data[e]},e.prototype.key=function(e){return this.keys()[e]},e.prototype.keys=function(){return Object.keys(this.data)},e.prototype.rm=function(e){delete this.data[e]},e.prototype.set=function(e,t){this.data[e]=t},e}();function w(e){var t=e?h(e):{},n=f(t,this._defaultConfig),r=b.resolve(n);return this._dbInfo=t,this._dbInfo.serializer=_,this._dbInfo.keyPrefix=n,this._dbInfo.mStore=r,Promise.resolve()}function S(e){var t=this,n=this.ready().then((function(){t._dbInfo.mStore.clear()}));return g(n,e),n}function E(e,t){var n=m.apply(this,arguments),r=n.promise,s=n.callback;return g(r.then((function(e){b.resolve(e).drop()})),s),r}function A(e,t){var n=this;e=v(e);var r=this.ready().then((function(){var t=n._dbInfo.mStore.get(e);return null==t?null:n._dbInfo.serializer.deserialize(t)}));return g(r,t),r}function x(e,t){var n=this,r=this.ready().then((function(){for(var t=n._dbInfo.mStore,r=t.keys(),s=0;s<r.length;s++){var i=t.get(r[s]);if(i&&(i=n._dbInfo.serializer.deserialize(i)),void 0!==(i=e(i,r[s],s+1)))return i}}));return g(r,t),r}function j(e,t){var n=this,r=this.ready().then((function(){var t;try{void 0===(t=n._dbInfo.mStore.key(e))&&(t=null)}catch(e){t=null}return t}));return g(r,t),r}function C(e){var t=this,n=this.ready().then((function(){return t._dbInfo.mStore.keys()}));return g(n,e),n}function I(e){var t=this.keys().then((function(e){return e.length}));return g(t,e),t}function N(e,t){var n=this;e=v(e);var r=this.ready().then((function(){n._dbInfo.mStore.rm(e)}));return g(r,t),r}function O(e,t,n){var r=this;e=v(e);var s=this.ready().then((function(){void 0===t&&(t=null);var n=t;return new Promise((function(s,i){r._dbInfo.serializer.serialize(t,(function(t,o){if(o)i(o);else try{r._dbInfo.mStore.set(e,t),s(n)}catch(e){i(e)}}))}))}));return g(s,n),s}var k=!0;e._support=k,e._driver=t,e._initStorage=w,e.clear=S,e.dropInstance=E,e.getItem=A,e.iterate=x,e.key=j,e.keys=C,e.length=I,e.removeItem=N,e.setItem=O,Object.defineProperty(e,"__esModule",{value:!0})}(t)},1459:function(e,t,n){!function(e,t){"use strict";function n(e){return n.result?n.result:e&&"function"==typeof e.getSerializer?(n.result=e.getSerializer(),n.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function r(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function s(e,t,n,r){function s(e,t){var n=e||t;return e&&"function"==typeof e||"string"!=typeof n||(e=function(e){return e[n]}),e}var i=[];if("[object Array]"===Object.prototype.toString.call(e)){t=s(t,"key"),n=s(n,"value");for(var o=0,a=e.length;o<a;o++){var c=e[o];i.push(r(t(c),n(c)))}}else for(var u in e)e.hasOwnProperty(u)&&i.push(r(u,e[u]));return i}function i(e,t,n,i){var o=this,a=o.ready().then((function(){return new Promise((function(r,i){var a,c=o._dbInfo,u=c.db.transaction(c.storeName,"readwrite"),d=u.objectStore(c.storeName);function l(e){var t=e.target||this;a=t.error||t.transaction.error,i(a)}u.oncomplete=function(){r(e)},u.onabort=u.onerror=function(e){i(a||e.target)},s(e,t,n,(function(e,t){null===t&&(t=void 0),d.put(t,e).onerror=l}))}))}));return r(a,i),a}function o(e,t,i,o){var a=this,c=new Promise((function(r,o){a.ready().then((function(){return n(a)})).then((function(n){var c=a._dbInfo;c.db.transaction((function(a){var u="INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",d=s(e,t,i,(function(e,t){return new Promise((function(r,s){n.serialize(t,(function(t,n){n?s(n):a.executeSql(u,[e,t],(function(){r()}),(function(e,t){s(t)}))}))}))}));Promise.all(d).then((function(){r(e)}),o)}),(function(e){o(e)}))})).catch(o)}));return r(c,o),c}function a(e,t,n,i){var o=this,a=s(e,t,n,(function(e,t){return o.setItem(e,t)})),c=Promise.all(a);return r(c,i),c}function c(e,t,n,r){var s=this,c=s.driver();return c===s.INDEXEDDB?i.call(s,e,t,n,r):c===s.WEBSQL?o.call(s,e,t,n,r):a.call(s,e,t,n,r)}function u(e){var t=Object.getPrototypeOf(e);t&&(t.setItems=c,t.setItems.indexedDB=function(){return i.apply(this,arguments)},t.setItems.websql=function(){return o.apply(this,arguments)},t.setItems.generic=function(){return a.apply(this,arguments)})}var d=u(t="default"in t?t.default:t);e.setItemsGeneric=a,e.localforageSetItems=c,e.extendPrototype=u,e.extendPrototypeResult=d,Object.defineProperty(e,"__esModule",{value:!0})}(t,n(9483))},7715:(e,t,n)=>{"use strict";var r=n(4836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,a.getStorage)(),r=!(!n||!n[t]),c=r?n[t]:{clear:function(){},get:function(){},remove:function(){},set:function(){}},u=c.clear.bind(c),d=c.get.bind(c),l=c.remove.bind(c),h=c.set.bind(c);return{_driver:e,_support:r,_initStorage:function(){return Promise.resolve()},clear:function(e){return(0,o.default)(s.default.mark((function t(){return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:u(),e&&e();case 2:case"end":return t.stop()}}),t)})))()},iterate:function(e,t){return(0,o.default)(s.default.mark((function n(){var r;return s.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.usePromise)(d,null);case 2:r=n.sent,Object.keys(r).forEach((function(t,n){return e(r[t],t,n)})),t&&t();case 6:case"end":return n.stop()}}),n)})))()},getItem:function(e,t){return(0,o.default)(s.default.mark((function n(){var r;return s.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,a.usePromise)(d,e);case 3:return r=n.sent,r=void 0===(r="string"==typeof e?r[e]:r)?null:r,t&&t(null,r),n.abrupt("return",r);case 10:throw n.prev=10,n.t0=n.catch(0),t&&t(n.t0),n.t0;case 14:case"end":return n.stop()}}),n,null,[[0,10]])})))()},key:function(e,t){return(0,o.default)(s.default.mark((function n(){var r,i;return s.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.usePromise)(d,null);case 2:return r=n.sent,i=Object.keys(r)[e],t&&t(i),n.abrupt("return",i);case 6:case"end":return n.stop()}}),n)})))()},keys:function(e){return(0,o.default)(s.default.mark((function t(){var n,r;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.usePromise)(d,null);case 2:return n=t.sent,r=Object.keys(n),e&&e(r),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t)})))()},length:function(e){return(0,o.default)(s.default.mark((function t(){var n,r,i;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.usePromise)(d,null);case 2:return n=t.sent,r=Object.keys(n),i=r.length,e&&e(i),t.abrupt("return",i);case 6:case"end":return t.stop()}}),t)})))()},removeItem:function(e,t){return(0,o.default)(s.default.mark((function n(){return s.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.usePromise)(l,e);case 2:t&&t();case 3:case"end":return n.stop()}}),n)})))()},setItem:function(e,t,n){return(0,o.default)(s.default.mark((function r(){return s.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,a.usePromise)(h,(0,i.default)({},e,t));case 2:n&&n();case 3:case"end":return r.stop()}}),r)})))()}}};var s=r(n(4687)),i=r(n(8416)),o=r(n(7156)),a=n(4639)},7002:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var s=(0,r(n(7715)).default)("webExtensionLocalStorage","local");t.Z=s},1063:(e,t,n)=>{"use strict";var r=n(4836);t.Z=void 0;var s=(0,r(n(7715)).default)("webExtensionSyncStorage","sync");t.Z=s},4639:(e,t)=>{"use strict";function n(){return"undefined"!=typeof browser&&browser.storage||"undefined"!=typeof chrome&&chrome.storage}Object.defineProperty(t,"__esModule",{value:!0}),t.getStorage=n,t.usePromise=function(e,t){if(function(){var e=n();try{return e&&e.local.get&&e.local.get()&&"function"==typeof e.local.get().then}catch(e){return!1}}())return e(t);return new Promise((function(n){e(t,(function(){n.apply(void 0,arguments)}))}))}},9483:(e,t,n)=>{e.exports=function e(t,n,r){function s(o,a){if(!n[o]){if(!t[o]){if(i)return i(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,(function(e){var n=t[o][1][e];return s(n||e)}),u,u.exports,e,t,n,r)}return n[o].exports}for(var i=void 0,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(e,t,r){(function(e){"use strict";var n,r,s=e.MutationObserver||e.WebKitMutationObserver;if(s){var i=0,o=new s(d),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),n=function(){a.data=i=++i%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)};else{var c=new e.MessageChannel;c.port1.onmessage=d,n=function(){c.port2.postMessage(0)}}var u=[];function d(){var e,t;r=!0;for(var n=u.length;n;){for(t=u,u=[],e=-1;++e<n;)t[e]();n=u.length}r=!1}function l(e){1!==u.push(e)||r||n()}t.exports=l}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function s(){}var i={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==s&&f(this,e)}function d(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function l(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return i.reject(e,t)}r===e?i.reject(e,new TypeError("Cannot resolve promise with itself")):i.resolve(e,r)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,i.reject(e,t))}function s(t){n||(n=!0,i.resolve(e,t))}function o(){t(s,r)}var a=g(o);"error"===a.status&&r(a.value)}function g(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function p(e){return e instanceof this?e:i.resolve(new this(s),e)}function m(e){var t=new this(s);return i.reject(t,e)}function v(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=new Array(n),a=0,c=-1,u=new this(s);++c<n;)d(e[c],c);return u;function d(e,s){function c(e){o[s]=e,++a!==n||r||(r=!0,i.resolve(u,o))}t.resolve(e).then(c,(function(e){r||(r=!0,i.reject(u,e))}))}}function _(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=-1,a=new this(s);++o<n;)c(e[o]);return a;function c(e){t.resolve(e).then((function(e){r||(r=!0,i.resolve(a,e))}),(function(e){r||(r=!0,i.reject(a,e))}))}}t.exports=u,u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(s);return this.state!==c?l(n,this.state===a?e:t,this.outcome):this.queue.push(new d(n,e,t)),n},d.prototype.callFulfilled=function(e){i.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){l(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){i.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){l(this.promise,this.onRejected,e)},i.resolve=function(e,t){var n=g(h,t);if("error"===n.status)return i.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=a,e.outcome=t;for(var s=-1,o=e.queue.length;++s<o;)e.queue[s].callFulfilled(t)}return e},i.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},u.resolve=p,u.reject=m,u.all=v,u.race=_},{1:1}],3:[function(e,t,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var o=i();function a(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(s){if("TypeError"!==s.name)throw s;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var u=Promise;function d(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function l(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function h(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function f(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var g="local-forage-detect-blob-support",p=void 0,m={},v=Object.prototype.toString,_="readonly",y="readwrite";function b(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),s=0;s<t;s++)r[s]=e.charCodeAt(s);return n}function w(e){return new u((function(t){var n=e.transaction(g,y),r=c([""]);n.objectStore(g).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function S(e){return"boolean"==typeof p?u.resolve(p):w(e).then((function(e){return p=e}))}function E(e){var t=m[e.name],n={};n.promise=new u((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function A(e){var t=m[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function x(e,t){var n=m[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function j(e,t){return new u((function(n,r){if(m[e.name]=m[e.name]||D(),e.db){if(!t)return n(e.db);E(e),e.db.close()}var s=[e.name];t&&s.push(e.version);var i=o.open.apply(o,s);t&&(i.onupgradeneeded=function(t){var n=i.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(g)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),i.onerror=function(e){e.preventDefault(),r(i.error)},i.onsuccess=function(){var t=i.result;t.onversionchange=function(e){e.target.close()},n(t),A(e)}}))}function C(e){return j(e,!1)}function I(e){return j(e,!0)}function N(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,s=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),s||n){if(n){var i=e.db.version+1;i>e.version&&(e.version=i)}return!0}return!1}function O(e){return new u((function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)}))}function k(e){return c([b(atob(e.data))],{type:e.type})}function T(e){return e&&e.__local_forage_encoded_blob}function M(e){var t=this,n=t._initReady().then((function(){var e=m[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return l(n,e,e),n}function R(e){E(e);for(var t=m[e.name],n=t.forages,r=0;r<n.length;r++){var s=n[r];s._dbInfo.db&&(s._dbInfo.db.close(),s._dbInfo.db=null)}return e.db=null,C(e).then((function(t){return e.db=t,N(e)?I(e):t})).then((function(r){e.db=t.db=r;for(var s=0;s<n.length;s++)n[s]._dbInfo.db=r})).catch((function(t){throw x(e,t),t}))}function $(e,t,n,r){void 0===r&&(r=1);try{var s=e.db.transaction(e.storeName,t);n(null,s)}catch(s){if(r>0&&(!e.db||"InvalidStateError"===s.name||"NotFoundError"===s.name))return u.resolve().then((function(){if(!e.db||"NotFoundError"===s.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),I(e)})).then((function(){return R(e).then((function(){$(e,t,n,r-1)}))})).catch(n);n(s)}}function D(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function P(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var s=m[n.name];s||(s=D(),m[n.name]=s),s.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=M);var i=[];function o(){return u.resolve()}for(var a=0;a<s.forages.length;a++){var c=s.forages[a];c!==t&&i.push(c._initReady().catch(o))}var d=s.forages.slice(0);return u.all(i).then((function(){return n.db=s.db,C(n)})).then((function(e){return n.db=e,N(n,t._defaultConfig.version)?I(n):e})).then((function(e){n.db=s.db=e,t._dbInfo=n;for(var r=0;r<d.length;r++){var i=d[r];i!==t&&(i._dbInfo.db=n.db,i._dbInfo.version=n.version)}}))}function F(e,t){var n=this;e=h(e);var r=new u((function(t,r){n.ready().then((function(){$(n._dbInfo,_,(function(s,i){if(s)return r(s);try{var o=i.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),T(e)&&(e=k(e)),t(e)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return d(r,t),r}function L(e,t){var n=this,r=new u((function(t,r){n.ready().then((function(){$(n._dbInfo,_,(function(s,i){if(s)return r(s);try{var o=i.objectStore(n._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;T(r)&&(r=k(r));var s=e(r,n.key,a++);void 0!==s?t(s):n.continue()}else t()},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return d(r,t),r}function z(e,t,n){var r=this;e=h(e);var s=new u((function(n,s){var i;r.ready().then((function(){return i=r._dbInfo,"[object Blob]"===v.call(t)?S(i.db).then((function(e){return e?t:O(t)})):t})).then((function(t){$(r._dbInfo,y,(function(i,o){if(i)return s(i);try{var a=o.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;s(e)}}catch(e){s(e)}}))})).catch(s)}));return d(s,n),s}function U(e,t){var n=this;e=h(e);var r=new u((function(t,r){n.ready().then((function(){$(n._dbInfo,y,(function(s,i){if(s)return r(s);try{var o=i.objectStore(n._dbInfo.storeName).delete(e);i.oncomplete=function(){t()},i.onerror=function(){r(o.error)},i.onabort=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return d(r,t),r}function B(e){var t=this,n=new u((function(e,n){t.ready().then((function(){$(t._dbInfo,y,(function(r,s){if(r)return n(r);try{var i=s.objectStore(t._dbInfo.storeName).clear();s.oncomplete=function(){e()},s.onabort=s.onerror=function(){var e=i.error?i.error:i.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return d(n,e),n}function q(e){var t=this,n=new u((function(e,n){t.ready().then((function(){$(t._dbInfo,_,(function(r,s){if(r)return n(r);try{var i=s.objectStore(t._dbInfo.storeName).count();i.onsuccess=function(){e(i.result)},i.onerror=function(){n(i.error)}}catch(e){n(e)}}))})).catch(n)}));return d(n,e),n}function H(e,t){var n=this,r=new u((function(t,r){e<0?t(null):n.ready().then((function(){$(n._dbInfo,_,(function(s,i){if(s)return r(s);try{var o=i.objectStore(n._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return d(r,t),r}function G(e){var t=this,n=new u((function(e,n){t.ready().then((function(){$(t._dbInfo,_,(function(r,s){if(r)return n(r);try{var i=s.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];i.onsuccess=function(){var t=i.result;t?(o.push(t.key),t.continue()):e(o)},i.onerror=function(){n(i.error)}}catch(e){n(e)}}))})).catch(n)}));return d(n,e),n}function J(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,s=this;if(e.name){var i=e.name===n.name&&s._dbInfo.db?u.resolve(s._dbInfo.db):C(e).then((function(t){var n=m[e.name],r=n.forages;n.db=t;for(var s=0;s<r.length;s++)r[s]._dbInfo.db=t;return t}));r=e.storeName?i.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;E(e);var r=m[e.name],s=r.forages;t.close();for(var i=0;i<s.length;i++){var a=s[i];a._dbInfo.db=null,a._dbInfo.version=n}var c=new u((function(t,r){var s=o.open(e.name,n);s.onerror=function(e){s.result.close(),r(e)},s.onupgradeneeded=function(){s.result.deleteObjectStore(e.storeName)},s.onsuccess=function(){var e=s.result;e.close(),t(e)}}));return c.then((function(e){r.db=e;for(var t=0;t<s.length;t++){var n=s[t];n._dbInfo.db=e,A(n._dbInfo)}})).catch((function(t){throw(x(e,t)||u.resolve()).catch((function(){})),t}))}})):i.then((function(t){E(e);var n=m[e.name],r=n.forages;t.close();for(var s=0;s<r.length;s++)r[s]._dbInfo.db=null;var i=new u((function(t,n){var r=o.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}}));return i.then((function(e){n.db=e;for(var t=0;t<r.length;t++)A(r[t]._dbInfo)})).catch((function(t){throw(x(e,t)||u.resolve()).catch((function(){})),t}))}))}else r=u.reject("Invalid arguments");return d(r,t),r}var W={_driver:"asyncStorage",_initStorage:P,_support:a(),iterate:L,getItem:F,setItem:z,removeItem:U,clear:B,length:q,key:H,keys:G,dropInstance:J};function Q(){return"function"==typeof openDatabase}var K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",V="~~local_forage_type~",Y=/^~~local_forage_type~([^~]+)~/,X="__lfsc__:",Z=X.length,ee="arbf",te="blob",ne="si08",re="ui08",se="uic8",ie="si16",oe="si32",ae="ur16",ce="ui32",ue="fl32",de="fl64",le=Z+ee.length,he=Object.prototype.toString;function fe(e){var t,n,r,s,i,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var u=new ArrayBuffer(o),d=new Uint8Array(u);for(t=0;t<a;t+=4)n=K.indexOf(e[t]),r=K.indexOf(e[t+1]),s=K.indexOf(e[t+2]),i=K.indexOf(e[t+3]),d[c++]=n<<2|r>>4,d[c++]=(15&r)<<4|s>>2,d[c++]=(3&s)<<6|63&i;return u}function ge(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=K[n[t]>>2],r+=K[(3&n[t])<<4|n[t+1]>>4],r+=K[(15&n[t+1])<<2|n[t+2]>>6],r+=K[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function pe(e,t){var n="";if(e&&(n=he.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===he.call(e.buffer))){var r,s=X;e instanceof ArrayBuffer?(r=e,s+=ee):(r=e.buffer,"[object Int8Array]"===n?s+=ne:"[object Uint8Array]"===n?s+=re:"[object Uint8ClampedArray]"===n?s+=se:"[object Int16Array]"===n?s+=ie:"[object Uint16Array]"===n?s+=ae:"[object Int32Array]"===n?s+=oe:"[object Uint32Array]"===n?s+=ce:"[object Float32Array]"===n?s+=ue:"[object Float64Array]"===n?s+=de:t(new Error("Failed to get type for BinaryArray"))),t(s+ge(r))}else if("[object Blob]"===n){var i=new FileReader;i.onload=function(){var n=V+e.type+"~"+ge(this.result);t(X+te+n)},i.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function me(e){if(e.substring(0,Z)!==X)return JSON.parse(e);var t,n=e.substring(le),r=e.substring(Z,le);if(r===te&&Y.test(n)){var s=n.match(Y);t=s[1],n=n.substring(s[0].length)}var i=fe(n);switch(r){case ee:return i;case te:return c([i],{type:t});case ne:return new Int8Array(i);case re:return new Uint8Array(i);case se:return new Uint8ClampedArray(i);case ie:return new Int16Array(i);case ae:return new Uint16Array(i);case oe:return new Int32Array(i);case ce:return new Uint32Array(i);case ue:return new Float32Array(i);case de:return new Float64Array(i);default:throw new Error("Unkown type: "+r)}}var ve={serialize:pe,deserialize:me,stringToBuffer:fe,bufferToString:ge};function _e(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function ye(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var s=new u((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(s){_e(s,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=ve,s}function be(e,t,n,r,s,i){e.executeSql(n,r,s,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?i(e,o):_e(e,t,(function(){e.executeSql(n,r,s,i)}),i)}),i):i(e,o)}),i)}function we(e,t){var n=this;e=h(e);var r=new u((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){be(n,s,"SELECT * FROM "+s.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=s.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return d(r,t),r}function Se(e,t){var n=this,r=new u((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){be(n,s,"SELECT * FROM "+s.storeName,[],(function(n,r){for(var i=r.rows,o=i.length,a=0;a<o;a++){var c=i.item(a),u=c.value;if(u&&(u=s.serializer.deserialize(u)),void 0!==(u=e(u,c.key,a+1)))return void t(u)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return d(r,t),r}function Ee(e,t,n,r){var s=this;e=h(e);var i=new u((function(i,o){s.ready().then((function(){void 0===t&&(t=null);var a=t,c=s._dbInfo;c.serializer.serialize(t,(function(t,u){u?o(u):c.db.transaction((function(n){be(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){i(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void i(Ee.apply(s,[e,a,n,r-1]));o(t)}}))}))})).catch(o)}));return d(i,n),i}function Ae(e,t,n){return Ee.apply(this,[e,t,n,1])}function xe(e,t){var n=this;e=h(e);var r=new u((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){be(n,s,"DELETE FROM "+s.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return d(r,t),r}function je(e){var t=this,n=new u((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){be(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,e),n}function Ce(e){var t=this,n=new u((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){be(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,e),n}function Ie(e,t){var n=this,r=new u((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){be(n,s,"SELECT key FROM "+s.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return d(r,t),r}function Ne(e){var t=this,n=new u((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){be(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],s=0;s<n.rows.length;s++)r.push(n.rows.item(s).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,e),n}function Oe(e){return new u((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var s=[],i=0;i<r.rows.length;i++)s.push(r.rows.item(i).name);t({db:e,storeNames:s})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}function ke(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,s=this;return d(r=e.name?new u((function(t){var r;r=e.name===n.name?s._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(Oe(r))})).then((function(e){return new u((function(t,n){e.db.transaction((function(r){function s(e){return new u((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var i=[],o=0,a=e.storeNames.length;o<a;o++)i.push(s(e.storeNames[o]));u.all(i).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):u.reject("Invalid arguments"),t),r}var Te={_driver:"webSQLStorage",_initStorage:ye,_support:Q(),iterate:Se,getItem:we,setItem:Ae,removeItem:xe,clear:je,length:Ce,key:Ie,keys:Ne,dropInstance:ke};function Me(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Re(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function $e(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function De(){return!$e()||localStorage.length>0}function Pe(e){var t=this,n={};if(e)for(var r in e)n[r]=e[r];return n.keyPrefix=Re(e,t._defaultConfig),De()?(t._dbInfo=n,n.serializer=ve,u.resolve()):u.reject()}function Fe(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return d(n,e),n}function Le(e,t){var n=this;e=h(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return d(r,t),r}function ze(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,s=r.length,i=localStorage.length,o=1,a=0;a<i;a++){var c=localStorage.key(a);if(0===c.indexOf(r)){var u=localStorage.getItem(c);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,c.substring(s),o++)))return u}}}));return d(r,t),r}function Ue(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return d(r,t),r}function Be(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],s=0;s<n;s++){var i=localStorage.key(s);0===i.indexOf(e.keyPrefix)&&r.push(i.substring(e.keyPrefix.length))}return r}));return d(n,e),n}function qe(e){var t=this.keys().then((function(e){return e.length}));return d(t,e),t}function He(e,t){var n=this;e=h(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return d(r,t),r}function Ge(e,t,n){var r=this;e=h(e);var s=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new u((function(s,i){var o=r._dbInfo;o.serializer.serialize(t,(function(t,r){if(r)i(r);else try{localStorage.setItem(o.keyPrefix+e,t),s(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||i(e),i(e)}}))}))}));return d(s,n),s}function Je(e,t){if(t=f.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,s=this;return r=e.name?new u((function(t){e.storeName?t(Re(e,s._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):u.reject("Invalid arguments"),d(r,t),r}var We={_driver:"localStorageWrapper",_initStorage:Pe,_support:Me(),iterate:ze,getItem:Le,setItem:Ge,removeItem:He,clear:Fe,length:qe,key:Ue,keys:Be,dropInstance:Je},Qe=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},Ke=function(e,t){for(var n=e.length,r=0;r<n;){if(Qe(e[r],t))return!0;r++}return!1},Ve=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Ye={},Xe={},Ze={INDEXEDDB:W,WEBSQL:Te,LOCALSTORAGE:We},et=[Ze.INDEXEDDB._driver,Ze.WEBSQL._driver,Ze.LOCALSTORAGE._driver],tt=["dropInstance"],nt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),rt={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function st(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function it(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(Ve(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ot=function(){function e(t){for(var n in s(this,e),Ze)if(Ze.hasOwnProperty(n)){var r=Ze[n],i=r._driver;this[n]=i,Ye[i]||this.defineDriver(r)}this._defaultConfig=it({},rt),this._config=it({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new u((function(t,n){try{var r=e._driver,s=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(s);for(var i=nt.concat("_initStorage"),o=0,a=i.length;o<a;o++){var c=i[o];if((!Ke(tt,c)||e[c])&&"function"!=typeof e[c])return void n(s)}var l=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=u.reject(t);return d(n,arguments[arguments.length-1]),n}},n=0,r=tt.length;n<r;n++){var s=tt[n];e[s]||(e[s]=t(s))}};l();var h=function(n){Ye[r]&&console.info("Redefining LocalForage driver: "+r),Ye[r]=e,Xe[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,n):h(!!e._support):h(!0)}catch(e){n(e)}}));return l(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=Ye[e]?u.resolve(Ye[e]):u.reject(new Error("Driver not found."));return l(r,t,n),r},e.prototype.getSerializer=function(e){var t=u.resolve(ve);return l(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return l(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;Ve(e)||(e=[e]);var s=this._getSupportedDrivers(e);function i(){r._config.driver=r.driver()}function o(e){return r._extend(e),i(),r._ready=r._initStorage(r._config),r._ready}function a(e){return function(){var t=0;function n(){for(;t<e.length;){var s=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(s).then(o).catch(n)}i();var a=new Error("No available storage method found.");return r._driverSet=u.reject(a),r._driverSet}return n()}}var c=null!==this._driverSet?this._driverSet.catch((function(){return u.resolve()})):u.resolve();return this._driverSet=c.then((function(){var e=s[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,i(),r._wrapLibraryMethodsWithReady(),r._initDriver=a(s)}))})).catch((function(){i();var e=new Error("No available storage method found.");return r._driverSet=u.reject(e),r._driverSet})),l(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!Xe[e]},e.prototype._extend=function(e){it(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var s=e[n];this.supports(s)&&t.push(s)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=nt.length;e<t;e++)st(this,nt[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),at=new ot;t.exports=at},{3:3}]},{},[4])(4)},1271:(e,t,n)=>{var r;!function(s){var i,o,a,c,u,d,l,h,f,g,p,m,v,_,y,b,w,S,E,A="sizzle"+1*new Date,x=s.document,j=0,C=0,I=he(),N=he(),O=he(),k=he(),T=function(e,t){return e===t&&(p=!0),0},M={}.hasOwnProperty,R=[],$=R.pop,D=R.push,P=R.push,F=R.slice,L=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},z="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",U="[\\x20\\t\\r\\n\\f]",B="(?:\\\\[\\da-fA-F]{1,6}"+U+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",q="\\["+U+"*("+B+")(?:"+U+"*([*^$|!~]?=)"+U+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+U+"*\\]",H=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+q+")*)|.*)\\)|)",G=new RegExp(U+"+","g"),J=new RegExp("^"+U+"+|((?:^|[^\\\\])(?:\\\\.)*)"+U+"+$","g"),W=new RegExp("^"+U+"*,"+U+"*"),Q=new RegExp("^"+U+"*([>+~]|"+U+")"+U+"*"),K=new RegExp(U+"|>"),V=new RegExp(H),Y=new RegExp("^"+B+"$"),X={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+q),PSEUDO:new RegExp("^"+H),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+U+"*(even|odd|(([+-]|)(\\d*)n|)"+U+"*(?:([+-]|)"+U+"*(\\d+)|))"+U+"*\\)|)","i"),bool:new RegExp("^(?:"+z+")$","i"),needsContext:new RegExp("^"+U+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+U+"*((?:-\\d)?\\d*)"+U+"*\\)|)(?=[^-]|$)","i")},Z=/HTML$/i,ee=/^(?:input|select|textarea|button)$/i,te=/^h\d$/i,ne=/^[^{]+\{\s*\[native \w/,re=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,se=/[+~]/,ie=new RegExp("\\\\[\\da-fA-F]{1,6}"+U+"?|\\\\([^\\r\\n\\f])","g"),oe=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},ae=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ce=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},ue=function(){m()},de=Ae((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{P.apply(R=F.call(x.childNodes),x.childNodes),R[x.childNodes.length].nodeType}catch(e){P={apply:R.length?function(e,t){D.apply(e,F.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function le(e,t,n,r){var s,i,a,c,u,l,f,g=t&&t.ownerDocument,p=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==p&&9!==p&&11!==p)return n;if(!r&&(m(t),t=t||v,y)){if(11!==p&&(u=re.exec(e)))if(s=u[1]){if(9===p){if(!(a=t.getElementById(s)))return n;if(a.id===s)return n.push(a),n}else if(g&&(a=g.getElementById(s))&&E(t,a)&&a.id===s)return n.push(a),n}else{if(u[2])return P.apply(n,t.getElementsByTagName(e)),n;if((s=u[3])&&o.getElementsByClassName&&t.getElementsByClassName)return P.apply(n,t.getElementsByClassName(s)),n}if(o.qsa&&!k[e+" "]&&(!b||!b.test(e))&&(1!==p||"object"!==t.nodeName.toLowerCase())){if(f=e,g=t,1===p&&(K.test(e)||Q.test(e))){for((g=se.test(e)&&we(t.parentNode)||t)===t&&o.scope||((c=t.getAttribute("id"))?c=c.replace(ae,ce):t.setAttribute("id",c=A)),i=(l=d(e)).length;i--;)l[i]=(c?"#"+c:":scope")+" "+Ee(l[i]);f=l.join(",")}try{return P.apply(n,g.querySelectorAll(f)),n}catch(t){k(e,!0)}finally{c===A&&t.removeAttribute("id")}}}return h(e.replace(J,"$1"),t,n,r)}function he(){var e=[];return function t(n,r){return e.push(n+" ")>a.cacheLength&&delete t[e.shift()],t[n+" "]=r}}function fe(e){return e[A]=!0,e}function ge(e){var t=v.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function pe(e,t){for(var n=e.split("|"),r=n.length;r--;)a.attrHandle[n[r]]=t}function me(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function ve(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function _e(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ye(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&de(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function be(e){return fe((function(t){return t=+t,fe((function(n,r){for(var s,i=e([],n.length,t),o=i.length;o--;)n[s=i[o]]&&(n[s]=!(r[s]=n[s]))}))}))}function we(e){return e&&void 0!==e.getElementsByTagName&&e}for(i in o=le.support={},u=le.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Z.test(t||n&&n.nodeName||"HTML")},m=le.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:x;return r!=v&&9===r.nodeType&&r.documentElement?(_=(v=r).documentElement,y=!u(v),x!=v&&(n=v.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",ue,!1):n.attachEvent&&n.attachEvent("onunload",ue)),o.scope=ge((function(e){return _.appendChild(e).appendChild(v.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),o.cssHas=ge((function(){try{return v.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}})),o.attributes=ge((function(e){return e.className="i",!e.getAttribute("className")})),o.getElementsByTagName=ge((function(e){return e.appendChild(v.createComment("")),!e.getElementsByTagName("*").length})),o.getElementsByClassName=ne.test(v.getElementsByClassName),o.getById=ge((function(e){return _.appendChild(e).id=A,!v.getElementsByName||!v.getElementsByName(A).length})),o.getById?(a.filter.ID=function(e){var t=e.replace(ie,oe);return function(e){return e.getAttribute("id")===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n=t.getElementById(e);return n?[n]:[]}}):(a.filter.ID=function(e){var t=e.replace(ie,oe);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n,r,s,i=t.getElementById(e);if(i){if((n=i.getAttributeNode("id"))&&n.value===e)return[i];for(s=t.getElementsByName(e),r=0;i=s[r++];)if((n=i.getAttributeNode("id"))&&n.value===e)return[i]}return[]}}),a.find.TAG=o.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):o.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],s=0,i=t.getElementsByTagName(e);if("*"===e){for(;n=i[s++];)1===n.nodeType&&r.push(n);return r}return i},a.find.CLASS=o.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&y)return t.getElementsByClassName(e)},w=[],b=[],(o.qsa=ne.test(v.querySelectorAll))&&(ge((function(e){var t;_.appendChild(e).innerHTML="<a id='"+A+"'></a><select id='"+A+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&b.push("[*^$]="+U+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||b.push("\\["+U+"*(?:value|"+z+")"),e.querySelectorAll("[id~="+A+"-]").length||b.push("~="),(t=v.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||b.push("\\["+U+"*name"+U+"*="+U+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||b.push(":checked"),e.querySelectorAll("a#"+A+"+*").length||b.push(".#.+[+~]"),e.querySelectorAll("\\\f"),b.push("[\\r\\n\\f]")})),ge((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=v.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&b.push("name"+U+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&b.push(":enabled",":disabled"),_.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&b.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),b.push(",.*:")}))),(o.matchesSelector=ne.test(S=_.matches||_.webkitMatchesSelector||_.mozMatchesSelector||_.oMatchesSelector||_.msMatchesSelector))&&ge((function(e){o.disconnectedMatch=S.call(e,"*"),S.call(e,"[s!='']:x"),w.push("!=",H)})),o.cssHas||b.push(":has"),b=b.length&&new RegExp(b.join("|")),w=w.length&&new RegExp(w.join("|")),t=ne.test(_.compareDocumentPosition),E=t||ne.test(_.contains)?function(e,t){var n=9===e.nodeType&&e.documentElement||e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},T=t?function(e,t){if(e===t)return p=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!o.sortDetached&&t.compareDocumentPosition(e)===n?e==v||e.ownerDocument==x&&E(x,e)?-1:t==v||t.ownerDocument==x&&E(x,t)?1:g?L(g,e)-L(g,t):0:4&n?-1:1)}:function(e,t){if(e===t)return p=!0,0;var n,r=0,s=e.parentNode,i=t.parentNode,o=[e],a=[t];if(!s||!i)return e==v?-1:t==v?1:s?-1:i?1:g?L(g,e)-L(g,t):0;if(s===i)return me(e,t);for(n=e;n=n.parentNode;)o.unshift(n);for(n=t;n=n.parentNode;)a.unshift(n);for(;o[r]===a[r];)r++;return r?me(o[r],a[r]):o[r]==x?-1:a[r]==x?1:0},v):v},le.matches=function(e,t){return le(e,null,null,t)},le.matchesSelector=function(e,t){if(m(e),o.matchesSelector&&y&&!k[t+" "]&&(!w||!w.test(t))&&(!b||!b.test(t)))try{var n=S.call(e,t);if(n||o.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){k(t,!0)}return le(t,v,null,[e]).length>0},le.contains=function(e,t){return(e.ownerDocument||e)!=v&&m(e),E(e,t)},le.attr=function(e,t){(e.ownerDocument||e)!=v&&m(e);var n=a.attrHandle[t.toLowerCase()],r=n&&M.call(a.attrHandle,t.toLowerCase())?n(e,t,!y):void 0;return void 0!==r?r:o.attributes||!y?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},le.escape=function(e){return(e+"").replace(ae,ce)},le.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},le.uniqueSort=function(e){var t,n=[],r=0,s=0;if(p=!o.detectDuplicates,g=!o.sortStable&&e.slice(0),e.sort(T),p){for(;t=e[s++];)t===e[s]&&(r=n.push(s));for(;r--;)e.splice(n[r],1)}return g=null,e},c=le.getText=function(e){var t,n="",r=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=c(e)}else if(3===s||4===s)return e.nodeValue}else for(;t=e[r++];)n+=c(t);return n},a=le.selectors={cacheLength:50,createPseudo:fe,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(ie,oe),e[3]=(e[3]||e[4]||e[5]||"").replace(ie,oe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||le.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&le.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return X.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&V.test(n)&&(t=d(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(ie,oe).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=I[e+" "];return t||(t=new RegExp("(^|"+U+")"+e+"("+U+"|$)"))&&I(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(r){var s=le.attr(r,e);return null==s?"!="===t:!t||(s+="","="===t?s===n:"!="===t?s!==n:"^="===t?n&&0===s.indexOf(n):"*="===t?n&&s.indexOf(n)>-1:"$="===t?n&&s.slice(-n.length)===n:"~="===t?(" "+s.replace(G," ")+" ").indexOf(n)>-1:"|="===t&&(s===n||s.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,s){var i="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===s?function(e){return!!e.parentNode}:function(t,n,c){var u,d,l,h,f,g,p=i!==o?"nextSibling":"previousSibling",m=t.parentNode,v=a&&t.nodeName.toLowerCase(),_=!c&&!a,y=!1;if(m){if(i){for(;p;){for(h=t;h=h[p];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;g=p="only"===e&&!g&&"nextSibling"}return!0}if(g=[o?m.firstChild:m.lastChild],o&&_){for(y=(f=(u=(d=(l=(h=m)[A]||(h[A]={}))[h.uniqueID]||(l[h.uniqueID]={}))[e]||[])[0]===j&&u[1])&&u[2],h=f&&m.childNodes[f];h=++f&&h&&h[p]||(y=f=0)||g.pop();)if(1===h.nodeType&&++y&&h===t){d[e]=[j,f,y];break}}else if(_&&(y=f=(u=(d=(l=(h=t)[A]||(h[A]={}))[h.uniqueID]||(l[h.uniqueID]={}))[e]||[])[0]===j&&u[1]),!1===y)for(;(h=++f&&h&&h[p]||(y=f=0)||g.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++y||(_&&((d=(l=h[A]||(h[A]={}))[h.uniqueID]||(l[h.uniqueID]={}))[e]=[j,y]),h!==t)););return(y-=s)===r||y%r==0&&y/r>=0}}},PSEUDO:function(e,t){var n,r=a.pseudos[e]||a.setFilters[e.toLowerCase()]||le.error("unsupported pseudo: "+e);return r[A]?r(t):r.length>1?(n=[e,e,"",t],a.setFilters.hasOwnProperty(e.toLowerCase())?fe((function(e,n){for(var s,i=r(e,t),o=i.length;o--;)e[s=L(e,i[o])]=!(n[s]=i[o])})):function(e){return r(e,0,n)}):r}},pseudos:{not:fe((function(e){var t=[],n=[],r=l(e.replace(J,"$1"));return r[A]?fe((function(e,t,n,s){for(var i,o=r(e,null,s,[]),a=e.length;a--;)(i=o[a])&&(e[a]=!(t[a]=i))})):function(e,s,i){return t[0]=e,r(t,null,i,n),t[0]=null,!n.pop()}})),has:fe((function(e){return function(t){return le(e,t).length>0}})),contains:fe((function(e){return e=e.replace(ie,oe),function(t){return(t.textContent||c(t)).indexOf(e)>-1}})),lang:fe((function(e){return Y.test(e||"")||le.error("unsupported lang: "+e),e=e.replace(ie,oe).toLowerCase(),function(t){var n;do{if(n=y?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(e){var t=s.location&&s.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===_},focus:function(e){return e===v.activeElement&&(!v.hasFocus||v.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ye(!1),disabled:ye(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!a.pseudos.empty(e)},header:function(e){return te.test(e.nodeName)},input:function(e){return ee.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:be((function(){return[0]})),last:be((function(e,t){return[t-1]})),eq:be((function(e,t,n){return[n<0?n+t:n]})),even:be((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:be((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:be((function(e,t,n){for(var r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e})),gt:be((function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e}))}},a.pseudos.nth=a.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})a.pseudos[i]=ve(i);for(i in{submit:!0,reset:!0})a.pseudos[i]=_e(i);function Se(){}function Ee(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function Ae(e,t,n){var r=t.dir,s=t.next,i=s||r,o=n&&"parentNode"===i,a=C++;return t.first?function(t,n,s){for(;t=t[r];)if(1===t.nodeType||o)return e(t,n,s);return!1}:function(t,n,c){var u,d,l,h=[j,a];if(c){for(;t=t[r];)if((1===t.nodeType||o)&&e(t,n,c))return!0}else for(;t=t[r];)if(1===t.nodeType||o)if(d=(l=t[A]||(t[A]={}))[t.uniqueID]||(l[t.uniqueID]={}),s&&s===t.nodeName.toLowerCase())t=t[r]||t;else{if((u=d[i])&&u[0]===j&&u[1]===a)return h[2]=u[2];if(d[i]=h,h[2]=e(t,n,c))return!0}return!1}}function xe(e){return e.length>1?function(t,n,r){for(var s=e.length;s--;)if(!e[s](t,n,r))return!1;return!0}:e[0]}function je(e,t,n,r,s){for(var i,o=[],a=0,c=e.length,u=null!=t;a<c;a++)(i=e[a])&&(n&&!n(i,r,s)||(o.push(i),u&&t.push(a)));return o}function Ce(e,t,n,r,s,i){return r&&!r[A]&&(r=Ce(r)),s&&!s[A]&&(s=Ce(s,i)),fe((function(i,o,a,c){var u,d,l,h=[],f=[],g=o.length,p=i||function(e,t,n){for(var r=0,s=t.length;r<s;r++)le(e,t[r],n);return n}(t||"*",a.nodeType?[a]:a,[]),m=!e||!i&&t?p:je(p,h,e,a,c),v=n?s||(i?e:g||r)?[]:o:m;if(n&&n(m,v,a,c),r)for(u=je(v,f),r(u,[],a,c),d=u.length;d--;)(l=u[d])&&(v[f[d]]=!(m[f[d]]=l));if(i){if(s||e){if(s){for(u=[],d=v.length;d--;)(l=v[d])&&u.push(m[d]=l);s(null,v=[],u,c)}for(d=v.length;d--;)(l=v[d])&&(u=s?L(i,l):h[d])>-1&&(i[u]=!(o[u]=l))}}else v=je(v===o?v.splice(g,v.length):v),s?s(null,o,v,c):P.apply(o,v)}))}function Ie(e){for(var t,n,r,s=e.length,i=a.relative[e[0].type],o=i||a.relative[" "],c=i?1:0,u=Ae((function(e){return e===t}),o,!0),d=Ae((function(e){return L(t,e)>-1}),o,!0),l=[function(e,n,r){var s=!i&&(r||n!==f)||((t=n).nodeType?u(e,n,r):d(e,n,r));return t=null,s}];c<s;c++)if(n=a.relative[e[c].type])l=[Ae(xe(l),n)];else{if((n=a.filter[e[c].type].apply(null,e[c].matches))[A]){for(r=++c;r<s&&!a.relative[e[r].type];r++);return Ce(c>1&&xe(l),c>1&&Ee(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(J,"$1"),n,c<r&&Ie(e.slice(c,r)),r<s&&Ie(e=e.slice(r)),r<s&&Ee(e))}l.push(n)}return xe(l)}Se.prototype=a.filters=a.pseudos,a.setFilters=new Se,d=le.tokenize=function(e,t){var n,r,s,i,o,c,u,d=N[e+" "];if(d)return t?0:d.slice(0);for(o=e,c=[],u=a.preFilter;o;){for(i in n&&!(r=W.exec(o))||(r&&(o=o.slice(r[0].length)||o),c.push(s=[])),n=!1,(r=Q.exec(o))&&(n=r.shift(),s.push({value:n,type:r[0].replace(J," ")}),o=o.slice(n.length)),a.filter)!(r=X[i].exec(o))||u[i]&&!(r=u[i](r))||(n=r.shift(),s.push({value:n,type:i,matches:r}),o=o.slice(n.length));if(!n)break}return t?o.length:o?le.error(e):N(e,c).slice(0)},l=le.compile=function(e,t){var n,r=[],s=[],i=O[e+" "];if(!i){for(t||(t=d(e)),n=t.length;n--;)(i=Ie(t[n]))[A]?r.push(i):s.push(i);i=O(e,function(e,t){var n=t.length>0,r=e.length>0,s=function(s,i,o,c,u){var d,l,h,g=0,p="0",_=s&&[],b=[],w=f,S=s||r&&a.find.TAG("*",u),E=j+=null==w?1:Math.random()||.1,A=S.length;for(u&&(f=i==v||i||u);p!==A&&null!=(d=S[p]);p++){if(r&&d){for(l=0,i||d.ownerDocument==v||(m(d),o=!y);h=e[l++];)if(h(d,i||v,o)){c.push(d);break}u&&(j=E)}n&&((d=!h&&d)&&g--,s&&_.push(d))}if(g+=p,n&&p!==g){for(l=0;h=t[l++];)h(_,b,i,o);if(s){if(g>0)for(;p--;)_[p]||b[p]||(b[p]=$.call(c));b=je(b)}P.apply(c,b),u&&!s&&b.length>0&&g+t.length>1&&le.uniqueSort(c)}return u&&(j=E,f=w),_};return n?fe(s):s}(s,r)),i.selector=e}return i},h=le.select=function(e,t,n,r){var s,i,o,c,u,h="function"==typeof e&&e,f=!r&&d(e=h.selector||e);if(n=n||[],1===f.length){if((i=f[0]=f[0].slice(0)).length>2&&"ID"===(o=i[0]).type&&9===t.nodeType&&y&&a.relative[i[1].type]){if(!(t=(a.find.ID(o.matches[0].replace(ie,oe),t)||[])[0]))return n;h&&(t=t.parentNode),e=e.slice(i.shift().value.length)}for(s=X.needsContext.test(e)?0:i.length;s--&&(o=i[s],!a.relative[c=o.type]);)if((u=a.find[c])&&(r=u(o.matches[0].replace(ie,oe),se.test(i[0].type)&&we(t.parentNode)||t))){if(i.splice(s,1),!(e=r.length&&Ee(i)))return P.apply(n,r),n;break}}return(h||l(e,f))(r,t,!y,n,!t||se.test(e)&&we(t.parentNode)||t),n},o.sortStable=A.split("").sort(T).join("")===A,o.detectDuplicates=!!p,m(),o.sortDetached=ge((function(e){return 1&e.compareDocumentPosition(v.createElement("fieldset"))})),ge((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||pe("type|href|height|width",(function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),o.attributes&&ge((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||pe("value",(function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),ge((function(e){return null==e.getAttribute("disabled")}))||pe(z,(function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}));var Ne=s.Sizzle;le.noConflict=function(){return s.Sizzle===le&&(s.Sizzle=Ne),le},void 0===(r=function(){return le}.call(t,n,t,e))||(e.exports=r)}(window)},6404:(e,t,n)=>{var r={"./af/LC_MESSAGES/converse.po":[4534,5830],"./ar/LC_MESSAGES/converse.po":[4201,4469],"./bg/LC_MESSAGES/converse.po":[5384,2551],"./ca/LC_MESSAGES/converse.po":[122,1553],"./cs/LC_MESSAGES/converse.po":[3893,5301],"./da/LC_MESSAGES/converse.po":[7889,1163],"./de/LC_MESSAGES/converse.po":[1658,2895],"./el/LC_MESSAGES/converse.po":[7530,5524],"./eo/LC_MESSAGES/converse.po":[1758,2433],"./es/LC_MESSAGES/converse.po":[7790,8269],"./eu/LC_MESSAGES/converse.po":[9398,3103],"./fa/LC_MESSAGES/converse.po":[2897,321],"./fi/LC_MESSAGES/converse.po":[9583,7618],"./fr/LC_MESSAGES/converse.po":[5011,5129],"./gl/LC_MESSAGES/converse.po":[8816,777],"./he/LC_MESSAGES/converse.po":[6725,4363],"./hi/LC_MESSAGES/converse.po":[411,4468],"./hu/LC_MESSAGES/converse.po":[2825,6239],"./id/LC_MESSAGES/converse.po":[6042,6678],"./it/LC_MESSAGES/converse.po":[3741,3719],"./ja/LC_MESSAGES/converse.po":[6893,6249],"./lt/LC_MESSAGES/converse.po":[5176,513],"./mr/LC_MESSAGES/converse.po":[6292,1784],"./nb/LC_MESSAGES/converse.po":[8467,473],"./nl/LC_MESSAGES/converse.po":[8544,2473],"./nl_BE/LC_MESSAGES/converse.po":[8133,8131],"./oc/LC_MESSAGES/converse.po":[8857,5500],"./pl/LC_MESSAGES/converse.po":[2503,3606],"./pt/LC_MESSAGES/converse.po":[1132,6227],"./pt_BR/LC_MESSAGES/converse.po":[6380,1455],"./ro/LC_MESSAGES/converse.po":[9740,3539],"./ru/LC_MESSAGES/converse.po":[2276,7917],"./si/LC_MESSAGES/converse.po":[4319,9437],"./sq/LC_MESSAGES/converse.po":[6392,3631],"./sv/LC_MESSAGES/converse.po":[1025,8859],"./th/LC_MESSAGES/converse.po":[4297,457],"./tr/LC_MESSAGES/converse.po":[2266,4195],"./ug/LC_MESSAGES/converse.po":[3915,8676],"./uk/LC_MESSAGES/converse.po":[9642,7979],"./vi/LC_MESSAGES/converse.po":[1298,2110],"./zh_CN/LC_MESSAGES/converse.po":[9771,3325],"./zh_TW/LC_MESSAGES/converse.po":[4133,1458]};function s(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],s=t[0];return n.e(t[1]).then((()=>n.t(s,19)))}s.keys=()=>Object.keys(r),s.id=6404,e.exports=s},7156:e=>{function t(e,t,n,r,s,i,o){try{var a=e[i](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,s)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(s,i){var o=e.apply(n,r);function a(e){t(o,s,i,a,c,"next",e)}function c(e){t(o,s,i,a,c,"throw",e)}a(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},8416:(e,t,n)=>{var r=n(4062);e.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},4836:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},7061:(e,t,n)=>{var r=n(8698).default;function s(){"use strict";e.exports=s=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},i=Object.prototype,o=i.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",d=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function h(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(t){h=function(e,t,n){return e[t]=n}}function f(e,t,n,r){var s=t&&t.prototype instanceof b?t:b,i=Object.create(s.prototype),o=new M(r||[]);return a(i,"_invoke",{value:N(e,n,o)}),i}function g(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=f;var p="suspendedStart",m="suspendedYield",v="executing",_="completed",y={};function b(){}function w(){}function S(){}var E={};h(E,u,(function(){return this}));var A=Object.getPrototypeOf,x=A&&A(A(R([])));x&&x!==i&&o.call(x,u)&&(E=x);var j=S.prototype=b.prototype=Object.create(E);function C(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function n(s,i,a,c){var u=g(e[s],e,i);if("throw"!==u.type){var d=u.arg,l=d.value;return l&&"object"==r(l)&&o.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):t.resolve(l).then((function(e){d.value=e,a(d)}),(function(e){return n("throw",e,a,c)}))}c(u.arg)}var s;a(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,s){n(e,r,t,s)}))}return s=s?s.then(i,i):i()}})}function N(e,n,r){var s=p;return function(i,o){if(s===v)throw new Error("Generator is already running");if(s===_){if("throw"===i)throw o;return{value:t,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var c=O(a,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(s===p)throw s=_,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s=v;var u=g(e,n,r);if("normal"===u.type){if(s=r.done?_:m,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(s=_,r.method="throw",r.arg=u.arg)}}}function O(e,n){var r=n.method,s=e.iterator[r];if(s===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,O(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=g(s,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var o=i.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function R(e){if(e||""===e){var n=e[u];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,i=function n(){for(;++s<e.length;)if(o.call(e,s))return n.value=e[s],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(r(e)+" is not iterable")}return w.prototype=S,a(j,"constructor",{value:S,configurable:!0}),a(S,"constructor",{value:w,configurable:!0}),w.displayName=h(S,l,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,h(e,l,"GeneratorFunction")),e.prototype=Object.create(j),e},n.awrap=function(e){return{__await:e}},C(I.prototype),h(I.prototype,d,(function(){return this})),n.AsyncIterator=I,n.async=function(e,t,r,s,i){void 0===i&&(i=Promise);var o=new I(f(e,t,r,s),i);return n.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},C(j),h(j,l,"Generator"),h(j,u,(function(){return this})),h(j,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=R,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,s){return a.type="throw",a.arg=e,n.next=r,s&&(n.method="next",n.arg=t),!!s}for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var i=s?s.completion:{};return i.type=e,i.arg=t,s?(this.method="next",this.next=s.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var s=r.arg;T(n)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:R(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},n}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports},5036:(e,t,n)=>{var r=n(8698).default;e.exports=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!==r(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},4062:(e,t,n)=>{var r=n(8698).default,s=n(5036);e.exports=function(e){var t=s(e,"string");return"symbol"===r(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports},8698:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4687:(e,t,n)=>{var r=n(7061)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}},i={};function o(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={id:e,loaded:!1,exports:{}};return s[e].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}o.m=s,o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var s=Object.create(null);o.r(s);var i={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>i[e]=()=>n[e]));return i.default=()=>n,o.d(s,i),s},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,n)=>(o.f[n](e,t),t)),[])),o.u=e=>({52:"locales/dayjs/de-js",102:"locales/dayjs/ca-js",145:"locales/dayjs/me-js",265:"locales/dayjs/pt-js",280:"locales/dayjs/bn-js",321:"locales/fa-LC_MESSAGES-converse-po",457:"locales/th-LC_MESSAGES-converse-po",473:"locales/nb-LC_MESSAGES-converse-po",485:"locales/dayjs/ar-sa-js",513:"locales/lt-LC_MESSAGES-converse-po",535:"locales/dayjs/en-js",555:"locales/dayjs/tet-js",559:"locales/dayjs/ru-js",578:"locales/dayjs/bg-js",631:"locales/dayjs/lv-js",646:"locales/dayjs/nb-js",688:"locales/dayjs/ga-js",760:"locales/dayjs/br-js",777:"locales/gl-LC_MESSAGES-converse-po",825:"locales/dayjs/gom-latn-js",882:"locales/dayjs/ms-my-js",911:"locales/dayjs/es-pr-js",1107:"locales/dayjs/ja-js",1110:"locales/dayjs/uz-latn-js",1163:"locales/da-LC_MESSAGES-converse-po",1194:"locales/dayjs/is-js",1204:"locales/dayjs/lo-js",1211:"locales/dayjs/pl-js",1298:"locales/dayjs/sd-js",1351:"locales/dayjs/bn-bd-js",1396:"locales/dayjs/eu-js",1455:"locales/pt_BR-LC_MESSAGES-converse-po",1458:"locales/zh_TW-LC_MESSAGES-converse-po",1520:"locales/dayjs/nl-js",1553:"locales/ca-LC_MESSAGES-converse-po",1606:"locales/dayjs/el-js",1619:"locales/dayjs/uk-js",1679:"locales/dayjs/de-ch-js",1729:"locales/dayjs/th-js",1735:"locales/dayjs/en-sg-js",1784:"locales/mr-LC_MESSAGES-converse-po",1880:"locales/dayjs/it-js",1910:"locales/dayjs/fr-js",1942:"locales/dayjs/se-js",2110:"locales/vi-LC_MESSAGES-converse-po",2130:"locales/dayjs/fi-js",2263:"locales/dayjs/bm-js",2433:"locales/eo-LC_MESSAGES-converse-po",2446:"locales/dayjs/tg-js",2473:"locales/nl-LC_MESSAGES-converse-po",2475:"locales/dayjs/km-js",2548:"locales/dayjs/da-js",2551:"locales/bg-LC_MESSAGES-converse-po",2814:"locales/dayjs/tlh-js",2843:"locales/dayjs/tzl-js",2895:"locales/de-LC_MESSAGES-converse-po",2984:"locales/dayjs/bi-js",2990:"locales/dayjs/ar-iq-js",3103:"locales/eu-LC_MESSAGES-converse-po",3153:"locales/dayjs/uz-js",3155:"locales/dayjs/nl-be-js",3208:"locales/dayjs/es-us-js",3221:"locales/dayjs/rw-js",3325:"locales/zh_CN-LC_MESSAGES-converse-po",3411:"locales/dayjs/es-js",3435:"locales/dayjs/sr-cyrl-js",3446:"locales/dayjs/ko-js",3463:"locales/dayjs/en-il-js",3521:"locales/dayjs/ar-ly-js",3539:"locales/ro-LC_MESSAGES-converse-po",3606:"locales/pl-LC_MESSAGES-converse-po",3623:"locales/dayjs/gu-js",3631:"locales/sq-LC_MESSAGES-converse-po",3719:"locales/it-LC_MESSAGES-converse-po",3755:"locales/dayjs/zh-hk-js",3933:"locales/dayjs/tzm-latn-js",4035:"locales/dayjs/en-ca-js",4153:"locales/dayjs/et-js",4195:"locales/tr-LC_MESSAGES-converse-po",4305:"locales/dayjs/jv-js",4342:"locales/dayjs/tzm-js",4363:"locales/he-LC_MESSAGES-converse-po",4423:"locales/dayjs/x-pseudo-js",4468:"locales/hi-LC_MESSAGES-converse-po",4469:"locales/ar-LC_MESSAGES-converse-po",4481:"locales/dayjs/cv-js",4610:"emojis",4678:"locales/dayjs/rn-js",4951:"locales/dayjs/mk-js",4963:"locales/dayjs/az-js",5050:"locales/dayjs/gd-js",5055:"locales/dayjs/ky-js",5073:"locales/dayjs/am-js",5121:"locales/dayjs/eo-js",5129:"locales/fr-LC_MESSAGES-converse-po",5166:"locales/dayjs/my-js",5186:"locales/dayjs/ka-js",5206:"locales/dayjs/kk-js",5215:"locales/dayjs/lb-js",5256:"locales/dayjs/tk-js",5274:"locales/dayjs/pt-br-js",5301:"locales/cs-LC_MESSAGES-converse-po",5313:"locales/dayjs/ar-ma-js",5407:"locales/dayjs/hy-am-js",5485:"locales/dayjs/en-au-js",5500:"locales/oc-LC_MESSAGES-converse-po",5524:"locales/el-LC_MESSAGES-converse-po",5544:"locales/dayjs/fa-js",5569:"locales/dayjs/dv-js",5600:"locales/dayjs/mr-js",5818:"locales/dayjs/gl-js",5822:"locales/dayjs/ht-js",5830:"locales/af-LC_MESSAGES-converse-po",5850:"locales/dayjs/pa-in-js",6010:"locales/dayjs/it-ch-js",6031:"locales/dayjs/en-gb-js",6105:"locales/dayjs/en-tt-js",6227:"locales/pt-LC_MESSAGES-converse-po",6239:"locales/hu-LC_MESSAGES-converse-po",6249:"locales/ja-LC_MESSAGES-converse-po",6376:"locales/dayjs/fy-js",6678:"locales/id-LC_MESSAGES-converse-po",6740:"locales/dayjs/cy-js",6755:"locales/dayjs/ar-js",6776:"locales/dayjs/zh-tw-js",6783:"locales/dayjs/sk-js",6890:"locales/dayjs/ug-cn-js",6898:"locales/dayjs/en-in-js",7024:"locales/dayjs/ku-js",7050:"locales/dayjs/nn-js",7175:"locales/dayjs/de-at-js",7203:"locales/dayjs/oc-lnc-js",7363:"locales/dayjs/fr-ca-js",7390:"locales/dayjs/sr-js",7400:"locales/dayjs/cs-js",7416:"locales/dayjs/es-mx-js",7419:"locales/dayjs/hr-js",7454:"locales/dayjs/mi-js",7523:"locales/dayjs/kn-js",7618:"locales/fi-LC_MESSAGES-converse-po",7645:"locales/dayjs/ta-js",7679:"locales/dayjs/ml-js",7714:"locales/dayjs/te-js",7899:"locales/dayjs/lt-js",7917:"locales/ru-LC_MESSAGES-converse-po",7952:"locales/dayjs/fr-ch-js",7979:"locales/uk-LC_MESSAGES-converse-po",8010:"locales/dayjs/hi-js",8022:"locales/dayjs/ro-js",8040:"locales/dayjs/ar-tn-js",8073:"locales/dayjs/vi-js",8129:"locales/dayjs/en-ie-js",8131:"locales/nl_BE-LC_MESSAGES-converse-po",8214:"locales/dayjs/hu-js",8269:"locales/es-LC_MESSAGES-converse-po",8458:"locales/dayjs/zh-js",8547:"locales/dayjs/en-nz-js",8603:"locales/dayjs/sq-js",8618:"locales/dayjs/mn-js",8665:"locales/dayjs/tr-js",8676:"locales/ug-LC_MESSAGES-converse-po",8692:"locales/dayjs/yo-js",8745:"locales/dayjs/fo-js",8758:"locales/dayjs/es-do-js",8859:"locales/sv-LC_MESSAGES-converse-po",9030:"locales/dayjs/ne-js",9095:"locales/dayjs/ms-js",9210:"locales/dayjs/af-js",9238:"locales/dayjs/ss-js",9333:"locales/dayjs/si-js",9372:"locales/dayjs/he-js",9406:"locales/dayjs/ar-dz-js",9437:"locales/si-LC_MESSAGES-converse-po",9443:"locales/dayjs/tl-ph-js",9478:"locales/dayjs/be-js",9513:"locales/dayjs/id-js",9568:"locales/dayjs/ur-js",9625:"locales/dayjs/sl-js",9630:"locales/dayjs/zh-cn-js",9652:"locales/dayjs/sv-js",9665:"locales/dayjs/mt-js",9733:"locales/dayjs/sw-js",9833:"locales/dayjs/bs-js",9897:"locales/dayjs/ar-kw-js",9950:"locales/dayjs/bo-js",9997:"locales/dayjs/sv-fi-js"}[e]+".js"),o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n={},r="converse:",o.l=(e,t,s,i)=>{if(n[e])n[e].push(t);else{var a,c;if(void 0!==s)for(var u=document.getElementsByTagName("script"),d=0;d<u.length;d++){var l=u[d];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==r+s){a=l;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",r+s),a.src=e),n[e]=[t];var h=(t,r)=>{a.onerror=a.onload=null,clearTimeout(f);var s=n[e];if(delete n[e],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((e=>e(r))),t)return t(r)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.p="",(()=>{var e={7267:0,2729:0};o.f.j=(t,n)=>{var r=o.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var s=new Promise(((n,s)=>r=e[t]=[n,s]));n.push(r[2]=s);var i=o.p+o.u(t),a=new Error;o.l(i,(n=>{if(o.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var s=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+i+")",a.name="ChunkLoadError",a.type=s,a.request=i,r[1](a)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,s,[i,a,c]=n,u=0;if(i.some((t=>0!==e[t]))){for(r in a)o.o(a,r)&&(o.m[r]=a[r]);if(c)c(o)}for(t&&t(n);u<i.length;u++)s=i[u],o.o(e,s)&&e[s]&&e[s][0](),e[s]=0},n=this.webpackChunkconverse=this.webpackChunkconverse||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a={};return(()=>{"use strict";o.r(a),o.d(a,{_converse:()=>er,api:()=>xh,converse:()=>Ah,default:()=>Uy,i18n:()=>Te,log:()=>Fe});var e={};o.r(e),o.d(e,{DOMParser:()=>r,WebSocket:()=>n,getDummyXMLDOMDocument:()=>s});var t={};o.r(t),o.d(t,{addCookies:()=>S,arrayBufToBase64:()=>y,base64ToArrayBuf:()=>b,copyElement:()=>T,createHtml:()=>k,default:()=>G,escapeNode:()=>L,forEachChild:()=>D,getBareJidFromJid:()=>H,getDomainFromJid:()=>B,getNodeFromJid:()=>U,getResourceFromJid:()=>q,getText:()=>F,isTagEqual:()=>P,serialize:()=>$,stringToArrayBuf:()=>w,unescapeNode:()=>z,utf16to8:()=>v,validAttribute:()=>N,validCSS:()=>O,validTag:()=>I,xmlElement:()=>C,xmlGenerator:()=>A,xmlHtmlNode:()=>j,xmlTextNode:()=>x,xmlescape:()=>M,xmlunescape:()=>R,xorArrayBuffers:()=>_});const n=window.WebSocket,r=window.DOMParser;function s(){return document.implementation.createDocument("jabber:client","strophe",null)}const i={HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},c={tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"]},u={ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10,BINDREQUIRED:11,ATTACHFAIL:12,RECONNECTING:13},d={NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11};function l(e,t){return new p(e,t)}function h(e){return new p("message",e)}function f(e){return new p("iq",e)}function g(e){return new p("presence",e)}class p{constructor(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=i.CLIENT:t||(t={xmlns:i.CLIENT})),this.nodeTree=C(e,t),this.node=this.nodeTree}tree(){return this.nodeTree}toString(){return $(this.nodeTree)}up(){return this.node=this.node.parentElement,this}root(){return this.node=this.nodeTree,this}attrs(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(null!=e[t]?this.node.setAttribute(t,e[t].toString()):this.node.removeAttribute(t));return this}c(e,t,n){const r=C(e,t,n);return this.node.appendChild(r),"string"!=typeof n&&"number"!=typeof n&&(this.node=r),this}cnode(e){let t;const n=A();try{t=void 0!==n.importNode}catch(e){t=!1}const r=t?n.importNode(e,!0):T(e);return this.node.appendChild(r),this.node=r,this}t(e){const t=x(e);return this.node.appendChild(t),this}h(e){const t=A().createElement("body");t.innerHTML=e;const n=k(t);for(;n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}}const m=p;function v(e){let t="";const n=e.length;for(let r=0;r<n;r++){const n=e.charCodeAt(r);n>=0&&n<=127?t+=e.charAt(r):n>2047?(t+=String.fromCharCode(224|n>>12&15),t+=String.fromCharCode(128|n>>6&63),t+=String.fromCharCode(128|n>>0&63)):(t+=String.fromCharCode(192|n>>6&31),t+=String.fromCharCode(128|n>>0&63))}return t}function _(e,t){const n=new Uint8Array(e),r=new Uint8Array(t),s=new Uint8Array(e.byteLength);for(let t=0;t<e.byteLength;t++)s[t]=n[t]^r[t];return s.buffer}function y(e){let t="";const n=new Uint8Array(e),r=n.byteLength;for(let e=0;e<r;e++)t+=String.fromCharCode(n[e]);return btoa(t)}function b(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))?.buffer}function w(e){return(new TextEncoder).encode(e).buffer}function S(e){"undefined"==typeof document&&ge.log(ge.LogLevel.ERROR,"addCookies: not adding any cookies, since there's no document object"),e=e||{};for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let n="",r="",s="";const i=e[t],o="object"==typeof i,a=escape(unescape(o?i.value:i));o&&(n=i.expires?";expires="+i.expires:"",r=i.domain?";domain="+i.domain:"",s=i.path?";path="+i.path:""),document.cookie=t+"="+a+n+r+s}}let E=null;function A(){return E||(E=s()),E}function x(e){return A().createTextNode(e)}function j(e){return(new r).parseFromString(e,"text/xml")}function C(e,t,n){if(!e)return null;const r=A().createElement(e);if(!n||"string"!=typeof n&&"number"!=typeof n){if("string"==typeof t||"number"==typeof t)return r.appendChild(x(t.toString())),r;if(!t)return r}else r.appendChild(x(n.toString()));if(Array.isArray(t))for(const e of t)Array.isArray(e)&&null!=e[0]&&null!=e[1]&&r.setAttribute(e[0],e[1]);else for(const e of Object.keys(t))e&&null!=t[e]&&r.setAttribute(e,t[e].toString());return r}function I(e){for(let t=0;t<c.tags.length;t++)if(e===c.tags[t])return!0;return!1}function N(e,t){const n=c.attributes[e];if(n?.length>0)for(let e=0;e<n.length;e++)if(t===n[e])return!0;return!1}function O(e){for(let t=0;t<c.css.length;t++)if(e===c.css[t])return!0;return!1}function k(e){if(e.nodeType===d.NORMAL)return function(e){let t;const n=e.nodeName.toLowerCase();if(I(n))try{if(t=C(n),n in c.attributes){const r=c.attributes[n];for(let n=0;n<r.length;n++){const s=r[n];let i=e.getAttribute(s);if(null!=i&&""!==i)if("style"===s&&"object"==typeof i&&(i=i.cssText??i),"style"===s){const e=[],n=i.split(";");for(let t=0;t<n.length;t++){const r=n[t].split(":"),s=r[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(O(s)){const t=r[1].replace(/^\s*/,"").replace(/\s*$/,"");e.push(s+": "+t)}}e.length>0&&(i=e.join("; "),t.setAttribute(s,i))}else t.setAttribute(s,i)}for(let n=0;n<e.childNodes.length;n++)t.appendChild(k(e.childNodes[n]))}}catch(e){t=x("")}else{t=A().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(k(e.childNodes[n]))}return t}(e);if(e.nodeType===d.FRAGMENT){const t=A().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(k(e.childNodes[n]));return t}return e.nodeType===d.TEXT?x(e.nodeValue):void 0}function T(e){let t;if(e.nodeType===d.NORMAL){const n=e;t=C(n.tagName);for(let e=0;e<n.attributes.length;e++)t.setAttribute(n.attributes[e].nodeName,n.attributes[e].value);for(let e=0;e<n.childNodes.length;e++)t.appendChild(T(n.childNodes[e]))}else e.nodeType===d.TEXT&&(t=A().createTextNode(e.nodeValue));return t}function M(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")}function R(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')}function $(e){if(!e)return null;const t=e instanceof m?e.tree():e,n=[...Array(t.attributes.length).keys()].map((e=>t.attributes[e].nodeName));n.sort();let r=n.reduce(((e,n)=>`${e} ${n}="${M(t.attributes.getNamedItem(n).value)}"`),`<${t.nodeName}`);if(t.childNodes.length>0){r+=">";for(let e=0;e<t.childNodes.length;e++){const n=t.childNodes[e];switch(n.nodeType){case d.NORMAL:r+=$(n);break;case d.TEXT:r+=M(n.nodeValue);break;case d.CDATA:r+="<![CDATA["+n.nodeValue+"]]>"}}r+="</"+t.nodeName+">"}else r+="/>";return r}function D(e,t,n){for(let r=0;r<e.childNodes.length;r++){const s=e.childNodes[r];s.nodeType!==d.NORMAL||t&&!this.isTagEqual(s,t)||n(s)}}function P(e,t){return e.tagName===t}function F(e){if(!e)return null;let t="";e.childNodes?.length||e.nodeType!==d.TEXT||(t+=e.nodeValue);for(let n=0;n<e.childNodes?.length;n++)e.childNodes[n].nodeType===d.TEXT&&(t+=e.childNodes[n].nodeValue);return M(t)}function L(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")}function z(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")}function U(e){return e.indexOf("@")<0?null:e.split("@")[0]}function B(e){const t=H(e);if(t.indexOf("@")<0)return t;{const e=t.split("@");return e.splice(0,1),e.join("@")}}function q(e){if(!e)return null;const t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))}function H(e){return e?e.split("/")[0]:null}const G={utf16to8:v,xorArrayBuffers:_,arrayBufToBase64:y,base64ToArrayBuf:b,stringToArrayBuf:w,addCookies:S};const J=class{constructor(e,t,n,r,s,i,o){this.handler=e,this.ns=t,this.name=n,this.type=r,this.id=s,this.options=o||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBareFromJid?this.from=i?H(i):null:this.from=i,this.user=!0}getNamespace(e){let t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t}namespaceMatch(e){let t=!1;return!this.ns||(D(e,null,(e=>{this.getNamespace(e)===this.ns&&(t=!0)})),t||this.getNamespace(e)===this.ns)}isMatch(e){let t=e.getAttribute("from");this.options.matchBareFromJid&&(t=H(t));const n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!ge.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)}run(e){let t=null;try{t=this.handler(e)}catch(e){throw ge._handleError(e),e}return t}toString(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}};const W=class{constructor(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0}run(){return this.lastCalled=(new Date).getTime(),this.handler()}reset(){this.lastCalled=(new Date).getTime()}toString(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}};var Q=o(9494);class K extends Error{constructor(e){super(e),this.name="StropheSessionError"}}const V=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.service=e,this.options=t,this.setProtocol(),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_bind=!1,this.do_session=!1,this.mechanisms={},this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout((()=>this._onIdle()),100),S(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),this.iqFallbackHandler=new J((e=>this.send(f({type:"error",id:e.getAttribute("id")}).c("error",{type:"cancel"}).c("service-unavailable",{xmlns:ge.NS.STANZAS}))),null,"iq",["get","set"]);for(const e in ge._connectionPlugins)if(Object.prototype.hasOwnProperty.call(ge._connectionPlugins,e)){const t=function(){};t.prototype=ge._connectionPlugins[e],this[e]=new t,this[e].init(this)}}setProtocol(){const e=this.options.protocol||"";this.options.worker?this._proto=new ge.WorkerWebsocket(this):0===this.service.indexOf("ws:")||0===this.service.indexOf("wss:")||0===e.indexOf("ws")?this._proto=new ge.Websocket(this):this._proto=new ge.Bosh(this)}reset(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0}pause(){this.paused=!0}resume(){this.paused=!1}getUniqueId(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t+""}addProtocolErrorHandler(e,t,n){this.protocolErrorHandlers[e][t]=n}connect(e,t,n,r,s,i,o){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3e3;this.jid=e,this.authzid=ge.getBareJidFromJid(this.jid),this.authcid=o||ge.getNodeFromJid(this.jid),this.pass=t,this.scram_keys=null,this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.disconnection_timeout=a,this.domain=ge.getDomainFromJid(this.jid),this._changeConnectStatus(u.CONNECTING,null),this._proto._connect(r,s,i)}attach(e,t,n,r,s,i,o){if(this._proto instanceof ge.Bosh)return this._proto._attach(e,t,n,r,s,i,o);throw new K('The "attach" method is not available for your connection protocol')}restore(e,t,n,r,s){if(!(this._proto instanceof ge.Bosh&&this._sessionCachingSupported()))throw new K('The "restore" method can only be used with a BOSH connection.');this._sessionCachingSupported()&&this._proto._restore(e,t,n,r,s)}_sessionCachingSupported(){if(this._proto instanceof ge.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1}xmlInput(e){}xmlOutput(e){}rawInput(e){}rawOutput(e){}nextValidRid(e){}send(e){if(null!==e){if(Array.isArray(e))e.forEach((e=>this._queueData(e instanceof m?e.tree():e)));else{const t=e instanceof m?e.tree():e;this._queueData(t)}this._proto._send()}}flush(){clearTimeout(this._idleTimeout),this._onIdle()}sendPresence(e,t,n,r){let s=null;const i=e instanceof m?e.tree():e;let o=i.getAttribute("id");if(o||(o=this.getUniqueId("sendPresence"),i.setAttribute("id",o)),"function"==typeof t||"function"==typeof n){const e=this.addHandler((e=>{s&&this.deleteTimedHandler(s),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)}),null,"presence",null,o);r&&(s=this.addTimedHandler(r,(()=>(this.deleteHandler(e),n&&n(null),!1))))}return this.send(i),o}sendIQ(e,t,n,r){let s=null;const i=e instanceof m?e.tree():e;let o=i.getAttribute("id");if(o||(o=this.getUniqueId("sendIQ"),i.setAttribute("id",o)),"function"==typeof t||"function"==typeof n){const e=this.addHandler((e=>{s&&this.deleteTimedHandler(s);const r=e.getAttribute("type");if("result"===r)t&&t(e);else{if("error"!==r){const e=new Error(`Got bad IQ type of ${r}`);throw e.name="StropheError",e}n&&n(e)}}),null,"iq",["error","result"],o);r&&(s=this.addTimedHandler(r,(()=>(this.deleteHandler(e),n&&n(null),!1))))}return this.send(i),o}_queueData(e){if(null===e||!e.tagName||!e.childNodes){const e=new Error("Cannot queue non-DOMElement.");throw e.name="StropheError",e}this._data.push(e)}_sendRestart(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout((()=>this._onIdle()),100)}addTimedHandler(e,t){const n=new ge.TimedHandler(e,t);return this.addTimeds.push(n),n}deleteTimedHandler(e){this.removeTimeds.push(e)}addHandler(e,t,n,r,s,i,o){const a=new J(e,t,n,r,s,i,o);return this.addHandlers.push(a),a}deleteHandler(e){this.removeHandlers.push(e);const t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)}registerSASLMechanisms(e){this.mechanisms={},(e||[ge.SASLAnonymous,ge.SASLExternal,ge.SASLOAuthBearer,ge.SASLXOAuth2,ge.SASLPlain,ge.SASLSHA1,ge.SASLSHA256,ge.SASLSHA384,ge.SASLSHA512]).forEach((e=>this.registerSASLMechanism(e)))}registerSASLMechanism(e){const t=new e;this.mechanisms[t.mechname]=t}disconnect(e){if(this._changeConnectStatus(u.DISCONNECTING,e),e?ge.warn("Disconnect was called because: "+e):ge.info("Disconnect was called"),this.connected){let e=null;this.disconnecting=!0,this.authenticated&&(e=g({xmlns:ge.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(this.disconnection_timeout,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else ge.warn("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()}_changeConnectStatus(e,t,n){for(const n in ge._connectionPlugins)if(Object.prototype.hasOwnProperty.call(ge._connectionPlugins,n)){const r=this[n];if(r.statusChanged)try{r.statusChanged(e,t)}catch(e){ge.error(`${n} plugin caused an exception changing status: ${e}`)}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){ge._handleError(e),ge.error(`User connection callback caused an exception: ${e}`)}}_doDisconnect(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),ge.debug("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(u.DISCONNECTED,e),this.connected=!1}_dataRecv(e,t){const n="_reqToData"in this._proto?this._proto._reqToData(e):e;if(null===n)return;for(this.xmlInput!==ge.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==ge.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(ge.serialize(n)));this.removeHandlers.length>0;){const e=this.removeHandlers.pop(),t=this.handlers.indexOf(e);t>=0&&this.handlers.splice(t,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();const r=n.getAttribute("type");if(null!==r&&"terminate"===r){if(this.disconnecting)return;let e=n.getAttribute("condition");const t=n.getElementsByTagName("conflict");return null!==e?("remote-stream-error"===e&&t.length>0&&(e="conflict"),this._changeConnectStatus(u.CONNFAIL,e)):this._changeConnectStatus(u.CONNFAIL,ge.ErrorCondition.UNKNOWN_REASON),void this._doDisconnect(e)}ge.forEachChild(n,null,(e=>{const t=[];this.handlers=this.handlers.reduce(((n,r)=>{try{!r.isMatch(e)||!this.authenticated&&r.user?n.push(r):(r.run(e)&&n.push(r),t.push(r))}catch(e){ge.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}return n}),[]),!t.length&&this.iqFallbackHandler.isMatch(e)&&this.iqFallbackHandler.run(e)}))}_connect_cb(e,t,n){let r;ge.debug("_connect_cb was called"),this.connected=!0;try{r="_reqToData"in this._proto?this._proto._reqToData(e):e}catch(e){if(e.name!==ge.ErrorCondition.BAD_FORMAT)throw e;this._changeConnectStatus(u.CONNFAIL,ge.ErrorCondition.BAD_FORMAT),this._doDisconnect(ge.ErrorCondition.BAD_FORMAT)}if(!r)return;this.xmlInput!==ge.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==ge.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(ge.serialize(r)));if(this._proto._connect_cb(r)===u.CONNFAIL)return;let s;if(s=r.getElementsByTagNameNS?r.getElementsByTagNameNS(ge.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0,!s)return void this._proto._no_auth_received(t);const i=Array.from(r.getElementsByTagName("mechanism")).map((e=>this.mechanisms[e.textContent])).filter((e=>e));0!==i.length||0!==r.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(i):this._proto._no_auth_received(t)}sortMechanismsByPriority(e){for(let t=0;t<e.length-1;++t){let n=t;for(let r=t+1;r<e.length;++r)e[r].priority>e[n].priority&&(n=r);if(n!==t){const r=e[t];e[t]=e[n],e[n]=r}}return e}authenticate(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()}_attemptSASLAuth(e){e=this.sortMechanismsByPriority(e||[]);let t=!1;for(let n=0;n<e.length;++n){if(!e[n].test(this))continue;this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=e[n],this._sasl_mechanism.onStart(this);const r=l("auth",{xmlns:ge.NS.SASL,mechanism:this._sasl_mechanism.mechname});if(this._sasl_mechanism.isClientFirst){const e=this._sasl_mechanism.clientChallenge(this);r.t((0,Q.btoa)(e))}this.send(r.tree()),t=!0;break}return t}async _sasl_challenge_cb(e){const t=(0,Q.atob)(F(e)),n=await this._sasl_mechanism.onChallenge(this,t),r=l("response",{xmlns:ge.NS.SASL});return n&&r.t((0,Q.btoa)(n)),this.send(r.tree()),!0}_attemptLegacyAuth(){null===ge.getNodeFromJid(this.jid)?(this._changeConnectStatus(u.CONNFAIL,ge.ErrorCondition.MISSING_JID_NODE),this.disconnect(ge.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(u.AUTHENTICATING,null),this._addSysHandler(this._onLegacyAuthIQResult.bind(this),null,null,null,"_auth_1"),this.send(f({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:ge.NS.AUTH}).c("username",{}).t(ge.getNodeFromJid(this.jid)).tree()))}_onLegacyAuthIQResult(){const e="string"==typeof this.pass?this.pass:"",t=f({type:"set",id:"_auth_2"}).c("query",{xmlns:ge.NS.AUTH}).c("username",{}).t(ge.getNodeFromJid(this.jid)).up().c("password").t(e);return ge.getResourceFromJid(this.jid)||(this.jid=ge.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(ge.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1}_sasl_success_cb(e){if(this._sasl_data["server-signature"]){let t;const n=/([a-z]+)=([^,]+)(,|$)/,r=(0,Q.atob)(F(e)).match(n);if("v"===r[1]&&(t=r[2]),t!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}ge.info("SASL authentication succeeded."),this._sasl_data.keys&&(this.scram_keys=this._sasl_data.keys),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);const t=[],n=(e,t)=>{for(;e.length;)this.deleteHandler(e.pop());return this._onStreamFeaturesAfterSASL(t),!1};return t.push(this._addSysHandler((e=>n(t,e)),null,"stream:features",null,null)),t.push(this._addSysHandler((e=>n(t,e)),ge.NS.STREAM,"features",null,null)),this._sendRestart(),!1}_onStreamFeaturesAfterSASL(e){this.features=e;for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}return this.do_bind?(this.options.explicitResourceBinding?this._changeConnectStatus(u.BINDREQUIRED,null):this.bind(),!1):(this._changeConnectStatus(u.AUTHFAIL,null),!1)}bind(){if(!this.do_bind)return void ge.log(ge.LogLevel.INFO,'Strophe.Connection.prototype.bind called but "do_bind" is false');this._addSysHandler(this._onResourceBindResultIQ.bind(this),null,null,null,"_bind_auth_2");const e=ge.getResourceFromJid(this.jid);e?this.send(f({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:ge.NS.BIND}).c("resource",{}).t(e).tree()):this.send(f({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:ge.NS.BIND}).tree())}_onResourceBindResultIQ(e){if("error"===e.getAttribute("type")){ge.warn("Resource binding failed.");let t;return e.getElementsByTagName("conflict").length>0&&(t=ge.ErrorCondition.CONFLICT),this._changeConnectStatus(u.AUTHFAIL,t,e),!1}const t=e.getElementsByTagName("bind");if(!(t.length>0))return ge.warn("Resource binding failed."),this._changeConnectStatus(u.AUTHFAIL,null,e),!1;{const e=t[0].getElementsByTagName("jid");e.length>0&&(this.authenticated=!0,this.jid=F(e[0]),this.do_session?this._establishSession():this._changeConnectStatus(u.CONNECTED,null))}}_establishSession(){if(!this.do_session)throw new Error(`Strophe.Connection.prototype._establishSession called but apparently ${ge.NS.SESSION} wasn't advertised by the server`);this._addSysHandler(this._onSessionResultIQ.bind(this),null,null,null,"_session_auth_2"),this.send(f({type:"set",id:"_session_auth_2"}).c("session",{xmlns:ge.NS.SESSION}).tree())}_onSessionResultIQ(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(u.CONNECTED,null);else if("error"===e.getAttribute("type"))return this.authenticated=!1,ge.warn("Session creation failed."),this._changeConnectStatus(u.AUTHFAIL,null,e),!1;return!1}_sasl_failure_cb(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(u.AUTHFAIL,null,e),!1}_auth2_cb(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(u.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(u.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1}_addSysTimedHandler(e,t){const n=new W(e,t);return n.user=!1,this.addTimeds.push(n),n}_addSysHandler(e,t,n,r,s){const i=new J(e,t,n,r,s);return i.user=!1,this.addHandlers.push(i),i}_onDisconnectTimeout(){return ge.debug("_onDisconnectTimeout was called"),this._changeConnectStatus(u.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1}_onIdle(){for(;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){const e=this.removeTimeds.pop(),t=this.timedHandlers.indexOf(e);t>=0&&this.timedHandlers.splice(t,1)}const e=(new Date).getTime(),t=[];for(let n=0;n<this.timedHandlers.length;n++){const r=this.timedHandlers[n];if(this.authenticated||!r.user){r.lastCalled+r.period-e<=0?r.run()&&t.push(r):t.push(r)}}this.timedHandlers=t,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout((()=>this._onIdle()),100))}};const Y=class{constructor(e,t,n){this.mechname=e,this.isClientFirst=t,this.priority=n}test(e){return!0}onStart(e){this._connection=e}onChallenge(e,t){throw new Error("You should implement challenge handling!")}clientChallenge(e){if(!this.isClientFirst)throw new Error("clientChallenge should not be called if isClientFirst is false!");return this.onChallenge(e)}onFailure(){this._connection=null}onSuccess(){this._connection=null}};const X=class extends Y{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ANONYMOUS",arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:20)}test(e){return null===e.authcid}};const Z=class extends Y{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"EXTERNAL",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:10)}onChallenge(e){return e.authcid===e.authzid?"":e.authzid}};const ee=class extends Y{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"OAUTHBEARER",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:40)}test(e){return null!==e.pass}onChallenge(e){let t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",G.utf16to8(t)}};const te=class extends Y{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PLAIN",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:50)}test(e){return null!==e.authcid}onChallenge(e){const{authcid:t,authzid:n,domain:r,pass:s}=e;if(!r)throw new Error("SASLPlain onChallenge: domain is not defined!");let i=n!==`${t}@${r}`?n:"";return i+="\0",i+=t,i+="\0",i+=s,G.utf16to8(i)}};const ne={async scramResponse(e,t,n,r){const s=e._sasl_data.cnonce,i=function(e){let t,n,r;const s=/([a-z]+)=([^,]+)(,|$)/;for(;e.match(s);){const i=e.match(s);switch(e=e.replace(i[0],""),i[1]){case"r":t=i[2];break;case"s":n=G.base64ToArrayBuf(i[2]);break;case"i":r=parseInt(i[2],10);break;default:return}}if(isNaN(r)||r<4096)ge.warn("Failing SCRAM authentication because server supplied iteration count < 4096.");else{if(n)return{nonce:t,salt:n,iter:r};ge.warn("Failing SCRAM authentication because server supplied incorrect salt.")}}(t);if(!i&&i?.nonce.slice(0,s.length)!==s)return ge.warn("Failing SCRAM authentication because server supplied incorrect nonce."),e._sasl_data={},e._sasl_failure_cb();let o,a;const{pass:c}=e;if("string"==typeof e.pass||e.pass instanceof String){const e=await async function(e,t,n,r,s){const i=await crypto.subtle.deriveBits({name:"PBKDF2",salt:t,iterations:n,hash:{name:r}},await crypto.subtle.importKey("raw",G.stringToArrayBuf(e),"PBKDF2",!1,["deriveBits"]),s),o=await crypto.subtle.importKey("raw",i,{name:"HMAC",hash:r},!1,["sign"]);return{ck:await crypto.subtle.sign("HMAC",o,G.stringToArrayBuf("Client Key")),sk:await crypto.subtle.sign("HMAC",o,G.stringToArrayBuf("Server Key"))}}(c,i.salt,i.iter,n,r);o=e.ck,a=e.sk}else{if(c?.name!==n||c?.salt!==G.arrayBufToBase64(i.salt)||c?.iter!==i.iter)return e._sasl_failure_cb();{const{ck:e,sk:t}=c;o=G.base64ToArrayBuf(e),a=G.base64ToArrayBuf(t)}}const u=e._sasl_data["client-first-message-bare"],d=t,l=`c=biws,r=${i.nonce}`,h=`${u},${d},${l}`,f=await async function(e,t,n){const r=await crypto.subtle.importKey("raw",await crypto.subtle.digest(n,t),{name:"HMAC",hash:n},!1,["sign"]),s=await crypto.subtle.sign("HMAC",r,G.stringToArrayBuf(e));return G.xorArrayBuffers(t,s)}(h,o,n),g=await async function(e,t,n){const r=await crypto.subtle.importKey("raw",t,{name:"HMAC",hash:n},!1,["sign"]);return crypto.subtle.sign("HMAC",r,G.stringToArrayBuf(e))}(h,a,n);return e._sasl_data["server-signature"]=G.arrayBufToBase64(g),e._sasl_data.keys={name:n,iter:i.iter,salt:G.arrayBufToBase64(i.salt),ck:G.arrayBufToBase64(o),sk:G.arrayBufToBase64(a)},`${l},p=${G.arrayBufToBase64(f)}`},clientChallenge(e,t){const n=t||function(){const e=new Uint8Array(16);return G.arrayBufToBase64(crypto.getRandomValues(e).buffer)}(),r=`n=${e.authcid},r=${n}`;return e._sasl_data.cnonce=n,e._sasl_data["client-first-message-bare"]=r,`n,,${r}`}};const re=class extends Y{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SCRAM-SHA-1",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:60)}test(e){return null!==e.authcid}async onChallenge(e,t){return await ne.scramResponse(e,t,"SHA-1",160)}clientChallenge(e,t){return ne.clientChallenge(e,t)}};const se=class extends Y{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SCRAM-SHA-256",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:70)}test(e){return null!==e.authcid}async onChallenge(e,t){return await ne.scramResponse(e,t,"SHA-256",256)}clientChallenge(e,t){return ne.clientChallenge(e,t)}};const ie=class extends Y{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SCRAM-SHA-384",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:71)}test(e){return null!==e.authcid}async onChallenge(e,t){return await ne.scramResponse(e,t,"SHA-384",384)}clientChallenge(e,t){return ne.clientChallenge(e,t)}};const oe=class extends Y{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SCRAM-SHA-512",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:72)}test(e){return null!==e.authcid}async onChallenge(e,t){return await ne.scramResponse(e,t,"SHA-512",512)}clientChallenge(e,t){return ne.clientChallenge(e,t)}};const ae=class extends Y{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"X-OAUTH2",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:30)}test(e){return null!==e.pass}onChallenge(e){let t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,G.utf16to8(t)}};const ce=class{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.id=++ge._requestId,this.xmlData=e,this.data=ge.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=r,this.abort=!1,this.dead=null,this.age=()=>this.date?((new Date).valueOf()-this.date.valueOf())/1e3:0,this.timeDead=()=>this.dead?((new Date).valueOf()-this.dead.valueOf())/1e3:0,this.xhr=this._newXHR()}getResponse(){let e=this.xhr.responseXML?.documentElement;if(e){if("parsererror"===e.tagName)throw ge.error("invalid response received"),ge.error("responseText: "+this.xhr.responseText),ge.error("responseXML: "+ge.serialize(e)),new Error("parsererror")}else if(this.xhr.responseText){ge.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),e=(new r).parseFromString(this.xhr.responseText,"application/xml").documentElement;const t=e?.querySelector("parsererror");if(!e||t){t&&(ge.error("invalid response received: "+t.textContent),ge.error("responseText: "+this.xhr.responseText));const e=new Error;throw e.name=ge.ErrorCondition.BAD_FORMAT,e}}return e}_newXHR(){const e=new XMLHttpRequest;return e.overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"),e.onreadystatechange=this.func.bind(null,this),e}};class ue{constructor(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.strip=ue.prototype.strip??!1,this.lastResponseHeaders=null,this._requests=[]}_buildBody(){const e=l("body",{rid:this.rid++,xmlns:ge.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e}_reset(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_connect(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;const r=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":ge.NS.BOSH});n&&r.attrs({route:n});const s=this._conn._connect_cb;this._requests.push(new ge.Request(r.tree(),this._onRequestStateChange.bind(this,s.bind(this._conn)),Number(r.tree().getAttribute("rid")))),this._throttledRequestHandler()}_attach(e,t,n,r,s,i,o){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=r,this._conn.domain=ge.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=s||this.wait,this.hold=i||this.hold,this.window=o||this.window,this._conn._changeConnectStatus(ge.Status.ATTACHED,null)}_restore(e,t,n,r,s){const i=JSON.parse(sessionStorage.getItem("strophe-bosh-session"));if(!(null!=i&&i.rid&&i.sid&&i.jid&&(null==e||ge.getBareJidFromJid(i.jid)===ge.getBareJidFromJid(e)||null===ge.getNodeFromJid(e)&&ge.getDomainFromJid(i.jid)===e))){const e=new Error("_restore: no restoreable session.");throw e.name="StropheSessionError",e}this._conn.restored=!0,this._attach(i.jid,i.sid,i.rid,t,n,r,s)}_cacheSession(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):sessionStorage.removeItem("strophe-bosh-session")}_connect_cb(e){const t=e.getAttribute("type");if(null!==t&&"terminate"===t){let t=e.getAttribute("condition");ge.error("BOSH-Connection failed: "+t);const n=e.getElementsByTagName("conflict");return null!==t?("remote-stream-error"===t&&n.length>0&&(t="conflict"),this._conn._changeConnectStatus(ge.Status.CONNFAIL,t)):this._conn._changeConnectStatus(ge.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(t),ge.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));const n=e.getAttribute("requests");n&&(this.window=parseInt(n,10));const r=e.getAttribute("hold");r&&(this.hold=parseInt(r,10));const s=e.getAttribute("wait");s&&(this.wait=parseInt(s,10));const i=e.getAttribute("inactivity");i&&(this.inactivity=parseInt(i,10))}_disconnect(e){this._sendTerminate(e)}_doDisconnect(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_emptyQueue(){return 0===this._requests.length}_callProtocolErrorHandlers(e){const t=ue._getRequestStatus(e),n=this._conn.protocolErrorHandlers.HTTP[t];n&&n.call(this,t)}_hitError(e){this.errors++,ge.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()}_no_auth_received(e){ge.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);const t=this._buildBody();this._requests.push(new ge.Request(t.tree(),this._onRequestStateChange.bind(this,e),Number(t.tree().getAttribute("rid")))),this._throttledRequestHandler()}_onDisconnectTimeout(){this._abortAllRequests()}_abortAllRequests(){for(;this._requests.length>0;){const e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}}_onIdle(){const e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(ge.debug("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){const t=this._buildBody();for(let n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":ge.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new ge.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),Number(t.tree().getAttribute("rid")))),this._throttledRequestHandler()}if(this._requests.length>0){const e=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(ge.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),e>Math.floor(ge.TIMEOUT*this.wait)&&(ge.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(ge.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}}static _getRequestStatus(e,t){let n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){ge.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof t?t:0),n}_onRequestStateChange(e,t){if(ge.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)return void(t.abort=!1);if(4!==t.xhr.readyState)return;const n=ue._getRequestStatus(t);if(this.lastResponseHeaders=t.xhr.getAllResponseHeaders(),this._conn.disconnecting&&n>=400)return this._hitError(n),void this._callProtocolErrorHandlers(t);const r=this._requests[0]===t,s=this._requests[1]===t,i=n>0&&n<500,o=t.sends>this._conn.maxRetries;(i||o)&&(this._removeRequest(t),ge.debug("request id "+t.id+" should now be removed")),200===n?((s||r&&this._requests.length>0&&this._requests[0].age()>Math.floor(ge.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(t.rid+1),ge.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0):0===n||n>=400&&n<600||n>=12e3?(ge.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),this._hitError(n),this._callProtocolErrorHandlers(t),n>=400&&n<500&&(this._conn._changeConnectStatus(ge.Status.DISCONNECTING,null),this._conn._doDisconnect())):ge.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),i||o?o&&!this._conn.connected&&this._conn._changeConnectStatus(ge.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}_processRequest(e){let t=this._requests[e];const n=ue._getRequestStatus(t,-1);if(t.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();const r=t.age(),s=!isNaN(r)&&r>Math.floor(ge.TIMEOUT*this.wait),i=null!==t.dead&&t.timeDead()>Math.floor(ge.SECONDARY_TIMEOUT*this.wait),o=4===t.xhr.readyState&&(n<1||n>=500);if((s||i||o)&&(i&&ge.error(`Request ${this._requests[e].id} timed out (secondary), restarting`),t.abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){},this._requests[e]=new ge.Request(t.xmlData,t.origFunc,t.rid,t.sends),t=this._requests[e]),0===t.xhr.readyState){ge.debug("request id "+t.id+"."+t.sends+" posting");try{const e=this._conn.options.contentType||"text/xml; charset=utf-8";t.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==t.xhr.setRequestHeader&&t.xhr.setRequestHeader("Content-Type",e),this._conn.options.withCredentials&&(t.xhr.withCredentials=!0)}catch(e){return ge.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(ge.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}const e=()=>{if(t.date=(new Date).valueOf(),this._conn.options.customHeaders){const e=this._conn.options.customHeaders;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.xhr.setRequestHeader(n,e[n])}t.xhr.send(t.data)};if(t.sends>1){const n=1e3*Math.min(Math.floor(ge.TIMEOUT*this.wait),Math.pow(t.sends,3));setTimeout((function(){e()}),n)}else e();t.sends++,this.strip&&"body"===t.xmlData.nodeName&&t.xmlData.childNodes.length?this._conn.xmlOutput?.(t.xmlData.children[0]):this._conn.xmlOutput?.(t.xmlData),this._conn.rawOutput?.(t.data)}else ge.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+t.xhr.readyState)}_removeRequest(e){ge.debug("removing request");for(let t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()}_restartRequest(e){const t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)}_reqToData(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}}_sendTerminate(e){ge.debug("_sendTerminate was called");const t=this._buildBody().attrs({type:"terminate"}),n=e instanceof m?e.tree():e;e&&t.cnode(n);const r=new ge.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),Number(t.tree().getAttribute("rid")));this._requests.push(r),this._throttledRequestHandler()}_send(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout((()=>this._conn._onIdle()),100)}_sendRestart(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)}_throttledRequestHandler(){this._requests?ge.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):ge.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}const de=ue;const le=class{constructor(e){this._conn=e,this.strip="wrapper";const t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){let n="";"ws"===e.options.protocol&&"https:"!==location.protocol?n+="ws":n+="wss",n+="://"+location.host,0!==t.indexOf("/")?n+=location.pathname+t:n+=t,e.service=n}}_buildStream(){return l("open",{xmlns:ge.NS.FRAMING,to:this._conn.domain,version:"1.0"})}_checkStreamError(e,t){let n;if(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(ge.NS.STREAM,"error"):e.getElementsByTagName("stream:error"),0===n.length)return!1;const r=n[0];let s="",i="";for(let e=0;e<r.childNodes.length;e++){const t=r.children[e];if("urn:ietf:params:xml:ns:xmpp-streams"!==t.getAttribute("xmlns"))break;"text"===t.nodeName?i=t.textContent:s=t.nodeName}let o="WebSocket stream error: ";return o+=s||"unknown",i&&(o+=" - "+i),ge.error(o),this._conn._changeConnectStatus(t,s),this._conn._doDisconnect(),!0}_reset(){}_connect(){this._closeSocket(),this.socket=new n(this._conn.service,"xmpp"),this.socket.onopen=()=>this._onOpen(),this.socket.onerror=e=>this._onError(e),this.socket.onclose=e=>this._onClose(e),this.socket.onmessage=e=>this._onInitialMessage(e)}_connect_cb(e){if(this._checkStreamError(e,ge.Status.CONNFAIL))return ge.Status.CONNFAIL}_handleStreamStart(e){let t=null;const n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==ge.NS.FRAMING&&(t="Wrong xmlns in <open />: "+n);const r=e.getAttribute("version");return"string"!=typeof r?t="Missing version in <open />":"1.0"!==r&&(t="Wrong version in <open />: "+r),!t||(this._conn._changeConnectStatus(ge.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)}_onInitialMessage(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){const t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;const n=(new r).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){const t=(new r).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(t),this._conn.rawInput(e.data);const n=t.getAttribute("see-other-uri");if(n){const e=this._conn.service;(e.indexOf("wss:")>=0&&n.indexOf("wss:")>=0||e.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(ge.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=n,this._connect())}else this._conn._changeConnectStatus(ge.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{this._replaceMessageHandler();const t=this._streamWrap(e.data),n=(new r).parseFromString(t,"text/xml").documentElement;this._conn._connect_cb(n,null,e.data)}}_replaceMessageHandler(){this.socket.onmessage=e=>this._onMessage(e)}_disconnect(e){if(this.socket&&this.socket.readyState!==n.CLOSED){e&&this._conn.send(e);const t=l("close",{xmlns:ge.NS.FRAMING});this._conn.xmlOutput(t.tree());const n=ge.serialize(t);this._conn.rawOutput(n);try{this.socket.send(n)}catch(e){ge.warn("Couldn't send <close /> tag.")}}setTimeout((()=>this._conn._doDisconnect()),0)}_doDisconnect(){ge.debug("WebSockets _doDisconnect was called"),this._closeSocket()}_streamWrap(e){return"<wrapper>"+e+"</wrapper>"}_closeSocket(){if(this.socket)try{this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()}catch(e){ge.debug(e.message)}this.socket=null}_emptyQueue(){return!0}_onClose(e){this._conn.connected&&!this._conn.disconnecting?(ge.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(ge.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(ge.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):ge.debug("Websocket closed")}_no_auth_received(e){ge.error("Server did not offer a supported authentication mechanism"),this._conn._changeConnectStatus(ge.Status.CONNFAIL,ge.ErrorCondition.NO_AUTH_MECH),e?.call(this._conn),this._conn._doDisconnect()}_onDisconnectTimeout(){}_abortAllRequests(){}_onError(e){ge.error("Websocket error "+JSON.stringify(e)),this._conn._changeConnectStatus(ge.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()}_onIdle(){const e=this._conn._data;if(e.length>0&&!this._conn.paused){for(let t=0;t<e.length;t++)if(null!==e[t]){const n="restart"===e[t]?this._buildStream().tree():e[t];if("restart"===n)throw new Error("Wrong type for stanza");const r=ge.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}}_onMessage(e){let t;const n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new r).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{const n=this._streamWrap(e.data);t=(new r).parseFromString(n,"text/xml").documentElement}return this._checkStreamError(t,ge.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstElementChild.nodeName&&"unavailable"===t.firstElementChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(ge.serialize(t))):void this._conn._dataRecv(t,e.data)}_onOpen(){ge.debug("Websocket open");const e=this._buildStream();this._conn.xmlOutput(e.tree());const t=ge.serialize(e);this._conn.rawOutput(t),this.socket.send(t)}_send(){this._conn.flush()}_sendRestart(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}};const he=class extends le{constructor(e){super(e),this._conn=e,this.worker=new SharedWorker(this._conn.options.worker,"Strophe XMPP Connection"),this.worker.onerror=e=>{console?.error(e),ge.log(ge.LogLevel.ERROR,`Shared Worker Error: ${e}`)}}_setSocket(){this.socket={send:e=>this.worker.port.postMessage(["send",e]),close:()=>this.worker.port.postMessage(["_closeSocket"]),onopen:()=>{},onerror:e=>this._onError(e),onclose:e=>this._onClose(e),onmessage:()=>{},readyState:null}}_connect(){this._setSocket(),this._messageHandler=e=>this._onInitialMessage(e),this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_connect",this._conn.service,this._conn.jid])}_attach(e){this._setSocket(),this._messageHandler=e=>this._onMessage(e),this._conn.connect_callback=e,this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_attach",this._conn.service])}_attachCallback(e,t){e===ge.Status.ATTACHED?(this._conn.jid=t,this._conn.authenticated=!0,this._conn.connected=!0,this._conn.restored=!0,this._conn._changeConnectStatus(ge.Status.ATTACHED)):e===ge.Status.ATTACHFAIL&&(this._conn.authenticated=!1,this._conn.connected=!1,this._conn.restored=!1,this._conn._changeConnectStatus(ge.Status.ATTACHFAIL))}_disconnect(e){e&&this._conn.send(e);const t=l("close",{xmlns:ge.NS.FRAMING});this._conn.xmlOutput(t.tree());const n=ge.serialize(t);this._conn.rawOutput(n),this.worker.port.postMessage(["send",n]),this._conn._doDisconnect()}_closeSocket(){this.socket.close()}_replaceMessageHandler(){this._messageHandler=e=>this._onMessage(e)}_onWorkerMessage(e){const t={};t.debug=ge.LogLevel.DEBUG,t.info=ge.LogLevel.INFO,t.warn=ge.LogLevel.WARN,t.error=ge.LogLevel.ERROR,t.fatal=ge.LogLevel.FATAL;const{data:n}=e,r=n[0];if("_onMessage"===r)this._messageHandler(n[1]);else if(r in this)try{this[r].apply(this,e.data.slice(1))}catch(e){ge.log(ge.LogLevel.ERROR,e)}else if("log"===r){const e=n[1],r=n[2];ge.log(t[e],r)}else ge.log(ge.LogLevel.ERROR,`Found unhandled service worker message: ${n}`)}},fe={VERSION:"1.6.1",TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,shims:e,Request:ce,Bosh:de,Websocket:le,WorkerWebsocket:he,SASLAnonymous:X,SASLPlain:te,SASLSHA1:re,SASLSHA256:se,SASLSHA384:ie,SASLSHA512:oe,SASLOAuthBearer:ee,SASLExternal:Z,SASLXOAuth2:ae,Builder:m,Connection:V,ElementType:d,ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},Handler:J,LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},NS:i,SASLMechanism:Y,Status:u,TimedHandler:W,...t,XHTML:{...c,validTag:I,validCSS:O,validAttribute:N},addNamespace(e,t){fe.NS[e]=t},_handleError(e){void 0!==e.stack&&fe.fatal(e.stack),fe.fatal("error: "+e.message)},log(e,t){e===this.LogLevel.FATAL&&console?.error(t)},debug(e){this.log(this.LogLevel.DEBUG,e)},info(e){this.log(this.LogLevel.INFO,e)},warn(e){this.log(this.LogLevel.WARN,e)},error(e){this.log(this.LogLevel.ERROR,e)},fatal(e){this.log(this.LogLevel.FATAL,e)},_requestId:0,_connectionPlugins:{},addConnectionPlugin(e,t){fe._connectionPlugins[e]=t}},ge=fe,pe="http://www.w3.org/1999/xhtml";function me(e,t){const n=ge.xmlHtmlNode(e);if(n.getElementsByTagNameNS(pe,"parsererror").length)throw new Error(`Parser Error: ${e}`);const r=n.firstElementChild;if(["message","iq","presence"].includes(r.nodeName.toLowerCase())&&"jabber:client"!==r.namespaceURI&&"jabber:server"!==r.namespaceURI){const e=`Invalid namespaceURI ${r.namespaceURI}`;if(t)throw new Error(e);ge.log(ge.LogLevel.ERROR,e)}return r}class ve{constructor(e,t){this.strings=e,this.values=t}toString(){return this.string=this.string||this.strings.reduce(((e,t)=>{const n=this.strings.indexOf(t);return e+t+(this.values.length>n?this.values[n].toString():"")}),""),this.string}tree(){return this.node=this.node??me(this.toString(),!0),this.node}}globalThis.$build=l,globalThis.$iq=f,globalThis.$msg=h,globalThis.$pres=g,globalThis.Strophe=ge;const _e="v10.1.5",ye={offline:6,unavailable:5,xa:4,away:3,dnd:2,chat:1,online:1},be="anonymous",we="external",Se="login",Ee="logout",Ae="prebind",xe="headline",je={};je[ge.Status.ATTACHED]="ATTACHED",je[ge.Status.AUTHENTICATING]="AUTHENTICATING",je[ge.Status.AUTHFAIL]="AUTHFAIL",je[ge.Status.CONNECTED]="CONNECTED",je[ge.Status.CONNECTING]="CONNECTING",je[ge.Status.CONNFAIL]="CONNFAIL",je[ge.Status.DISCONNECTED]="DISCONNECTED",je[ge.Status.DISCONNECTING]="DISCONNECTING",je[ge.Status.ERROR]="ERROR",je[ge.Status.RECONNECTING]="RECONNECTING",je[ge.Status.REDIRECT]="REDIRECT",ge.addNamespace("ACTIVITY","http://jabber.org/protocol/activity"),ge.addNamespace("CARBONS","urn:xmpp:carbons:2"),ge.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates"),ge.addNamespace("CSI","urn:xmpp:csi:0"),ge.addNamespace("DELAY","urn:xmpp:delay"),ge.addNamespace("EME","urn:xmpp:eme:0"),ge.addNamespace("FASTEN","urn:xmpp:fasten:0"),ge.addNamespace("FORWARD","urn:xmpp:forward:0"),ge.addNamespace("HINTS","urn:xmpp:hints"),ge.addNamespace("HTTPUPLOAD","urn:xmpp:http:upload:0"),ge.addNamespace("MAM","urn:xmpp:mam:2"),ge.addNamespace("MARKERS","urn:xmpp:chat-markers:0"),ge.addNamespace("MENTIONS","urn:xmpp:mmn:0"),ge.addNamespace("MESSAGE_CORRECT","urn:xmpp:message-correct:0"),ge.addNamespace("MODERATE","urn:xmpp:message-moderate:0"),ge.addNamespace("NICK","http://jabber.org/protocol/nick"),ge.addNamespace("OCCUPANTID","urn:xmpp:occupant-id:0"),ge.addNamespace("OMEMO","eu.siacs.conversations.axolotl"),ge.addNamespace("OUTOFBAND","jabber:x:oob"),ge.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),ge.addNamespace("RAI","urn:xmpp:rai:0"),ge.addNamespace("RECEIPTS","urn:xmpp:receipts"),ge.addNamespace("REFERENCE","urn:xmpp:reference:0"),ge.addNamespace("REGISTER","jabber:iq:register"),ge.addNamespace("RETRACT","urn:xmpp:message-retract:0"),ge.addNamespace("ROSTERX","http://jabber.org/protocol/rosterx"),ge.addNamespace("RSM","http://jabber.org/protocol/rsm"),ge.addNamespace("SID","urn:xmpp:sid:0"),ge.addNamespace("SPOILER","urn:xmpp:spoiler:0"),ge.addNamespace("STANZAS","urn:ietf:params:xml:ns:xmpp-stanzas"),ge.addNamespace("STYLING","urn:xmpp:styling:0"),ge.addNamespace("VCARD","vcard-temp"),ge.addNamespace("VCARDUPDATE","vcard-temp:x:update"),ge.addNamespace("XFORM","jabber:x:data"),ge.addNamespace("XHTML","http://www.w3.org/1999/xhtml");const Ce=["converse-adhoc","converse-bookmarks","converse-bosh","converse-caps","converse-chat","converse-chatboxes","converse-disco","converse-emoji","converse-headlines","converse-mam","converse-muc","converse-ping","converse-pubsub","converse-roster","converse-smacks","converse-status","converse-vcard"],Ie={start:/(\b|_)(?:([a-z][a-z0-9.+-]*:\/\/)|xmpp:|mailto:|www\.)/gi};var Ne=o(8734),Oe=o.n(Ne),ke=o(6293);const Te={initialize(){},__(){return(0,ke.sprintf)(...arguments)}};function Me(e){return e instanceof Element||e instanceof HTMLDocument}const Re=document.createElement("div");function $e(e){return e&&"string"==typeof e&&(e=Re.textContent,Re.textContent=""),e}const De={debug:0,info:1,warn:2,error:3,fatal:4},Pe=Object.assign({debug:console?.log?console.log.bind(console):function(){},error:console?.log?console.log.bind(console):function(){},info:console?.log?console.log.bind(console):function(){},warn:console?.log?console.log.bind(console):function(){}},console),Fe={setLogLevel(e){if(!["debug","info","warn","error","fatal"].includes(e))throw new Error(`Invalid loglevel: ${e}`);this.loglevel=e},log(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(De[t]<De[this.loglevel])return;"error"===t||"fatal"===t?n=n||"color: maroon":"debug"===t&&(n=n||"color: green"),e instanceof Error?e=e.stack:Me(e)&&(e=e.outerHTML);const r=n?"%c":"";"error"===t?Pe.error(`${r} ERROR: ${e}`,n):"warn"===t?Pe.warn(`${r} ${(new Date).toISOString()} WARNING: ${e}`,n):"fatal"===t?Pe.error(`${r} FATAL: ${e}`,n):"debug"===t?Pe.debug(`${r} ${(new Date).toISOString()} DEBUG: ${e}`,n):Pe.info(`${r} ${(new Date).toISOString()} INFO: ${e}`,n)},debug(e,t){this.log(e,"debug",t)},error(e,t){this.log(e,"error",t)},info(e,t){this.log(e,"info",t)},warn(e,t){this.log(e,"warn",t)},fatal(e,t){this.log(e,"fatal",t)}};function Le(e,t,n,r){"function"==typeof n&&(void 0===this.__super__&&(this.__super__=r),this.__super__[e]=n.bind(this));for(var s=arguments.length,i=new Array(s>4?s-4:0),o=4;o<s;o++)i[o-4]=arguments[o];return t.apply(this,i)}class ze{constructor(e,t){this.name=t,this.plugged=e,void 0===this.plugged.__super__?this.plugged.__super__={}:"string"==typeof this.plugged.__super__&&(this.plugged.__super__={__string__:this.plugged.__super__}),this.plugged.__super__[t]=this.plugged,this.plugins={},this.initialized_plugins=[]}_overrideAttribute(e,t){const n=t.overrides[e];if("function"==typeof n){const t={};t[this.name]=this.plugged;const r=this.plugged[e];this.plugged[e]=function(){for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return Le.apply(this,[e,n,r,t,...i])}}else this.plugged[e]=n}_extendObject(e,t){e.prototype.__super__||(e.prototype.__super__={},e.prototype.__super__[this.name]=this.plugged);for(const[n,r]of Object.entries(t))if("events"===n)e.prototype[n]=Object.assign(r,e.prototype[n]);else if("function"==typeof r){const t={};t[this.name]=this.plugged;const s=e.prototype[n];e.prototype[n]=function(){for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return Le.apply(this,[n,r,s,t,...i])}}else e.prototype[n]=r}loadPluginDependencies(e){e.dependencies?.forEach((t=>{const n=this.plugins[t];if(n){if(n.dependencies?.includes(e.__name__))throw'Found a circular dependency between the plugins "'+e.__name__+'" and "'+t+'"';this.initializePlugin(n)}else this.throwUndefinedDependencyError('Could not find dependency "'+t+'" for the plugin "'+e.__name__+"\". If it's needed, make sure it's loaded by require.js")}))}throwUndefinedDependencyError(e){if(this.plugged.strict_plugin_dependencies)throw e;console.warn?console.warn(e):console.log(e)}applyOverrides(e){Object.keys(e.overrides||{}).forEach((t=>{const n=e.overrides[t];"object"==typeof n?void 0===this.plugged[t]?this.throwUndefinedDependencyError(`Plugin "${e.__name__}" tried to override "${t}" but it's not found.`):this._extendObject(this.plugged[t],n):this._overrideAttribute(t,e)}))}initializePlugin(e){Object.keys(this.allowed_plugins).includes(e.__name__)&&(this.initialized_plugins.includes(e.__name__)||("boolean"==typeof e.enabled&&e.enabled||e.enabled?.(this.plugged)||null==e.enabled)&&(Object.assign(e,this.properties),e.dependencies&&this.loadPluginDependencies(e),this.applyOverrides(e),"function"==typeof e.initialize&&e.initialize.bind(e)(this),this.initialized_plugins.push(e.__name__)))}registerPlugin(e,t){if(e in this.plugins)throw new Error("Error: Plugin name "+e+" is already taken");t.__name__=e,this.plugins[e]=t}initializePlugins(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Object.keys(this.plugins).length){this.properties=e,this.allowed_plugins={};for(const[e,r]of Object.entries(this.plugins))t.length&&!t.includes(e)||n.includes(e)||(this.allowed_plugins[e]=r);Object.values(this.allowed_plugins).forEach((e=>this.initializePlugin(e)))}}}const Ue={enable:function(e,t,n){return void 0===n&&(n="pluginSocket"),void 0===t&&(t="plugged"),e[n]=new ze(e,t),e}};var Be=Object.prototype;const qe=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Be)};const He=function(e,t){return function(n){return e(t(n))}};const Ge=He(Object.keys,Object);var Je=Object.prototype.hasOwnProperty;const We=function(e){if(!qe(e))return Ge(e);var t=[];for(var n in Object(e))Je.call(e,n)&&"constructor"!=n&&t.push(n);return t};const Qe="object"==typeof global&&global&&global.Object===Object&&global;var Ke="object"==typeof self&&self&&self.Object===Object&&self;const Ve=Qe||Ke||Function("return this")();const Ye=Ve.Symbol;var Xe=Object.prototype,Ze=Xe.hasOwnProperty,et=Xe.toString,tt=Ye?Ye.toStringTag:void 0;const nt=function(e){var t=Ze.call(e,tt),n=e[tt];try{e[tt]=void 0;var r=!0}catch(e){}var s=et.call(e);return r&&(t?e[tt]=n:delete e[tt]),s};var rt=Object.prototype.toString;const st=function(e){return rt.call(e)};var it=Ye?Ye.toStringTag:void 0;const ot=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":it&&it in Object(e)?nt(e):st(e)};const at=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const ct=function(e){if(!at(e))return!1;var t=ot(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const ut=Ve["__core-js_shared__"];var dt,lt=(dt=/[^.]+$/.exec(ut&&ut.keys&&ut.keys.IE_PROTO||""))?"Symbol(src)_1."+dt:"";const ht=function(e){return!!lt&&lt in e};var ft=Function.prototype.toString;const gt=function(e){if(null!=e){try{return ft.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var pt=/^\[object .+?Constructor\]$/,mt=Function.prototype,vt=Object.prototype,_t=mt.toString,yt=vt.hasOwnProperty,bt=RegExp("^"+_t.call(yt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const wt=function(e){return!(!at(e)||ht(e))&&(ct(e)?bt:pt).test(gt(e))};const St=function(e,t){return null==e?void 0:e[t]};const Et=function(e,t){var n=St(e,t);return wt(n)?n:void 0};const At=Et(Ve,"DataView");const xt=Et(Ve,"Map");const jt=Et(Ve,"Promise");const Ct=Et(Ve,"Set");const It=Et(Ve,"WeakMap");var Nt="[object Map]",Ot="[object Promise]",kt="[object Set]",Tt="[object WeakMap]",Mt="[object DataView]",Rt=gt(At),$t=gt(xt),Dt=gt(jt),Pt=gt(Ct),Ft=gt(It),Lt=ot;(At&&Lt(new At(new ArrayBuffer(1)))!=Mt||xt&&Lt(new xt)!=Nt||jt&&Lt(jt.resolve())!=Ot||Ct&&Lt(new Ct)!=kt||It&&Lt(new It)!=Tt)&&(Lt=function(e){var t=ot(e),n="[object Object]"==t?e.constructor:void 0,r=n?gt(n):"";if(r)switch(r){case Rt:return Mt;case $t:return Nt;case Dt:return Ot;case Pt:return kt;case Ft:return Tt}return t});const zt=Lt;const Ut=function(e){return null!=e&&"object"==typeof e};const Bt=function(e){return Ut(e)&&"[object Arguments]"==ot(e)};var qt=Object.prototype,Ht=qt.hasOwnProperty,Gt=qt.propertyIsEnumerable;const Jt=Bt(function(){return arguments}())?Bt:function(e){return Ut(e)&&Ht.call(e,"callee")&&!Gt.call(e,"callee")};const Wt=Array.isArray;const Qt=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};const Kt=function(e){return null!=e&&Qt(e.length)&&!ct(e)};const Vt=function(){return!1};var Yt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Xt=Yt&&"object"==typeof module&&module&&!module.nodeType&&module,Zt=Xt&&Xt.exports===Yt?Ve.Buffer:void 0;const en=(Zt?Zt.isBuffer:void 0)||Vt;var tn={};tn["[object Float32Array]"]=tn["[object Float64Array]"]=tn["[object Int8Array]"]=tn["[object Int16Array]"]=tn["[object Int32Array]"]=tn["[object Uint8Array]"]=tn["[object Uint8ClampedArray]"]=tn["[object Uint16Array]"]=tn["[object Uint32Array]"]=!0,tn["[object Arguments]"]=tn["[object Array]"]=tn["[object ArrayBuffer]"]=tn["[object Boolean]"]=tn["[object DataView]"]=tn["[object Date]"]=tn["[object Error]"]=tn["[object Function]"]=tn["[object Map]"]=tn["[object Number]"]=tn["[object Object]"]=tn["[object RegExp]"]=tn["[object Set]"]=tn["[object String]"]=tn["[object WeakMap]"]=!1;const nn=function(e){return Ut(e)&&Qt(e.length)&&!!tn[ot(e)]};const rn=function(e){return function(t){return e(t)}};var sn="object"==typeof exports&&exports&&!exports.nodeType&&exports,on=sn&&"object"==typeof module&&module&&!module.nodeType&&module,an=on&&on.exports===sn&&Qe.process;const cn=function(){try{var e=on&&on.require&&on.require("util").types;return e||an&&an.binding&&an.binding("util")}catch(e){}}();var un=cn&&cn.isTypedArray;const dn=un?rn(un):nn;var ln=Object.prototype.hasOwnProperty;const hn=function(e){if(null==e)return!0;if(Kt(e)&&(Wt(e)||"string"==typeof e||"function"==typeof e.splice||en(e)||dn(e)||Jt(e)))return!e.length;var t=zt(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(qe(e))return!We(e).length;for(var n in e)if(ln.call(e,n))return!1;return!0};const fn=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r};var gn=/^(?:0|[1-9]\d*)$/;const pn=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&gn.test(e))&&e>-1&&e%1==0&&e<t};var mn=Object.prototype.hasOwnProperty;const vn=function(e,t){var n=Wt(e),r=!n&&Jt(e),s=!n&&!r&&en(e),i=!n&&!r&&!s&&dn(e),o=n||r||s||i,a=o?fn(e.length,String):[],c=a.length;for(var u in e)!t&&!mn.call(e,u)||o&&("length"==u||s&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||pn(u,c))||a.push(u);return a};const _n=function(e){return Kt(e)?vn(e):We(e)};var yn=/\s/;const bn=function(e){for(var t=e.length;t--&&yn.test(e.charAt(t)););return t};var wn=/^\s+/;const Sn=function(e){return e?e.slice(0,bn(e)+1).replace(wn,""):e};const En=function(e){return"symbol"==typeof e||Ut(e)&&"[object Symbol]"==ot(e)};var An=/^[-+]0x[0-9a-f]+$/i,xn=/^0b[01]+$/i,jn=/^0o[0-7]+$/i,Cn=parseInt;const In=function(e){if("number"==typeof e)return e;if(En(e))return NaN;if(at(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=at(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Sn(e);var n=xn.test(e);return n||jn.test(e)?Cn(e.slice(2),n?2:8):An.test(e)?NaN:+e};var Nn=1/0;const On=function(e){return e?(e=In(e))===Nn||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const kn=function(e){var t=On(e),n=t%1;return t==t?n?t-n:t:0};const Tn=function(e,t){var n;if("function"!=typeof t)throw new TypeError("Expected a function");return e=kn(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}};const Mn=function(e){return Tn(2,e)};const Rn=function(e,t){for(var n=-1,r=null==e?0:e.length,s=Array(r);++n<r;)s[n]=t(e[n],n,e);return s};var $n=Ye?Ye.prototype:void 0,Dn=$n?$n.toString:void 0;const Pn=function e(t){if("string"==typeof t)return t;if(Wt(t))return Rn(t,e)+"";if(En(t))return Dn?Dn.call(t):"";var n=t+"";return"0"==n&&1/t==-Infinity?"-0":n};const Fn=function(e){return null==e?"":Pn(e)};var Ln=0;const zn=function(e){var t=++Ln;return Fn(e)+t},Un={},Bn=/\s+/;let qn;const Hn=function(e,t,n,r,s){let i,o=0;if(n&&"object"==typeof n){void 0!==r&&"context"in s&&void 0===s.context&&(s.context=r);for(i=_n(n);o<i.length;o++)t=Hn(e,t,i[o],n[i[o]],s)}else if(n&&Bn.test(n))for(i=n.split(Bn);o<i.length;o++)t=e(t,i[o],r,s);else t=e(t,n,r,s);return t};Un.on=function(e,t,n){if(this._events=Hn(Gn,this._events||{},e,t,{context:n,ctx:this,listening:qn}),qn){(this._listeners||(this._listeners={}))[qn.id]=qn,qn.interop=!1}return this},Un.listenTo=function(e,t,n){if(!e)return this;const r=e._listenId||(e._listenId=zn("l")),s=this._listeningTo||(this._listeningTo={});let i=qn=s[r];i||(this._listenId||(this._listenId=zn("l")),i=qn=s[r]=new Yn(this,e));const o=Jn(e,t,n,this);if(qn=void 0,o)throw o;return i.interop&&i.on(t,n),this};const Gn=function(e,t,n,r){if(n){const s=e[t]||(e[t]=[]),i=r.context,o=r.ctx,a=r.listening;a&&a.count++,s.push({callback:n,context:i,ctx:i||o,listening:a})}return e},Jn=function(e,t,n,r){try{e.on(t,n,r)}catch(e){return e}};Un.off=function(e,t,n){return this._events?(this._events=Hn(Wn,this._events,e,t,{context:n,listeners:this._listeners}),this):this},Un.stopListening=function(e,t,n){const r=this._listeningTo;if(!r)return this;const s=e?[e._listenId]:_n(r);for(let e=0;e<s.length;e++){const i=r[s[e]];if(!i)break;i.obj.off(t,n,this),i.interop&&i.off(t,n)}return hn(r)&&(this._listeningTo=void 0),this};const Wn=function(e,t,n,r){if(!e)return;const s=r.context,i=r.listeners;let o,a=0;if(t||s||n){for(o=t?[t]:_n(e);a<o.length;a++){const r=e[t=o[a]];if(!r)break;const i=[];for(let e=0;e<r.length;e++){const o=r[e];if(n&&n!==o.callback&&n!==o.callback._callback||s&&s!==o.context)i.push(o);else{const e=o.listening;e&&e.off(t,n)}}i.length?e[t]=i:delete e[t]}return e}for(o=_n(i);a<o.length;a++)i[o[a]].cleanup()};Un.once=function(e,t,n){const r=Hn(Qn,{},e,t,this.off.bind(this));return"string"==typeof e&&null==n&&(t=void 0),this.on(r,t,n)},Un.listenToOnce=function(e,t,n){const r=Hn(Qn,{},t,n,this.stopListening.bind(this,e));return this.listenTo(e,r)};const Qn=function(e,t,n,r){if(n){const s=e[t]=Mn((function(){r(t,s),n.apply(this,arguments)}));s._callback=n}return e};Un.trigger=function(e){if(!this._events)return this;const t=Math.max(0,arguments.length-1),n=Array(t);for(let e=0;e<t;e++)n[e]=arguments[e+1];return Hn(Kn,this._events,e,void 0,n),this};const Kn=function(e,t,n,r){if(e){const n=e[t];let s=e.all;n&&s&&(s=s.slice()),n&&Vn(n,r),s&&Vn(s,[t].concat(r))}return e},Vn=function(e,t){let n,r=-1;const s=e.length,i=t[0],o=t[1],a=t[2];switch(t.length){case 0:for(;++r<s;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<s;)(n=e[r]).callback.call(n.ctx,i);return;case 2:for(;++r<s;)(n=e[r]).callback.call(n.ctx,i,o);return;case 3:for(;++r<s;)(n=e[r]).callback.call(n.ctx,i,o,a);return;default:for(;++r<s;)(n=e[r]).callback.apply(n.ctx,t);return}},Yn=function(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0};function Xn(){const e={isResolved:!1,isPending:!0,isRejected:!1},t=new Promise(((t,n)=>{e.resolve=t,e.reject=n}));return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}Yn.prototype.on=Un.on,Yn.prototype.off=function(e,t){let n;this.interop?(this._events=Hn(Wn,this._events,e,t,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=0===this.count),n&&this.cleanup()},Yn.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},Un.bind=Un.on,Un.unbind=Un.off;const Zn={VERSION_NAME:_e,templates:{},promises:{initialized:Xn()},ANONYMOUS:be,CLOSED:"closed",EXTERNAL:we,LOGIN:Se,LOGOUT:Ee,OPENED:"opened",PREBIND:Ae,SUCCESS:"success",FAILURE:"failure",DEFAULT_IMAGE_TYPE:"image/svg+xml",DEFAULT_IMAGE:"PD94bWwgdmVyc2lvbj0iMS4wIj8+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCI+CiA8cmVjdCB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgZmlsbD0iIzU1NSIvPgogPGNpcmNsZSBjeD0iNjQiIGN5PSI0MSIgcj0iMjQiIGZpbGw9IiNmZmYiLz4KIDxwYXRoIGQ9Im0yOC41IDExMiB2LTEyIGMwLTEyIDEwLTI0IDI0LTI0IGgyMyBjMTQgMCAyNCAxMiAyNCAyNCB2MTIiIGZpbGw9IiNmZmYiLz4KPC9zdmc+Cg==",INACTIVE:"inactive",ACTIVE:"active",COMPOSING:"composing",PAUSED:"paused",GONE:"gone",PRIVATE_CHAT_TYPE:"chatbox",CHATROOMS_TYPE:"chatroom",HEADLINES_TYPE:xe,CONTROLBOX_TYPE:"controlbox",TIMEOUTS:{PAUSED:1e4,INACTIVE:9e4},__:function(){return Te.__(...arguments)},___:e=>e};Object.assign(Zn,Un),Ue.enable(Zn,"_converse","pluggable");const er=Zn;function tr(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&"__proto__"!==n&&"constructor"!==n&&(e[n]instanceof Object?tr(e[n],t[n]):e[n]=t[n])}function nr(e){return"[object Error]"===Object.prototype.toString.call(e)}function rr(e){return"function"==typeof e}const sr={async trigger(e){if(!er._events)return;const t=Array.from(arguments),n=t.pop();if(n&&n.synchronous){const n=er._events[e]||[],r=t.splice(1);await Promise.all(n.map((e=>e.callback.apply(e.ctx,r))))}else er.trigger.apply(er,arguments);const r=er.promises[e];void 0!==r&&r.resolve()},hook(e,t,n){const r=er._events[e]||[];return r.length?r.reduce(((e,n)=>e.then((e=>n.callback(t,e)))),Promise.resolve(n)):n},listen:{once:er.once.bind(er),on:er.on.bind(er),not:er.off.bind(er),stanza(e,t,n){rr(t)?(n=t,t={}):t=t||{},api.connection.get().addHandler(n,t.ns,e,t.type,t.id,t.from,t)}}};const ir=function(){return Ve.Date.now()};var or=Math.max,ar=Math.min;const cr=function(e,t,n){var r,s,i,o,a,c,u=0,d=!1,l=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var n=r,i=s;return r=s=void 0,u=t,o=e.apply(i,n)}function g(e){var n=e-c;return void 0===c||n>=t||n<0||l&&e-u>=i}function p(){var e=ir();if(g(e))return m(e);a=setTimeout(p,function(e){var n=t-(e-c);return l?ar(n,i-(e-u)):n}(e))}function m(e){return a=void 0,h&&r?f(e):(r=s=void 0,o)}function v(){var e=ir(),n=g(e);if(r=arguments,s=this,c=e,n){if(void 0===a)return function(e){return u=e,a=setTimeout(p,t),d?f(e):o}(c);if(l)return clearTimeout(a),a=setTimeout(p,t),f(c)}return void 0===a&&(a=setTimeout(p,t)),o}return t=In(t)||0,at(n)&&(d=!!n.leading,i=(l="maxWait"in n)?or(In(n.maxWait)||0,t):i,h="trailing"in n?!!n.trailing:h),v.cancel=function(){void 0!==a&&clearTimeout(a),u=0,r=c=s=a=void 0},v.flush=function(){return void 0===a?o:m(ir())},v};var ur=o(1271),dr=o.n(ur);const lr=function(){this.__data__=[],this.size=0};const hr=function(e,t){return e===t||e!=e&&t!=t};const fr=function(e,t){for(var n=e.length;n--;)if(hr(e[n][0],t))return n;return-1};var gr=Array.prototype.splice;const pr=function(e){var t=this.__data__,n=fr(t,e);return!(n<0)&&(n==t.length-1?t.pop():gr.call(t,n,1),--this.size,!0)};const mr=function(e){var t=this.__data__,n=fr(t,e);return n<0?void 0:t[n][1]};const vr=function(e){return fr(this.__data__,e)>-1};const _r=function(e,t){var n=this.__data__,r=fr(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function yr(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}yr.prototype.clear=lr,yr.prototype.delete=pr,yr.prototype.get=mr,yr.prototype.has=vr,yr.prototype.set=_r;const br=yr;const wr=function(){this.__data__=new br,this.size=0};const Sr=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};const Er=function(e){return this.__data__.get(e)};const Ar=function(e){return this.__data__.has(e)};const xr=Et(Object,"create");const jr=function(){this.__data__=xr?xr(null):{},this.size=0};const Cr=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var Ir=Object.prototype.hasOwnProperty;const Nr=function(e){var t=this.__data__;if(xr){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Ir.call(t,e)?t[e]:void 0};var Or=Object.prototype.hasOwnProperty;const kr=function(e){var t=this.__data__;return xr?void 0!==t[e]:Or.call(t,e)};const Tr=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=xr&&void 0===t?"__lodash_hash_undefined__":t,this};function Mr(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Mr.prototype.clear=jr,Mr.prototype.delete=Cr,Mr.prototype.get=Nr,Mr.prototype.has=kr,Mr.prototype.set=Tr;const Rr=Mr;const $r=function(){this.size=0,this.__data__={hash:new Rr,map:new(xt||br),string:new Rr}};const Dr=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const Pr=function(e,t){var n=e.__data__;return Dr(t)?n["string"==typeof t?"string":"hash"]:n.map};const Fr=function(e){var t=Pr(this,e).delete(e);return this.size-=t?1:0,t};const Lr=function(e){return Pr(this,e).get(e)};const zr=function(e){return Pr(this,e).has(e)};const Ur=function(e,t){var n=Pr(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function Br(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Br.prototype.clear=$r,Br.prototype.delete=Fr,Br.prototype.get=Lr,Br.prototype.has=zr,Br.prototype.set=Ur;const qr=Br;const Hr=function(e,t){var n=this.__data__;if(n instanceof br){var r=n.__data__;if(!xt||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new qr(r)}return n.set(e,t),this.size=n.size,this};function Gr(e){var t=this.__data__=new br(e);this.size=t.size}Gr.prototype.clear=wr,Gr.prototype.delete=Sr,Gr.prototype.get=Er,Gr.prototype.has=Ar,Gr.prototype.set=Hr;const Jr=Gr;const Wr=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};const Qr=function(e){return this.__data__.has(e)};function Kr(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new qr;++t<n;)this.add(e[t])}Kr.prototype.add=Kr.prototype.push=Wr,Kr.prototype.has=Qr;const Vr=Kr;const Yr=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1};const Xr=function(e,t){return e.has(t)};const Zr=function(e,t,n,r,s,i){var o=1&n,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=i.get(e),d=i.get(t);if(u&&d)return u==t&&d==e;var l=-1,h=!0,f=2&n?new Vr:void 0;for(i.set(e,t),i.set(t,e);++l<a;){var g=e[l],p=t[l];if(r)var m=o?r(p,g,l,t,e,i):r(g,p,l,e,t,i);if(void 0!==m){if(m)continue;h=!1;break}if(f){if(!Yr(t,(function(e,t){if(!Xr(f,t)&&(g===e||s(g,e,n,r,i)))return f.push(t)}))){h=!1;break}}else if(g!==p&&!s(g,p,n,r,i)){h=!1;break}}return i.delete(e),i.delete(t),h};const es=Ve.Uint8Array;const ts=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n};const ns=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n};var rs=Ye?Ye.prototype:void 0,ss=rs?rs.valueOf:void 0;const is=function(e,t,n,r,s,i,o){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!i(new es(e),new es(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return hr(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=ts;case"[object Set]":var c=1&r;if(a||(a=ns),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;r|=2,o.set(e,t);var d=Zr(a(e),a(t),r,s,i,o);return o.delete(e),d;case"[object Symbol]":if(ss)return ss.call(e)==ss.call(t)}return!1};const os=function(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e};const as=function(e,t,n){var r=t(e);return Wt(e)?r:os(r,n(e))};const cs=function(e,t){for(var n=-1,r=null==e?0:e.length,s=0,i=[];++n<r;){var o=e[n];t(o,n,e)&&(i[s++]=o)}return i};const us=function(){return[]};var ds=Object.prototype.propertyIsEnumerable,ls=Object.getOwnPropertySymbols;const hs=ls?function(e){return null==e?[]:(e=Object(e),cs(ls(e),(function(t){return ds.call(e,t)})))}:us;const fs=function(e){return as(e,_n,hs)};var gs=Object.prototype.hasOwnProperty;const ps=function(e,t,n,r,s,i){var o=1&n,a=fs(e),c=a.length;if(c!=fs(t).length&&!o)return!1;for(var u=c;u--;){var d=a[u];if(!(o?d in t:gs.call(t,d)))return!1}var l=i.get(e),h=i.get(t);if(l&&h)return l==t&&h==e;var f=!0;i.set(e,t),i.set(t,e);for(var g=o;++u<c;){var p=e[d=a[u]],m=t[d];if(r)var v=o?r(m,p,d,t,e,i):r(p,m,d,e,t,i);if(!(void 0===v?p===m||s(p,m,n,r,i):v)){f=!1;break}g||(g="constructor"==d)}if(f&&!g){var _=e.constructor,y=t.constructor;_==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof y&&y instanceof y||(f=!1)}return i.delete(e),i.delete(t),f};var ms="[object Arguments]",vs="[object Array]",_s="[object Object]",ys=Object.prototype.hasOwnProperty;const bs=function(e,t,n,r,s,i){var o=Wt(e),a=Wt(t),c=o?vs:zt(e),u=a?vs:zt(t),d=(c=c==ms?_s:c)==_s,l=(u=u==ms?_s:u)==_s,h=c==u;if(h&&en(e)){if(!en(t))return!1;o=!0,d=!1}if(h&&!d)return i||(i=new Jr),o||dn(e)?Zr(e,t,n,r,s,i):is(e,t,c,n,r,s,i);if(!(1&n)){var f=d&&ys.call(e,"__wrapped__"),g=l&&ys.call(t,"__wrapped__");if(f||g){var p=f?e.value():e,m=g?t.value():t;return i||(i=new Jr),s(p,m,n,r,i)}}return!!h&&(i||(i=new Jr),ps(e,t,n,r,s,i))};const ws=function e(t,n,r,s,i){return t===n||(null==t||null==n||!Ut(t)&&!Ut(n)?t!=t&&n!=n:bs(t,n,r,s,e,i))};const Ss=function(e,t){return ws(e,t)};var Es=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,As=/^\w*$/;const xs=function(e,t){if(Wt(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!En(e))||(As.test(e)||!Es.test(e)||null!=t&&e in Object(t))};function js(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,s=t?t.apply(this,r):r[0],i=n.cache;if(i.has(s))return i.get(s);var o=e.apply(this,r);return n.cache=i.set(s,o)||i,o};return n.cache=new(js.Cache||qr),n}js.Cache=qr;const Cs=js;const Is=function(e){var t=Cs(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t};var Ns=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Os=/\\(\\)?/g,ks=Is((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Ns,(function(e,n,r,s){t.push(r?s.replace(Os,"$1"):n||e)})),t}));const Ts=ks;const Ms=function(e,t){return Wt(e)?e:xs(e,t)?[e]:Ts(Fn(e))};const Rs=function(e){if("string"==typeof e||En(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t};const $s=function(e,t){for(var n=0,r=(t=Ms(t,e)).length;null!=e&&n<r;)e=e[Rs(t[n++])];return n&&n==r?e:void 0};const Ds=function(){try{var e=Et(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const Ps=function(e,t,n){"__proto__"==t&&Ds?Ds(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var Fs=Object.prototype.hasOwnProperty;const Ls=function(e,t,n){var r=e[t];Fs.call(e,t)&&hr(r,n)&&(void 0!==n||t in e)||Ps(e,t,n)};const zs=function(e,t,n,r){if(!at(e))return e;for(var s=-1,i=(t=Ms(t,e)).length,o=i-1,a=e;null!=a&&++s<i;){var c=Rs(t[s]),u=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(s!=o){var d=a[c];void 0===(u=r?r(d,c,a):void 0)&&(u=at(d)?d:pn(t[s+1])?[]:{})}Ls(a,c,u),a=a[c]}return e};const Us=function(e,t,n){for(var r=-1,s=t.length,i={};++r<s;){var o=t[r],a=$s(e,o);n(a,o)&&zs(i,Ms(o,e),a)}return i};const Bs=function(e,t){return null!=e&&t in Object(e)};const qs=function(e,t,n){for(var r=-1,s=(t=Ms(t,e)).length,i=!1;++r<s;){var o=Rs(t[r]);if(!(i=null!=e&&n(e,o)))break;e=e[o]}return i||++r!=s?i:!!(s=null==e?0:e.length)&&Qt(s)&&pn(o,s)&&(Wt(e)||Jt(e))};const Hs=function(e,t){return null!=e&&qs(e,t,Bs)};const Gs=function(e,t){return Us(e,t,(function(t,n){return Hs(e,n)}))};var Js=Ye?Ye.isConcatSpreadable:void 0;const Ws=function(e){return Wt(e)||Jt(e)||!!(Js&&e&&e[Js])};const Qs=function e(t,n,r,s,i){var o=-1,a=t.length;for(r||(r=Ws),i||(i=[]);++o<a;){var c=t[o];n>0&&r(c)?n>1?e(c,n-1,r,s,i):os(i,c):s||(i[i.length]=c)}return i};const Ks=function(e){return(null==e?0:e.length)?Qs(e,1):[]};const Vs=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)};var Ys=Math.max;const Xs=function(e,t,n){return t=Ys(void 0===t?e.length-1:t,0),function(){for(var r=arguments,s=-1,i=Ys(r.length-t,0),o=Array(i);++s<i;)o[s]=r[t+s];s=-1;for(var a=Array(t+1);++s<t;)a[s]=r[s];return a[t]=n(o),Vs(e,this,a)}};const Zs=function(e){return function(){return e}};const ei=function(e){return e};const ti=Ds?function(e,t){return Ds(e,"toString",{configurable:!0,enumerable:!1,value:Zs(t),writable:!0})}:ei;var ni=Date.now;const ri=function(e){var t=0,n=0;return function(){var r=ni(),s=16-(r-n);if(n=r,s>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(ti);const si=function(e){return ri(Xs(e,void 0,Ks),e+"")};const ii=si((function(e,t){return null==e?{}:Gs(e,t)})),oi={allow_non_roster_messaging:!1,allow_url_history_change:!0,assets_path:"/dist",authentication:"login",auto_login:!1,reuse_scram_keys:!1,auto_reconnect:!0,blacklisted_plugins:[],clear_cache_on_logout:!1,connection_options:{},credentials_url:null,discover_connection_methods:!0,geouri_regex:/https\:\/\/www.openstreetmap.org\/.*#map=[0-9]+\/([\-0-9.]+)\/([\-0-9.]+)\S*/g,geouri_replacement:"https://www.openstreetmap.org/?mlat=$1&mlon=$2#map=18/$1/$2",i18n:void 0,jid:void 0,keepalive:!0,loglevel:"info",locales:["af","ar","bg","ca","cs","da","de","el","en","eo","es","eu","fa","fi","fr","gl","he","hi","hu","id","it","ja","lt","mr","nb","nl","oc","pl","pt","pt_BR","ro","ru","sv","th","tr","ug","uk","vi","zh_CN","zh_TW"],nickname:void 0,password:void 0,persistent_store:"IndexedDB",rid:void 0,root:window.document,sid:void 0,singleton:!1,strict_plugin_dependencies:!1,stanza_timeout:2e4,view_mode:"overlayed",websocket_url:void 0,whitelisted_plugins:[]};const ai=function(e,t,n){var r=-1,s=(t=Ms(t,e)).length;for(s||(s=1,e=void 0);++r<s;){var i=null==e?void 0:e[Rs(t[r])];void 0===i&&(r=s,i=n),e=ct(i)?i.call(e):i}return e};function ci(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function ui(){const e={isResolved:!1,isPending:!0,isRejected:!1,resolve:null,reject:null},t=new Promise(((t,n)=>{e.resolve=t,e.reject=n}));return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}function di(){throw new Error('A "url" property or function must be specified')}function li(e,t){const n=t.error;t.error=function(r){n&&n.call(t.context,e,r,t),e.trigger("error",e,r,t)}}const hi={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};function fi(e){const t=ai(e,"browserStorage")||ai(e.collection,"browserStorage");return t?t.sync():gi}function gi(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.data;null!=r||!t||"create"!==e&&"update"!==e&&"patch"!==e||(r=n.attrs||t.toJSON());const s={method:hi[e],body:r?JSON.stringify(r):"",success:n.success,error:n.error},i=n.url||ai(t,"url")||di(),o=n.xhr=fetch(i,s);return t.trigger("request",t,o,{...s,xhr:o}),o}const pi=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e};const mi=function(e,t,n,r){var s=!n;n||(n={});for(var i=-1,o=t.length;++i<o;){var a=t[i],c=r?r(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),s?Ps(n,a,c):Ls(n,a,c)}return n};const vi=function(e,t){return e&&mi(t,_n(t),e)};const _i=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t};var yi=Object.prototype.hasOwnProperty;const bi=function(e){if(!at(e))return _i(e);var t=qe(e),n=[];for(var r in e)("constructor"!=r||!t&&yi.call(e,r))&&n.push(r);return n};const wi=function(e){return Kt(e)?vn(e,!0):bi(e)};const Si=function(e,t){return e&&mi(t,wi(t),e)};var Ei="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ai=Ei&&"object"==typeof module&&module&&!module.nodeType&&module,xi=Ai&&Ai.exports===Ei?Ve.Buffer:void 0,ji=xi?xi.allocUnsafe:void 0;const Ci=function(e,t){if(t)return e.slice();var n=e.length,r=ji?ji(n):new e.constructor(n);return e.copy(r),r};const Ii=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t};const Ni=function(e,t){return mi(e,hs(e),t)};const Oi=He(Object.getPrototypeOf,Object);var ki=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)os(t,hs(e)),e=Oi(e);return t}:us;const Ti=ki;const Mi=function(e,t){return mi(e,Ti(e),t)};const Ri=function(e){return as(e,wi,Ti)};var $i=Object.prototype.hasOwnProperty;const Di=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&$i.call(e,"index")&&(n.index=e.index,n.input=e.input),n};const Pi=function(e){var t=new e.constructor(e.byteLength);return new es(t).set(new es(e)),t};const Fi=function(e,t){var n=t?Pi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)};var Li=/\w*$/;const zi=function(e){var t=new e.constructor(e.source,Li.exec(e));return t.lastIndex=e.lastIndex,t};var Ui=Ye?Ye.prototype:void 0,Bi=Ui?Ui.valueOf:void 0;const qi=function(e){return Bi?Object(Bi.call(e)):{}};const Hi=function(e,t){var n=t?Pi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};const Gi=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return Pi(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return Fi(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Hi(e,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return zi(e);case"[object Symbol]":return qi(e)}};var Ji=Object.create,Wi=function(){function e(){}return function(t){if(!at(t))return{};if(Ji)return Ji(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const Qi=Wi;const Ki=function(e){return"function"!=typeof e.constructor||qe(e)?{}:Qi(Oi(e))};const Vi=function(e){return Ut(e)&&"[object Map]"==zt(e)};var Yi=cn&&cn.isMap;const Xi=Yi?rn(Yi):Vi;const Zi=function(e){return Ut(e)&&"[object Set]"==zt(e)};var eo=cn&&cn.isSet;const to=eo?rn(eo):Zi;var no="[object Arguments]",ro="[object Function]",so="[object Object]",io={};io[no]=io["[object Array]"]=io["[object ArrayBuffer]"]=io["[object DataView]"]=io["[object Boolean]"]=io["[object Date]"]=io["[object Float32Array]"]=io["[object Float64Array]"]=io["[object Int8Array]"]=io["[object Int16Array]"]=io["[object Int32Array]"]=io["[object Map]"]=io["[object Number]"]=io[so]=io["[object RegExp]"]=io["[object Set]"]=io["[object String]"]=io["[object Symbol]"]=io["[object Uint8Array]"]=io["[object Uint8ClampedArray]"]=io["[object Uint16Array]"]=io["[object Uint32Array]"]=!0,io["[object Error]"]=io[ro]=io["[object WeakMap]"]=!1;const oo=function e(t,n,r,s,i,o){var a,c=1&n,u=2&n,d=4&n;if(r&&(a=i?r(t,s,i,o):r(t)),void 0!==a)return a;if(!at(t))return t;var l=Wt(t);if(l){if(a=Di(t),!c)return Ii(t,a)}else{var h=zt(t),f=h==ro||"[object GeneratorFunction]"==h;if(en(t))return Ci(t,c);if(h==so||h==no||f&&!i){if(a=u||f?{}:Ki(t),!c)return u?Mi(t,Si(a,t)):Ni(t,vi(a,t))}else{if(!io[h])return i?t:{};a=Gi(t,h,c)}}o||(o=new Jr);var g=o.get(t);if(g)return g;o.set(t,a),to(t)?t.forEach((function(s){a.add(e(s,n,r,s,t,o))})):Xi(t)&&t.forEach((function(s,i){a.set(i,e(s,n,r,i,t,o))}));var p=l?void 0:(d?u?Ri:fs:u?wi:_n)(t);return pi(p||t,(function(s,i){p&&(s=t[i=s]),Ls(a,i,e(s,n,r,i,t,o))})),a};const ao=function(e){return oo(e,4)};const co=function(e,t){return ri(Xs(e,t,ei),e+"")};const uo=function(e,t,n){if(!at(n))return!1;var r=typeof t;return!!("number"==r?Kt(n)&&pn(t,n.length):"string"==r&&t in n)&&hr(n[t],e)};var lo=Object.prototype,ho=lo.hasOwnProperty,fo=co((function(e,t){e=Object(e);var n=-1,r=t.length,s=r>2?t[2]:void 0;for(s&&uo(t[0],t[1],s)&&(r=1);++n<r;)for(var i=t[n],o=wi(i),a=-1,c=o.length;++a<c;){var u=o[a],d=e[u];(void 0===d||hr(d,lo[u])&&!ho.call(e,u))&&(e[u]=i[u])}return e}));const go=fo;const po=function(e,t,n){if("function"!=typeof e)throw new TypeError("Expected a function");return setTimeout((function(){e.apply(void 0,n)}),t)};const mo=co((function(e,t){return po(e,1,t)}));var vo=Object.prototype.hasOwnProperty;const _o=function(e,t){return null!=e&&vo.call(e,t)};const yo=function(e,t){return null!=e&&qs(e,t,_o)};const bo=function(e){return function(t,n,r){for(var s=-1,i=Object(t),o=r(t),a=o.length;a--;){var c=o[e?a:++s];if(!1===n(i[c],c,i))break}return t}};const wo=bo();const So=function(e,t){return e&&wo(e,t,_n)};const Eo=function(e,t,n,r){return So(e,(function(e,s,i){t(r,n(e),s,i)})),r};const Ao=function(e,t){return function(n,r){return Eo(n,e,t(r),{})}};var xo=Object.prototype.toString,jo=Ao((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=xo.call(t)),e[t]=n}),Zs(ei));const Co=jo;const Io=function(e,t,n,r){var s=n.length,i=s,o=!r;if(null==e)return!i;for(e=Object(e);s--;){var a=n[s];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++s<i;){var c=(a=n[s])[0],u=e[c],d=a[1];if(o&&a[2]){if(void 0===u&&!(c in e))return!1}else{var l=new Jr;if(r)var h=r(u,d,c,e,t,l);if(!(void 0===h?ws(d,u,3,r,l):h))return!1}}return!0};const No=function(e){return e==e&&!at(e)};const Oo=function(e){for(var t=_n(e),n=t.length;n--;){var r=t[n],s=e[r];t[n]=[r,s,No(s)]}return t};const ko=function(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}};const To=function(e){var t=Oo(e);return 1==t.length&&t[0][2]?ko(t[0][0],t[0][1]):function(n){return n===e||Io(n,e,t)}};const Mo=function(e,t,n){var r=null==e?void 0:$s(e,t);return void 0===r?n:r};const Ro=function(e,t){return xs(e)&&No(t)?ko(Rs(e),t):function(n){var r=Mo(n,e);return void 0===r&&r===t?Hs(n,e):ws(t,r,3)}};const $o=function(e){return function(t){return null==t?void 0:t[e]}};const Do=function(e){return function(t){return $s(t,e)}};const Po=function(e){return xs(e)?$o(Rs(e)):Do(e)};const Fo=function(e){return"function"==typeof e?e:null==e?ei:"object"==typeof e?Wt(e)?Ro(e[0],e[1]):To(e):Po(e)};const Lo=function(e){return Fo("function"==typeof e?e:oo(e,1))};const zo=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0};const Uo=function(e,t,n){var r=-1,s=e.length;t<0&&(t=-t>s?0:s+t),(n=n>s?s:n)<0&&(n+=s),s=t>n?0:n-t>>>0,t>>>=0;for(var i=Array(s);++r<s;)i[r]=e[r+t];return i};const Bo=function(e,t){return t.length<2?e:$s(e,Uo(t,0,-1))};const qo=function(e,t){return t=Ms(t,e),null==(e=Bo(e,t))||delete e[Rs(zo(t))]};var Ho=Function.prototype,Go=Object.prototype,Jo=Ho.toString,Wo=Go.hasOwnProperty,Qo=Jo.call(Object);const Ko=function(e){if(!Ut(e)||"[object Object]"!=ot(e))return!1;var t=Oi(e);if(null===t)return!0;var n=Wo.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Jo.call(n)==Qo};const Vo=function(e){return Ko(e)?void 0:e};var Yo=si((function(e,t){var n={};if(null==e)return n;var r=!1;t=Rn(t,(function(t){return t=Ms(t,e),r||(r=t.length>1),t})),mi(e,Ri(e),n),r&&(n=oo(n,7,Vo));for(var s=t.length;s--;)qo(n,t[s]);return n}));const Xo=Yo,Zo=/\s+/;function ea(e,t,n,r,s){let i,o=0;if(n&&"object"==typeof n){void 0!==r&&"context"in s&&void 0===s.context&&(s.context=r);for(i=_n(n);o<i.length;o++)t=ea(e,t,i[o],n[i[o]],s)}else if(n&&Zo.test(n))for(i=n.split(Zo);o<i.length;o++)t=e(t,i[o],r,s);else t=e(t,n,r,s);return t}function ta(e,t,n,r){if(n){const s=e[t]||(e[t]=[]),i=r.context,o=r.ctx,a=r.listening;a&&a.count++,s.push({callback:n,context:i,ctx:i||o,listening:a})}return e}function na(e,t,n,r){if(!e)return;const s=r.context,i=r.listeners;let o,a=0;if(t||s||n){for(o=t?[t]:_n(e);a<o.length;a++){const r=e[t=o[a]];if(!r)break;const i=[];for(let e=0;e<r.length;e++){const o=r[e];if(n&&n!==o.callback&&n!==o.callback._callback||s&&s!==o.context)i.push(o);else{const e=o.listening;e&&e.stop(t,n)}}i.length?e[t]=i:delete e[t]}return e}for(o=_n(i);a<o.length;a++)i[o[a]].cleanup()}function ra(e,t,n,r){if(n){const s=e[t]=Mn((function(){r(t,s),n.apply(this,arguments)}));s._callback=n}return e}function sa(e,t,n,r){if(e){const n=e[t];let s=e.all;n&&s&&(s=s.slice()),n&&ia(n,r),s&&ia(s,[t].concat(r))}return e}function ia(e,t){let n,r=-1;const s=e.length,i=t[0],o=t[1],a=t[2];switch(t.length){case 0:for(;++r<s;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<s;)(n=e[r]).callback.call(n.ctx,i);return;case 2:for(;++r<s;)(n=e[r]).callback.call(n.ctx,i,o);return;case 3:for(;++r<s;)(n=e[r]).callback.call(n.ctx,i,o,a);return;default:for(;++r<s;)(n=e[r]).callback.apply(n.ctx,t);return}}const oa=class{constructor(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0}start(e,t,n){this._events=ea(ta,this._events||{},e,t,{context:this.obj,ctx:n,listening:this});return(this.obj._listeners||(this.obj._listeners={}))[this.id]=this,this.interop=!1,this}stop(e,t){let n;this.interop?(this._events=ea(na,this._events,e,t,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=0===this.count),n&&this.cleanup()}cleanup(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]}};let aa;const ca=class{on(e,t,n){if(this._events=ea(ta,this._events||{},e,t,{context:n,ctx:this,listening:aa}),aa){(this._listeners||(this._listeners={}))[aa.id]=aa,aa.interop=!1}return this}listenTo(e,t,n){if(!e)return this;const r=e._listenId||(e._listenId=zn("l")),s=this._listeningTo||(this._listeningTo={});let i=aa=s[r];i||(this._listenId||(this._listenId=zn("l")),i=aa=s[r]=new oa(this,e));const o=function(e,t,n,r){try{e.on(t,n,r)}catch(e){return e}}(e,t,n,this);if(aa=void 0,o)throw o;return i.interop&&i.start(t,n,this),this}off(e,t,n){return this._events?(this._events=ea(na,this._events,e,t,{context:n,listeners:this._listeners}),this):this}stopListening(e,t,n){const r=this._listeningTo;if(!r)return this;const s=e?[e._listenId]:_n(r);for(let e=0;e<s.length;e++){const i=r[s[e]];if(!i)break;i.obj.off(t,n,this),i.interop&&i.stop(t,n)}return hn(r)&&(this._listeningTo=void 0),this}once(e,t,n){const r=ea(ra,{},e,t,this.off.bind(this));return"string"==typeof e&&null==n&&(t=void 0),this.on(r,t,n)}listenToOnce(e,t,n){const r=ea(ra,{},t,n,this.stopListening.bind(this,e));return this.listenTo(e,r)}trigger(e){if(!this._events)return this;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return ea(sa,this._events,e,void 0,n),this}};class ua extends ca{constructor(e,t){super();let n=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=zn(this.cidPrefix),this.attributes={},this.validationError=null,this.validate=this.validate??null,t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});const r=ai(this,"defaults");n=go(Object.assign({},r,n),r),this.set(n,t),this.initialize.apply(this,arguments),this.changed={}}get idAttribute(){return"id"}get cidPrefix(){return"c"}preinitialize(){}initialize(){}toJSON(){return ao(this.attributes)}sync(e,t,n){return fi(t)(e,t,n)}get(e){return this.attributes[e]}keys(){return Object.keys(this.attributes)}values(){return Object.values(this.attributes)}pairs(){return this.entries()}entries(){return Object.entries(this.attributes)}invert(){return Co(this.attributes)}pick(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 1===t.length&&Array.isArray(t[0])&&(t=t[0]),ii(this.attributes,t)}omit(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 1===t.length&&Array.isArray(t[0])&&(t=t[0]),Xo(this.attributes,t)}isEmpty(){return hn(this.attributes)}has(e){return null!=this.get(e)}matches(e){return!!Lo(e,this)(this.attributes)}set(e,t,n){if(null==e)return this;let r;if("object"==typeof e?(r=e,n=t):(r={})[e]=t,n||(n={}),!this._validate(r,n))return!1;const s=n.unset,i=n.silent,o=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=ao(this.attributes),this.changed={});const c=this.attributes,u=this.changed,d=this._previousAttributes;for(const e in r)t=r[e],Ss(c[e],t)||o.push(e),Ss(d[e],t)?delete u[e]:u[e]=t,s?delete c[e]:c[e]=t;if(this.idAttribute in r&&(this.id=this.get(this.idAttribute)),!i){o.length&&(this._pending=n);for(let e=0;e<o.length;e++)this.trigger("change:"+o[e],this,c[o[e]],n)}if(a)return this;if(!i)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this}unset(e,t){return this.set(e,void 0,Object.assign({},t,{unset:!0}))}clear(e){const t={};for(const e in this.attributes)t[e]=void 0;return this.set(t,Object.assign({},e,{unset:!0}))}hasChanged(e){return null==e?!hn(this.changed):yo(this.changed,e)}changedAttributes(e){if(!e)return!!this.hasChanged()&&ao(this.changed);const t=this._changing?this._previousAttributes:this.attributes,n={};let r;for(const s in e){const i=e[s];Ss(t[s],i)||(n[s]=i,r=!0)}return!!r&&n}previous(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null}previousAttributes(){return ao(this._previousAttributes)}fetch(e){const t=(e=Object.assign({parse:!0},e)).success;return e.success=n=>{const r=e.parse?this.parse(n,e):n;if(!this.set(r,e))return!1;t&&t.call(e.context,this,n,e),this.trigger("sync",this,n,e)},li(this,e),this.sync("read",this,e)}save(e,t,n){let r;null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t;const s=(n=Object.assign({validate:!0,parse:!0},n)).wait,i=n.promise,o=i&&ui();if(r&&!s){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;const a=n.success,c=n.error,u=this.attributes;n.success=e=>{this.attributes=u;let t=n.parse?this.parse(e,n):e;if(s&&(t=Object.assign({},r,t)),t&&!this.set(t,n))return!1;a&&a.call(n.context,this,e,n),this.trigger("sync",this,e,n),i&&o.resolve()},n.error=(e,t,n)=>{c&&c.call(n.context,e,t,n),i&&o.reject(t)},li(this,n),r&&s&&(this.attributes=Object.assign({},u,r));const d=this.isNew()?"create":n.patch?"patch":"update";"patch"!==d||n.attrs||(n.attrs=r);const l=this.sync(d,this,n);return this.attributes=u,i?o:l}destroy(e){const t=(e=e?ao(e):{}).success,n=e.wait,r=()=>{this.stopListening(),this.trigger("destroy",this,this.collection,e)};e.success=s=>{n&&r(),t&&t.call(e.context,this,s,e),this.isNew()||this.trigger("sync",this,s,e)};let s=!1;return this.isNew()?mo(e.success):(li(this,e),s=this.sync("delete",this,e)),n||r(),s}url(){const e=ai(this,"urlRoot")||ai(this.collection,"url")||di();if(this.isNew())return e;const t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)}parse(e,t){return e}isNew(){return!this.has(this.idAttribute)}isValid(e){return this._validate({},Object.assign({},e,{validate:!0}))}_validate(e,t){if(!t.validate||!this.validate)return!0;e=Object.assign({},this.attributes,e);const n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,Object.assign(t,{validationError:n})),!1)}}var da=o(3245);const la=function(e){return oo(e,5)};const ha=function(e){return"string"==typeof e||!Wt(e)&&Ut(e)&&"[object String]"==ot(e)};const fa=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();const ga=function(){try{if(!fa||!fa.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}};const pa=function(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(s){if("TypeError"!==s.name)throw s;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}};"undefined"==typeof Promise&&o(9236);const ma=Promise;const va=function(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))};const _a=function(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)};function ya(e){return"string"!=typeof e&&(console.warn(`${e} used as a key, but it is not a string.`),e=String(e)),e}function ba(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}const wa="local-forage-detect-blob-support";let Sa;const Ea={},Aa=Object.prototype.toString,xa="readonly",ja="readwrite";function Ca(e){return"boolean"==typeof Sa?ma.resolve(Sa):function(e){return new ma((function(t){var n=e.transaction(wa,ja),r=pa([""]);n.objectStore(wa).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return Sa=e,Sa}))}function Ia(e){var t=Ea[e.name],n={};n.promise=new ma((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function Na(e){var t=Ea[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function Oa(e,t){var n=Ea[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function ka(e,t){return new ma((function(n,r){if(Ea[e.name]=Ea[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);Ia(e),e.db.close()}var s=[e.name];t&&s.push(e.version);var i=fa.open.apply(fa,s);t&&(i.onupgradeneeded=function(t){var n=i.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(wa)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),i.onerror=function(e){e.preventDefault(),r(i.error)},i.onsuccess=function(){var t=i.result;t.onversionchange=function(e){e.target.close()},n(t),Na(e)}}))}function Ta(e){return ka(e,!1)}function Ma(e){return ka(e,!0)}function Ra(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,s=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),s||n){if(n){var i=e.db.version+1;i>e.version&&(e.version=i)}return!0}return!1}function $a(e){var t=function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),s=0;s<t;s++)r[s]=e.charCodeAt(s);return n}(atob(e.data));return pa([t],{type:e.type})}function Da(e){return e&&e.__local_forage_encoded_blob}function Pa(e){var t=this,n=t._initReady().then((function(){var e=Ea[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return _a(n,e,e),n}function Fa(e,t,n,r){void 0===r&&(r=1);try{var s=e.db.transaction(e.storeName,t);n(null,s)}catch(s){if(r>0&&(!e.db||"InvalidStateError"===s.name||"NotFoundError"===s.name))return ma.resolve().then((()=>{if(!e.db||"NotFoundError"===s.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),Ma(e)})).then((()=>function(e){Ia(e);for(var t=Ea[e.name],n=t.forages,r=0;r<n.length;r++){const e=n[r];e._dbInfo.db&&(e._dbInfo.db.close(),e._dbInfo.db=null)}return e.db=null,Ta(e).then((t=>(e.db=t,Ra(e)?Ma(e):t))).then((r=>{e.db=t.db=r;for(var s=0;s<n.length;s++)n[s]._dbInfo.db=r})).catch((t=>{throw Oa(e,t),t}))}(e).then((function(){Fa(e,t,n,r-1)})))).catch(n);n(s)}}var La={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var s=Ea[n.name];s||(s={forages:[],db:null,dbReady:null,deferredOperations:[]},Ea[n.name]=s),s.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=Pa);var i=[];function o(){return ma.resolve()}for(var a=0;a<s.forages.length;a++){var c=s.forages[a];c!==t&&i.push(c._initReady().catch(o))}var u=s.forages.slice(0);return ma.all(i).then((function(){return n.db=s.db,Ta(n)})).then((function(e){return n.db=e,Ra(n,t._defaultConfig.version)?Ma(n):e})).then((function(e){n.db=s.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var i=u[r];i!==t&&(i._dbInfo.db=n.db,i._dbInfo.version=n.version)}}))},_support:ga(),iterate:function(e,t){var n=this,r=new ma((function(t,r){n.ready().then((function(){Fa(n._dbInfo,xa,(function(s,i){if(s)return r(s);try{var o=i.objectStore(n._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;Da(r)&&(r=$a(r));var s=e(r,n.key,a++);void 0!==s?t(s):n.continue()}else t()},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return va(r,t),r},getItem:function(e,t){var n=this;e=ya(e);var r=new ma((function(t,r){n.ready().then((function(){Fa(n._dbInfo,xa,(function(s,i){if(s)return r(s);try{var o=i.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),Da(e)&&(e=$a(e)),t(e)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return va(r,t),r},setItem:function(e,t,n){var r=this;e=ya(e);var s=new ma((function(n,s){var i;r.ready().then((function(){return i=r._dbInfo,"[object Blob]"===Aa.call(t)?Ca(i.db).then((function(e){return e?t:(n=t,new ma((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){Fa(r._dbInfo,ja,(function(i,o){if(i)return s(i);try{var a=o.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;s(e)}}catch(e){s(e)}}))})).catch(s)}));return va(s,n),s},removeItem:function(e,t){var n=this;e=ya(e);var r=new ma((function(t,r){n.ready().then((function(){Fa(n._dbInfo,ja,(function(s,i){if(s)return r(s);try{var o=i.objectStore(n._dbInfo.storeName).delete(e);i.oncomplete=function(){t()},i.onerror=function(){r(o.error)},i.onabort=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return va(r,t),r},clear:function(e){var t=this,n=new ma((function(e,n){t.ready().then((function(){Fa(t._dbInfo,ja,(function(r,s){if(r)return n(r);try{var i=s.objectStore(t._dbInfo.storeName).clear();s.oncomplete=function(){e()},s.onabort=s.onerror=function(){var e=i.error?i.error:i.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return va(n,e),n},length:function(e){var t=this,n=new ma((function(e,n){t.ready().then((function(){Fa(t._dbInfo,xa,(function(r,s){if(r)return n(r);try{var i=s.objectStore(t._dbInfo.storeName).count();i.onsuccess=function(){e(i.result)},i.onerror=function(){n(i.error)}}catch(e){n(e)}}))})).catch(n)}));return va(n,e),n},key:function(e,t){var n=this,r=new ma((function(t,r){e<0?t(null):n.ready().then((function(){Fa(n._dbInfo,xa,(function(s,i){if(s)return r(s);try{var o=i.objectStore(n._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return va(r,t),r},keys:function(e){var t=this,n=new ma((function(e,n){t.ready().then((function(){Fa(t._dbInfo,xa,(function(r,s){if(r)return n(r);try{var i=s.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];i.onsuccess=function(){var t=i.result;t?(o.push(t.key),t.continue()):e(o)},i.onerror=function(){n(i.error)}}catch(e){n(e)}}))})).catch(n)}));return va(n,e),n},dropInstance:function(e,t){t=ba.apply(this,arguments);var n,r=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName),e.name){const t=e.name===r.name&&this._dbInfo.db?ma.resolve(this._dbInfo.db):Ta(e).then((t=>{const n=Ea[e.name],r=n.forages;n.db=t;for(var s=0;s<r.length;s++)r[s]._dbInfo.db=t;return t}));n=e.storeName?t.then((t=>{if(!t.objectStoreNames.contains(e.storeName))return;const n=t.version+1;Ia(e);const r=Ea[e.name],s=r.forages;t.close();for(let e=0;e<s.length;e++){const t=s[e];t._dbInfo.db=null,t._dbInfo.version=n}const i=new ma(((t,r)=>{const s=fa.open(e.name,n);s.onerror=e=>{s.result.close(),r(e)},s.onupgradeneeded=()=>{s.result.deleteObjectStore(e.storeName)},s.onsuccess=()=>{const e=s.result;e.close(),t(e)}}));return i.then((e=>{r.db=e;for(let t=0;t<s.length;t++){const n=s[t];n._dbInfo.db=e,Na(n._dbInfo)}})).catch((t=>{throw(Oa(e,t)||ma.resolve()).catch((()=>{})),t}))})):t.then((t=>{Ia(e);const n=Ea[e.name],r=n.forages;t.close();for(var s=0;s<r.length;s++){r[s]._dbInfo.db=null}const i=new ma(((t,n)=>{var r=fa.deleteDatabase(e.name);r.onerror=()=>{const e=r.result;e&&e.close(),n(r.error)},r.onblocked=()=>{console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=()=>{const e=r.result;e&&e.close(),t(e)}}));return i.then((e=>{n.db=e;for(var t=0;t<r.length;t++){Na(r[t]._dbInfo)}})).catch((t=>{throw(Oa(e,t)||ma.resolve()).catch((()=>{})),t}))}))}else n=ma.reject("Invalid arguments");return va(n,t),n}};const za=La;const Ua=function(){return"function"==typeof openDatabase};var Ba="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qa=/^~~local_forage_type~([^~]+)~/,Ha="__lfsc__:",Ga="arbf",Ja="blob",Wa="si08",Qa="ui08",Ka="uic8",Va="si16",Ya="si32",Xa="ur16",Za="ui32",ec="fl32",tc="fl64",nc=Object.prototype.toString;function rc(e){var t,n,r,s,i,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var u=new ArrayBuffer(o),d=new Uint8Array(u);for(t=0;t<a;t+=4)n=Ba.indexOf(e[t]),r=Ba.indexOf(e[t+1]),s=Ba.indexOf(e[t+2]),i=Ba.indexOf(e[t+3]),d[c++]=n<<2|r>>4,d[c++]=(15&r)<<4|s>>2,d[c++]=(3&s)<<6|63&i;return u}function sc(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=Ba[n[t]>>2],r+=Ba[(3&n[t])<<4|n[t+1]>>4],r+=Ba[(15&n[t+1])<<2|n[t+2]>>6],r+=Ba[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var ic={serialize:function(e,t){var n="";if(e&&(n=nc.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===nc.call(e.buffer))){var r,s=Ha;e instanceof ArrayBuffer?(r=e,s+=Ga):(r=e.buffer,"[object Int8Array]"===n?s+=Wa:"[object Uint8Array]"===n?s+=Qa:"[object Uint8ClampedArray]"===n?s+=Ka:"[object Int16Array]"===n?s+=Va:"[object Uint16Array]"===n?s+=Xa:"[object Int32Array]"===n?s+=Ya:"[object Uint32Array]"===n?s+=Za:"[object Float32Array]"===n?s+=ec:"[object Float64Array]"===n?s+=tc:t(new Error("Failed to get type for BinaryArray"))),t(s+sc(r))}else if("[object Blob]"===n){var i=new FileReader;i.onload=function(){var n="~~local_forage_type~"+e.type+"~"+sc(this.result);t(Ha+Ja+n)},i.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,9)!==Ha)return JSON.parse(e);var t,n=e.substring(13),r=e.substring(9,13);if(r===Ja&&qa.test(n)){var s=n.match(qa);t=s[1],n=n.substring(s[0].length)}var i=rc(n);switch(r){case Ga:return i;case Ja:return pa([i],{type:t});case Wa:return new Int8Array(i);case Qa:return new Uint8Array(i);case Ka:return new Uint8ClampedArray(i);case Va:return new Int16Array(i);case Xa:return new Uint16Array(i);case Ya:return new Int32Array(i);case Za:return new Uint32Array(i);case ec:return new Float32Array(i);case tc:return new Float64Array(i);default:throw new Error("Unkown type: "+r)}},stringToBuffer:rc,bufferToString:sc};const oc=ic;function ac(e,t,n,r){e.executeSql(`CREATE TABLE IF NOT EXISTS ${t.storeName} (id INTEGER PRIMARY KEY, key unique, value)`,[],n,r)}function cc(e,t,n,r,s,i){e.executeSql(n,r,s,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?i(e,o):ac(e,t,(function(){e.executeSql(n,r,s,i)}),i)}),i):i(e,o)}),i)}function uc(e,t,n,r){var s=this;e=ya(e);var i=new ma((function(i,o){s.ready().then((function(){void 0===t&&(t=null);var a=t,c=s._dbInfo;c.serializer.serialize(t,(function(t,u){u?o(u):c.db.transaction((function(n){cc(n,c,`INSERT OR REPLACE INTO ${c.storeName} (key, value) VALUES (?, ?)`,[e,t],(function(){i(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void i(uc.apply(s,[e,a,n,r-1]));o(t)}}))}))})).catch(o)}));return va(i,n),i}var dc={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var s=new ma((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(s){ac(s,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=oc,s},_support:Ua(),iterate:function(e,t){var n=this,r=new ma((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){cc(n,s,`SELECT * FROM ${s.storeName}`,[],(function(n,r){for(var i=r.rows,o=i.length,a=0;a<o;a++){var c=i.item(a),u=c.value;if(u&&(u=s.serializer.deserialize(u)),void 0!==(u=e(u,c.key,a+1)))return void t(u)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return va(r,t),r},getItem:function(e,t){var n=this;e=ya(e);var r=new ma((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){cc(n,s,`SELECT * FROM ${s.storeName} WHERE key = ? LIMIT 1`,[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=s.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return va(r,t),r},setItem:function(e,t,n){return uc.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=ya(e);var r=new ma((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){cc(n,s,`DELETE FROM ${s.storeName} WHERE key = ?`,[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return va(r,t),r},clear:function(e){var t=this,n=new ma((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){cc(t,r,`DELETE FROM ${r.storeName}`,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return va(n,e),n},length:function(e){var t=this,n=new ma((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){cc(t,r,`SELECT COUNT(key) as c FROM ${r.storeName}`,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return va(n,e),n},key:function(e,t){var n=this,r=new ma((function(t,r){n.ready().then((function(){var s=n._dbInfo;s.db.transaction((function(n){cc(n,s,`SELECT key FROM ${s.storeName} WHERE id = ? LIMIT 1`,[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return va(r,t),r},keys:function(e){var t=this,n=new ma((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){cc(t,r,`SELECT key FROM ${r.storeName}`,[],(function(t,n){for(var r=[],s=0;s<n.rows.length;s++)r.push(n.rows.item(s).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return va(n,e),n},dropInstance:function(e,t){t=ba.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,s=this;return r=e.name?new ma((function(t){var r;r=e.name===n.name?s._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(function(e){return new ma((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var s=[],i=0;i<r.rows.length;i++)s.push(r.rows.item(i).name);t({db:e,storeNames:s})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}(r))})).then((function(e){return new ma((function(t,n){e.db.transaction((function(r){function s(e){return new ma((function(t,n){r.executeSql(`DROP TABLE IF EXISTS ${e}`,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var i=[],o=0,a=e.storeNames.length;o<a;o++)i.push(s(e.storeNames[o]));ma.all(i).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):ma.reject("Invalid arguments"),va(r,t),r}};const lc=dc;function hc(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function fc(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}var gc={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=hc(e,this._defaultConfig),fc()?(this._dbInfo=t,t.serializer=oc,ma.resolve()):ma.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,s=r.length,i=localStorage.length,o=1,a=0;a<i;a++){var c=localStorage.key(a);if(0===c.indexOf(r)){var u=localStorage.getItem(c);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,c.substring(s),o++)))return u}}}));return va(r,t),r},getItem:function(e,t){var n=this;e=ya(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return va(r,t),r},setItem:function(e,t,n){var r=this;e=ya(e);var s=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new ma((function(s,i){var o=r._dbInfo;o.serializer.serialize(t,(function(t,r){if(r)i(r);else try{localStorage.setItem(o.keyPrefix+e,t),s(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||i(e),i(e)}}))}))}));return va(s,n),s},removeItem:function(e,t){var n=this;e=ya(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return va(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return va(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return va(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return va(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],s=0;s<n;s++){var i=localStorage.key(s);0===i.indexOf(e.keyPrefix)&&r.push(i.substring(e.keyPrefix.length))}return r}));return va(n,e),n},dropInstance:function(e,t){if(t=ba.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,s=this;return r=e.name?new ma((function(t){e.storeName?t(hc(e,s._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):ma.reject("Invalid arguments"),va(r,t),r}};const pc=gc,mc=(e,t)=>e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t),vc=(e,t)=>{const n=e.length;let r=0;for(;r<n;){if(mc(e[r],t))return!0;r++}return!1},_c=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},yc={},bc={},wc={INDEXEDDB:za,WEBSQL:lc,LOCALSTORAGE:pc},Sc=[wc.INDEXEDDB._driver,wc.WEBSQL._driver,wc.LOCALSTORAGE._driver],Ec=["dropInstance"],Ac=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Ec),xc={description:"",driver:Sc.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function jc(e,t){e[t]=function(){const n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function Cc(){for(let e=1;e<arguments.length;e++){const t=arguments[e];if(t)for(let e in t)t.hasOwnProperty(e)&&(_c(t[e])?arguments[0][e]=t[e].slice():arguments[0][e]=t[e])}return arguments[0]}class Ic{constructor(e){for(let e in wc)if(wc.hasOwnProperty(e)){const t=wc[e],n=t._driver;this[e]=n,yc[n]||this.defineDriver(t)}this._defaultConfig=Cc({},xc),this._config=Cc({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((()=>{}))}config(e){if("object"==typeof e){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(let t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config}defineDriver(e,t,n){const r=new ma((function(t,n){try{const r=e._driver,s=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(s);const i=Ac.concat("_initStorage");for(let t=0,r=i.length;t<r;t++){const r=i[t];if((!vc(Ec,r)||e[r])&&"function"!=typeof e[r])return void n(s)}const o=function(){const t=function(e){return function(){const t=new Error(`Method ${e} is not implemented by the current driver`),n=ma.reject(t);return va(n,arguments[arguments.length-1]),n}};for(let n=0,r=Ec.length;n<r;n++){const r=Ec[n];e[r]||(e[r]=t(r))}};o();const a=function(n){yc[r]&&console.info(`Redefining LocalForage driver: ${r}`),yc[r]=e,bc[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(a,n):a(!!e._support):a(!0)}catch(e){n(e)}}));return _a(r,t,n),r}driver(){return this._driver||null}getDriver(e,t,n){const r=yc[e]?ma.resolve(yc[e]):ma.reject(new Error("Driver not found."));return _a(r,t,n),r}getSerializer(e){const t=ma.resolve(oc);return _a(t,e),t}ready(e){const t=this,n=t._driverSet.then((()=>(null===t._ready&&(t._ready=t._initDriver()),t._ready)));return _a(n,e,e),n}setDriver(e,t,n){const r=this;_c(e)||(e=[e]);const s=this._getSupportedDrivers(e);function i(){r._config.driver=r.driver()}function o(e){return r._extend(e),i(),r._ready=r._initStorage(r._config),r._ready}const a=null!==this._driverSet?this._driverSet.catch((()=>ma.resolve())):ma.resolve();return this._driverSet=a.then((()=>{const e=s[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((e=>{r._driver=e._driver,i(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){let t=0;return function n(){for(;t<e.length;){let s=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(s).then(o).catch(n)}i();const s=new Error("No available storage method found.");return r._driverSet=ma.reject(s),r._driverSet}()}}(s)}))})).catch((()=>{i();const e=new Error("No available storage method found.");return r._driverSet=ma.reject(e),r._driverSet})),_a(this._driverSet,t,n),this._driverSet}supports(e){return!!bc[e]}_extend(e){Cc(this,e)}_getSupportedDrivers(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];this.supports(r)&&t.push(r)}return t}_wrapLibraryMethodsWithReady(){for(let e=0,t=Ac.length;e<t;e++)jc(this,Ac[e])}createInstance(e){return new Ic(e)}}const Nc=new Ic;const Oc=function(e,t,n){(void 0!==n&&!hr(e[t],n)||void 0===n&&!(t in e))&&Ps(e,t,n)};const kc=function(e){return Ut(e)&&Kt(e)};const Tc=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]};const Mc=function(e){return mi(e,wi(e))};const Rc=function(e,t,n,r,s,i,o){var a=Tc(e,n),c=Tc(t,n),u=o.get(c);if(u)Oc(e,n,u);else{var d=i?i(a,c,n+"",e,t,o):void 0,l=void 0===d;if(l){var h=Wt(c),f=!h&&en(c),g=!h&&!f&&dn(c);d=c,h||f||g?Wt(a)?d=a:kc(a)?d=Ii(a):f?(l=!1,d=Ci(c,!0)):g?(l=!1,d=Hi(c,!0)):d=[]:Ko(c)||Jt(c)?(d=a,Jt(a)?d=Mc(a):at(a)&&!ct(a)||(d=Ki(c))):l=!1}l&&(o.set(c,d),s(d,c,r,i,o),o.delete(c)),Oc(e,n,d)}};const $c=function e(t,n,r,s,i){t!==n&&wo(n,(function(o,a){if(i||(i=new Jr),at(o))Rc(t,n,a,r,e,s,i);else{var c=s?s(Tc(t,a),o,a+"",t,n,i):void 0;void 0===c&&(c=o),Oc(t,a,c)}}),wi)};const Dc=function(e){return co((function(t,n){var r=-1,s=n.length,i=s>1?n[s-1]:void 0,o=s>2?n[2]:void 0;for(i=e.length>3&&"function"==typeof i?(s--,i):void 0,o&&uo(n[0],n[1],o)&&(i=s<3?void 0:i,s=1),t=Object(t);++r<s;){var a=n[r];a&&e(t,a,r,i)}return t}))};const Pc=Dc((function(e,t,n){$c(e,t,n)}));const Fc=Dc((function(e,t,n,r){$c(e,t,n,r)})),Lc=Math.max,zc=Math.min;const Uc=function(e,t){let n,r,s,i,o,a,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=0,d=!1,l=c.promise?Xn():null;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){const s=n,o=r,a=l;return n=r=void 0,u=t,i=e.apply(o,s),c.promise&&(a.resolve(i),l=Xn()),c.promise?a:i}function f(e){const n=e-a;return void 0===a||n>=t||n<0||d&&e-u>=s}function g(){const e=ir();if(f(e))return p(e);o=setTimeout(g,function(e){const n=t-(e-a);return d?zc(n,s-(e-u)):n}(e))}function p(e){return o=void 0,n?h(e):(n=r=void 0,c.promise?l:i)}function m(e,t){if(Array.isArray(e)&&Array.isArray(t))return c?.dedupeArrays?e.concat(t.filter((t=>-1===e.indexOf(t)))):e.concat(t)}function v(){const e=ir(),s=f(e);var p;if(p=Array.from(arguments),n=n?.length?p.length?c?.concatArrays||c?.dedupeArrays?Fc(n,p,m):Pc(n,p):n:p||[],r=this,a=e,s){if(void 0===o)return function(e){return u=e,o=setTimeout(g,t),c.promise?l:i}(a);if(d)return clearTimeout(o),o=setTimeout(g,t),h(a)}return void 0===o&&(o=setTimeout(g,t)),c.promise?l:i}return t=In(t)||0,at(c)&&(d="maxWait"in c,s=d?Lc(In(c.maxWait)||0,t):s),v.cancel=function(){void 0!==o&&clearTimeout(o),u=0,n=a=r=o=void 0},v.flush=function(){return void 0===o?i:p(ir())},v};function Bc(e,t){let n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}const qc={serializer:{serialize:oc.serialize,deserialize:oc.deserialize}};const Hc={_driver:"sessionStorageWrapper",_initStorage:function(e){if(qc.keyPrefix=Bc(e,this._defaultConfig),e)for(const t in e)qc[t]=e[t]},_support:function(){try{if(sessionStorage&&"setItem"in sessionStorage)return!0}catch(e){console.log(e)}return!1}(),iterate:function(e,t){const n=this.ready().then((function(){const t=qc.keyPrefix,n=t.length,r=sessionStorage.length;let s=1;for(let i=0;i<r;i++){const r=sessionStorage.key(i);if(0!==r.indexOf(t))continue;let o=sessionStorage.getItem(r);if(o&&(o=qc.serializer.deserialize(o)),o=e(o,r.substring(n),s++),void 0!==o)return o}}));return va(n,t),n},getItem:function(e,t){e=ya(e);const n=this.ready().then((function(){let t=sessionStorage.getItem(qc.keyPrefix+e);return t&&(t=qc.serializer.deserialize(t)),t}));return va(n,t),n},setItem:async function(e,t,n){e=ya(e),await this.ready();const r=t=t??null;qc.serializer.serialize(t,((t,s)=>{if(s)throw s;try{sessionStorage.setItem(qc.keyPrefix+e,t),va(Promise.resolve(r),n)}catch(e){if("QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)throw console.error("Your sesionStorage capacity is used up."),e;throw e}}))},removeItem:function(e,t){e=ya(e);const n=this.ready().then((function(){sessionStorage.removeItem(qc.keyPrefix+e)}));return va(n,t),n},clear:function(e){const t=this.ready().then((function(){const e=qc.keyPrefix;for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}}));return va(t,e),t},length:function(e){const t=this.keys().then((function(e){return e.length}));return va(t,e),t},key:function(e,t){const n=this.ready().then((function(){let t;try{t=sessionStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(qc.keyPrefix.length)),t}));return va(n,t),n},keys:function(e){const t=this.ready().then((function(){const e=sessionStorage.length,t=[];for(let n=0;n<e;n++){const e=sessionStorage.key(n);0===e.indexOf(qc.keyPrefix)&&t.push(e.substring(qc.keyPrefix.length))}return t}));return va(t,e),t},dropInstance:function(e,t){if(t=ba.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){const t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}const n=this;let r;return r=e.name?new Promise((function(t){e.storeName?t(Bc(e,n._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}})):Promise.reject(new Error("Invalid arguments")),va(r,t),r}},Gc=Hc;var Jc=o(1459),Wc=o(8487);const Qc=da._driver;Nc.defineDriver(da),(0,Jc.extendPrototype)(Nc),(0,Wc.extendPrototype)(Nc);class Kc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("local"===t&&!window.localStorage)throw new Error("Skeletor.storage: Environment does not support localStorage.");if("session"===t&&!window.sessionStorage)throw new Error("Skeletor.storage: Environment does not support sessionStorage.");ha(t)?this.storeInitialized=this.initStore(t,n):(this.store=t,n&&(this.store.debouncedSetItems=Uc((e=>this.store.setItems(e)),50,{promise:!0})),this.storeInitialized=Promise.resolve()),this.name=e}async initStore(e,t){if("session"===e)await Nc.setDriver(Gc._driver);else if("local"===e)await Nc.config({driver:Nc.LOCALSTORAGE});else if("in_memory"===e)await Nc.config({driver:Qc});else if("indexed"!==e)throw new Error("Skeletor.storage: No storage type was specified");this.store=Nc,t&&(this.store.debouncedSetItems=Uc((e=>this.store.setItems(e)),50,{promise:!0}))}flush(){return this.store.debouncedSetItems?.flush()}async clear(){await this.store.removeItem(this.name).catch((e=>console.error(e)));const e=new RegExp(`^${this.name}-`),t=(await this.store.keys()).filter((t=>e.test(t)));await Promise.all(t.map((e=>this.store.removeItem(e).catch((e=>console.error(e))))))}sync(){const e=this;async function t(t,n,r){let s,i,o,a;const c=n.collection;["patch","update"].includes(t)&&(a=la(n.attributes)),await e.storeInitialized;try{const i=n.attributes;switch(t){case"read":s=void 0!==n.id?await e.find(n):await e.findAll();break;case"create":s=await e.create(n,r);break;case"patch":case"update":r.wait&&(n.attributes=a),o=e.update(n,r),r.wait&&(n.attributes=i),s=await o;break;case"delete":s=await e.destroy(n,c)}}catch(t){i=22===t.code&&0===e.getStorageSize()?"Private browsing is unsupported":t.message}if(s){if(r&&r.success){const e="read"===t?s:null;r.success(e,r)}}else i=i||"Record Not Found",r&&r.error&&r.error(i)}return t.__name__="localSync",t}removeCollectionReference(e,t){if(!t)return;const n=t.filter((t=>t.id!==e.id)).map((e=>this.getItemName(e.id)));return this.store.setItem(this.name,n)}addCollectionReference(e,t){if(!t)return;const n=t.map((e=>this.getItemName(e.id))),r=this.getItemName(e.id);return n.includes(r)||n.push(r),this.store.setItem(this.name,n)}getCollectionReferenceData(e){if(!e.collection)return{};const t=e.collection.map((e=>this.getItemName(e.id))),n=this.getItemName(e.id);t.includes(n)||t.push(n);const r={};return r[this.name]=t,r}async save(e){if(this.store.setItems){const t={};return t[this.getItemName(e.id)]=e.toJSON(),Object.assign(t,this.getCollectionReferenceData(e)),this.store.debouncedSetItems?this.store.debouncedSetItems(t):this.store.setItems(t)}{const t=this.getItemName(e.id),n=await this.store.setItem(t,e.toJSON());return await this.addCollectionReference(e,e.collection),n}}create(e,t){return e.id||(e.id=ci()+ci()+"-"+ci()+"-"+ci()+"-"+ci()+"-"+ci()+ci()+ci(),e.set(e.idAttribute,e.id,t)),this.save(e)}update(e){return this.save(e)}find(e){return this.store.getItem(this.getItemName(e.id))}async findAll(){const e=await this.store.getItem(this.name);if(e?.length){const t=await this.store.getItems(e);return Object.values(t)}return[]}async destroy(e,t){return await this.flush(),await this.store.removeItem(this.getItemName(e.id)),await this.removeCollectionReference(e,t),e}getStorageSize(){return this.store.length}getItemName(e){return this.name+"-"+e}}Kc.sessionStorageInitialized=Nc.defineDriver(Gc),Kc.localForage=Nc;const Vc=Kc;function Yc(){if(er.config.get("trusted")){return"sessionStorage"===au.get("persistent_store")?"session":"persistent"}return"session"}function Xc(e){return"persistent"===e&&"IndexedDB"===au.get("persistent_store")}function Zc(e,t){const n=t||Yc(),r=er.storage[n];if(void 0===r)throw new TypeError(`createStore: Could not find store for ${e}`);return new Vc(e,r,Xc(t))}function eu(e,t,n){const r=n||Yc();if(e.browserStorage=Zc(t,r),Xc(r)){const t=()=>e.browserStorage.flush();window.addEventListener(er.unloadevent,t),e.on("destroy",(()=>window.removeEventListener(er.unloadevent,t))),e.listenTo(er,"beforeLogout",t)}}let tu,nu,ru={};function su(){if(!er.bare_jid){const e="No JID to fetch user settings for";throw Fe.error(e),Error(e)}if(!nu?.fetched){const e=`converse.user-settings.${er.bare_jid}`;nu=new ua({id:e}),eu(nu,e),nu.fetched=nu.fetch({promise:!0})}return nu.fetched}async function iu(){return await su(),nu}async function ou(e,t){return await su(),nu.save(e,t)}const au={extend:e=>function(e){tr(oi,e);const t=Object.keys(e).filter((e=>e in oi)),n=ii(ru,t),r=Object.assign(ii(e,t),n);tr(tu,r)}(e),update(e){return Fe.warn("The api.settings.update method has been deprecated and will be removed. Please use api.settings.extend instead."),this.extend(e)},get:e=>function(e){if(Object.keys(oi).includes(e))return tu[e]}(e),set(e,t){!function(e,t){if(null==e)return this;let n;e instanceof Object?n=e:"string"==typeof e&&(n={},n[e]=t);const r=Object.keys(n).filter((e=>e in oi)),s={};r.forEach((e=>{const t=n[e];Ss(tu[e],t)||(s[e]=t,tu[e]=t)})),Object.keys(s).forEach((e=>tu.trigger("change:"+e,s[e]))),tu.trigger("change",s)}(e,t)},listen:{on(e,t,n){!function(e,t,n){tu.on(e,t,n)}(e,t,n)},not(e,t){!function(e,t){tu.off(e,t)}(e,t)}}},cu={getModel:()=>iu(),async get(e,t){const n=await iu();return void 0===n.get(e)?t:n.get(e)},set(e,t){if(e instanceof Object)return ou(e,{promise:!0});{const n={};return n[e]=t,ou(n,{promise:!0})}},clear:()=>async function(){return await su(),nu.clear()}()};function uu(){return["mobile","fullscreen","embedded"].includes(au.get("view_mode"))}function du(){return"montague.lit/http-bind"===ru.bosh_service_url}function lu(e){let t;const n={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};t=(e=e||document.createEvent("Events")).type in n?n[e.type]:document.hidden?"hidden":"visible",er.windowState=t,er.api.trigger("windowStateChanged",{state:t})}function hu(e){const t=er.promises[e];if(!t)throw new Error(`Tried to replace non-existing promise: ${e}`);if(t.replace){const n=Xn();n.replace=t.replace,er.promises[e]=n}else Fe.debug(`Not replacing promise "${e}"`)}function fu(){const{api:e}=er;return!er.config.get("trusted")||e.settings.get("clear_cache_on_logout")||du()}async function gu(){const{api:e}=er;return await e.trigger("beforeTearDown",{synchronous:!0}),window.removeEventListener("click",er.onUserActivity),window.removeEventListener("focus",er.onUserActivity),window.removeEventListener("keypress",er.onUserActivity),window.removeEventListener("mousemove",er.onUserActivity),window.removeEventListener(er.unloadevent,er.onUserActivity),window.clearInterval(er.everySecondTrigger),e.trigger("afterTearDown"),er}function pu(){return er.session?.destroy(),delete er.session,fu()&&er.api.user.settings.clear(),er.api.trigger("clearSession",{synchronous:!0})}var mu=o(7002),vu=o(1063);function _u(){return("WebSocket"in window||"MozWebSocket"in window)&&au.get("websocket_url")?au.get("websocket_url"):au.get("bosh_service_url")?au.get("bosh_service_url"):""}function yu(e){return"string"==typeof e&&(2===e.split("@").filter((e=>!!e)).length&&!e.startsWith("@")&&!e.endsWith("@"))}function bu(e){return e.startsWith("xmpp:")&&e.endsWith("?join")?e.replace(/^xmpp:/,"").replace(/\?join$/,""):e}function wu(e,t){t=e.session.get("jid")||t,e.api.settings.get("authentication")===be||ge.getResourceFromJid(t)||(t=t.toLowerCase()+Nu.generateResource()),e.jid=t,e.bare_jid=ge.getBareJidFromJid(t),e.resource=ge.getResourceFromJid(t),e.domain=ge.getDomainFromJid(t),e.session.save({jid:t,bare_jid:e.bare_jid,resource:e.resource,domain:e.domain,active:!0}),xh.connection.get().jid=t}async function Su(e){return await async function(e,t){const n=e.api.settings.get("connection_options").worker,r=ge.getBareJidFromJid(t).toLowerCase(),s=`converse.session-${r}`;e.session?.get("id")!==s?(!function(e,t){if("sessionStorage"===e.api.settings.get("persistent_store"))return;if("BrowserExtLocal"===e.api.settings.get("persistent_store"))return Vc.localForage.defineDriver(mu.Z).then((()=>Vc.localForage.setDriver("webExtensionLocalStorage"))),void(e.storage.persistent=Vc.localForage);if("BrowserExtSync"===e.api.settings.get("persistent_store"))return Vc.localForage.defineDriver(vu.Z).then((()=>Vc.localForage.setDriver("webExtensionSyncStorage"))),void(e.storage.persistent=Vc.localForage);const n={name:du()?"converse-test-persistent":"converse-persistent",storeName:t};"localStorage"===e.api.settings.get("persistent_store")?(n.description="localStorage instance",n.driver=[Vc.localForage.LOCALSTORAGE]):"IndexedDB"===e.api.settings.get("persistent_store")&&(n.description="indexedDB instance",n.driver=[Vc.localForage.INDEXEDDB]),e.storage.persistent=Vc.localForage.createInstance(n)}(e,r),e.session=new ua({id:s}),eu(e.session,s,n?"persistent":"session"),await new Promise((t=>e.session.fetch({success:t,error:t}))),!n&&e.session.get("active")&&(e.session.clear(),e.session.save({id:s})),wu(e,t),window.addEventListener(e.unloadevent,(()=>e.session?.save("active",!1))),e.api.trigger("userSessionInitialized")):wu(e,t)}(er,e),er.api.trigger("setUserJID"),e}async function Eu(e){const{api:t}=e;await t.trigger("cleanup",{synchronous:!0}),function(e){const{api:t}=e;document.removeEventListener("visibilitychange",lu),t.trigger("unregisteredGlobalEventHandlers")}(e),t.connection.get()?.reset(),e.stopListening(),e.off(),e.promises.initialized.isResolved&&t.promises.add("initialized")}function Au(){return new Promise(cr((async(e,t)=>{let n=new XMLHttpRequest;n.open("GET",er.api.settings.get("credentials_url"),!0),n.setRequestHeader("Accept","application/json, text/javascript"),n.onload=()=>{if(n.status>=200&&n.status<400){const t=JSON.parse(n.responseText);Su(t.jid).then((()=>{e({jid:t.jid,password:t.password})}))}else t(new Error(`${n.status}: ${n.responseText}`))},n.onerror=t,n=await er.api.hook("beforeFetchLoginCredentials",this,n),n.send()}),arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))}async function xu(e,t){const{api:n}=er;if(n.settings.get("authentication")===Se){if(e)return Cu(e);if(n.settings.get("credentials_url"))return Cu(await async function(){let e,t=0;for(;!e;){try{e=await Au(t)}catch(e){Fe.error("Could not fetch login credentials"),Fe.error(e)}t=2e3}return e}());if(er.jid&&(n.settings.get("password")||n.connection.get().pass))return Cu();if(n.settings.get("reuse_scram_keys")){const e=await async function(){const e=localStorage.getItem("conversejs-session-jid");if(!e)return null;await Su(e);const t=(await ju(e)).get("scram_keys");return t?{jid:e,password:t}:null}();if(e)return Cu(e)}if(!du()&&"credentials"in navigator){const e=await async function(){if(!localStorage.getItem("conversejs-session-jid"))return null;try{const e=await navigator.credentials.get({password:!0});if(e&&"password"==e.type&&yu(e.id))return await Su(e.id),{jid:e.id,password:e.password}}catch(e){return Fe.error(e),null}}();if(e)return Cu(e)}du()||Fe.warn("attemptNonPreboundSession: Couldn't find credentials to log in with")}else![be,we].includes(n.settings.get("authentication"))||t&&!n.settings.get("auto_login")||Cu()}async function ju(e){const t=`converse.scram-keys-${ge.getBareJidFromJid(e)}`,n=new ua({id:t});return eu(n,t,"persistent"),await new Promise((e=>n.fetch({success:e,error:e}))),n}async function Cu(e){const{api:t}=er,n=t.connection.get();if([be,we].includes(t.settings.get("authentication"))){if(!er.jid)throw new Error("Config Error: when using anonymous login you need to provide the server's domain via the 'jid' option. Either when calling converse.initialize, or when calling _converse.api.user.login.");n.reconnecting||n.reset(),n.connect(er.jid.toLowerCase())}else if(t.settings.get("authentication")===Se){const r=e?.password??(n?.pass||t.settings.get("password"));if(!r){if(t.settings.get("auto_login"))throw new Error("autoLogin: If you use auto_login and authentication='login' then you also need to provide a password.");return n.setDisconnectionCause(ge.Status.AUTHFAIL,void 0,!0),void t.connection.disconnect()}let s;if(n.reconnecting||(n.reset(),n.service=_u()),er.config.get("trusted")&&er.jid&&t.settings.get("reuse_scram_keys")&&!r?.ck){const e=await ju(er.jid);s=t=>{const{scram_keys:r}=n;r&&e.save({scram_keys:r}),n.onConnectStatusChanged(t)}}n.connect(er.jid,r,s)}}const Iu=Object.keys(ge.Status).reduce(((e,t)=>Math.max(e,ge.Status[t])),0);ge.Status.RECONNECTING=Iu+1;class Nu extends ge.Connection{constructor(e,t){super(e,t),this.debouncedReconnect=cr(this.reconnect,3e3)}static generateResource(){return`/converse.js-${Math.floor(139749528*Math.random()).toString()}`}async bind(){await xh.trigger("beforeResourceBinding",{synchronous:!0}),super.bind()}async onDomainDiscovered(e){const t=await e.text(),n=(new window.DOMParser).parseFromString(t,"text/xml").firstElementChild;if("XRD"!=n.nodeName||"http://docs.oasis-open.org/ns/xri/xrd-1.0"!=n.namespaceURI)return Fe.warn("Could not discover XEP-0156 connection methods");const r=dr()('Link[rel="urn:xmpp:alt-connections:xbosh"]',n),s=dr()('Link[rel="urn:xmpp:alt-connections:websocket"]',n),i=r.map((e=>e.getAttribute("href"))),o=s.map((e=>e.getAttribute("href")));0===i.length&&0===o.length?Fe.warn("Neither BOSH nor WebSocket connection methods have been specified with XEP-0156."):(xh.settings.set("websocket_url",o.pop()),xh.settings.set("bosh_service_url",i.pop()),this.service=xh.settings.get("websocket_url")||xh.settings.get("bosh_service_url"),this.setProtocol())}async discoverConnectionMethods(e){const t={mode:"no-cors",headers:{Accept:"application/xrd+xml, text/xml"}},n=`https://${e}/.well-known/host-meta`;let r;try{r=await fetch(n,t)}catch(e){return Fe.error(`Failed to discover alternative connection methods at ${n}`),void Fe.error(e)}r.status>=200&&r.status<400?await this.onDomainDiscovered(r):Fe.warn("Could not discover XEP-0156 connection methods")}async connect(e,t,n){if(xh.settings.get("discover_connection_methods")){const t=ge.getDomainFromJid(e);await this.discoverConnectionMethods(t)}if(!xh.settings.get("bosh_service_url")&&!xh.settings.get("websocket_url"))throw new Error("You must supply a value for either the bosh_service_url or websocket_url or both.");super.connect(e,t,n||this.onConnectStatusChanged,59)}async switchTransport(){xh.connection.isType("websocket")&&xh.settings.get("bosh_service_url")?(await Su(er.bare_jid),this._proto._doDisconnect(),this._proto=new ge.Bosh(this),this.service=xh.settings.get("bosh_service_url")):xh.connection.isType("bosh")&&xh.settings.get("websocket_url")&&(xh.settings.get("authentication")===be?await Su(xh.settings.get("jid")):await Su(er.bare_jid),this._proto._doDisconnect(),this._proto=new ge.Websocket(this),this.service=xh.settings.get("websocket_url"))}async reconnect(){Fe.debug("RECONNECTING: the connection has dropped, attempting to reconnect."),this.reconnecting=!0,await gu();const e=er.connfeedback.get("connection_status");return e===ge.Status.CONNFAIL?this.switchTransport():e===ge.Status.AUTHFAIL&&xh.settings.get("authentication")===be&&await Su(xh.settings.get("jid")),xh.trigger("will-reconnect"),xh.settings.get("authentication")===be&&await pu(),xh.user.login(er.jid)}async onConnected(e){delete this.reconnecting,this.flush(),await Su(this.jid),er.config.get("trusted")&&localStorage.setItem("conversejs-session-jid",er.bare_jid),await xh.trigger("afterResourceBinding",e,{synchronous:!0}),e?xh.trigger("reconnected"):xh.trigger("connected")}setDisconnectionCause(e,t,n){void 0===e?(delete this.disconnection_cause,delete this.disconnection_reason):(void 0===this.disconnection_cause||n)&&(this.disconnection_cause=e,this.disconnection_reason=t)}setConnectionStatus(e,t){this.status=e,er.connfeedback.set({connection_status:e,message:t})}async finishDisconnection(){Fe.debug("DISCONNECTED"),delete this.reconnecting,this.reset(),gu(),await pu(),xh.connection.destroy(),xh.trigger("disconnected")}onDisconnected(){if(!xh.settings.get("auto_reconnect"))return this.finishDisconnection();{const e=this.disconnection_reason;if(this.disconnection_cause===ge.Status.AUTHFAIL)return xh.settings.get("credentials_url")||xh.settings.get("authentication")===be?xh.connection.reconnect():this.finishDisconnection();if(this.status===ge.Status.CONNECTING){const{__:e}=er;return this.setConnectionStatus(ge.Status.CONNFAIL,e("An error occurred while connecting to the chat server.")),this.finishDisconnection()}if(this.disconnection_cause===Ee||e===ge.ErrorCondition.NO_AUTH_MECH||"host-unknown"===e||"remote-connection-failed"===e)return this.finishDisconnection();xh.connection.reconnect()}}onConnectStatusChanged(e,t){const{__:n}=er;if(Fe.debug(`Status changed to: ${je[e]}`),e===ge.Status.ATTACHFAIL)this.setConnectionStatus(e),this.worker_attach_promise?.resolve(!1);else if(e===ge.Status.CONNECTED||e===ge.Status.ATTACHED){if(this.worker_attach_promise?.isResolved&&this.status===ge.Status.ATTACHED)return;this.setConnectionStatus(e),this.worker_attach_promise?.resolve(!0),er.send_initial_presence=!0,this.setDisconnectionCause(),this.reconnecting?(Fe.debug(e===ge.Status.CONNECTED?"Reconnected":"Reattached"),this.onConnected(!0)):(Fe.debug(e===ge.Status.CONNECTED?"Connected":"Attached"),this.restored&&(er.send_initial_presence=!1),this.onConnected())}else if(e===ge.Status.DISCONNECTED)this.setDisconnectionCause(e,t),this.onDisconnected();else if(e===ge.Status.BINDREQUIRED)this.bind();else if(e===ge.Status.ERROR)this.setConnectionStatus(e,n("An error occurred while connecting to the chat server."));else if(e===ge.Status.CONNECTING)this.setConnectionStatus(e);else if(e===ge.Status.AUTHENTICATING)this.setConnectionStatus(e);else if(e===ge.Status.AUTHFAIL)t||(t=n("Your XMPP address and/or password is incorrect. Please try again.")),this.setConnectionStatus(e,t),this.setDisconnectionCause(e,t,!0),this.onDisconnected();else if(e===ge.Status.CONNFAIL){let r=t;"host-unknown"===t||"remote-connection-failed"==t?r=n("Sorry, we could not connect to the XMPP host with domain: %1$s",`"${ge.getDomainFromJid(this.jid)}"`):void 0!==t&&t===ge?.ErrorCondition?.NO_AUTH_MECH&&(r=n("The XMPP server did not offer a supported authentication mechanism")),this.setConnectionStatus(e,r),this.setDisconnectionCause(e,t)}else e===ge.Status.DISCONNECTING&&this.setDisconnectionCause(e,t)}isType(e){return"websocket"===e.toLowerCase()?this._proto instanceof ge.Websocket:"bosh"===e.toLowerCase()?ge.Bosh&&this._proto instanceof ge.Bosh:void 0}hasResumed(){return xh.settings.get("connection_options")?.worker||this.isType("bosh")?er.connfeedback.get("connection_status")===ge.Status.ATTACHED:!this.do_bind}restoreWorkerSession(){return this.attach(this.onConnectStatusChanged),this.worker_attach_promise=Xn(),this.worker_attach_promise}}class Ou extends Nu{constructor(e,t){super(e,t),this.sent_stanzas=[],this.IQ_stanzas=[],this.IQ_ids=[],this.features=ge.xmlHtmlNode('<stream:features xmlns:stream="http://etherx.jabber.org/streams" xmlns="jabber:client"><ver xmlns="urn:xmpp:features:rosterver"/><csi xmlns="urn:xmpp:csi:0"/><this xmlns="http://jabber.org/protocol/caps" ver="UwBpfJpEt3IoLYfWma/o/p3FFRo=" hash="sha-1" node="http://prosody.im"/><bind xmlns="urn:ietf:params:xml:ns:xmpp-bind"><required/></bind><sm xmlns=\'urn:xmpp:sm:3\'/><session xmlns="urn:ietf:params:xml:ns:xmpp-session"><optional/></session></stream:features>').firstChild,this._proto._processRequest=()=>{},this._proto._disconnect=()=>this._onDisconnectTimeout(),this._proto._onDisconnectTimeout=()=>{},this._proto._connect=()=>{this.connected=!0,this.mock=!0,this.jid="romeo@montague.lit/orchard",this._changeConnectStatus(ge.Status.BINDREQUIRED)}}_processRequest(){}sendIQ(e,t,n){e=e.tree?.()??e,this.IQ_stanzas.push(e);const r=super.sendIQ(e,t,n);return this.IQ_ids.push(r),r}send(e){return e=e.tree?.()??e,this.sent_stanzas.push(e),super.send(e)}async bind(){await xh.trigger("beforeResourceBinding",{synchronous:!0}),this.authenticated=!0,er.no_connection_on_bind||this._changeConnectStatus(ge.Status.CONNECTED)}}let ku;const Tu={explicitResourceBinding:!0},Mu={init(e){if(e&&ku?.jid&&(t=ku.jid,n=e,"string"==typeof t&&"string"==typeof n&&ge.getDomainFromJid(t).toLowerCase()===ge.getDomainFromJid(n).toLowerCase()))return ku;var t,n;if(!au.get("bosh_service_url")&&au.get("authentication")===Ae)throw new Error("authentication is set to 'prebind' but we don't have a BOSH connection");const r=du()?Ou:Nu;return ku=new r(_u(),Object.assign(Tu,au.get("connection_options"),{keepalive:au.get("keepalive")})),function(e){const t={};t[ge.LogLevel.DEBUG]="debug",t[ge.LogLevel.INFO]="info",t[ge.LogLevel.WARN]="warn",t[ge.LogLevel.ERROR]="error",t[ge.LogLevel.FATAL]="fatal",ge.log=(e,n)=>Fe.log(n,t[e]),ge.error=e=>Fe.error(e),e.xmlInput=e=>Fe.debug(e.outerHTML,"color: darkgoldenrod"),e.xmlOutput=e=>Fe.debug(e.outerHTML,"color: darkcyan")}(ku),sr.trigger("connectionInitialized"),ku},get:()=>ku,destroy(){this.disconnect(),ku?.disconnect(),ku=void 0},authenticated:()=>ku?.authenticated&&!0,connected:()=>ku?.connected&&!0,disconnect(){ku?.disconnect()},reconnect:()=>(ku.setConnectionStatus(ge.Status.RECONNECTING,"The connection has dropped, attempting to reconnect."),ku?.reconnecting?ku.debouncedReconnect():ku.reconnect()),isType:e=>ku.isType(e)};function Ru(e,t){clearTimeout(e),clearInterval(t)}function $u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;try{const t=e();if(t)return Promise.resolve(t)}catch(e){return Promise.reject(e)}const r=Xn(),s=new Error;const i=setInterval((function(){try{const t=e();t&&(Ru(o,i),r.resolve(t))}catch(e){Ru(o,i),r.reject(e)}}),n);const o=setTimeout((function(){Ru(o,i);const e=`Wait until promise timed out: \n\n${s.stack}`;console.trace(),Fe.error(e),r.reject(new Error(e))}),t);return r}const Du={promises:{add(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(e=Array.isArray(e)?e:[e]).forEach((e=>{const n=Xn();n.replace=t,er.promises[e]=n}))}},waitUntil(e){if(rr(e))return $u(e);{const t=er.promises[e];return void 0===t?null:t}}};class Pu extends Error{}const Fu={send(e){const{api:t}=er;return t.connection.connected()?("string"==typeof e?e=me(e):e?.tree&&(e=e.tree()),"iq"===e.tagName?t.sendIQ(e):(t.connection.get().send(e),void t.trigger("send",e))):(Fe.warn("Not sending stanza because we're not connected!"),void Fe.warn(ge.serialize(e)))},sendIQ(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{api:r}=er;if(!r.connection.connected())return Fe.warn("Not sending IQ stanza because we're not connected!"),void Fe.warn(ge.serialize(e));const s=r.connection.get();let i;return e=e.tree?.()??e,["get","set"].includes(e.getAttribute("type"))?(t=t||r.settings.get("stanza_timeout"),n?(i=new Promise(((n,r)=>s.sendIQ(e,n,r,t))),i.catch((n=>{if(null===n)throw new Pu(`Timeout error after ${t}ms for the following IQ stanza: ${ge.serialize(e)}`)}))):i=new Promise((n=>s.sendIQ(e,n,n,t)))):(s.sendIQ(e),i=Promise.resolve()),r.trigger("send",e),i}},Lu={presence:{async send(e,t,n,r){await xh.waitUntil("statusInitialized"),r&&!Array.isArray(r)&&(r=[r]);const s=er.xmppstatus,i=await s.constructPresence(e,t,n);if(r?.map((e=>e?.tree()??e)).forEach((e=>i.cnode(e).up())),xh.send(i),["away","chat","dnd","online","xa",void 0].includes(e)){(await xh.rooms.get()).forEach((t=>t.sendStatusPresence(e,n,r)))}}}},zu={user:{settings:cu,...Lu,jid:()=>Mu.get()?.jid,async login(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{api:r}=er;e=e||r.settings.get("jid");const s=Mu.init(e);if(r.settings.get("connection_options")?.worker&&await s.restoreWorkerSession())return;e&&(e=await Su(e));const i=er.pluggable.plugins["converse-bosh"];if(i?.enabled()){if(await er.restoreBOSHSession())return;if(r.settings.get("authentication")===Ae&&(!n||r.settings.get("auto_login")))return er.startNewPreboundBOSHSession()}t=t||r.settings.get("password");xu(e&&t?{jid:e,password:t}:null,n)},async logout(){const{api:e}=er;await e.trigger("beforeLogout",{synchronous:!0});const t=Xn(),n=()=>{Object.keys(er.promises).forEach(hu),delete er.jid,localStorage.removeItem("conversejs-session-jid"),e.trigger("logout"),t.resolve()},r=Mu.get();return r?(r.setDisconnectionCause(Ee,void 0,!0),e.listen.once("disconnected",(()=>n())),r.disconnect()):n(),t}}};const Uu=class extends ua{defaults(){return{connection_status:ge.Status.DISCONNECTED,message:""}}initialize(){super.initialize();const{api:e}=er;this.on("change",(()=>e.trigger("connfeedback",er.connfeedback)))}};var Bu=o(9988),qu=o.n(Bu),Hu=o(7484),Gu=o.n(Hu);const Ju=e=>`<value>${e}</value>`;function Wu(e){const t=[],n=e?.options;for(let e=0,r=n.length;e<r;e++){const r=n[e];r.selected&&t.push(r.value||r.text)}return t}function Qu(e){return"@"!==e&&RegExp("(\\p{Z}|\\p{P})","u").test(e)}function Ku(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer}function Vu(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}function Yu(e){return new TextDecoder("utf-8").decode(e)}function Xu(e){return new TextEncoder("utf-8").encode(e).buffer}function Zu(e){return btoa(new Uint8Array(e).reduce(((e,t)=>e+String.fromCharCode(t)),""))}function ed(e){const t=window.atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return r.buffer}function td(e){const t=new Uint8Array(e.match(/[\da-f]{2}/gi).map((e=>parseInt(e,16))));return t.buffer}function nd(e){const t=rd(e),{protocol:n}=window.location;return!!["chrome-extension:","file:"].includes(n)||("http:"===n||"https:"===n&&["https","aesgcm"].includes(t.protocol().toLowerCase()))}function rd(e){try{return e instanceof qu()?e:new(qu())(e)}catch(e){return Fe.debug(e),null}}function sd(e,t){const n=rd(t);if(null===n)throw new Error(`checkFileTypes: could not parse url ${t}`);const r=n.filename().toLowerCase();return!!e.filter((e=>r.endsWith(e))).length}function id(e,t){const n=rd(t),r=n.subdomain(),s=n.domain(),i=`${r?`${r}.`:""}${s}`;return e.includes(s)||e.includes(i)}function od(e,t){const n=xh.settings.get(t);if(!Array.isArray(n))return!0;try{return id(n,e)}catch(e){return Fe.debug(e),!1}}function ad(e){return sd([".jpg",".jpeg",".png",".gif",".bmp",".tiff",".svg"],e)}function cd(e){return sd([".ogg",".mp3",".m4a"],e)}function ud(e){return sd([".mp4",".webm"],e)}function dd(e){const t=xh.settings.get("image_urls_regex");return t?.test(e)||ad(e)}function ld(e){if(location.hash.startsWith("#converse?loglevel=")){e?.preventDefault();const t=location.hash.split("=").pop();Object.keys(De).includes(t)?Fe.setLogLevel(t):Fe.error(`Could not set loglevel of ${t}`)}}function hd(e){return e instanceof ua&&(e=e.attributes),!(e.oob_url||e.file||e.is_encrypted&&e.plaintext||e.message||e.body)}function fd(e,t,n){!function(e){return e.collection&&e.collection.browserStorage}(e)?e.set(t,n):e.save(t,n)}function gd(e){return Math.random()*e|0}function pd(e){const t=crypto.randomUUID?.()??"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=gd(16);return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t}const md=Object.assign({arrayBufferToBase64:Zu,arrayBufferToHex:Vu,arrayBufferToString:Yu,base64ToArrayBuffer:ed,checkFileTypes:sd,createStore:Zc,getCurrentWord:function(e,t,n){t||(t=e.selectionEnd||void 0);let[r]=e.value.slice(0,t).split(/\s/).slice(-1);return n&&([r]=r.split(n).slice(-1)),r},getDefaultStore:Yc,getLongestSubstring:function(e,t){return t.reduce((function(t,n){return e.startsWith(n)&&n.length>t.length?n:t}),"")},getOpenPromise:Xn,getOuterWidth:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.offsetWidth;if(!t)return n;const r=window.getComputedStyle(e);return n+=parseInt(r.marginLeft?r.marginLeft:"0",10)+parseInt(r.marginRight?r.marginRight:"0",10),n},getRandomInt:gd,getSelectValues:Wu,getURI:rd,getUniqueId:pd,isAllowedProtocolForMedia:nd,isAudioURL:cd,isElement:Me,isEmptyMessage:hd,isError:nr,isErrorObject:function(e){return e instanceof Error},isErrorStanza:function(e){return!!Me(e)&&"error"===e.getAttribute("type")},isFunction:rr,isGIFURL:function(e){return sd([".gif"],e)},isImageURL:dd,isMentionBoundary:Qu,isSameBareJID:function(e,t){return"string"==typeof e&&"string"==typeof t&&ge.getBareJidFromJid(e).toLowerCase()===ge.getBareJidFromJid(t).toLowerCase()},isTagEqual:function e(t,n){if(t instanceof ge.Builder)return e(t.tree(),n);if(t instanceof Element)return ge.isTagEqual(t,n);throw Error("isTagEqual called with value which isn't an element or Strophe.Builder instance")},isURLWithImageExtension:ad,isValidJID:yu,isValidMUCJID:function(e){return!e.startsWith("@")&&!e.endsWith("@")},isVideoURL:ud,merge:tr,onMultipleEvents:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=[];function r(r){n.push(r),e.length===n.length&&(t(n),n=[])}e.forEach((e=>e.object.on(e.event,r)))},placeCaretAtEnd:function(e){e!==document.activeElement&&e.focus();const t=2*e.value.length;setTimeout((()=>e.setSelectionRange(t,t)),1),e.scrollTop=999999},prefixMentions:function(e){let t=e.getMessageText();return(e.get("references")||[]).sort(((e,t)=>t.begin-e.begin)).forEach((e=>{t=`${t.slice(0,e.begin)}@${t.slice(e.begin)}`})),t},queryChildren:function(e,t){return Array.from(e.childNodes).filter((e=>e instanceof Element&&e.matches(t)))},replaceCurrentWord:function(e,t){const n=e.selectionEnd||void 0,r=e.value.slice(0,n).split(/\s/).pop(),s=e.value,i=Qu(r[0])?r[0]:"";e.value=s.slice(0,n-r.length)+i+`${t} `+s.slice(n);const o=n-r.length+t.length+1;e.selectionEnd=i?o+1:o},safeSave:fd,saveWindowState:lu,shouldClearCache:fu,shouldCreateMessage:function(e){return e.retracted||!hd(e)},shouldRenderMediaFromURL:function(e,t){if(!nd(e))return!1;const n=xh.settings.get("render_media"),r=od(e,`allowed_${t}_domains`);return Array.isArray(n)?r&&id(n,e):r&&n},stringToArrayBuffer:Xu,stringToElement:function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},toStanza:me,triggerEvent:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Event",r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const i=document.createEvent(n);i.initEvent(t,r,s),e.dispatchEvent(i)},webForm2xForm:function(e){const t=e.getAttribute("name");if(!t)return null;let n;return n="checkbox"===e.getAttribute("type")?e.checked?"1":"0":"TEXTAREA"==e.tagName?e.value.split("\n").filter((e=>e.trim())):"SELECT"==e.tagName?Wu(e):e.value,me(((e,t)=>`<field var="${e}">${t}</field>`)(t,Array.isArray(n)?n.map(Ju):Ju(n)))},waitUntil:$u},{});const vd=function(e,t,n,r){for(var s=-1,i=null==e?0:e.length;++s<i;){var o=e[s];t(r,o,n(o),e)}return r};const _d=function(e,t){return function(n,r){if(null==n)return n;if(!Kt(n))return e(n,r);for(var s=n.length,i=t?s:-1,o=Object(n);(t?i--:++i<s)&&!1!==r(o[i],i,o););return n}};const yd=_d(So);const bd=function(e,t,n,r){return yd(e,(function(e,s,i){t(r,e,n(e),i)})),r};const wd=function(e,t){return function(n,r){var s=Wt(n)?vd:bd,i=t?t():{};return s(n,e,Fo(r,2),i)}};var Sd=Object.prototype.hasOwnProperty,Ed=wd((function(e,t,n){Sd.call(e,n)?++e[n]:Ps(e,n,1)}));const Ad=Ed;var xd=Object.prototype.hasOwnProperty,jd=wd((function(e,t,n){xd.call(e,n)?e[n].push(t):Ps(e,n,[t])}));const Cd=jd;var Id=wd((function(e,t,n){Ps(e,n,t)}));const Nd=Id;const Od=function(e,t){var n=-1,r=Kt(e)?Array(e.length):[];return yd(e,(function(e,s,i){r[++n]=t(e,s,i)})),r};const kd=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e};const Td=function(e,t){if(e!==t){var n=void 0!==e,r=null===e,s=e==e,i=En(e),o=void 0!==t,a=null===t,c=t==t,u=En(t);if(!a&&!u&&!i&&e>t||i&&o&&c&&!a&&!u||r&&o&&c||!n&&c||!s)return 1;if(!r&&!i&&!u&&e<t||u&&n&&s&&!r&&!i||a&&n&&s||!o&&s||!c)return-1}return 0};const Md=function(e,t,n){for(var r=-1,s=e.criteria,i=t.criteria,o=s.length,a=n.length;++r<o;){var c=Td(s[r],i[r]);if(c)return r>=a?c:c*("desc"==n[r]?-1:1)}return e.index-t.index};const Rd=function(e,t,n){t=t.length?Rn(t,(function(e){return Wt(e)?function(t){return $s(t,1===e.length?e[0]:e)}:e})):[ei];var r=-1;t=Rn(t,rn(Fo));var s=Od(e,(function(e,n,s){var i=Rn(t,(function(t){return t(e)}));return{criteria:i,index:++r,value:e}}));return kd(s,(function(e,t){return Md(e,t,n)}))};var $d=co((function(e,t){if(null==e)return[];var n=t.length;return n>1&&uo(e,t[0],t[1])?t=[]:n>2&&uo(t[0],t[1],t[2])&&(t=[t[0]]),Rd(e,Qs(t,1),[])}));const Dd=$d,Pd=Array.prototype.slice,Fd={add:!0,remove:!0,merge:!0},Ld={add:!0,remove:!1};class zd extends ca{constructor(e,t){super(),t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this._model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,Object.assign({silent:!0},t))}set browserStorage(e){this._browserStorage=e}get browserStorage(){return this._browserStorage}get model(){return this._model??ua}set model(e){this._model=e}get length(){return this.models.length}preinitialize(){}initialize(){}toJSON(e){return this.map((function(t){return t.toJSON(e)}))}sync(e,t,n){return fi(this)(e,t,n)}add(e,t){return this.set(e,Object.assign({merge:!1},t,Ld))}remove(e,t){t=Object.assign({},t);const n=!Array.isArray(e),r=n?[e]:e.slice(),s=this._removeModels(r,t);return!t.silent&&s.length&&(t.changes={added:[],merged:[],removed:s},this.trigger("update",this,t)),n?s[0]:s}set(e,t){if(null==e)return;(t=Object.assign({},Fd,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);const n=!Array.isArray(e);e=n?[e]:e.slice();let r=t.at;null!=r&&(r=+r),r>this.length&&(r=this.length),r<0&&(r+=this.length+1);const s=[],i=[],o=[],a=[],c={},u=t.add,d=t.merge,l=t.remove;let h=!1;const f=this.comparator&&null==r&&!1!==t.sort,g=ha(this.comparator)?this.comparator:null;let p,m;for(m=0;m<e.length;m++){p=e[m];const n=this.get(p);if(n){if(d&&p!==n){let e=this._isModel(p)?p.attributes:p;t.parse&&(e=n.parse(e,t)),n.set(e,t),o.push(n),f&&!h&&(h=n.hasChanged(g))}c[n.cid]||(c[n.cid]=!0,s.push(n)),e[m]=n}else u&&(p=e[m]=this._prepareModel(p,t),p&&(i.push(p),this._addReference(p,t),c[p.cid]=!0,s.push(p)))}if(l){for(m=0;m<this.length;m++)p=this.models[m],c[p.cid]||a.push(p);a.length&&this._removeModels(a,t)}let v=!1;const _=!f&&u&&l;if(s.length&&_)v=this.length!==s.length||this.models.some(((e,t)=>e!==s[t])),this.models.length=0,this.models.splice(0,0,...s);else if(i.length){f&&(h=!0);let e=null==r?this.length:r;e=Math.min(Math.max(e,0),this.models.length),this.models.splice(e,0,...i)}if(h&&this.sort({silent:!0}),!t.silent){for(m=0;m<i.length;m++)null!=r&&(t.index=r+m),p=i[m],p.trigger("add",p,this,t);(h||v)&&this.trigger("sort",this,t),(i.length||a.length||o.length)&&(t.changes={added:i,removed:a,merged:o},this.trigger("update",this,t))}return n?e[0]:e}async clearStore(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e;await Promise.all(this.models.filter(t).map((t=>new Promise((n=>{t.destroy(Object.assign(e,{success:n,error:(e,t)=>{console.error(t),n()}}))}))))),await this.browserStorage.clear(),this.reset()}reset(e,t){t=t?ao(t):{};for(let e=0;e<this.models.length;e++)this._removeReference(this.models[e],t);return t.previousModels=this.models,this._reset(),e=this.add(e,Object.assign({silent:!0},t)),t.silent||this.trigger("reset",this,t),e}push(e,t){return this.add(e,Object.assign({at:this.length},t))}pop(e){const t=this.at(this.length-1);return this.remove(t,e)}unshift(e,t){return this.add(e,Object.assign({at:0},t))}shift(e){const t=this.at(0);return this.remove(t,e)}slice(){return Pd.apply(this.models,arguments)}filter(e,t){return this.models.filter(ct(e)?e:t=>t.matches(e),t)}every(e){return ct(e)?this.models.map((e=>e.attributes)).every(e):this.models.every((t=>t.matches(e)))}difference(e){return this.models.filter((t=>!e.includes(t)))}max(){return Math.max.apply(Math,this.models)}min(){return Math.min.apply(Math,this.models)}drop(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.models.slice(e)}some(e){return ct(e)?this.models.map((e=>e.attributes)).some(e):this.models.some((t=>t.matches(e)))}sortBy(e){return Dd(this.models,ct(e)?e:t=>ha(e)?t.get(e):t.matches(e))}isEmpty(){return!this.models.length}keyBy(e){return Nd(this.models,e)}each(e,t){return this.forEach(e,t)}forEach(e,t){return this.models.forEach(e,t)}includes(e){return this.models.includes(e)}size(){return this.models.length}countBy(e){return Ad(this.models,ct(e)?e:t=>ha(e)?t.get(e):t.matches(e))}groupBy(e){return Cd(this.models,ct(e)?e:t=>ha(e)?t.get(e):t.matches(e))}indexOf(e){return this.models.indexOf(e)}findLastIndex(e,t){return this.models.findLastIndex(ct(e)?e:t=>ha(e)?t.get(e):t.matches(e),t)}lastIndexOf(e){return this.models.lastIndexOf(e)}findIndex(e){return this.models.findIndex(ct(e)?e:t=>ha(e)?t.get(e):t.matches(e))}last(){const e=null==this.models?0:this.models.length;return e?this.models[e-1]:void 0}head(){return this.models[0]}first(){return this.head()}map(e,t){return this.models.map(ct(e)?e:t=>ha(e)?t.get(e):t.matches(e),t)}reduce(e,t){return this.models.reduce(e,t||this.models[0])}reduceRight(e,t){return this.models.reduceRight(e,t||this.models[0])}toArray(){return Array.from(this.models)}get(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e)]||e.cid&&this._byId[e.cid]}has(e){return null!=this.get(e)}at(e){return e<0&&(e+=this.length),this.models[e]}where(e,t){return this[t?"find":"filter"](e)}findWhere(e){return this.where(e,!0)}find(e,t){const n=ct(e)?e:t=>t.matches(e);return this.models.find(n,t)}sort(e){let t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});const n=t.length;return ct(t)&&(t=t.bind(this)),1===n||ha(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this}pluck(e){return this.map(e+"")}fetch(e){const t=(e=Object.assign({parse:!0},e)).success,n=this,r=e.promise&&ui();return e.success=function(s){const i=e.reset?"reset":"set";n[i](s,e),t&&t.call(e.context,n,s,e),r&&r.resolve(),n.trigger("sync",n,s,e)},li(this,e),r||this.sync("read",this,e)}create(e,t){const n=(t=t?ao(t):{}).wait,r=t.promise,s=r&&ui();if(!(e=this._prepareModel(e,t)))return!1;n||this.add(e,t);const i=this,o=t.success,a=t.error;return t.success=function(e,t,a){n&&i.add(e,a),o&&o.call(a.context,e,t,a),r&&s.resolve(e)},t.error=function(e,t,n){a&&a.call(n.context,e,t,n),r&&s.reject(t)},e.save(null,Object.assign(t,{promise:!1})),r?s:e}parse(e,t){return e}modelId(e){return e[this.model.prototype?.idAttribute||"id"]}values(){return new Bd(this,qd)}keys(){return new Bd(this,Hd)}entries(){return new Bd(this,Gd)}_reset(){this.models=[],this._byId={}}createModel(e,t){return new(0,this.model)(e,t)}_prepareModel(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;(t=t?ao(t):{}).collection=this;const n=this.createModel(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),null):n}_removeModels(e,t){const n=[];for(let r=0;r<e.length;r++){const s=this.get(e[r]);if(!s)continue;const i=this.indexOf(s);this.models.splice(i,1),delete this._byId[s.cid];const o=this.modelId(s.attributes);null!=o&&delete this._byId[o],t.silent||(t.index=i,s.trigger("remove",s,this,t)),n.push(s),this._removeReference(s,t)}return n}_isModel(e){return e instanceof ua}_addReference(e,t){this._byId[e.cid]=e;const n=this.modelId(e.attributes);null!=n&&(this._byId[n]=e),e.on("all",this._onModelEvent,this)}_removeReference(e,t){delete this._byId[e.cid];const n=this.modelId(e.attributes);null!=n&&delete this._byId[n],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)}_onModelEvent(e,t,n,r){if(t){if(("add"===e||"remove"===e)&&n!==this)return;if("destroy"===e&&this.remove(t,r),"change"===e){const e=this.modelId(t.previousAttributes()),n=this.modelId(t.attributes);e!==n&&(null!=e&&delete this._byId[e],null!=n&&(this._byId[n]=t))}}this.trigger.apply(this,arguments)}}const Ud="function"==typeof Symbol&&Symbol.iterator;Ud&&(zd.prototype[Ud]=zd.prototype.values);const Bd=function(e,t){this._collection=e,this._kind=t,this._index=0},qd=1,Hd=2,Gd=3;Ud&&(Bd.prototype[Ud]=function(){return this}),Bd.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){const e=this._collection.at(this._index);let t;if(this._index++,this._kind===qd)t=e;else{const n=this._collection.modelId(e.attributes);t=this._kind===Hd?n:[n,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};const Jd="array",Wd="bit",Qd="bits",Kd="byte",Vd="bytes",Yd="",Xd="exponent",Zd="function",el="iec",tl="Invalid number",nl="Invalid rounding method",rl="jedec",sl="object",il=".",ol="round",al="s",cl="si",ul="kbit",dl="kB",ll=" ",hl="string",fl="0",gl={symbol:{iec:{bits:["bit","Kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["bit","Kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},fullform:{iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]}};function pl(e,{bits:t=!1,pad:n=!1,base:r=-1,round:s=2,locale:i=Yd,localeOptions:o={},separator:a=Yd,spacer:c=ll,symbols:u={},standard:d=Yd,output:l=hl,fullform:h=!1,fullforms:f=[],exponent:g=-1,roundingMethod:p=ol,precision:m=0}={}){let v=g,_=Number(e),y=[],b=0,w=Yd;d===cl?(r=10,d=rl):d===el||d===rl?r=2:2===r?d=el:(r=10,d=rl);const S=10===r?1e3:1024,E=!0===h,A=_<0,x=Math[p];if("bigint"!=typeof e&&isNaN(e))throw new TypeError(tl);if(typeof x!==Zd)throw new TypeError(nl);if(A&&(_=-_),(-1===v||isNaN(v))&&(v=Math.floor(Math.log(_)/Math.log(S)),v<0&&(v=0)),v>8&&(m>0&&(m+=8-v),v=8),l===Xd)return v;if(0===_)y[0]=0,w=y[1]=gl.symbol[d][t?Qd:Vd][v];else{b=_/(2===r?Math.pow(2,10*v):Math.pow(1e3,v)),t&&(b*=8,b>=S&&v<8&&(b/=S,v++));const e=Math.pow(10,v>0?s:0);y[0]=x(b*e)/e,y[0]===S&&v<8&&-1===g&&(y[0]=1,v++),w=y[1]=10===r&&1===v?t?ul:dl:gl.symbol[d][t?Qd:Vd][v]}if(A&&(y[0]=-y[0]),m>0&&(y[0]=y[0].toPrecision(m)),y[1]=u[y[1]]||y[1],!0===i?y[0]=y[0].toLocaleString():i.length>0?y[0]=y[0].toLocaleString(i,o):a.length>0&&(y[0]=y[0].toString().replace(il,a)),n&&!1===Number.isInteger(y[0])&&s>0){const e=a||il,t=y[0].toString().split(e),n=t[1]||Yd,r=n.length,i=s-r;y[0]=`${t[0]}${e}${n.padEnd(r+i,fl)}`}return E&&(y[1]=f[v]?f[v]:gl.fullform[d][v]+(t?Wd:Kd)+(1===y[0]?Yd:al)),l===Jd?y:l===sl?{value:y[0],symbol:y[1],exponent:v,unit:w}:y.join(c)}const ml=window,vl=ml.ShadowRoot&&(void 0===ml.ShadyCSS||ml.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,_l=Symbol(),yl=new WeakMap;class bl{constructor(e,t,n){if(this._$cssResult$=!0,n!==_l)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(vl&&void 0===e){const n=void 0!==t&&1===t.length;n&&(e=yl.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&yl.set(t,e))}return e}toString(){return this.cssText}}const wl=vl?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return(e=>new bl("string"==typeof e?e:e+"",void 0,_l))(t)})(e):e;var Sl;const El=window,Al=El.trustedTypes,xl=Al?Al.emptyScript:"",jl=El.reactiveElementPolyfillSupport,Cl={toAttribute(e,t){switch(t){case Boolean:e=e?xl:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=null!==e;break;case Number:n=null===e?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch(e){n=null}}return n}},Il=(e,t)=>t!==e&&(t==t||e==e),Nl={attribute:!0,type:String,converter:Cl,reflect:!1,hasChanged:Il},Ol="finalized";class kl extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this._$Eu()}static addInitializer(e){var t;this.finalize(),(null!==(t=this.h)&&void 0!==t?t:this.h=[]).push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,n)=>{const r=this._$Ep(n,t);void 0!==r&&(this._$Ev.set(r,n),e.push(r))})),e}static createProperty(e,t=Nl){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const n="symbol"==typeof e?Symbol():"__"+e,r=this.getPropertyDescriptor(e,n,t);void 0!==r&&Object.defineProperty(this.prototype,e,r)}}static getPropertyDescriptor(e,t,n){return{get(){return this[t]},set(r){const s=this[e];this[t]=r,this.requestUpdate(e,s,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||Nl}static finalize(){if(this.hasOwnProperty(Ol))return!1;this[Ol]=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),void 0!==e.h&&(this.h=[...e.h]),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const n of t)this.createProperty(n,e[n])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const e of n)t.unshift(wl(e))}else void 0!==e&&t.push(wl(e));return t}static _$Ep(e,t){const n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}_$Eu(){var e;this._$E_=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(e=this.constructor.h)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,n;(null!==(t=this._$ES)&&void 0!==t?t:this._$ES=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(n=e.hostConnected)||void 0===n||n.call(e))}removeController(e){var t;null===(t=this._$ES)||void 0===t||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])}))}createRenderRoot(){var e;const t=null!==(e=this.shadowRoot)&&void 0!==e?e:this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{vl?e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):t.forEach((t=>{const n=document.createElement("style"),r=ml.litNonce;void 0!==r&&n.setAttribute("nonce",r),n.textContent=t.cssText,e.appendChild(n)}))})(t,this.constructor.elementStyles),t}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)}))}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$EO(e,t,n=Nl){var r;const s=this.constructor._$Ep(e,n);if(void 0!==s&&!0===n.reflect){const i=(void 0!==(null===(r=n.converter)||void 0===r?void 0:r.toAttribute)?n.converter:Cl).toAttribute(t,n.type);this._$El=e,null==i?this.removeAttribute(s):this.setAttribute(s,i),this._$El=null}}_$AK(e,t){var n;const r=this.constructor,s=r._$Ev.get(e);if(void 0!==s&&this._$El!==s){const e=r.getPropertyOptions(s),i="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==(null===(n=e.converter)||void 0===n?void 0:n.fromAttribute)?e.converter:Cl;this._$El=s,this[s]=i.fromAttribute(t,e.type),this._$El=null}}requestUpdate(e,t,n){let r=!0;void 0!==e&&(((n=n||this.constructor.getPropertyOptions(e)).hasChanged||Il)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),!0===n.reflect&&this._$El!==e&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(e,n))):r=!1),!this.isUpdatePending&&r&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((e,t)=>this[t]=e)),this._$Ei=void 0);let t=!1;const n=this._$AL;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(n)):this._$Ek()}catch(e){throw t=!1,this._$Ek(),e}t&&this._$AE(n)}willUpdate(e){}_$AE(e){var t;null===(t=this._$ES)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){void 0!==this._$EC&&(this._$EC.forEach(((e,t)=>this._$EO(t,this[t],e))),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}}var Tl;kl[Ol]=!0,kl.elementProperties=new Map,kl.elementStyles=[],kl.shadowRootOptions={mode:"open"},null==jl||jl({ReactiveElement:kl}),(null!==(Sl=El.reactiveElementVersions)&&void 0!==Sl?Sl:El.reactiveElementVersions=[]).push("1.6.3");const Ml=window,Rl=Ml.trustedTypes,$l=Rl?Rl.createPolicy("lit-html",{createHTML:e=>e}):void 0,Dl="$lit$",Pl=`lit$${(Math.random()+"").slice(9)}$`,Fl="?"+Pl,Ll=`<${Fl}>`,zl=document,Ul=()=>zl.createComment(""),Bl=e=>null===e||"object"!=typeof e&&"function"!=typeof e,ql=Array.isArray,Hl=e=>ql(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]),Gl="[ \t\n\f\r]",Jl=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Wl=/-->/g,Ql=/>/g,Kl=RegExp(`>|${Gl}(?:([^\\s"'>=/]+)(${Gl}*=${Gl}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),Vl=/'/g,Yl=/"/g,Xl=/^(?:script|style|textarea|title)$/i,Zl=e=>function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return{_$litType$:e,strings:t,values:r}},eh=Zl(1),th=(Zl(2),Symbol.for("lit-noChange")),nh=Symbol.for("lit-nothing"),rh=new WeakMap,sh=zl.createTreeWalker(zl,129,null,!1);function ih(e,t){if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==$l?$l.createHTML(t):t}const oh=(e,t)=>{const n=e.length-1,r=[];let s,i=2===t?"<svg>":"",o=Jl;for(let t=0;t<n;t++){const n=e[t];let a,c,u=-1,d=0;for(;d<n.length&&(o.lastIndex=d,c=o.exec(n),null!==c);)d=o.lastIndex,o===Jl?"!--"===c[1]?o=Wl:void 0!==c[1]?o=Ql:void 0!==c[2]?(Xl.test(c[2])&&(s=RegExp("</"+c[2],"g")),o=Kl):void 0!==c[3]&&(o=Kl):o===Kl?">"===c[0]?(o=null!=s?s:Jl,u=-1):void 0===c[1]?u=-2:(u=o.lastIndex-c[2].length,a=c[1],o=void 0===c[3]?Kl:'"'===c[3]?Yl:Vl):o===Yl||o===Vl?o=Kl:o===Wl||o===Ql?o=Jl:(o=Kl,s=void 0);const l=o===Kl&&e[t+1].startsWith("/>")?" ":"";i+=o===Jl?n+Ll:u>=0?(r.push(a),n.slice(0,u)+Dl+n.slice(u)+Pl+l):n+Pl+(-2===u?(r.push(void 0),t):l)}return[ih(e,i+(e[n]||"<?>")+(2===t?"</svg>":"")),r]};class ah{constructor(e,t){let n,{strings:r,_$litType$:s}=e;this.parts=[];let i=0,o=0;const a=r.length-1,c=this.parts,[u,d]=oh(r,s);if(this.el=ah.createElement(u,t),sh.currentNode=this.el.content,2===s){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(n=sh.nextNode())&&c.length<a;){if(1===n.nodeType){if(n.hasAttributes()){const e=[];for(const t of n.getAttributeNames())if(t.endsWith(Dl)||t.startsWith(Pl)){const r=d[o++];if(e.push(t),void 0!==r){const e=n.getAttribute(r.toLowerCase()+Dl).split(Pl),t=/([.?@])?(.*)/.exec(r);c.push({type:1,index:i,name:t[2],strings:e,ctor:"."===t[1]?hh:"?"===t[1]?gh:"@"===t[1]?ph:lh})}else c.push({type:6,index:i})}for(const t of e)n.removeAttribute(t)}if(Xl.test(n.tagName)){const e=n.textContent.split(Pl),t=e.length-1;if(t>0){n.textContent=Rl?Rl.emptyScript:"";for(let r=0;r<t;r++)n.append(e[r],Ul()),sh.nextNode(),c.push({type:2,index:++i});n.append(e[t],Ul())}}}else if(8===n.nodeType)if(n.data===Fl)c.push({type:2,index:i});else{let e=-1;for(;-1!==(e=n.data.indexOf(Pl,e+1));)c.push({type:7,index:i}),e+=Pl.length-1}i++}}static createElement(e,t){const n=zl.createElement("template");return n.innerHTML=e,n}}function ch(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3?arguments[3]:void 0;var s,i,o,a;if(t===th)return t;let c=void 0!==r?null===(s=n._$Co)||void 0===s?void 0:s[r]:n._$Cl;const u=Bl(t)?void 0:t._$litDirective$;return(null==c?void 0:c.constructor)!==u&&(null===(i=null==c?void 0:c._$AO)||void 0===i||i.call(c,!1),void 0===u?c=void 0:(c=new u(e),c._$AT(e,n,r)),void 0!==r?(null!==(o=(a=n)._$Co)&&void 0!==o?o:a._$Co=[])[r]=c:n._$Cl=c),void 0!==c&&(t=ch(e,c._$AS(e,t.values),c,r)),t}class uh{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var t;const{el:{content:n},parts:r}=this._$AD,s=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:zl).importNode(n,!0);sh.currentNode=s;let i=sh.nextNode(),o=0,a=0,c=r[0];for(;void 0!==c;){if(o===c.index){let t;2===c.type?t=new dh(i,i.nextSibling,this,e):1===c.type?t=new c.ctor(i,c.name,c.strings,this,e):6===c.type&&(t=new mh(i,this,e)),this._$AV.push(t),c=r[++a]}o!==(null==c?void 0:c.index)&&(i=sh.nextNode(),o++)}return sh.currentNode=zl,s}v(e){let t=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}}class dh{constructor(e,t,n,r){var s;this.type=2,this._$AH=nh,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=r,this._$Cp=null===(s=null==r?void 0:r.isConnected)||void 0===s||s}get _$AU(){var e,t;return null!==(t=null===(e=this._$AM)||void 0===e?void 0:e._$AU)&&void 0!==t?t:this._$Cp}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===(null==e?void 0:e.nodeType)&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e){e=ch(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this),Bl(e)?e===nh||null==e||""===e?(this._$AH!==nh&&this._$AR(),this._$AH=nh):e!==this._$AH&&e!==th&&this._(e):void 0!==e._$litType$?this.g(e):void 0!==e.nodeType?this.$(e):Hl(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==nh&&Bl(this._$AH)?this._$AA.nextSibling.data=e:this.$(zl.createTextNode(e)),this._$AH=e}g(e){var t;const{values:n,_$litType$:r}=e,s="number"==typeof r?this._$AC(e):(void 0===r.el&&(r.el=ah.createElement(ih(r.h,r.h[0]),this.options)),r);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===s)this._$AH.v(n);else{const e=new uh(s,this),t=e.u(this.options);e.v(n),this.$(t),this._$AH=e}}_$AC(e){let t=rh.get(e.strings);return void 0===t&&rh.set(e.strings,t=new ah(e)),t}T(e){ql(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,r=0;for(const s of e)r===t.length?t.push(n=new dh(this.k(Ul()),this.k(Ul()),this,this.options)):n=t[r],n._$AI(s),r++;r<t.length&&(this._$AR(n&&n._$AB.nextSibling,r),t.length=r)}_$AR(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._$AA.nextSibling,t=arguments.length>1?arguments[1]:void 0;var n;for(null===(n=this._$AP)||void 0===n||n.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cp=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}}class lh{constructor(e,t,n,r,s){this.type=1,this._$AH=nh,this._$AN=void 0,this.element=e,this.name=t,this._$AM=r,this.options=s,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=nh}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;const s=this.strings;let i=!1;if(void 0===s)e=ch(this,e,t,0),i=!Bl(e)||e!==this._$AH&&e!==th,i&&(this._$AH=e);else{const r=e;let o,a;for(e=s[0],o=0;o<s.length-1;o++)a=ch(this,r[n+o],t,o),a===th&&(a=this._$AH[o]),i||(i=!Bl(a)||a!==this._$AH[o]),a===nh?e=nh:e!==nh&&(e+=(null!=a?a:"")+s[o+1]),this._$AH[o]=a}i&&!r&&this.j(e)}j(e){e===nh?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class hh extends lh{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===nh?void 0:e}}const fh=Rl?Rl.emptyScript:"";class gh extends lh{constructor(){super(...arguments),this.type=4}j(e){e&&e!==nh?this.element.setAttribute(this.name,fh):this.element.removeAttribute(this.name)}}class ph extends lh{constructor(e,t,n,r,s){super(e,t,n,r,s),this.type=5}_$AI(e){var t;if((e=null!==(t=ch(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,0))&&void 0!==t?t:nh)===th)return;const n=this._$AH,r=e===nh&&n!==nh||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,s=e!==nh&&(n===nh||r);r&&this.element.removeEventListener(this.name,this,n),s&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,n;"function"==typeof this._$AH?this._$AH.call(null!==(n=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==n?n:this.element,e):this._$AH.handleEvent(e)}}class mh{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){ch(this,e)}}const vh={O:Dl,P:Pl,A:Fl,C:1,M:oh,L:uh,R:Hl,D:ch,I:dh,V:lh,H:gh,N:ph,U:hh,F:mh},_h=Ml.litHtmlPolyfillSupport;null==_h||_h(ah,dh),(null!==(Tl=Ml.litHtmlVersions)&&void 0!==Tl?Tl:Ml.litHtmlVersions=[]).push("2.8.0");const yh=(e,t,n)=>{var r,s;const i=null!==(r=null==n?void 0:n.renderBefore)&&void 0!==r?r:t;let o=i._$litPart$;if(void 0===o){const e=null!==(s=null==n?void 0:n.renderBefore)&&void 0!==s?s:null;i._$litPart$=o=new dh(t.insertBefore(Ul(),e),e,void 0,null!=n?n:{})}return o._$AI(e),o};var bh,wh;class Sh extends kl{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,t;const n=super.createRenderRoot();return null!==(e=(t=this.renderOptions).renderBefore)&&void 0!==e||(t.renderBefore=n.firstChild),n}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=yh(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!1)}render(){return th}}Sh.finalized=!0,Sh._$litElement$=!0,null===(bh=globalThis.litElementHydrateSupport)||void 0===bh||bh.call(globalThis,{LitElement:Sh});const Eh=globalThis.litElementPolyfillSupport;null==Eh||Eh({LitElement:Sh});(null!==(wh=globalThis.litElementVersions)&&void 0!==wh?wh:globalThis.litElementVersions=[]).push("3.3.3");const Ah=Object.assign(window.converse||{},{CHAT_STATES:["active","composing","gone","inactive","paused"],keycodes:{TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESCAPE:27,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,FORWARD_SLASH:47,AT:50,META:91,META_RIGHT:93},async initialize(e){const{api:t}=er;if(await Eu(er),"onpagehide"in window?er.unloadevent="pagehide":"onbeforeunload"in window?er.unloadevent="beforeunload":"onunload"in window&&(er.unloadevent="unload"),function(e){ru=e,tu={},Object.assign(tu,Un);const t=ii(e,Object.keys(oi));Object.assign(tu,oi,t)}(e),er.strict_plugin_dependencies=e.strict_plugin_dependencies,Fe.setLogLevel(t.settings.get("loglevel")),t.settings.get("authentication")===be&&t.settings.get("auto_login")&&!t.settings.get("jid"))throw new Error("Config Error: you need to provide the server's domain via the 'jid' option when using anonymous authentication with auto_login.");ld(),addEventListener("hashchange",ld),er.connfeedback=new Uu,er.send_initial_presence=!0,await async function(e){await Vc.sessionStorageInitialized,e.storage={session:Vc.localForage.createInstance({name:du()?"converse-test-session":"converse-session",description:"sessionStorage instance",driver:["sessionStorageWrapper"]})}}(er),await async function(e){const t="converse.client-config";e.config=new ua({id:t,trusted:!0}),e.config.browserStorage=Zc(t,"session"),await new Promise((t=>e.config.fetch({success:t,error:t}))),e.api.trigger("clientConfigInitialized")}(er),await Te.initialize(),function(e){e.pluggable.initialized_plugins=[];const t=Ce.concat(e.api.settings.get("whitelisted_plugins"));e.api.settings.get("singleton")&&["converse-bookmarks","converse-controlbox","converse-headline","converse-register"].forEach((t=>e.api.settings.get("blacklisted_plugins").push(t))),e.pluggable.initializePlugins({_converse:e},t,e.api.settings.get("blacklisted_plugins")),e.api.trigger("pluginsInitialized")}(er),t.elements?.register(),function(e){document.addEventListener("visibilitychange",lu),lu({type:document.hidden?"blur":"focus"}),e.api.trigger("registeredGlobalEventHandlers")}(er);const n=er.pluggable.plugins;if((t.settings.get("auto_login")||t.settings.get("keepalive")&&n["converse-bosh"]?.enabled())&&await t.user.login(null,null,!0),t.trigger("initialized"),du())return er},plugins:{add(e,t){if(t.__name__=e,void 0!==er.pluggable.plugins[e])throw new TypeError(`Error: plugin with name "${e}" has already been registered!`);er.pluggable.plugins[e]=t}},env:{$build:l,$iq:f,$msg:h,$pres:g,utils:md,Collection:zd,Model:ua,Promise,Strophe:ge,TimeoutError:Pu,URI:qu(),VERSION_NAME:_e,dayjs:Gu(),filesize:pl,html:eh,log:Fe,sizzle:dr(),sprintf:ke.sprintf,stx:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new ve(e,n)},u:md}}),xh={connection:Mu,settings:au,...Fu,...zu,...sr,...Du,disco:null,elements:null};const jh=class extends ua{initialize(){super.initialize(),this.rosterContactAdded=Xn()}async setRosterContact(e){const t=await xh.contacts.get(e);t&&(this.contact=t,this.set("nickname",t.get("nickname")),this.rosterContactAdded.resolve())}};const Ch=function(e,t){return e===t||Io(e,t,Oo(t))},{u:Ih}=Ah.env;async function Nh(e,t){if(!t.replace_id||!t.from)return;const n="groupchat"===t.type&&t.occupant_id?e=>{let{attributes:n}=e;return n.msgid===t.replace_id&&n.occupant_id==t.occupant_id}:e=>{let{attributes:n}=e;return n.msgid===t.replace_id&&n.from===t.from&&null==n.occupant_id},r=e.messages.models.find(n);if(!r)return t.older_versions={},await e.createMessage(t);const s=r.get("older_versions")||{};return t.time<r.get("time")&&r.get("edited")?(s[t.time]=t.message,r.save({older_versions:s})):(Object.keys(s).length?s[r.get("edited")]=r.getMessageText():s[r.get("time")]=r.getMessageText(),delete(t=Object.assign(t,{older_versions:s})).msgid,delete t.id,t.time=r.get("time"),r.save(t)),r}const Oh=cr((function(e){const t=xh.settings.get("prune_messages_above");if(t&&"number"==typeof t&&e.messages.length>t){const n=e.messages.filter((e=>!Ih.isEmptyMessage(e)));if(n.length>t){for(;n.length>t;)n.shift().destroy();xh.trigger("historyPruned",e)}}}),500);Ah.env.utils;function kh(e,t){xh.send(h({to:e.getAttribute("from"),type:"error",id:e.getAttribute("id")}).c("error",{type:"cancel"}).c("not-allowed",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("text",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).t(t)),Fe.warn(`Rejecting message stanza with the following reason: ${t}`),Fe.warn(e)}const{NS:Th}=ge;class Mh extends Error{constructor(e,t){super(e,t),this.name="StanzaParseError",this.stanza=t}}function Rh(e,t){const n={},r=dr()(`stanza-id[xmlns="${ge.NS.SID}"]`,e).reduce(((e,t)=>(e[`stanza_id ${t.getAttribute("by")}`]=t.getAttribute("id"),e)),{});Object.assign(n,r);const s=dr()(`message > result[xmlns="${ge.NS.MAM}"]`,t).pop();if(s){n[`stanza_id ${t.getAttribute("from")||er.bare_jid}`]=s.getAttribute("id")}const i=dr()(`origin-id[xmlns="${ge.NS.SID}"]`,e).pop();return i&&(n.origin_id=i.getAttribute("id")),n}function $h(e){const t=dr()(`encryption[xmlns="${ge.NS.EME}"]`,e).pop(),n=t?.getAttribute("namespace"),r={};return n?(r.is_encrypted=!0,r.encryption_namespace=n):dr()(`encrypted[xmlns="${ge.NS.OMEMO}"]`,e).pop()&&(r.is_encrypted=!0,r.encryption_namespace=ge.NS.OMEMO),r}function Dh(e,t){const n=dr()(`> apply-to[xmlns="${ge.NS.FASTEN}"]`,e).pop();if(n){const e=n.getAttribute("id");if(dr()(`> retract[xmlns="${ge.NS.RETRACT}"]`,n).pop()){const n=dr()(`delay[xmlns="${ge.NS.DELAY}"]`,t).pop();return{editable:!1,retracted:n?Gu()(n.getAttribute("stamp")).toISOString():(new Date).toISOString(),retracted_id:e}}}else{const t=dr()(`> retracted[xmlns="${ge.NS.RETRACT}"]`,e).pop();if(t)return{editable:!1,is_tombstone:!0,retracted:t.getAttribute("stamp")}}return{}}function Ph(e,t){const n=dr()(`replace[xmlns="${ge.NS.MESSAGE_CORRECT}"]`,e).pop();if(n){const e=n.getAttribute("id");if(e){const n=dr()(`delay[xmlns="${ge.NS.DELAY}"]`,t).pop();return{replace_id:e,edited:n?Gu()(n.getAttribute("stamp")).toISOString():(new Date).toISOString()}}}return{}}function Fh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=[];if(!e)return{};try{qu().withinString(e,((e,r,s)=>(e.startsWith("_")&&(e=e.slice(1),r+=1),e.endsWith("_")&&(e=e.slice(0,e.length-1),s-=1),n.push({url:e,start:r+t,end:s+t}),e)),Ie)}catch(e){Fe.debug(e)}const r=n.map((e=>{return{end:e.end,is_audio:cd(e.url),is_image:dd(e.url),is_video:ud(e.url),is_encrypted:(t=e.url,t.startsWith("aesgcm://")),start:e.start};var t}));return r.length?{media_urls:r}:{}}function Lh(e){const t=dr()(`spoiler[xmlns="${ge.NS.SPOILER}"]`,e).pop();return{is_spoiler:!!t,spoiler_hint:t?.textContent}}function zh(e){const t=dr()(`x[xmlns="${ge.NS.OUTOFBAND}"]`,e).pop();return t?{oob_url:t.querySelector("url")?.textContent,oob_desc:t.querySelector("desc")?.textContent}:{}}function Uh(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error"),n=dr()(`text[xmlns="${ge.NS.STANZAS}"]`,t).pop();return{is_error:!0,error_text:n?.textContent,error_type:t.getAttribute("type"),error_condition:t.firstElementChild.nodeName}}return{}}function Bh(e){return dr()(`reference[xmlns="${ge.NS.REFERENCE}"]`,e).map((t=>{const n=t.getAttribute("anchor"),r=e.querySelector(n?`#${n}`:"body")?.textContent;if(!r)return Fe.warn(`Could not find referenced text for ${t}`),null;const s=t.getAttribute("begin"),i=t.getAttribute("end");return{begin:s,end:i,type:t.getAttribute("type"),value:r.slice(s,i),uri:t.getAttribute("uri")}})).filter((e=>e))}function qh(e){const t=dr()(`received[xmlns="${ge.NS.RECEIPTS}"]`,e).pop();return t?.getAttribute("id")}function Hh(e){const t=ge.NS.CARBONS;return dr()(`message > received[xmlns="${t}"]`,e).length>0||dr()(`message > sent[xmlns="${t}"]`,e).length>0}function Gh(e){return dr()(`\n        composing[xmlns="${Th.CHATSTATES}"],\n        paused[xmlns="${Th.CHATSTATES}"],\n        inactive[xmlns="${Th.CHATSTATES}"],\n        active[xmlns="${Th.CHATSTATES}"],\n        gone[xmlns="${Th.CHATSTATES}"]`,e).pop()?.nodeName}function Jh(e,t){return"me"!==t.sender&&!t.is_carbon&&!t.is_archived&&dr()(`request[xmlns="${ge.NS.RECEIPTS}"]`,e).length}function Wh(e){if(dr()(`message > forwarded[xmlns="${ge.NS.FORWARD}"]`,e).length){kh(e,"Forwarded messages not part of an encapsulating protocol are not supported");const t=e.getAttribute("from");throw new Mh(`Ignoring unencapsulated forwarded message from ${t}`,e)}}function Qh(e){return dr()(`\n        acknowledged[xmlns="${ge.NS.MARKERS}"],\n        displayed[xmlns="${ge.NS.MARKERS}"],\n        received[xmlns="${ge.NS.MARKERS}"]`,e).pop()}function Kh(e){return"headline"===e.getAttribute("type")}function Vh(e){if(dr()(`mentions[xmlns="${ge.NS.MENTIONS}"]`,e).pop())return!1;const t=e.getAttribute("from");return!("error"===e.getAttribute("type")||!t||t.includes("@"))}function Yh(e){return!!dr()(`message > result[xmlns="${ge.NS.MAM}"]`,e).pop()}function Xh(e){return e.getAttributeNames().reduce(((t,n)=>(t[n]=ge.xmlunescape(e.getAttribute(n)),t)),{})}const{Strophe:Zh,sizzle:ef}=Ah.env;async function tf(e){Wh(e);let t=e.getAttribute("to");const n=Zh.getResourceFromJid(t);if(xh.settings.get("filter_by_resource")&&n&&n!==er.resource)return new Mh(`Ignoring incoming message intended for a different resource: ${t}`,e);const r=e;let s=e.getAttribute("from")||er.bare_jid;if(Hh(e)){if(s!==er.bare_jid)return kh(e,"Rejecting carbon from invalid JID"),new Mh(`Rejecting carbon from invalid JID ${t}`,e);{const n=`[xmlns="${Zh.NS.CARBONS}"] > forwarded[xmlns="${Zh.NS.FORWARD}"] > message`;t=(e=ef(n,e).pop()).getAttribute("to"),s=e.getAttribute("from")}}const i=Yh(e);if(i){if(s!==er.bare_jid)return new Mh(`Invalid Stanza: alleged MAM message from ${e.getAttribute("from")}`,e);{const n=`[xmlns="${Zh.NS.MAM}"] > forwarded[xmlns="${Zh.NS.FORWARD}"] > message`;t=(e=ef(n,e).pop()).getAttribute("to"),s=e.getAttribute("from")}}const o=Zh.getBareJidFromJid(s),a=o===er.bare_jid;if(a&&null===t)return new Mh(`Don't know how to handle message stanza without 'to' attribute. ${e.outerHTML}`,e);const c=Kh(e),u=Vh(e);let d,l;if(!c&&!u&&(l=a?Zh.getBareJidFromJid(t):o,d=await xh.contacts.get(l),void 0===d&&!xh.settings.get("allow_non_roster_messaging")))return Fe.error(e),new Mh("Blocking messaging with a JID not in our roster because allow_non_roster_messaging is false.",e);const h=ef(`delay[xmlns="${Zh.NS.DELAY}"]`,r).pop(),f=Qh(e),g=(new Date).toISOString();let p=Object.assign({contact_jid:l,is_archived:i,is_headline:c,is_server_message:u,body:e.querySelector("body")?.textContent?.trim(),chat_state:Gh(e),from:Zh.getBareJidFromJid(e.getAttribute("from")),is_carbon:Hh(r),is_delayed:!!h,is_markable:!!ef(`markable[xmlns="${Zh.NS.MARKERS}"]`,e).length,is_marker:!!f,is_unstyled:!!ef(`unstyled[xmlns="${Zh.NS.STYLING}"]`,e).length,marker_id:f&&f.getAttribute("id"),msgid:e.getAttribute("id")||r.getAttribute("id"),nick:d?.attributes?.nickname,receipt_id:qh(e),received:(new Date).toISOString(),references:Bh(e),sender:a?"me":"them",subject:e.querySelector("subject")?.textContent,thread:e.querySelector("thread")?.textContent,time:h?Gu()(h.getAttribute("stamp")).toISOString():g,to:e.getAttribute("to"),type:e.getAttribute("type")||"normal"},Uh(e),zh(e),Lh(e),Ph(e,r),Rh(e,r),Dh(e,r),$h(e));if(p.is_archived){const t=r.getAttribute("from");if(t&&t!==er.bare_jid)return new Mh(`Invalid Stanza: Forged MAM message from ${t}`,e)}return await xh.emojis.initialize(),p=Object.assign({message:p.body||p.error,is_only_emojis:!!p.body&&md.isOnlyEmojis(p.body),is_valid_receipt_request:Jh(e,p)},p),p.id=p.origin_id||p[`stanza_id ${p.from}`]||md.getUniqueId(),p=await xh.hook("parseMessage",e,p),Object.assign(p,Fh(p.is_encrypted?p.plaintext:p.body))}const{Strophe:nf,u:rf}=Ah.env;function sf(e){if(!location.hash.startsWith("#converse/chat?jid="))return;e?.preventDefault();const t=location.hash.split("=").pop();if(!rf.isValidJID(t))return Fe.warn(`Invalid JID "${t}" provided in URL fragment`);xh.chats.open(t)}async function of(){if(fu()){await Promise.all(er.chatboxes.map((e=>e.messages&&e.messages.clearStore({silent:!0}))));const e=e=>e.get("type")!==er.CONTROLBOX_TYPE;er.chatboxes.clearStore({silent:!0},e)}}function af(){xh.settings.get("auto_join_private_chats").forEach((e=>{er.chatboxes.where({jid:e}).length||("string"==typeof e?xh.chats.open(e):Fe.error('Invalid jid criteria specified for "auto_join_private_chats"'))})),xh.trigger("privateChatsAutoJoined")}function cf(){xh.connection.get().addHandler((e=>!!(["groupchat","error"].includes(e.getAttribute("type"))||Kh(e)||Vh(e)||Yh(e))||(er.handleMessageStanza(e)||!0)),null,"message"),xh.connection.get().addHandler((e=>async function(e){const t=nf.getBareJidFromJid(e.getAttribute("from"));if(rf.isSameBareJID(t,er.bare_jid))return;const n=await xh.chatboxes.get(t);n?.get("type")===er.PRIVATE_CHAT_TYPE&&n?.handleErrorMessageStanza(e)}(e)||!0),null,"message","error")}async function uf(e){if(Vh(e=e.tree?.()??e)){const t=e.getAttribute("from");return Fe.info(`handleMessageStanza: Ignoring incoming server message from JID: ${t}`)}let t;try{t=await tf(e)}catch(e){return Fe.error(e)}if(rf.isErrorObject(t))return t.stanza&&Fe.error(t.stanza),Fe.error(t.message);const n=!(!t.body&&!t.plaintext),r=await xh.chats.get(t?t.contact_jid:null,{nickname:t.nick},n);await(r?.queueMessage(t));const s={stanza:e,attrs:t,chatbox:r};xh.trigger("message",s)}async function df(){const e=nf.getDomainFromJid(er.bare_jid);if(!await xh.disco.supports(nf.NS.CARBONS,e))return void Fe.warn("Not enabling carbons because it's not supported!");const t=new nf.Builder("iq",{from:xh.connection.get().jid,type:"set"}).c("enable",{xmlns:nf.NS.CARBONS}),n=await xh.sendIQ(t,null,!1);null===n?Fe.warn("A timeout occurred while trying to enable carbons"):rf.isErrorStanza(n)?(Fe.warn("An error occurred while trying to enable message carbons."),Fe.error(n)):Fe.debug("Message carbons have been enabled.")}const{Strophe:lf,$msg:hf}=Ah.env,ff=Ah.env.utils;const gf=class extends jh{defaults(){return{bookmarked:!1,chat_state:void 0,hidden:uu()&&!xh.settings.get("singleton"),message_type:"chat",nickname:void 0,num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:er.PRIVATE_CHAT_TYPE,url:""}}async initialize(){super.initialize(),this.initialized=Xn();const e=this.get("jid");e&&(this.set({box_id:`box-${e}`}),this.initNotifications(),this.initUI(),this.initMessages(),this.get("type")===er.PRIVATE_CHAT_TYPE&&(this.presence=er.presences.get(e)||er.presences.create({jid:e}),await this.setRosterContact(e),this.presence.on("change:show",(e=>this.onPresenceChanged(e)))),this.on("change:chat_state",this.sendChatState,this),this.ui.on("change:scrolled",this.onScrolledChanged,this),await this.fetchMessages(),await xh.trigger("chatBoxInitialized",this,{Synchronous:!0}),this.initialized.resolve())}getMessagesCollection(){return new er.Messages}getMessagesCacheKey(){return`converse.messages-${this.get("jid")}-${er.bare_jid}`}initMessages(){this.messages=this.getMessagesCollection(),this.messages.fetched=Xn(),this.messages.chatbox=this,eu(this.messages,this.getMessagesCacheKey()),this.listenTo(this.messages,"change:upload",this.onMessageUploadChanged,this),this.listenTo(this.messages,"add",this.onMessageAdded,this)}initUI(){this.ui=new ua}initNotifications(){this.notifications=new ua}getNotificationsText(){const{__:e}=er;return this.notifications?.get("chat_state")===er.COMPOSING?e("%1$s is typing",this.getDisplayName()):this.notifications?.get("chat_state")===er.PAUSED?e("%1$s has stopped typing",this.getDisplayName()):this.notifications?.get("chat_state")===er.GONE?e("%1$s has gone away",this.getDisplayName()):""}afterMessagesFetched(){this.pruneHistoryWhenScrolledDown(),xh.trigger("afterMessagesFetched",this)}fetchMessages(){if(this.messages.fetched_flag)return void Fe.info(`Not re-fetching messages for ${this.get("jid")}`);this.messages.fetched_flag=!0;const e=this.messages.fetched.resolve;return this.messages.fetch({add:!0,success:t=>{this.afterMessagesFetched(t),e()},error:()=>{this.afterMessagesFetched(),e()}}),this.messages.fetched}async handleErrorMessageStanza(e){const{__:t}=er,n=await tf(e);if(!await this.shouldShowErrorMessage(n))return;const r=this.getMessageReferencedByError(n);if(r){const e={error:n.error,error_condition:n.error_condition,error_text:n.error_text,error_type:n.error_type,editable:!1};n.msgid===r.get("retraction_id")?(e.retraction_id=void 0,n.error||("forbidden"===n.error_condition?e.error=t("You're not allowed to retract your message."):e.error=t("Sorry, an error occurred while trying to retract your message."))):n.error||("forbidden"===n.error_condition?e.error=t("You're not allowed to send a message."):e.error=t("Sorry, an error occurred while trying to send your message.")),r.save(e)}else this.createMessage(n)}queueMessage(e){return this.msg_chain=(this.msg_chain||this.messages.fetched).then((()=>this.onMessage(e))).catch((e=>Fe.error(e))),this.msg_chain}async onMessage(e){if(e=await e,ff.isErrorObject(e))return e.stanza&&Fe.error(e.stanza),Fe.error(e.message);const t=this.getDuplicateMessage(e);if(t)this.updateMessage(t,e);else if(!this.handleReceipt(e)&&!this.handleChatMarker(e)&&!await this.handleRetraction(e)&&(this.setEditable(e,e.time),e.chat_state&&"them"===e.sender&&this.notifications.set("chat_state",e.chat_state),ff.shouldCreateMessage(e))){const t=await Nh(this,e)||await this.createMessage(e);this.notifications.set({chat_state:null}),this.handleUnreadMessage(t)}}async onMessageUploadChanged(e){if(e.get("upload")===er.SUCCESS){const t={body:e.get("body"),spoiler_hint:e.get("spoiler_hint"),oob_url:e.get("oob_url")};await this.sendMessage(t),e.destroy()}}onMessageAdded(e){!xh.settings.get("prune_messages_above")||"scrolled"!==xh.settings.get("pruning_behavior")&&this.ui.get("scrolled")||hd(e)||Oh(this)}async clearMessages(){try{await this.messages.clearStore()}catch(e){this.messages.trigger("reset"),Fe.error(e)}finally{this.messages.fetched.resolve()}}async close(){xh.connection.connected()&&(this.setChatState(er.INACTIVE),this.sendChatState());try{await new Promise(((e,t)=>this.destroy({success:e,error:(e,n)=>t(n)})))}catch(e){Fe.error(e)}finally{xh.settings.get("clear_messages_on_reconnection")&&await this.clearMessages()}xh.trigger("chatBoxClosed",this)}announceReconnection(){xh.trigger("chatReconnected",this)}async onReconnection(){xh.settings.get("clear_messages_on_reconnection")&&await this.clearMessages(),this.announceReconnection()}onPresenceChanged(e){const{__:t}=er,n=e.get("show"),r=this.getDisplayName();let s;"offline"===n?s=t("%1$s has gone offline",r):"away"===n?s=t("%1$s has gone away",r):"dnd"===n?s=t("%1$s is busy",r):"online"===n&&(s=t("%1$s is online",r)),s&&this.createMessage({message:s,type:"info"})}onScrolledChanged(){this.ui.get("scrolled")||(this.clearUnreadMsgCounter(),this.pruneHistoryWhenScrolledDown())}pruneHistoryWhenScrolledDown(){xh.settings.get("prune_messages_above")&&"unscrolled"===xh.settings.get("pruning_behavior")&&!this.ui.get("scrolled")&&Oh(this)}validate(e){if(!e.jid)return"Ignored ChatBox without JID";const t=xh.settings.get("auto_join_rooms").map((e=>e instanceof Object?e.jid:e)),n=xh.settings.get("auto_join_private_chats").concat(t);if(xh.settings.get("singleton")&&!n.includes(e.jid)&&!xh.settings.get("auto_join_on_invite")){const t=`${e.jid} is not allowed because singleton is true and it's not being auto_joined`;return Fe.warn(t),t}}getDisplayName(){return this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():this.get("jid")}async createMessageFromError(e){if(e instanceof Pu){(await this.createMessage({type:"error",message:e.message,retry_event_id:e.retry_event_id,is_ephemeral:3e4})).error=e}}editEarlierMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t>0;){t-=1;const n=this.messages.at(t);if(n.get("editable")){e=n;break}}e=e||this.messages.filter({sender:"me"}).reverse().find((e=>e.get("editable"))),e&&e.save("correcting",!0)}editLaterMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t<this.messages.length-1;){t+=1;const n=this.messages.at(t);if(n.get("editable")){e=n,e.save("correcting",!0);break}}return e}getOldestMessage(){for(let e=0;e<this.messages.length;e++){const t=this.messages.at(e);if(t.get("type")===this.get("message_type"))return t}}getMostRecentMessage(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages.at(e);if(t.get("type")===this.get("message_type"))return t}}getUpdatedMessageAttributes(e,t){return t.error_type||"Decryption"!==e.get("error_type")?{is_archived:t.is_archived}:Object.assign({},t,{error_condition:void 0,error_message:void 0,error_text:void 0,error_type:void 0,is_archived:t.is_archived,is_ephemeral:!1,is_error:!1})}updateMessage(e,t){const n=this.getUpdatedMessageAttributes(e,t);n&&e.save(n)}setChatState(e,t){return void 0!==this.chat_state_timeout&&(window.clearTimeout(this.chat_state_timeout),delete this.chat_state_timeout),e===er.COMPOSING?this.chat_state_timeout=window.setTimeout(this.setChatState.bind(this),er.TIMEOUTS.PAUSED,er.PAUSED):e===er.PAUSED&&(this.chat_state_timeout=window.setTimeout(this.setChatState.bind(this),er.TIMEOUTS.INACTIVE,er.INACTIVE)),this.set("chat_state",e,t),this}getMessageReferencedByError(e){const t=e.msgid;return t&&this.messages.models.find((e=>[e.get("msgid"),e.get("retraction_id")].includes(t)))}shouldShowErrorMessage(e){if(this.getMessageReferencedByError(e)||!e.chat_state)return!0}isSameUser(e,t){return ff.isSameBareJID(e,t)}findDanglingRetraction(e){if(!e.origin_id||!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models);return t.reverse(),t.find((t=>{let{attributes:n}=t;return n.retracted_id===e.origin_id&&n.from===e.from&&!n.moderated_by}))}}async handleRetraction(e){const t=["retracted","retracted_id","editable"];if(e.retracted){if(e.is_tombstone)return!1;const n=this.messages.findWhere({origin_id:e.retracted_id,from:e.from});return n?(n.save(ii(e,t)),!0):(e.dangling_retraction=!0,await this.createMessage(e),!0)}{const n=this.findDanglingRetraction(e);if(n){const r=ii(n.attributes,t),s=Object.assign({dangling_retraction:!1},e,r);return delete s.id,n.save(s),!0}}return!1}getDuplicateMessage(e){const t=[...this.getStanzaIdQueryAttrs(e),this.getOriginIdQueryAttrs(e),this.getMessageBodyQueryAttrs(e)].filter((e=>e));return this.messages.models.find((e=>t.reduce(((t,n)=>t||Ch(e.attributes,n)),!1)))}getOriginIdQueryAttrs(e){return e.origin_id&&{origin_id:e.origin_id,from:e.from}}getStanzaIdQueryAttrs(e){const t=Object.keys(e).filter((e=>e.startsWith("stanza_id ")));return t.map((t=>{const n={};return n[`stanza_id ${t.replace(/^stanza_id /,"")}`]=e[t],n}))}getMessageBodyQueryAttrs(e){if(e.msgid){const t={from:e.from,msgid:e.msgid};return!e.is_encrypted&&e.body&&(t.body=e.body),t}}retractOwnMessage(e){this.sendRetractionMessage(e),e.save({retracted:(new Date).toISOString(),retracted_id:e.get("origin_id"),retraction_id:e.get("id"),is_ephemeral:!0,editable:!1})}sendRetractionMessage(e){const t=e.get("origin_id");if(!t)throw new Error("Can't retract message without a XEP-0359 Origin ID");const n=hf({id:ff.getUniqueId(),to:this.get("jid"),type:"chat"}).c("store",{xmlns:lf.NS.HINTS}).up().c("apply-to",{id:t,xmlns:lf.NS.FASTEN}).c("retract",{xmlns:lf.NS.RETRACT});return xh.connection.get().send(n)}sendMarkerForLastMessage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"displayed",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Array.from(this.messages.models);n.reverse();const r=n.find((e=>"them"===e.get("sender")&&(t||e.get("is_markable"))));r&&this.sendMarkerForMessage(r,e,t)}sendMarkerForMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"displayed",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e&&xh.settings.get("send_chat_markers").includes(t)&&(e?.get("is_markable")||n)){lf.getBareJidFromJid(e.get("from"));e.get("msgid"),e.get("type")}}handleChatMarker(e){if(lf.getBareJidFromJid(e.to)!==er.bare_jid)return!1;if(e.is_markable)return!this.contact||e.is_archived||e.is_carbon||(e.from,e.msgid),!1;if(e.marker_id){const t=this.messages.findWhere({msgid:e.marker_id}),n=`marker_${e.marker}`;return t&&!t.get(n)&&t.save({field_name:(new Date).toISOString()}),!0}}sendReceiptStanza(e,t){}handleReceipt(e){if("them"===e.sender)if(e.is_valid_receipt_request)this.sendReceiptStanza(e.from,e.msgid);else if(e.receipt_id){const t=this.messages.findWhere({msgid:e.receipt_id});return t&&!t.get("received")&&t.save({received:(new Date).toISOString()}),!0}return!1}async createMessageStanza(e){const t=hf({from:xh.connection.get().jid,to:this.get("jid"),type:this.get("message_type"),id:e.get("edited")&&ff.getUniqueId()||e.get("msgid")}).c("body").t(e.get("body")).up().c(er.ACTIVE,{xmlns:lf.NS.CHATSTATES}).root();"chat"===e.get("type")&&t.c("request",{xmlns:lf.NS.RECEIPTS}).root(),e.get("is_encrypted")||(e.get("is_spoiler")&&(e.get("spoiler_hint")?t.c("spoiler",{xmlns:lf.NS.SPOILER},e.get("spoiler_hint")).root():t.c("spoiler",{xmlns:lf.NS.SPOILER}).root()),(e.get("references")||[]).forEach((e=>{const n={xmlns:lf.NS.REFERENCE,begin:e.begin,end:e.end,type:e.type};e.uri&&(n.uri=e.uri),t.c("reference",n).root()})),e.get("oob_url")&&t.c("x",{xmlns:lf.NS.OUTOFBAND}).c("url").t(e.get("oob_url")).root()),e.get("edited")&&t.c("replace",{xmlns:lf.NS.MESSAGE_CORRECT,id:e.get("msgid")}).root(),e.get("origin_id")&&t.c("origin-id",{xmlns:lf.NS.SID,id:e.get("origin_id")}).root(),t.root();return(await xh.hook("createMessageStanza",this,{message:e,stanza:t})).stanza}async getOutgoingMessageAttributes(e){await xh.emojis.initialize();const t=!!this.get("composing_spoiler"),n=ff.getUniqueId(),r=e?.body,s=r?ff.shortnamesToUnicode(r):void 0;return e=Object.assign({},e,{from:er.bare_jid,fullname:er.xmppstatus.get("fullname"),id:n,is_only_emojis:!!r&&ff.isOnlyEmojis(r),jid:this.get("jid"),message:s,msgid:n,nickname:this.get("nickname"),sender:"me",time:(new Date).toISOString(),type:this.get("message_type"),body:s,is_spoiler:t,origin_id:n},Fh(r)),e=await xh.hook("getOutgoingMessageAttributes",this,e)}setEditable(e,t){e.is_headline||hd(e)||"me"!==e.sender||("all"===xh.settings.get("allow_message_corrections")?e.editable=!(e.file||e.retracted||"oob_url"in e):"last"===xh.settings.get("allow_message_corrections")&&t>this.get("time_sent")&&(this.set({time_sent:t}),this.messages.findWhere({editable:!0})?.save({editable:!1}),e.editable=!(e.file||e.retracted||"oob_url"in e)))}async createMessage(e,t){return e.time=e.time||(new Date).toISOString(),this.messages.create(e,t)}async sendMessage(e){e=await this.getOutgoingMessageAttributes(e);let t=this.messages.findWhere("correcting");if(t){const n=t.get("older_versions")||{};n[t.get("edited")||t.get("time")]=t.getMessageText(),t.save({...ii(e,["body","is_only_emojis","media_urls","references","is_encrypted"]),correcting:!1,edited:(new Date).toISOString(),message:e.body,ogp_metadata:[],origin_id:ff.getUniqueId(),received:void 0,older_versions:n,plaintext:e.is_encrypted?e.message:void 0})}else this.setEditable(e,(new Date).toISOString()),t=await this.createMessage(e);try{const e=await this.createMessageStanza(t);xh.send(e)}catch(e){return t.destroy(),void Fe.error(e)}return xh.trigger("sendMessage",{chatbox:this,message:t}),t}sendChatState(){if(xh.settings.get("send_chat_state_notifications")&&this.get("chat_state")){const e=xh.settings.get("send_chat_state_notifications");if(Array.isArray(e)&&!e.includes(this.get("chat_state")))return;xh.send(hf({id:ff.getUniqueId(),to:this.get("jid"),type:"chat"}).c(this.get("chat_state"),{xmlns:lf.NS.CHATSTATES}).up().c("no-store",{xmlns:lf.NS.HINTS}).up().c("no-permanent-store",{xmlns:lf.NS.HINTS}))}}async sendFiles(e){const{__:t}=er,n=(await xh.disco.features.get(lf.NS.HTTPUPLOAD,er.domain)).pop();if(!n)return void this.createMessage({message:t("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0});const r=n.dataforms.where({FORM_TYPE:{value:lf.NS.HTTPUPLOAD,type:"hidden"}}).pop(),s=window.parseInt((r?.attributes||{})["max-file-size"]?.value),i=n?.id;i?Array.from(e).forEach((async e=>{if(e=await xh.hook("beforeFileUpload",this,e),!window.isNaN(s)&&window.parseInt(e.size)>s)return this.createMessage({message:t("The size of your file, %1$s, exceeds the maximum allowed by your server, which is %2$s.",e.name,pl(s)),type:"error",is_ephemeral:!0});{const t=await this.getOutgoingMessageAttributes(),n=Object.assign(t,{file:!0,progress:0,slot_request_url:i});this.setEditable(n,(new Date).toISOString());const r=await this.createMessage(n,{silent:!0});r.file=e,this.messages.trigger("add",r),r.getRequestSlotURL()}})):this.createMessage({message:t("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0})}maybeShow(e){if(!uu())return ff.safeSave(this,{hidden:!1}),this.trigger("show"),this;{const t=e=>!e.get("hidden")&&e.get("jid")!==this.get("jid")&&"controlbox"!==e.get("id"),n=er.chatboxes.filter(t);(e||0===n.length)&&(n.forEach((e=>ff.safeSave(e,{hidden:!0}))),ff.safeSave(this,{hidden:!1}))}}isHidden(){return this.get("hidden")||this.isScrolledUp()||"hidden"===er.windowState}handleUnreadMessage(e){e?.get("body")&&function(e){return e instanceof Element?!(dr()(`result[xmlns="${nf.NS.MAM}"]`,e).length&&dr()(`delay[xmlns="${nf.NS.DELAY}"]`,e).length):(e instanceof ua&&(e=e.attributes),!(e.is_delayed&&e.is_archived))}(e)&&("me"===e.get("sender")?this.ui.set("scrolled",!1):this.isHidden()?this.incrementUnreadMsgsCounter(e):this.sendMarkerForMessage(e))}incrementUnreadMsgsCounter(e){const t={num_unread:this.get("num_unread")+1};0===this.get("num_unread")&&(t.first_unread_id=e.get("id")),this.save(t)}clearUnreadMsgCounter(){this.get("num_unread")>0&&this.sendMarkerForMessage(this.messages.last()),ff.safeSave(this,{num_unread:0})}isScrolledUp(){return this.ui.get("scrolled")}},{Strophe:pf,sizzle:mf,u:vf}=Ah.env;const _f=class extends jh{defaults(){return{msgid:vf.getUniqueId(),time:(new Date).toISOString(),is_ephemeral:!1}}async initialize(){super.initialize(),this.checkValidity()&&(this.initialized=Xn(),this.get("file")&&this.on("change:put",(()=>this.uploadFile())),this.on("change:type",(()=>this.setContact())),this.on("change:is_ephemeral",(()=>this.setTimerForEphemeralMessage())),await this.setContact(),this.setTimerForEphemeralMessage(),await xh.trigger("messageInitialized",this,{Synchronous:!0}),this.initialized.resolve())}setContact(){["chat","normal"].includes(this.get("type"))&&(jh.prototype.initialize.apply(this,arguments),this.setRosterContact(pf.getBareJidFromJid(this.get("from"))))}setTimerForEphemeralMessage(){this.ephemeral_timer&&clearTimeout(this.ephemeral_timer);const e=this.isEphemeral();if(e){const t="number"==typeof e?e:1e4;this.ephemeral_timer=window.setTimeout((()=>this.safeDestroy()),t)}}checkValidity(){return 3!==Object.keys(this.attributes).length||(this.validationError="Empty message",this.safeDestroy(),!1)}mayBeRetracted(){const e="me"===this.get("sender"),t="cancel"!==this.get("error_type");return e&&t&&["all","own"].includes(xh.settings.get("allow_message_retraction"))}safeDestroy(){try{this.destroy()}catch(e){Fe.warn(`safeDestroy: ${e}`)}}isEphemeral(){return this.get("is_ephemeral")}isMeCommand(){const e=this.getMessageText();return!!e&&e.startsWith("/me ")}isFollowup(){const e=this.collection.models,t=e.indexOf(this),n=t?e[t-1]:null;if(null===n)return!1;const r=Gu()(this.get("time"));return this.get("from")===n.get("from")&&!this.isMeCommand()&&!n.isMeCommand()&&!!this.get("is_encrypted")==!!n.get("is_encrypted")&&this.get("type")===n.get("type")&&"info"!==this.get("type")&&r.isBefore(Gu()(n.get("time")).add(10,"minutes"))&&("groupchat"!==this.get("type")||this.get("occupant_id")===n.get("occupant_id"))}getDisplayName(){return this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():this.get("from")}getMessageText(){if(this.get("is_encrypted")){const{__:e}=er;return this.get("plaintext")||this.get("body")||e("Undecryptable OMEMO message")}return["groupchat","chat","normal"].includes(this.get("type"))?this.get("body"):this.get("message")}sendSlotRequestStanza(){if(!this.file)return Promise.reject(new Error("file is undefined"));const e=Ah.env.$iq({from:er.jid,to:this.get("slot_request_url"),type:"get"}).c("request",{xmlns:pf.NS.HTTPUPLOAD,filename:this.file.name,size:this.file.size,"content-type":this.file.type});return xh.sendIQ(e)}getUploadRequestMetadata(e){return{headers:mf(`slot[xmlns="${pf.NS.HTTPUPLOAD}"] put header`,e).map((e=>({name:e.getAttribute("name"),value:e.textContent}))).filter((e=>["Authorization","Expires"].includes(e.name)))}}async getRequestSlotURL(){const{__:e}=er;let t;try{t=await this.sendSlotRequestStanza()}catch(t){return Fe.error(t),this.save({type:"error",message:e("Sorry, could not determine upload URL."),is_ephemeral:!0})}const n=mf(`slot[xmlns="${pf.NS.HTTPUPLOAD}"]`,t).pop();if(!n)return this.save({type:"error",message:e("Sorry, could not determine file upload URL."),is_ephemeral:!0});this.upload_metadata=this.getUploadRequestMetadata(t),this.save({get:n.querySelector("get").getAttribute("url"),put:n.querySelector("put").getAttribute("url")})}uploadFile(){const e=new XMLHttpRequest;e.onreadystatechange=async()=>{if(e.readyState===XMLHttpRequest.DONE)if(Fe.info("Status: "+e.status),200===e.status||201===e.status){let e={upload:er.SUCCESS,oob_url:this.get("get"),message:this.get("get"),body:this.get("get")};e=await xh.hook("afterFileUploaded",this,e),this.save(e)}else e.onerror()},e.upload.addEventListener("progress",(e=>{e.lengthComputable&&this.set("progress",e.loaded/e.total)}),!1),e.onerror=()=>{const{__:t}=er;let n;n=e.responseText?t('Sorry, could not succesfully upload your file. Your server’s response: "%1$s"',e.responseText):t("Sorry, could not succesfully upload your file."),this.save({type:"error",upload:er.FAILURE,message:n,is_ephemeral:!0})},e.open("PUT",this.get("put"),!0),e.setRequestHeader("Content-type",this.file.type),this.upload_metadata.headers?.forEach((t=>e.setRequestHeader(t.name,t.value))),e.send(this.file)}};const yf=class extends zd{get comparator(){return"time"}constructor(){super(),this.model=_f}},bf={chats:{async create(e,t){if("string"==typeof e){if(t&&!t?.fullname){const n=await xh.contacts.get(e);t.fullname=n?.attributes?.fullname}const n=xh.chats.get(e,t,!0);return n||void Fe.error("Could not open chatbox for JID: "+e)}return Array.isArray(e)?Promise.all(e.forEach((async n=>{const r=await xh.contacts.get(e);return t.fullname=r?.attributes?.fullname,xh.chats.get(n,t,!0).maybeShow()}))):(Fe.error("chats.create: You need to provide at least one JID"),null)},async open(e,t,n){if("string"==typeof e){const r=await xh.chats.get(e,t,!0);return r?r.maybeShow(n):r}if(Array.isArray(e))return Promise.all(e.map((e=>xh.chats.get(e,t,!0).then((e=>e&&e.maybeShow(n))))).filter((e=>e)));const r="chats.open: You need to provide at least one JID";throw Fe.error(r),new Error(r)},async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];async function r(e){let r=await xh.chatboxes.get(e);return!r&&n?r=await xh.chatboxes.create(e,t,er.ChatBox):(r=r&&r.get("type")===er.PRIVATE_CHAT_TYPE?r:null,r&&Object.keys(t).length&&r.save(t)),r}if(await xh.waitUntil("chatBoxesFetched"),void 0===e){return(await xh.chatboxes.get()).filter((e=>e.get("type")===er.PRIVATE_CHAT_TYPE))}return"string"==typeof e?r(e):Promise.all(e.map((e=>r(e))))}}};Ah.plugins.add("converse-chat",{dependencies:["converse-chatboxes","converse-disco"],initialize(){xh.settings.extend({allow_message_corrections:"all",allow_message_retraction:"all",allow_message_styling:!0,auto_join_private_chats:[],clear_messages_on_reconnection:!1,filter_by_resource:!1,prune_messages_above:void 0,pruning_behavior:"unscrolled",send_chat_markers:["received","displayed","acknowledged"],send_chat_state_notifications:!0}),Object.assign(er,{ChatBox:gf,Message:_f,Messages:yf,handleMessageStanza:uf}),Object.assign(xh,bf),xh.chatboxes.registry.add(er.PRIVATE_CHAT_TYPE,gf),sf(),addEventListener("hashchange",sf),xh.listen.on("chatBoxesFetched",af),xh.listen.on("presencesInitialized",cf),xh.listen.on("clearSession",of),xh.listen.on("connected",(()=>df())),xh.listen.on("reconnected",(()=>df()))}});const{Strophe:wf}=Ah.env;const Sf=class extends ua{get idAttribute(){return"jid"}initialize(e,t){super.initialize(),this.waitUntilFeaturesDiscovered=Xn(),this.dataforms=new zd;let n=`converse.dataforms-${this.get("jid")}`;this.dataforms.browserStorage=Zc(n,"session"),this.features=new zd,n=`converse.features-${this.get("jid")}`,this.features.browserStorage=Zc(n,"session"),this.listenTo(this.features,"add",this.onFeatureAdded),this.fields=new zd,n=`converse.fields-${this.get("jid")}`,this.fields.browserStorage=Zc(n,"session"),this.listenTo(this.fields,"add",this.onFieldAdded),this.identities=new zd,n=`converse.identities-${this.get("jid")}`,this.identities.browserStorage=Zc(n,"session"),this.fetchFeatures(t)}async getIdentity(e,t){return await this.waitUntilFeaturesDiscovered,this.identities.findWhere({category:e,type:t})}async getFeature(e){if(await this.waitUntilFeaturesDiscovered,this.features.findWhere({var:e}))return this}onFeatureAdded(e){e.entity=this,xh.trigger("serviceDiscovered",e)}onFieldAdded(e){e.entity=this,xh.trigger("discoExtensionFieldDiscovered",e)}async fetchFeatures(e){if(e.ignore_cache)this.queryInfo();else{const e=this.features.browserStorage.name,t=await this.features.browserStorage.store.getItem(e);t&&0===t.length||null===t?this.queryInfo():(this.features.fetch({add:!0,success:()=>{this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")}}),this.identities.fetch({add:!0}))}}async queryInfo(){let e;try{e=await xh.disco.info(this.get("jid"),null)}catch(e){return}this.onInfo(e)}onDiscoItems(e){dr()(`query[xmlns="${wf.NS.DISCO_ITEMS}"] item`,e).forEach((e=>{if(e.getAttribute("node"))return;const t=e.getAttribute("jid"),n=er.disco_entities.get(t);n?n.set({parent_jids:[this.get("jid")]}):xh.disco.entities.create({jid:t,parent_jids:[this.get("jid")],name:e.getAttribute("name")})}))}async queryForItems(){if(0===this.identities.where({category:"server"}).length)return;const e=await xh.disco.items(this.get("jid"));this.onDiscoItems(e)}async onInfo(e){Array.from(e.querySelectorAll("identity")).forEach((e=>{this.identities.create({category:e.getAttribute("category"),type:e.getAttribute("type"),name:e.getAttribute("name")})})),dr()(`x[type="result"][xmlns="${wf.NS.XFORM}"]`,e).forEach((e=>{const t={};dr()("field",e).forEach((e=>{t[e.getAttribute("var")]={value:e.querySelector("value")?.textContent,type:e.getAttribute("type")}})),this.dataforms.create(t)})),e.querySelector(`feature[var="${wf.NS.DISCO_ITEMS}"]`)&&await this.queryForItems(),Array.from(e.querySelectorAll("feature")).forEach((t=>{this.features.create({var:t.getAttribute("var"),from:e.getAttribute("from")})})),dr()('x[type="result"][xmlns="jabber:x:data"] field',e).forEach((t=>{this.fields.create({var:t.getAttribute("var"),value:t.querySelector("value")?.textContent,from:e.getAttribute("from")})})),this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")}};const Ef=class extends zd{constructor(){super(),this.model=Sf}fetchEntities(){return new Promise(((e,t)=>{this.fetch({add:!0,success:e,error(e,n){Fe.error(n),t(new Error("Could not fetch disco entities"))}})}))}},{Strophe:Af,$iq:xf}=Ah.env,jf={disco:{stream:{async getFeature(e,t){if(await xh.waitUntil("streamFeaturesAdded"),!e||!t)throw new Error("name and xmlns need to be provided when calling disco.stream.getFeature");if(void 0!==er.stream_features||xh.connection.connected())return er.stream_features.findWhere({name:e,xmlns:t});{const n=`Tried to get feature ${e} ${t} but _converse.stream_features has been torn down`;Fe.warn(n)}}},own:{identities:{add(e,t,n,r){for(var s=0;s<er.disco._identities.length;s++)if(er.disco._identities[s].category==e&&er.disco._identities[s].type==t&&er.disco._identities[s].name==n&&er.disco._identities[s].lang==r)return!1;er.disco._identities.push({category:e,type:t,name:n,lang:r})},clear(){er.disco._identities=[]},get:()=>er.disco._identities},features:{add(e){for(var t=0;t<er.disco._features.length;t++)if(er.disco._features[t]==e)return!1;er.disco._features.push(e)},clear(){er.disco._features=[]},get:()=>er.disco._features}},info(e,t){const n={xmlns:Af.NS.DISCO_INFO};t&&(n.node=t);const r=xf({from:xh.connection.get().jid,to:e,type:"get"}).c("query",n);return xh.sendIQ(r)},items(e,t){const n={xmlns:Af.NS.DISCO_ITEMS};return t&&(n.node=t),xh.sendIQ(xf({from:xh.connection.get().jid,to:e,type:"get"}).c("query",n))},entities:{async get(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(await xh.waitUntil("discoInitialized"),!e)return er.disco_entities;if(void 0===er.disco_entities)return void Fe.warn(`Tried to look up entity ${e} but _converse.disco_entities has been torn down`);const n=er.disco_entities.get(e);return n||!t?n:xh.disco.entities.create({jid:e})},items:e=>er.disco_entities.filter((t=>t.get("parent_jids")?.includes(e))),create:(e,t)=>er.disco_entities.create(e,t)},features:{async get(e,t){if(!t)throw new TypeError("You need to provide an entity JID");const n=await xh.disco.entities.get(t,!0);if(void 0===er.disco_entities&&!xh.connection.connected())return Fe.warn(`Tried to get feature ${e} for ${t} but _converse.disco_entities has been torn down`),[];const r=[n.getFeature(e),...xh.disco.entities.items(t).map((t=>t.getFeature(e)))];return(await Promise.all(r)).filter((e=>e instanceof Object))},async has(e,t){if(!t)throw new TypeError("You need to provide an entity JID");const n=await xh.disco.entities.get(t,!0);if(void 0===er.disco_entities&&!xh.connection.connected())return Fe.warn(`Tried to check if ${t} supports feature ${e}`),!1;if(await n.getFeature(e))return!0;const r=await Promise.all(xh.disco.entities.items(t).map((t=>t.getFeature(e))));return r.map((e=>e instanceof Object)).includes(!0)}},supports:(e,t)=>xh.disco.features.has(e,t),async refresh(e){if(!e)throw new TypeError("api.disco.refresh: You need to provide an entity JID");await xh.waitUntil("discoInitialized");let t=await xh.disco.entities.get(e);return t?(t.features.reset(),t.fields.reset(),t.identities.reset(),t.waitUntilFeaturesDiscovered.isPending||(t.waitUntilFeaturesDiscovered=Xn()),t.queryInfo()):t=await xh.disco.entities.create({jid:e},{ignore_cache:!0}),t.waitUntilFeaturesDiscovered},refreshFeatures:e=>xh.refresh(e),async getFeatures(e){if(!e)throw new TypeError("api.disco.getFeatures: You need to provide an entity JID");await xh.waitUntil("discoInitialized");let t=await xh.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.features},async getFields(e){if(!e)throw new TypeError("api.disco.getFields: You need to provide an entity JID");await xh.waitUntil("discoInitialized");let t=await xh.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.fields},async getIdentity(e,t,n){const r=await xh.disco.entities.get(n,!0);if(void 0!==r||xh.connection.connected())return r.getIdentity(e,t);{const t=`Tried to look up category ${e} for ${n} but _converse.disco_entities has been torn down`;Fe.warn(t)}}}},{Strophe:Cf,$iq:If}=Ah.env;async function Nf(){xh.disco.own.identities.add("client","web","Converse"),xh.disco.own.features.add(Cf.NS.CHATSTATES),xh.disco.own.features.add(Cf.NS.DISCO_INFO),xh.disco.own.features.add(Cf.NS.ROSTERX),xh.disco.own.features.add(Cf.NS.CARBONS),xh.trigger("addClientFeatures"),xh.connection.get().addHandler((e=>function(e){const t=e.getElementsByTagName("query")[0].getAttribute("node"),n={xmlns:Cf.NS.DISCO_INFO};t&&(n.node=t);const r=If({type:"result",id:e.getAttribute("id")}),s=e.getAttribute("from");return null!==s&&r.attrs({to:s}),r.c("query",n),er.disco._identities.forEach((e=>{const t={category:e.category,type:e.type};e.name&&(t.name=e.name),e.lang&&(t["xml:lang"]=e.lang),r.c("identity",t).up()})),er.disco._features.forEach((e=>r.c("feature",{var:e}).up())),xh.send(r.tree()),!0}(e)),Cf.NS.DISCO_INFO,"iq","get",null,null),er.disco_entities=new er.DiscoEntities;const e=`converse.disco-entities-${er.bare_jid}`;er.disco_entities.browserStorage=Zc(e,"session");const t=await er.disco_entities.fetchEntities();0!==t.length&&t.get(er.domain)||xh.disco.entities.create({jid:er.domain},{ignore_cache:!0}),xh.trigger("discoInitialized")}function Of(){if(!er.stream_features){const e=`converse.stream-features-${Cf.getBareJidFromJid(er.jid)}`;xh.promises.add("streamFeaturesAdded"),er.stream_features=new zd,er.stream_features.browserStorage=Zc(e,"session")}}function kf(){xh.trigger("streamFeaturesAdded")}function Tf(){Of(),Array.from(xh.connection.get().features.childNodes).forEach((e=>{er.stream_features.create({name:e.nodeName,xmlns:e.getAttribute("xmlns")})})),kf()}function Mf(){er.disco_entities?.forEach((e=>e.features.clearStore())),er.disco_entities?.forEach((e=>e.identities.clearStore())),er.disco_entities?.forEach((e=>e.dataforms.clearStore())),er.disco_entities?.forEach((e=>e.fields.clearStore())),er.disco_entities?.clearStore(),delete er.disco_entities}const{Strophe:Rf}=Ah.env;Ah.plugins.add("converse-disco",{initialize(){Object.assign(xh,jf),xh.promises.add("discoInitialized"),xh.promises.add("streamFeaturesAdded"),er.DiscoEntity=Sf,er.DiscoEntities=Ef,er.disco={_identities:[],_features:[]},xh.listen.on("userSessionInitialized",(async()=>{Of(),er.connfeedback.get("connection_status")===Rf.Status.ATTACHED&&(await new Promise(((e,t)=>er.stream_features.fetch({success:e,error:t}))),kf())})),xh.listen.on("beforeResourceBinding",Tf),xh.listen.on("reconnected",Nf),xh.listen.on("connected",Nf),xh.listen.on("beforeTearDown",(async()=>{xh.promises.add("streamFeaturesAdded"),er.stream_features&&(await er.stream_features.clearStore(),delete er.stream_features)})),xh.listen.on("will-reconnect",Mf),xh.listen.on("clearSession",Mf)}});const $f=new RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|((\\s|^)(\\*\\\\0\\/\\*|\\*\\\\O\\/\\*|\\-___\\-|\\:'\\-\\)|'\\:\\-\\)|'\\:\\-D|\\>\\:\\-\\)|>\\:\\-\\)|'\\:\\-\\(|\\>\\:\\-\\(|>\\:\\-\\(|\\:'\\-\\(|O\\:\\-\\)|0\\:\\-3|0\\:\\-\\)|0;\\^\\)|O;\\-\\)|0;\\-\\)|O\\:\\-3|\\-__\\-|\\:\\-Þ|\\:\\-Þ|\\<\\/3|<\\/3|\\:'\\)|\\:\\-D|'\\:\\)|'\\=\\)|'\\:D|'\\=D|\\>\\:\\)|>\\:\\)|\\>;\\)|>;\\)|\\>\\=\\)|>\\=\\)|;\\-\\)|\\*\\-\\)|;\\-\\]|;\\^\\)|'\\:\\(|'\\=\\(|\\:\\-\\*|\\:\\^\\*|\\>\\:P|>\\:P|X\\-P|\\>\\:\\[|>\\:\\[|\\:\\-\\(|\\:\\-\\[|\\>\\:\\(|>\\:\\(|\\:'\\(|;\\-\\(|\\>\\.\\<|>\\.<|#\\-\\)|%\\-\\)|X\\-\\)|\\\\0\\/|\\\\O\\/|0\\:3|0\\:\\)|O\\:\\)|O\\=\\)|O\\:3|B\\-\\)|8\\-\\)|B\\-D|8\\-D|\\-_\\-|\\>\\:\\\\|>\\:\\\\|\\>\\:\\/|>\\:\\/|\\:\\-\\/|\\:\\-\\.|\\:\\-P|\\:Þ|\\:Þ|\\:\\-b|\\:\\-O|O_O|\\>\\:O|>\\:O|\\:\\-X|\\:\\-#|\\:\\-\\)|\\(y\\)|\\<3|<3|\\:D|\\=D|;\\)|\\*\\)|;\\]|;D|\\:\\*|\\=\\*|\\:\\(|\\:\\[|\\=\\(|\\:@|;\\(|D\\:|\\:\\$|\\=\\$|#\\)|%\\)|X\\)|B\\)|8\\)|\\:\\/|\\:\\\\|\\=\\/|\\=\\\\|\\:L|\\=L|\\:P|\\=P|\\:b|\\:O|\\:X|\\:#|\\=X|\\=#|\\:\\)|\\=\\]|\\=\\)|\\:\\])(?=\\s|$|[!,.?]))","gi"),Df=/(?:\ud83d\udc68\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69]|\ud83e\uddd1)(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[©®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,{u:Pf}=Ah.env,Ff={},Lf={"*\\0/*":"1f646","*\\O/*":"1f646","-___-":"1f611",":'-)":"1f602","':-)":"1f605","':-D":"1f605",">:-)":"1f606","':-(":"1f613",">:-(":"1f620",":'-(":"1f622","O:-)":"1f607","0:-3":"1f607","0:-)":"1f607","0;^)":"1f607","O;-)":"1f607","0;-)":"1f607","O:-3":"1f607","-__-":"1f611",":-Þ":"1f61b","</3":"1f494",":')":"1f602",":-D":"1f603","':)":"1f605","'=)":"1f605","':D":"1f605","'=D":"1f605",">:)":"1f606",">;)":"1f606",">=)":"1f606",";-)":"1f609","*-)":"1f609",";-]":"1f609",";^)":"1f609","':(":"1f613","'=(":"1f613",":-*":"1f618",":^*":"1f618",">:P":"1f61c","X-P":"1f61c",">:[":"1f61e",":-(":"1f61e",":-[":"1f61e",">:(":"1f620",":'(":"1f622",";-(":"1f622",">.<":"1f623","#-)":"1f635","%-)":"1f635","X-)":"1f635","\\0/":"1f646","\\O/":"1f646","0:3":"1f607","0:)":"1f607","O:)":"1f607","O=)":"1f607","O:3":"1f607","B-)":"1f60e","8-)":"1f60e","B-D":"1f60e","8-D":"1f60e","-_-":"1f611",">:\\":"1f615",">:/":"1f615",":-/":"1f615",":-.":"1f615",":-P":"1f61b",":Þ":"1f61b",":-b":"1f61b",":-O":"1f62e",O_O:"1f62e",">:O":"1f62e",":-X":"1f636",":-#":"1f636",":-)":"1f642","(y)":"1f44d","<3":"2764",":D":"1f603","=D":"1f603",";)":"1f609","*)":"1f609",";]":"1f609",";D":"1f609",":*":"1f618","=*":"1f618",":(":"1f61e",":[":"1f61e","=(":"1f61e",":@":"1f620",";(":"1f622","D:":"1f628",":$":"1f633","=$":"1f633","#)":"1f635","%)":"1f635","X)":"1f635","B)":"1f60e","8)":"1f60e",":/":"1f615",":\\":"1f615","=/":"1f615","=\\":"1f615",":L":"1f615","=L":"1f615",":P":"1f61b","=P":"1f61b",":b":"1f61b",":O":"1f62e",":X":"1f636",":#":"1f636","=X":"1f636","=#":"1f636",":)":"1f642","=]":"1f642","=)":"1f642",":]":"1f642"};function zf(e){if(e.indexOf("-")>-1){const t=[],n=e.split("-");for(let e=0;e<n.length;e++){let r=parseInt(n[e],16);if(r>=65536&&r<=1114111){const e=Math.floor((r-65536)/1024)+55296,t=(r-65536)%1024+56320;r=String.fromCharCode(e)+String.fromCharCode(t)}else r=String.fromCharCode(r);t.push(r)}return t.join("")}return function(e){let t="string"==typeof e?parseInt(e,16):e;return t<65536?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}(e)}function Uf(e){const t=[];return function(e,t){const n=/\uFE0F/g,r=String.fromCharCode(8205);String(e).replace(Df,((e,s,i)=>{const o=function(e){const t=[];let n=0,r=0;for(;r<e.length;){const s=e.charCodeAt(r++);n?(t.push((65536+(n-55296<<10)+(s-56320)).toString(16)),n=0):55296<=s&&s<=56319?n=s:t.push(s.toString(16))}return t.join("-")}(e.indexOf(r)<0?e.replace(n,""):e);o&&t(o,e,i)}))}(e,((e,n,r)=>{t.push({begin:r,cp:e,emoji:n,end:r+n.length,shortname:Bf("cp")[e]?.sn||""})})),t}function Bf(e){if(Ff[e])return Ff[e];if("category"===e)return Ah.emojis.json;const t=Ah.emojis.list.map((t=>t[e])).filter(((e,t,n)=>n.indexOf(e)==t));return Ff[e]={},t.forEach((t=>Ff[e][t]=Ah.emojis.list.find((n=>n[e]===t)))),Ff[e]}Object.assign(Pf,{getEmojisByAtrribute:Bf,isOnlyEmojis:function(e){const t=e.trim().split(/\s+/);if(0===t.length||t.length>3)return!1;return t.filter((e=>{const t=Uf(Pf.shortnamesToUnicode(e));return 1===t.length&&(e===t[0].shortname||e===t[0].emoji)})).length===t.length},shortnamesToUnicode:function(e){return function(e){let t=[e];return[...Uf(e)].sort(((e,t)=>t.begin-e.begin)).forEach((e=>{const n=t.shift(),r=e.emoji||e.shortname;t=[n.slice(0,e.begin)+r+n.slice(e.end),...t]})),t}(function(e){return e.replace($f,((e,t,n,r)=>void 0!==r&&""!==r&&Pf.unescapeHTML(r)in Lf?(r=Pf.unescapeHTML(r),n+zf(Lf[r].toUpperCase())):e))}(e)).pop()}}),Ah.emojis={initialized:!1,initialized_promise:Xn()},Ah.plugins.add("converse-emoji",{initialize(){const{___:e}=er;xh.settings.extend({emoji_image_path:"https://twemoji.maxcdn.com/v/12.1.6/",emoji_categories:{smileys:":grinning:",people:":thumbsup:",activity:":soccer:",travel:":motorcycle:",objects:":bomb:",nature:":rainbow:",food:":hotdog:",symbols:":musical_note:",flags:":flag_ac:",custom:null},emoji_category_labels:{smileys:e("Smileys and emotions"),people:e("People"),activity:e("Activities"),travel:e("Travel"),objects:e("Objects"),nature:e("Animals and nature"),food:e("Food and drink"),symbols:e("Symbols"),flags:e("Flags"),custom:e("Stickers")}});er.EmojiPicker=class extends ua{defaults(){return{current_category:"smileys",current_skintone:"",scroll_position:0}}},Object.assign(xh,{emojis:{async initialize(){if(!Ah.emojis.initialized){Ah.emojis.initialized=!0;const e=await o.e(4610).then(o.t.bind(o,5175,19)),t=Ah.emojis.json=e.default;Ah.emojis.by_sn=Object.keys(t).reduce(((e,n)=>Object.assign(e,t[n])),{}),Ah.emojis.list=Object.values(Ah.emojis.by_sn),Ah.emojis.list.sort(((e,t)=>e.sn<t.sn?-1:e.sn>t.sn?1:0)),Ah.emojis.shortnames=Ah.emojis.list.map((e=>e.sn));const n=()=>Ah.emojis.shortnames.map((e=>e.replace(/[+]/g,"\\$&"))).join("|");Ah.emojis.shortnames_regex=new RegExp(n(),"gi"),Ah.emojis.initialized_promise.resolve()}return Ah.emojis.initialized_promise}}})}});const qf=class extends _f{initialize(){this.checkValidity()&&(this.get("file")&&this.on("change:put",(()=>this.uploadFile())),this.on("change:type",(()=>this.setOccupant())),this.on("change:is_ephemeral",(()=>this.setTimerForEphemeralMessage())),this.chatbox=this.collection?.chatbox,this.setTimerForEphemeralMessage(),this.setOccupant(),xh.trigger("chatRoomMessageInitialized",this))}getDisplayName(){return this.occupant?.getDisplayName()||this.get("nick")}mayBeModerated(){if(void 0!==this.get("from_muc"))return["all","moderator"].includes(xh.settings.get("allow_message_retraction"))&&this.get(`stanza_id ${this.get("from_muc")}`)&&this.chatbox.canModerateMessages()}checkValidity(){const e=er.Message.prototype.checkValidity.call(this);return!e&&this.chatbox.debouncedRejoin(),e}onOccupantRemoved(){this.stopListening(this.occupant),delete this.occupant,this.listenTo(this.chatbox.occupants,"add",this.onOccupantAdded)}onOccupantAdded(e){if(this.get("occupant_id")){if(e.get("occupant_id")!==this.get("occupant_id"))return}else if(e.get("nick")!==ge.getResourceFromJid(this.get("from")))return;this.occupant=e,e.get("jid")&&this.save("from_real_jid",e.get("jid")),this.trigger("occupantAdded"),this.listenTo(this.occupant,"destroy",this.onOccupantRemoved),this.stopListening(this.chatbox.occupants,"add",this.onOccupantAdded)}getOccupant(){return this.occupant||this.setOccupant(),this.occupant}setOccupant(){if("groupchat"!==this.get("type")||this.isEphemeral()||this.occupant)return;const e=ge.getResourceFromJid(this.get("from")),t=this.get("occupant_id");if(this.occupant=this.chatbox.occupants.findOccupant({nick:e,occupant_id:t}),!this.occupant&&(this.occupant=this.chatbox.occupants.create({nick:e,occupant_id:t,jid:this.get("from_real_jid")}),xh.settings.get("muc_send_probes"))){const t=`${this.chatbox.get("jid")}/${e}`;xh.user.presence.send("probe",t)}this.listenTo(this.occupant,"destroy",this.onOccupantRemoved)}};const Hf=class extends zd{get comparator(){return"time"}constructor(){super(),this.model=qf}},Gf={},Jf=(e,t)=>e.replace(RegExp("\\"+t,"ig"),"\\"+t);Gf.escapeCharacters=e=>t=>e.split("").reduce(Jf,t),Gf.escapeRegexString=Gf.escapeCharacters("[\\^$.?*+(){}|"),Gf.findFirstMatchInArray=e=>t=>{for(let n=0;n<e.length;n++)if(0===t.localeCompare(e[n],void 0,{sensitivity:"base"}))return e[n];return null};const Wf=(e,t,n)=>{let[r,s]=e,i=r,{begin:o,end:a}=t;const{value:c}=t;return o-=n,a=a-n-1,i=`${i.slice(0,o)}${c}${i.slice(a+1)}`,[i,[...s,{...t,begin:o,end:a}]]};Gf.reduceTextFromReferences=(e,t)=>t.reduce(Wf,[e,[]]);const Qf=Gf,Kf=["moderator","participant","visitor"],Vf=["owner","admin","member","outcast","none"],Yf={moderator:1,participant:2,visitor:3,none:2},Xf={OWNER:"owner",ADMIN:"admin",MEMBER:"member",EXADMIN:"exadmin",EXOWNER:"exowner",EXOUTCAST:"exoutcast",EXMEMBER:"exmember"},Zf=Object.values(Xf),eg={ENTERED:"entered",EXITED:"exited"},tg=Object.values(eg),ng={OP:"op",DEOP:"deop",VOICE:"voice",MUTE:"mute"},rg=Object.values(ng),sg={visibility_changes:["100","102","103","172","173","174"],self:["110"],non_privacy_changes:["104","201"],muc_logging_changes:["170","171"],nickname_changes:["210","303"],disconnected:["301","307","321","322","332","333"],affiliation_changes:[...Zf],join_leave_events:[...tg],role_changes:[...rg]},ig={CONNECTED:0,CONNECTING:1,NICKNAME_REQUIRED:2,PASSWORD_REQUIRED:3,DISCONNECTED:4,ENTERED:5,DESTROYED:6,BANNED:7,CLOSING:8},{Strophe:og,sizzle:ag,u:cg}=Ah.env,{NS:ug}=og;function dg(e){const t=ag(`items[node="${og.NS.CONFINFO}"]`,e).pop();if(!t)return null;const n=e.getAttribute("from"),r=e.getAttribute("id"),s=`item conference-info[xmlns="${og.NS.CONFINFO}"] activity[xmlns="${og.NS.ACTIVITY}"]`;return ag(s,t).map((t=>{const s=t.querySelector("text")?.textContent;if(s){const i=Bh(e),o=t.querySelector("reason")?.textContent;return{from:n,msgid:r,message:s,reason:o,references:i,type:"mep"}}return{}}))}function lg(e,t){if(t.features.get(og.NS.OCCUPANTID))return ag(`occupant-id[xmlns="${og.NS.OCCUPANTID}"]`,e).pop()?.getAttribute("id")}function hg(e,t){let n;const r=t.get("occupant_id");return n=r?e.occupant_id===r:e.from_real_jid?og.getBareJidFromJid(e.from_real_jid)===er.bare_jid:e.nick===t.get("nick"),n?"me":"them"}async function fg(e,t){Wh(e);const n=`[xmlns="${ug.MAM}"] > forwarded[xmlns="${ug.FORWARD}"] > message`,r=e;if(e=ag(n,e).pop()||e,ag(`message > forwarded[xmlns="${og.NS.FORWARD}"]`,e).length)return new Mh(`Invalid Stanza: Forged MAM groupchat message from ${e.getAttribute("from")}`,e);const s=ag(`delay[xmlns="${og.NS.DELAY}"]`,r).pop(),i=e.getAttribute("from"),o=Qh(e);let a=Object.assign({from:i,activities:dg(e),body:e.querySelector(":scope > body")?.textContent?.trim(),chat_state:Gh(e),from_muc:og.getBareJidFromJid(i),is_archived:Yh(r),is_carbon:Hh(r),is_delayed:!!s,is_forwarded:!!e.querySelector("forwarded"),is_headline:Kh(e),is_markable:!!ag(`markable[xmlns="${og.NS.MARKERS}"]`,e).length,is_marker:!!o,is_unstyled:!!ag(`unstyled[xmlns="${og.NS.STYLING}"]`,e).length,marker_id:o&&o.getAttribute("id"),msgid:e.getAttribute("id")||r.getAttribute("id"),nick:og.unescapeNode(og.getResourceFromJid(i)),occupant_id:lg(e,t),receipt_id:qh(e),received:(new Date).toISOString(),references:Bh(e),subject:e.querySelector("subject")?.textContent,thread:e.querySelector("thread")?.textContent,time:s?Gu()(s.getAttribute("stamp")).toISOString():(new Date).toISOString(),to:e.getAttribute("to"),type:e.getAttribute("type")},Uh(e),zh(e),Lh(e),Ph(e,r),Rh(e,r),function(e){const t=dr()(`> apply-to[xmlns="${ge.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),n=dr()(`> meta[xmlns="${ge.NS.XHTML}"]`,t);if(n.length){const t=xh.settings.get("message_limit"),r=n.reduce(((e,n)=>{const r=n.getAttribute("property");if(r){let s=$e(n.getAttribute("content")||"");t&&"og:description"===r&&s.length>=t&&(s=`${s.slice(0,t)}${$e("&#8230;")}`),e[r]=s}return e}),{ogp_for_id:e});if("og:description"in r||"og:title"in r||"og:image"in r)return r}}return{}}(e),Dh(e,r),function(e){const t=ag(`apply-to[xmlns="${og.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),n=ag(`moderated[xmlns="${og.NS.MODERATE}"]`,t).pop();if(n&&ag(`retract[xmlns="${og.NS.RETRACT}"]`,n).pop())return{editable:!1,moderated:"retracted",moderated_by:n.getAttribute("by"),moderated_id:e,moderation_reason:n.querySelector("reason")?.textContent}}else{const t=ag(`> moderated[xmlns="${og.NS.MODERATE}"]`,e).pop();if(t&&ag(`retracted[xmlns="${og.NS.RETRACT}"]`,t).pop())return{editable:!1,is_tombstone:!0,moderated_by:t.getAttribute("by"),retracted:t.getAttribute("stamp"),moderation_reason:t.querySelector("reason")?.textContent}}return{}}(e),$h(e));return await xh.emojis.initialize(),a.from_real_jid=a.is_archived&&function(e){const t=ag(`x[xmlns="${og.NS.MUC_USER}"] item`,e).pop();return t?.getAttribute("jid")}(e)||t.occupants.findOccupant(a)?.get("jid"),a=Object.assign({is_only_emojis:!!a.body&&cg.isOnlyEmojis(a.body),is_valid_receipt_request:Jh(e,a),message:a.body||a.error,sender:hg(a,t)},a),a.is_archived&&r.getAttribute("from")!==a.from_muc?new Mh(`Invalid Stanza: Forged MAM message from ${r.getAttribute("from")}`,e):a.is_archived&&r.getAttribute("from")!==t.get("jid")?new Mh(`Invalid Stanza: Forged MAM groupchat message from ${e.getAttribute("from")}`,e):a.is_carbon?new Mh("Invalid Stanza: MUC messages SHOULD NOT be XEP-0280 carbon copied",e):(a.id=a.origin_id||a[`stanza_id ${a.from_muc||a.from}`]||cg.getUniqueId(),a=await xh.hook("parseMUCMessage",e,a),Object.assign(a,Fh(a.is_encrypted?a.plaintext:a.body)))}const{Strophe:gg,$iq:pg,u:mg}=Ah.env;async function vg(e,t){const{__:n}=er,r=pg({to:t,type:"get"}).c("query",{xmlns:gg.NS.MUC_ADMIN}).c("item",{affiliation:e}),s=await xh.sendIQ(r,null,!1);if(null===s){const r=n("Error: timeout while fetching %1s list for MUC %2s",e,t),s=new Error(r);return Fe.warn(r),s}if(mg.isErrorStanza(s)){const r=n("Error: not allowed to fetch %1s list for MUC %2s",e,t),i=new Error(r);return Fe.warn(r),Fe.warn(s),i}return function(e){return ag(`query[xmlns="${og.NS.MUC_ADMIN}"] item`,e).map((e=>{const t={affiliation:e.getAttribute("affiliation")},n=e.getAttribute("jid");cg.isValidJID(n)?t.jid=n:t.nick=n;const r=e.getAttribute("nick");return r&&(t.nick=r),e.getAttribute("role")&&(t.role=r),t}))}(s).filter((e=>e)).sort(((e,t)=>e.nick<t.nick?-1:e.nick>t.nick?1:0))}function _g(e,t){const n=[...new Set(t.map((e=>e.affiliation)))];return Promise.all(n.map((n=>function(e,t,n){Array.isArray(t)||(t=[t]);return n=n.filter((t=>[void 0,e].includes(t.affiliation))),Promise.all(t.reduce(((t,r)=>[...t,...n.map((t=>function(e,t,n){const r=pg({to:t,type:"set"}).c("query",{xmlns:gg.NS.MUC_ADMIN}).c("item",{affiliation:n.affiliation||e,nick:n.nick,jid:n.jid});void 0!==n.reason&&r.c("reason",n.reason);return xh.sendIQ(r)}(e,r,t)))]),[]))}(n,e,t))))}function yg(e,t,n,r){const s=n.map((e=>e.jid)),i=r.map((e=>e.jid));let o=s.filter((e=>!i.includes(e))).map((e=>n[s.indexOf(e)]));return e||(o=o.concat(n.filter((e=>{const t=i.indexOf(e.jid);return t>=0&&e.affiliation!==r[t].affiliation})))),t&&(o=o.concat(i.filter((e=>!s.includes(e))).map((e=>({jid:e,affiliation:"none"}))))),o}er.getAssignableAffiliations=function(e){let t=xh.settings.get("modtools_disable_assign");return Array.isArray(t)||(t=t?Vf:[]),"owner"===e?.get("affiliation")?Vf.filter((e=>!t.includes(e))):"admin"===e?.get("affiliation")?Vf.filter((e=>!["owner","admin",...t].includes(e))):[]};const{Strophe:bg,sizzle:wg,u:Sg}=Ah.env;function Eg(){}function Ag(){return er.chatboxes.filter((e=>e.get("type")===er.CHATROOMS_TYPE)).forEach((e=>e.session.save({connection_status:Ah.ROOMSTATUS.DISCONNECTED})))}async function xg(e){if("visible"===e.state&&xh.connection.connected()){(await xh.rooms.get()).forEach((e=>e.rejoinIfNecessary()))}}async function jg(e){if(!location.hash.startsWith("#converse/room?jid="))return;e?.preventDefault();const t=location.hash.split("=").pop();if(!Sg.isValidMUCJID(t))return Fe.warn(`invalid jid "${t}" provided in url fragment`);await xh.waitUntil("roomsAutoJoined"),xh.settings.get("allow_bookmarks")&&await xh.waitUntil("bookmarksInitialized"),xh.rooms.open(t,{},!0)}async function Cg(e){const t=wg('x[xmlns="jabber:x:conference"]',e).pop(),n=bg.getBareJidFromJid(e.getAttribute("from")),r=t.getAttribute("jid"),s=t.getAttribute("reason");let i;if(xh.settings.get("auto_join_on_invite"))i=!0;else{const e=er.roster.get(n)?.getDisplayName()??n;i=await xh.hook("confirmDirectMUCInvitation",{contact:e,reason:s,jid:r},!1)}if(i){(await async function(e,t){t.type=er.CHATROOMS_TYPE,t.id=e;const n=await xh.rooms.get(e,t,!0);return n.maybeShow(!0),n}(r,{password:t.getAttribute("password")})).session.get("connection_status")===Ah.ROOMSTATUS.DISCONNECTED&&er.chatboxes.get(r).rejoin()}}function Ig(){if(!er.xmppstatus)throw new Error("Can't call _converse.getDefaultMUCNickname before the statusInitialized has been fired.");const e=er.xmppstatus.getNickname();return e||(xh.settings.get("muc_nickname_from_jid")?bg.unescapeNode(bg.getNodeFromJid(er.bare_jid)):void 0)}function Ng(e){return!!xh.settings.get("muc_show_info_messages").includes(e)}async function Og(){await Promise.all(xh.settings.get("auto_join_rooms").map((e=>"string"==typeof e?er.chatboxes.where({jid:e}).length?Promise.resolve():xh.rooms.open(e):e instanceof Object?xh.rooms.open(e.jid,{...e}):(Fe.error('Invalid muc criteria specified for "auto_join_rooms"'),Promise.resolve())))),xh.trigger("roomsAutoJoined")}function kg(){xh.disco.own.features.add(bg.NS.MUC),xh.settings.get("allow_muc_invitations")&&xh.disco.own.features.add("jabber:x:conference")}function Tg(){er.chatboxes.where({type:er.CHATROOMS_TYPE}).forEach((e=>fd(e.session,{connection_status:Ah.ROOMSTATUS.DISCONNECTED})))}function Mg(){window.addEventListener(er.unloadevent,(()=>{!xh.connection.isType("websocket")||xh.settings.get("enable_smacks")&&er.session.get("smacks_stream_id")||Ag()}))}function Rg(){xh.connection.get().addHandler((e=>{const t=bg.getBareJidFromJid(e.getAttribute("from"));return er.chatboxes.get(t)||xh.waitUntil("chatBoxesFetched").then((async()=>{const n=er.chatboxes.get(t);n&&(await n.initialized,n.message_handler.run(e))})),!0}),null,"message","groupchat")}Object.assign(er,{getAssignableRoles:function(e){let t=xh.settings.get("modtools_disable_assign");return Array.isArray(t)||(t=t?Kf:[]),"moderator"===e.get("role")?Kf.filter((e=>!t.includes(e))):[]}});const{u:$g}=Ah.env,Dg=["owner"],Pg=["admin","ban","deop","destroy","member","op","revoke"],Fg=["kick","mute","voice","modtools"],Lg=["nick"],zg=["og:article:author","og:article:published_time","og:description","og:image","og:image:height","og:image:width","og:site_name","og:title","og:type","og:url","og:video:height","og:video:secure_url","og:video:tag","og:video:type","og:video:url","og:video:width"],Ug=["301","303","333","307","321","322"];class Bg extends ua{defaults(){return{connection_status:ig.DISCONNECTED}}}const qg=class extends gf{defaults(){return{bookmarked:!1,chat_state:void 0,has_activity:!1,hidden:uu()&&!xh.settings.get("singleton"),hidden_occupants:!!xh.settings.get("hide_muc_participants"),message_type:"groupchat",name:"",num_unread_general:0,num_unread:0,roomconfig:{},time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:er.CHATROOMS_TYPE}}async initialize(){this.initialized=Xn(),this.debouncedRejoin=cr(this.rejoin,250),this.set("box_id",`box-${this.get("jid")}`),this.initNotifications(),this.initMessages(),this.initUI(),this.initOccupants(),this.initDiscoModels(),this.registerHandlers(),this.on("change:chat_state",this.sendChatState,this),this.on("change:hidden",this.onHiddenChange,this),this.on("destroy",this.removeHandlers,this),this.ui.on("change:scrolled",this.onScrolledChanged,this),await this.restoreSession(),this.session.on("change:connection_status",this.onConnectionStatusChanged,this),this.listenTo(this.occupants,"add",this.onOccupantAdded),this.listenTo(this.occupants,"remove",this.onOccupantRemoved),this.listenTo(this.occupants,"change:show",this.onOccupantShowChanged),this.listenTo(this.occupants,"change:affiliation",this.createAffiliationChangeMessage),this.listenTo(this.occupants,"change:role",this.createRoleChangeMessage);await this.restoreFromCache()||this.join(),await xh.trigger("chatRoomInitialized",this,{Synchronous:!0}),this.initialized.resolve()}isEntered(){return this.session.get("connection_status")===ig.ENTERED}isRAICandidate(){return this.get("hidden")&&xh.settings.get("muc_subscribe_to_rai")&&"none"!==this.getOwnAffiliation()}async restoreFromCache(){if(this.isEntered()){if(await this.fetchOccupants().catch((e=>Fe.error(e))),this.isRAICandidate())return this.session.save("connection_status",ig.DISCONNECTED),this.enableRAI(),!0;if(await this.isJoined())return await new Promise((e=>this.config.fetch({success:e,error:e}))),await new Promise((e=>this.features.fetch({success:e,error:e}))),await this.fetchMessages().catch((e=>Fe.error(e))),!0}return this.session.save("connection_status",ig.DISCONNECTED),this.clearOccupantsCache(),!1}async join(e,t){return this.isEntered()?this:(this.session.save("connection_status",ig.CONNECTING),await this.refreshDiscoInfo(),(e=await this.getAndPersistNickname(e))?void 0:(fd(this.session,{connection_status:ig.NICKNAME_REQUIRED}),xh.settings.get("muc_show_logs_before_join")&&await this.fetchMessages(),this))}rejoin(){return this.session.save("connection_status",ig.DISCONNECTED),this.registerHandlers(),this.clearOccupantsCache(),this.join()}async constructJoinPresence(e){let t=g({id:pd(),from:xh.connection.get().jid,to:this.getRoomJIDAndNick()}).c("x",{xmlns:ge.NS.MUC}).c("history",{maxstanzas:this.features.get("mam_enabled")?0:xh.settings.get("muc_history_max_stanzas")}).up();return(e=e||this.get("password"))&&t.cnode(ge.xmlElement("password",[],e)),t.up(),t=await xh.hook("constructedMUCPresence",this,t),t}clearOccupantsCache(){this.occupants.length?this.occupants.filter((e=>!e.isMember())).forEach((e=>e.destroy())):this.occupants.clearStore()}sendMarkerForMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"displayed",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e&&xh.settings.get("send_chat_markers").includes(t)&&"groupchat"===e?.get("type")&&(e?.get("is_markable")||n)){const t=`stanza_id ${this.get("jid")}`,n=e.get(t);if(!n)return void Fe.error(`Can't send marker for message without stanza ID: ${t}`);ge.getBareJidFromJid(e.get("from"));e.get("type")}}enableRAI(){if(xh.settings.get("muc_subscribe_to_rai")){const e=ge.getDomainFromJid(this.get("jid"));xh.user.presence.send(null,e,null,l("rai",{xmlns:ge.NS.RAI}))}}async onHiddenChange(){const e=ig,t=this.session.get("connection_status");this.get("hidden")?t===e.ENTERED&&this.isRAICandidate()&&(this.sendMarkerForLastMessage("received",!0),await this.leave(),this.enableRAI()):(t===e.DISCONNECTED&&this.rejoin(),this.clearUnreadMsgCounter())}onOccupantAdded(e){er.isInfoVisible(Ah.MUC_TRAFFIC_STATES.ENTERED)&&this.session.get("connection_status")===ig.ENTERED&&"online"===e.get("show")&&this.updateNotifications(e.get("nick"),Ah.MUC_TRAFFIC_STATES.ENTERED)}onOccupantRemoved(e){er.isInfoVisible(Ah.MUC_TRAFFIC_STATES.EXITED)&&this.isEntered()&&"online"===e.get("show")&&this.updateNotifications(e.get("nick"),Ah.MUC_TRAFFIC_STATES.EXITED)}onOccupantShowChanged(e){e.get("states").includes("303")||("offline"===e.get("show")&&er.isInfoVisible(Ah.MUC_TRAFFIC_STATES.EXITED)?this.updateNotifications(e.get("nick"),Ah.MUC_TRAFFIC_STATES.EXITED):"online"===e.get("show")&&er.isInfoVisible(Ah.MUC_TRAFFIC_STATES.ENTERED)&&this.updateNotifications(e.get("nick"),Ah.MUC_TRAFFIC_STATES.ENTERED))}async onRoomEntered(){await this.occupants.fetchMembers(),xh.settings.get("clear_messages_on_reconnection")?await this.clearMessages():await this.fetchMessages(),xh.trigger("enteredNewRoom",this),xh.settings.get("auto_register_muc_nickname")&&await xh.disco.supports(ge.NS.MUC_REGISTER,this.get("jid"))&&this.registerNickname()}async onConnectionStatusChanged(){if(this.isEntered())if(this.isRAICandidate()){try{await this.leave()}catch(e){Fe.error(e)}this.enableRAI()}else await this.onRoomEntered()}async onReconnection(){await this.rejoin(),this.announceReconnection()}getMessagesCollection(){return new er.ChatRoomMessages}restoreSession(){const e=`muc.session-${er.bare_jid}-${this.get("jid")}`;return this.session=new Bg({id:e}),eu(this.session,e,"session"),new Promise((e=>this.session.fetch({success:e,error:e})))}initDiscoModels(){let e=`converse.muc-features-${er.bare_jid}-${this.get("jid")}`;this.features=new ua(Object.assign({id:e},Ah.ROOM_FEATURES.reduce(((e,t)=>(e[t]=!1,e)),{}))),this.features.browserStorage=Zc(e,"session"),this.features.listenTo(er,"beforeLogout",(()=>this.features.browserStorage.flush())),e=`converse.muc-config-${er.bare_jid}-${this.get("jid")}`,this.config=new ua({id:e}),this.config.browserStorage=Zc(e,"session"),this.config.listenTo(er,"beforeLogout",(()=>this.config.browserStorage.flush()))}initOccupants(){this.occupants=new er.ChatRoomOccupants;const e=`converse.occupants-${er.bare_jid}${this.get("jid")}`;this.occupants.browserStorage=Zc(e,"session"),this.occupants.chatroom=this,this.occupants.listenTo(er,"beforeLogout",(()=>this.occupants.browserStorage.flush()))}fetchOccupants(){return this.occupants.fetched=new Promise((e=>{this.occupants.fetch({add:!0,silent:!0,success:e,error:e})})),this.occupants.fetched}handleAffiliationChangedMessage(e){const t=dr()(`x[xmlns="${ge.NS.MUC_USER}"] item`,e).pop();if(t){const n=e.getAttribute("from"),r=e.getAttribute("type"),s=t.getAttribute("affiliation"),i=t.getAttribute("jid"),o={from:n,type:r,affiliation:s,states:[],show:"unavailable"==r?"offline":"online",role:t.getAttribute("role"),jid:ge.getBareJidFromJid(i),resource:ge.getResourceFromJid(i)},a=this.occupants.findOccupant({jid:o.jid});a?a.save(o):this.occupants.create(o)}}async handleErrorMessageStanza(e){const{__:t}=er,n=await fg(e,this);if(!await this.shouldShowErrorMessage(n))return;const r=this.getMessageReferencedByError(n);if(r){const e={error:n.error,error_condition:n.error_condition,error_text:n.error_text,error_type:n.error_type,editable:!1};n.msgid===r.get("retraction_id")?(e.retracted=void 0,e.retraction_id=void 0,e.retracted_id=void 0,n.error||("forbidden"===n.error_condition?e.error=t("You're not allowed to retract your message."):"not-acceptable"===n.error_condition?e.error=t("Your retraction was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to retract your message."))):n.error||("forbidden"===n.error_condition?e.error=t("Your message was not delivered because you weren't allowed to send it."):"not-acceptable"===n.error_condition?e.error=t("Your message was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to send your message.")),r.save(e)}else this.createMessage(n)}handleMessageFromMUCHost(e){if(this.isEntered())return;const t=dr()(`rai[xmlns="${ge.NS.RAI}"]`,e).pop(),n=Array.from(t?.querySelectorAll("activity")||[]).map((e=>e.textContent));n.includes(this.get("jid"))&&this.save({has_activity:!0,num_unread_general:0})}handleForwardedMentions(e){if(this.isEntered())return;const t=dr()(`mentions[xmlns="${ge.NS.MENTIONS}"] forwarded[xmlns="${ge.NS.FORWARD}"] message[type="groupchat"]`,e),n=this.get("jid"),r=t.filter((e=>ge.getBareJidFromJid(e.getAttribute("from"))===n));r.length&&(this.save({has_activity:!0,num_unread:this.get("num_unread")+r.length}),r.forEach((async e=>{const t={stanza:e,attrs:await fg(e,this),chatbox:this};xh.trigger("message",t)})))}async handleMessageStanza(e){const t=(e=e.tree?.()??e).getAttribute("type");if("error"===t)return this.handleErrorMessageStanza(e);if("groupchat"===t){if(Yh(e))return Fe.warn('Received a MAM message with type "groupchat"');this.createInfoMessages(e),this.fetchFeaturesIfConfigurationChanged(e)}else if(!t)return this.handleForwardedMentions(e);let n;try{n=await fg(e,this)}catch(e){return Fe.error(e)}const r={stanza:e,attrs:n,chatbox:this};return xh.trigger("message",r),n&&this.queueMessage(n)}registerHandlers(){const e=this.get("jid"),t=ge.getDomainFromJid(e);this.removeHandlers();const n=xh.connection.get();this.presence_handler=n.addHandler((e=>this.onPresence(e)||!0),null,"presence",null,null,e,{ignoreNamespaceFragment:!0,matchBareFromJid:!0}),this.domain_presence_handler=n.addHandler((e=>this.onPresenceFromMUCHost(e)||!0),null,"presence",null,null,t),this.message_handler=n.addHandler((e=>!!this.handleMessageStanza(e)||!0),null,"message",null,null,e,{matchBareFromJid:!0}),this.domain_message_handler=n.addHandler((e=>this.handleMessageFromMUCHost(e)||!0),null,"message",null,null,t),this.affiliation_message_handler=n.addHandler((e=>this.handleAffiliationChangedMessage(e)||!0),ge.NS.MUC_USER,"message",null,null,e)}removeHandlers(){const e=xh.connection.get();return this.message_handler&&(e?.deleteHandler(this.message_handler),delete this.message_handler),this.domain_message_handler&&(e?.deleteHandler(this.domain_message_handler),delete this.domain_message_handler),this.presence_handler&&(e?.deleteHandler(this.presence_handler),delete this.presence_handler),this.domain_presence_handler&&(e?.deleteHandler(this.domain_presence_handler),delete this.domain_presence_handler),this.affiliation_message_handler&&(e?.deleteHandler(this.affiliation_message_handler),delete this.affiliation_message_handler),this}invitesAllowed(){return xh.settings.get("allow_muc_invitations")&&(this.features.get("open")||"owner"===this.getOwnAffiliation())}getDisplayName(){const e=this.get("name");return e||("hidden"===xh.settings.get("locked_muc_domain")?ge.getNodeFromJid(this.get("jid")):this.get("jid"))}sendTimedMessage(e){"function"==typeof e.tree&&(e=e.tree());let t=e.getAttribute("id");t||(t=this.getUniqueId("sendIQ"),e.setAttribute("id",t));const n=Xn(),r=xh.settings.get("stanza_timeout"),s=xh.connection.get(),i=s.addTimedHandler(r,(()=>{s.deleteHandler(o);const e=new Pu("Timeout Error: No response from server");return n.resolve(e),!1})),o=s.addHandler((e=>{i&&s.deleteTimedHandler(i),n.resolve(e)}),null,"message",["error","groupchat"],t);return xh.send(e),n}async retractOwnMessage(e){const t=er.__,n=e.get("origin_id");if(!n)throw new Error("Can't retract message without a XEP-0359 Origin ID");const r=e.get("editable"),s=h({id:pd(),to:this.get("jid"),type:"groupchat"}).c("store",{xmlns:ge.NS.HINTS}).up().c("apply-to",{id:n,xmlns:ge.NS.FASTEN}).c("retract",{xmlns:ge.NS.RETRACT});e.set({retracted:(new Date).toISOString(),retracted_id:n,retraction_id:s.tree().getAttribute("id"),editable:!1});const i=await this.sendTimedMessage(s);$g.isErrorStanza(i)?Fe.error(i):i instanceof Pu&&(Fe.error(i),e.save({editable:r,error_type:"timeout",error:t("A timeout happened while while trying to retract your message."),retracted:void 0,retracted_id:void 0,retraction_id:void 0}))}async retractOtherMessage(e,t){const n=e.get("editable");e.save({moderated:"retracted",moderated_by:er.bare_jid,moderated_id:e.get("msgid"),moderation_reason:t,editable:!1});const r=await this.sendRetractionIQ(e,t);return(null===r||$g.isErrorStanza(r))&&e.save({editable:n,moderated:void 0,moderated_by:void 0,moderated_id:void 0,moderation_reason:void 0}),r}sendRetractionIQ(e,t){const n=f({to:this.get("jid"),type:"set"}).c("apply-to",{id:e.get(`stanza_id ${this.get("jid")}`),xmlns:ge.NS.FASTEN}).c("moderate",{xmlns:ge.NS.MODERATE}).c("retract",{xmlns:ge.NS.RETRACT}).up().c("reason").t(t||"");return xh.sendIQ(n,null,!1)}sendDestroyIQ(e,t){const n=l("destroy");t&&n.attrs({jid:t});const r=f({to:this.get("jid"),type:"set"}).c("query",{xmlns:ge.NS.MUC_OWNER}).cnode(n.node);return e&&e.length>0&&r.c("reason",e),xh.sendIQ(r)}async leave(e){xh.connection.connected()&&xh.user.presence.send("unavailable",this.getRoomJIDAndNick(),e),this.features&&await new Promise((e=>this.features.destroy({success:e,error:(t,n)=>{Fe.error(n),e()}})));const t=er.disco_entities?.get(this.get("jid"));t&&await new Promise((e=>t.destroy({success:e,error:(t,n)=>{Fe.error(n),e()}}))),fd(this.session,{connection_status:ig.DISCONNECTED})}async close(e){const{ENTERED:t,CLOSING:n}=ig,r=this.session.get("connection_status")===t;return fd(this.session,{connection_status:n}),r&&this.sendMarkerForLastMessage("received",!0),await this.unregisterNickname(),await this.leave(),this.occupants.clearStore(),"closeAllChatBoxes"!==e?.name&&xh.settings.get("muc_clear_messages_on_leave")&&this.clearMessages(),await new Promise((e=>this.session.destroy({success:e,error:(t,n)=>{Fe.error(n),e()}}))),er.ChatBox.prototype.close.call(this)}canModerateMessages(){const e=this.getOwnOccupant();return e&&e.isModerator()&&xh.disco.supports(ge.NS.MODERATE,this.get("jid"))}getAllKnownNicknames(){return[...new Set([...this.occupants.map((e=>e.get("nick"))),...this.messages.map((e=>e.get("nick")))])].filter((e=>e))}getAllKnownNicknamesRegex(){const e=this.getAllKnownNicknames().map((e=>Qf.escapeRegexString(e))).join("|");return RegExp(`(?:\\p{P}|\\p{Z}|^)@(${e})(?![\\w@-])`,"uig")}getOccupantByJID(e){return this.occupants.findOccupant({jid:e})}getOccupantByNickname(e){return this.occupants.findOccupant({nick:e})}getReferenceURIFromNickname(e){const t=this.get("jid"),n=this.getOccupant(e),r=this.features.get("nonanonymous")&&n?.get("jid")||`${t}/${e}`;return encodeURI(`xmpp:${r}`)}parseTextForReferences(e){if(!e||!/(\p{P}|\p{Z}|^)([@][\w_-]+(?:\.\w+)*)/giu.test(e))return[e,[]];const t=Qf.findFirstMatchInArray(this.getAllKnownNicknames()),n=this.getAllKnownNicknamesRegex(),r=[...e.matchAll(n)].filter((e=>!e[0].startsWith("/"))),s=r.map((e=>{let n=e[0].indexOf("@");"@"===e[0][n+1]&&(n+=1);const r=e.index+n,s=r+e[0].length-n,i=t(e[1]);return{begin:r,end:s,value:i,type:"mention",uri:this.getReferenceURIFromNickname(i)}})),[i,o]=Qf.reduceTextFromReferences(e,s);return[i,o]}async getOutgoingMessageAttributes(e){await xh.emojis.initialize();const t=this.get("composing_spoiler");let n,r="";e?.body&&([r,n]=this.parseTextForReferences(e.body));const s=pd(),i=r?$g.shortnamesToUnicode(r):void 0;return e=Object.assign({},e,{body:i,is_spoiler:t,origin_id:s,references:n,id:s,msgid:s,from:`${this.get("jid")}/${this.get("nick")}`,fullname:this.get("nick"),is_only_emojis:!!r&&$g.isOnlyEmojis(r),message:i,nick:this.get("nick"),sender:"me",type:"groupchat"},Fh(r)),e=await xh.hook("getOutgoingMessageAttributes",this,e)}getRoomJIDAndNick(){const e=this.get("nick");return ge.getBareJidFromJid(this.get("jid"))+(null!==e?`/${e}`:"")}sendChatState(){if(!xh.settings.get("send_chat_state_notifications")||!this.get("chat_state")||!this.isEntered()||this.features.get("moderated")&&"visitor"===this.getOwnRole())return;const e=xh.settings.get("send_chat_state_notifications");if(Array.isArray(e)&&!e.includes(this.get("chat_state")))return;const t=this.get("chat_state");t!==er.GONE&&xh.send(h({to:this.get("jid"),type:"groupchat"}).c(t,{xmlns:ge.NS.CHATSTATES}).up().c("no-store",{xmlns:ge.NS.HINTS}).up().c("no-permanent-store",{xmlns:ge.NS.HINTS}))}directInvite(e,t){this.features.get("membersonly")&&this.updateMemberLists([{jid:e,affiliation:"member",reason:t}]);const n={xmlns:"jabber:x:conference",jid:this.get("jid")};null!==t&&(n.reason=t),this.get("password")&&(n.password=this.get("password"));const r=h({from:xh.connection.get().jid,to:e,id:pd()}).c("x",n);xh.send(r),xh.trigger("roomInviteSent",{room:this,recipient:e,reason:t})}refreshDiscoInfo(){return xh.disco.refresh(this.get("jid")).then((()=>this.getDiscoInfo())).catch((e=>Fe.error(e)))}getDiscoInfo(){return xh.disco.getIdentity("conference","text",this.get("jid")).then((e=>this.save({name:e?.get("name")}))).then((()=>this.getDiscoInfoFields())).then((()=>this.getDiscoInfoFeatures())).catch((e=>Fe.error(e)))}async getDiscoInfoFields(){const e=(await xh.disco.getFields(this.get("jid"))).reduce(((e,t)=>{const n=t.get("var");return n?.startsWith("muc#roominfo_")&&(e[n.replace("muc#roominfo_","")]=t.get("value")),e}),{});this.config.save(e)}async getDiscoInfoFeatures(){const e=await xh.disco.getFeatures(this.get("jid")),t=Ah.ROOM_FEATURES.reduce(((e,t)=>(e[t]=!1,e)),{fetched:(new Date).toISOString()});e.each((e=>{const n=e.get("var");n.startsWith("muc_")?t[n.replace("muc_","")]=!0:n===ge.NS.MAM?t.mam_enabled=!0:t[n]=!0})),this.features.save(t)}addFieldValue(e){const t=e.getAttribute("type");if("fixed"===t)return e;const n=e.getAttribute("var").replace("muc#roomconfig_",""),r=this.get("roomconfig");if(n in r){let s;switch(t){case"boolean":s=[r[n]?1:0];break;case"list-multi":s=r[n];break;default:s=[r[n]]}e.innerHTML=s.map((e=>l("value").t(e))).join("")}return e}async autoConfigureChatRoom(){const e=await this.fetchRoomConfiguration(),t=dr()("field",e).map((e=>this.addFieldValue(e)));if(t.length)return this.sendConfiguration(t)}fetchRoomConfiguration(){return xh.sendIQ(f({to:this.get("jid"),type:"get"}).c("query",{xmlns:ge.NS.MUC_OWNER}))}sendConfiguration(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=f({to:this.get("jid"),type:"set"}).c("query",{xmlns:ge.NS.MUC_OWNER}).c("x",{xmlns:ge.NS.XFORM,type:"submit"});return e.forEach((e=>t.cnode(e).up())),xh.sendIQ(t)}onCommandError(e){const{__:t}=er;Fe.fatal(e);const n=t("Sorry, an error happened while running the command.")+" "+t("Check your browser's developer console for details.");this.createMessage({message:n,type:"error"})}getNickOrJIDFromCommandArgs(e){const{__:t}=er;if($g.isValidJID(e.trim()))return e.trim();e.startsWith("@")||(e="@"+e);const[n,r]=this.parseTextForReferences(e);if(!r.length){const e=t("Error: couldn't find a groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}if(r.length>1){const e=t("Error: found multiple groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}const s=r.pop().value,i=e.split(s,2)[1];if(!i||i.startsWith(" "))return s;{const e=t("Error: couldn't find a groupchat participant based on your arguments");this.createMessage({message:e,type:"error"})}}validateRoleOrAffiliationChangeArgs(e,t){const{__:n}=er;if(!t){const t=n('Error: the "%1$s" command takes two arguments, the user\'s nickname and optionally a reason.',e);return this.createMessage({message:t,type:"error"}),!1}return!0}getAllowedCommands(){let e=["clear","help","me","nick","register"];(this.config.get("changesubject")||["owner","admin"].includes(this.getOwnAffiliation()))&&(e=[...e,"subject","topic"]);const t=this.occupants.findWhere({jid:er.bare_jid});return this.verifyAffiliations(["owner"],t,!1)?e=e.concat(Dg).concat(Pg):this.verifyAffiliations(["admin"],t,!1)&&(e=e.concat(Pg)),this.verifyRoles(["moderator"],t,!1)?e=e.concat(Fg).concat(Lg):this.verifyRoles(["visitor","participant","moderator"],t,!1)||(e=e.concat(Lg)),e.sort(),Array.isArray(xh.settings.get("muc_disable_slash_commands"))?e.filter((e=>!xh.settings.get("muc_disable_slash_commands").includes(e))):e}verifyAffiliations(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{__:r}=er;if(!Array.isArray(e))throw new TypeError("affiliations must be an Array");if(!e.length)return!0;if(t=t||this.occupants.findWhere({jid:er.bare_jid})){const n=t.get("affiliation");if(e.includes(n))return!0}if(n){const e=r("Forbidden: you do not have the necessary affiliation in order to do that.");this.createMessage({message:e,type:"error"})}return!1}verifyRoles(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{__:r}=er;if(!Array.isArray(e))throw new TypeError("roles must be an Array");if(!e.length)return!0;if(t=t||this.occupants.findWhere({jid:er.bare_jid})){const n=t.get("role");if(e.includes(n))return!0}if(n){const e=r("Forbidden: you do not have the necessary role in order to do that.");this.createMessage({message:e,type:"error",is_ephemeral:2e4})}return!1}getOwnRole(){return this.getOwnOccupant()?.attributes?.role}getOwnAffiliation(){return this.getOwnOccupant()?.attributes?.affiliation||"none"}getOwnOccupant(){return this.occupants.getOwnOccupant()}async setNickname(e){if(xh.settings.get("auto_register_muc_nickname")&&await xh.disco.supports(ge.NS.MUC_REGISTER,this.get("jid"))){const t=this.get("nick");this.set({nick:e});try{await this.registerNickname()}catch(e){const{__:n}=er;Fe.error(e);const r=n("Error: couldn't register new nickname in members only room");return this.createMessage({message:r,type:"error",is_ephemeral:!0}),void this.set({nick:t})}}const t=ge.getBareJidFromJid(this.get("jid"));xh.send(g({from:xh.connection.get().jid,to:`${t}/${e}`,id:pd()}).tree())}setRole(e,t,n,r,s){const i=l("item",{nick:e.get("nick"),role:t}),o=f({to:this.get("jid"),type:"set"}).c("query",{xmlns:ge.NS.MUC_ADMIN}).cnode(i.node);return null!==n&&o.c("reason",n),xh.sendIQ(o).then(r).catch(s)}getOccupant(e){return $g.isValidJID(e)?this.getOccupantByJID(e):this.getOccupantByNickname(e)}getOccupantsWithRole(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("role")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),role:e.get("role")})))}getOccupantsWithAffiliation(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("affiliation")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),affiliation:e.get("affiliation")})))}getOccupantsSortedBy(e){return Array.from(this.occupants.models).sort(((t,n)=>t.get(e)<n.get(e)?-1:t.get(e)>n.get(e)?1:0))}async updateMemberLists(e){const t=this.get("jid"),n=await Promise.all(["member","admin","owner"].map((e=>vg(e,t)))),r=n.reduce(((e,t)=>$g.isErrorObject(t)?e:[...t,...e]),[]);await _g(t,yg(!0,!1,e,r)),await this.occupants.fetchMembers()}async getAndPersistNickname(e){return(e=e||this.get("nick")||await this.getReservedNick()||er.getDefaultMUCNickname())&&fd(this,{nick:e},{silent:!0}),e}async getReservedNick(){const e=f({to:this.get("jid"),from:xh.connection.get().jid,type:"get"}).c("query",{xmlns:ge.NS.DISCO_INFO,node:"x-roomuser-item"}),t=await xh.sendIQ(e,null,!1);if($g.isErrorObject(t))throw t;const n=t?.querySelector('query[node="x-roomuser-item"] identity');return n?n.getAttribute("name"):null}async registerNickname(){const{__:e}=er,t=this.get("nick"),n=this.get("jid");let r,s;try{r=await xh.sendIQ(f({to:n,type:"get"}).c("query",{xmlns:ge.NS.MUC_REGISTER}))}catch(t){return dr()(`not-allowed[xmlns="${ge.NS.STANZAS}"]`,t).length?s=e("You're not allowed to register yourself in this groupchat."):dr()(`registration-required[xmlns="${ge.NS.STANZAS}"]`,t).length&&(s=e("You're not allowed to register in this groupchat because it's members-only.")),Fe.error(t),s}const i=dr()("field required",r).map((e=>e.parentElement));if(i.length>1&&"muc#register_roomnick"!==i[0].getAttribute("var"))return Fe.error(`Can't register the user register in the groupchat ${n} due to the required fields`);try{await xh.sendIQ(f({to:n,type:"set"}).c("query",{xmlns:ge.NS.MUC_REGISTER}).c("x",{xmlns:ge.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#register").up().up().c("field",{var:"muc#register_roomnick"}).c("value").t(t))}catch(t){return dr()(`service-unavailable[xmlns="${ge.NS.STANZAS}"]`,t).length?s=e("Can't register your nickname in this groupchat, it doesn't support registration."):dr()(`bad-request[xmlns="${ge.NS.STANZAS}"]`,t).length&&(s=e("Can't register your nickname in this groupchat, invalid data form supplied.")),Fe.error(s),Fe.error(t),s}}async unregisterNickname(){if("unregister"===xh.settings.get("auto_register_muc_nickname"))try{await xh.disco.supports(ge.NS.MUC_REGISTER,this.get("jid"))&&await this.sendUnregistrationIQ()}catch(e){Fe.error(e)}}sendUnregistrationIQ(){const e=f({to:this.get("jid"),type:"set"}).c("query",{xmlns:ge.NS.MUC_REGISTER}).c("remove");return xh.sendIQ(e).catch((e=>Fe.error(e)))}updateOccupantsOnPresence(e){const t=function(e,t){const n=e.getAttribute("from"),r=e.getAttribute("type"),s={is_me:!!e.querySelector("status[code='110']"),from:n,occupant_id:lg(e,t),nick:og.getResourceFromJid(n),type:r,states:[],hats:[],show:"unavailable"!==r?"online":"offline"};return Array.from(e.children).forEach((e=>{e.matches("status")?s.status=e.textContent||null:e.matches("show")?s.show=e.textContent||"online":e.matches("x")&&e.getAttribute("xmlns")===og.NS.MUC_USER?Array.from(e.children).forEach((e=>{"item"===e.nodeName?(s.affiliation=e.getAttribute("affiliation"),s.role=e.getAttribute("role"),s.jid=e.getAttribute("jid"),s.nick=e.getAttribute("nick")||s.nick):"status"==e.nodeName&&e.getAttribute("code")&&s.states.push(e.getAttribute("code"))})):e.matches("x")&&e.getAttribute("xmlns")===og.NS.VCARDUPDATE?s.image_hash=e.querySelector("photo")?.textContent:e.matches("hats")&&e.getAttribute("xmlns")===og.NS.MUC_HATS&&(s.hats=Array.from(e.children).map((e=>e.matches("hat")&&{title:e.getAttribute("title"),uri:e.getAttribute("uri")})))})),s}(e,this);if("error"===t.type||!t.jid&&!t.nick&&!t.occupant_id)return!0;const n=this.occupants.findOccupant(t);if("unavailable"===t.type&&n&&!t.states.includes(Ah.MUC_NICK_CHANGED_CODE)&&!["admin","owner","member"].includes(t.affiliation))return n.set(t),void n.destroy();const r=t.jid||"",s={...t,jid:ge.getBareJidFromJid(r)||n?.attributes?.jid,resource:ge.getResourceFromJid(r)||n?.attributes?.resource};if(t.is_me){let e=!1;t.states.includes(Ah.MUC_NICK_CHANGED_CODE)&&(e=!0,this.set("nick",t.nick)),this.features.get(ge.NS.OCCUPANTID)&&this.get("occupant-id")!==t.occupant_id&&(e=!0,this.set("occupant_id",t.occupant_id)),e&&this.save()}n?n.save(s):this.occupants.create(s)}fetchFeaturesIfConfigurationChanged(e){const t=["104","170","171","172","173","174"];dr()("status",e).filter((e=>t.includes(e.getAttribute("status")))).length&&this.refreshDiscoInfo()}isSameUser(e,t){const n=ge.getBareJidFromJid(e),r=ge.getBareJidFromJid(t),s=ge.getResourceFromJid(e),i=ge.getResourceFromJid(t);if($g.isSameBareJID(e,t))return n!==this.get("jid")||s===i;return(n===this.get("jid")?this.occupants.findOccupant({nick:s}):this.occupants.findOccupant({jid:n}))===(r===this.get("jid")?this.occupants.findOccupant({nick:i}):this.occupants.findOccupant({jid:r}))}async isSubjectHidden(){return(await xh.user.settings.get("mucs_with_hidden_subject",[])).includes(this.get("jid"))}async toggleSubjectHiddenState(){const e=this.get("jid"),t=await xh.user.settings.get("mucs_with_hidden_subject",[]);t.includes(this.get("jid"))?xh.user.settings.set("mucs_with_hidden_subject",t.filter((t=>t!==e))):xh.user.settings.set("mucs_with_hidden_subject",[...t,e])}async handleSubjectChange(e){const t=er.__;if("string"==typeof e.subject&&!e.thread&&!e.message){const n=e.subject,r=e.nick;if(fd(this,{subject:{author:r,text:e.subject||""}}),!e.is_delayed&&r){const s=t(n?"Topic set by %1$s":"Topic cleared by %1$s",r),i=this.messages.last();i?.get("nick")===e.nick&&"info"===i?.get("type")&&i?.get("message")===s||this.createMessage({message:s,nick:e.nick,type:"info",is_ephemeral:!0}),await this.isSubjectHidden()&&this.toggleSubjectHiddenState()}return!0}return!1}setSubject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";xh.send(h({to:this.get("jid"),from:xh.connection.get().jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(e).tree())}ignorableCSN(e){return e.chat_state&&!e.body&&(e.is_delayed||this.isOwnMessage(e))}isOwnMessage(e){let t;return t=e instanceof Element?e.getAttribute("from"):e instanceof er.Message?e.get("from"):e.from,ge.getResourceFromJid(t)==this.get("nick")}getUpdatedMessageAttributes(e,t){const n={...er.ChatBox.prototype.getUpdatedMessageAttributes.call(this,e,t),...ii(t,["from_muc","occupant_id"])};if(this.isOwnMessage(t)){const r=Object.keys(t).filter((e=>e.startsWith("stanza_id")));Object.assign(n,ii(t,r)),e.get("received")||(n.received=(new Date).toISOString())}return n}async isJoined(){return!0}async sendStatusPresence(e,t,n){if(this.session.get("connection_status")===ig.ENTERED){const r=await er.xmppstatus.constructPresence(e,this.getRoomJIDAndNick(),t);n?.map((e=>e?.tree()??e)).forEach((e=>r.cnode(e).up())),xh.send(r)}}async rejoinIfNecessary(){return this.isRAICandidate()?(Fe.debug(`rejoinIfNecessary: not rejoining hidden MUC "${this.get("jid")}" since we're using RAI`),!0):await this.isJoined()?void 0:(this.rejoin(),!0)}async shouldShowErrorMessage(e){if("Decryption"===e.error_type){if("Message key not found. The counter was repeated or the key was not filled."===e.error_message)return!1;if("not-encrypted-for-this-device"===e.error_condition)return!1}else if("not-acceptable"===e.error_condition&&await this.rejoinIfNecessary())return!1;return er.ChatBox.prototype.shouldShowErrorMessage.call(this,e)}findDanglingModeration(e){if(!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models),n=e[`stanza_id ${this.get("jid")}`];return n?(t.reverse(),t.find((e=>{let{attributes:t}=e;return"retracted"===t.moderated&&t.moderated_id===n&&t.moderated_by}))):null}}async handleModeration(e){const t=["editable","moderated","moderated_by","moderated_id","moderation_reason"];if("retracted"===e.moderated){const n={};n[`stanza_id ${this.get("jid")}`]=e.moderated_id;const r=this.messages.findWhere(n);return r?(r.save(ii(e,t)),!0):(e.dangling_moderation=!0,await this.createMessage(e),!0)}{const n=this.findDanglingModeration(e);if(n){const r=ii(n.attributes,t),s=Object.assign({dangling_moderation:!1},e,r);return delete s.id,n.save(s),!0}}return!1}getNotificationsText(){const{__:e}=er,t=this.notifications.toJSON(),n=xh.settings.get("muc_show_info_messages").filter((e=>Ah.MUC_ROLE_CHANGES_LIST.includes(e))),r=xh.settings.get("muc_show_info_messages").filter((e=>Ah.MUC_TRAFFIC_STATES_LIST.includes(e)));return[...Ah.CHAT_STATES,...r,...n].reduce(((n,r)=>{const s=t[r];if(!s?.length)return n;const i=s.map((e=>this.getOccupant(e)?.getDisplayName()||e));if(1===i.length){if("composing"===r)return`${n}${e("%1$s is typing",i[0])}\n`;if("paused"===r)return`${n}${e("%1$s has stopped typing",i[0])}\n`;if(r===er.GONE)return`${n}${e("%1$s has gone away",i[0])}\n`;if("entered"===r)return`${n}${e("%1$s has entered the groupchat",i[0])}\n`;if("exited"===r)return`${n}${e("%1$s has left the groupchat",i[0])}\n`;if("op"===r)return`${n}${e("%1$s is now a moderator",i[0])}\n`;if("deop"===r)return`${n}${e("%1$s is no longer a moderator",i[0])}\n`;if("voice"===r)return`${n}${e("%1$s has been given a voice",i[0])}\n`;if("mute"===r)return`${n}${e("%1$s has been muted",i[0])}\n`}else if(i.length>1){let t;if(i.length>3)t=`${Array.from(i).slice(0,2).join(", ")} and others`;else{const n=i.pop();t=e("%1$s and %2$s",i.join(", "),n)}if("composing"===r)return`${n}${e("%1$s are typing",t)}\n`;if("paused"===r)return`${n}${e("%1$s have stopped typing",t)}\n`;if(r===er.GONE)return`${n}${e("%1$s have gone away",t)}\n`;if("entered"===r)return`${n}${e("%1$s have entered the groupchat",t)}\n`;if("exited"===r)return`${n}${e("%1$s have left the groupchat",t)}\n`;if("op"===r)return`${n}${e("%1$s are now moderators",i[0])}\n`;if("deop"===r)return`${n}${e("%1$s are no longer moderators",i[0])}\n`;if("voice"===r)return`${n}${e("%1$s have been given voices",i[0])}\n`;if("mute"===r)return`${n}${e("%1$s have been muted",i[0])}\n`}return n}),"")}removeNotification(e,t){const n=this.notifications.toJSON();(t=Array.isArray(t)?t:[t]).forEach((t=>{const r=Array.from(n[t]||[]);if(r.includes(e)){const n=r.indexOf(e);r.splice(n,1),this.notifications.set(t,Array.from(r))}}))}updateNotifications(e,t){const n=this.notifications.toJSON(),r=n[t]||[];if(r.includes(e))return;const s=(s,i)=>(s[i]=i===t?[...r,e]:(n[i]||[]).filter((t=>t!==e)),s),i=Ah.CHAT_STATES.reduce(s,{}),o=Ah.MUC_TRAFFIC_STATES_LIST.reduce(s,{}),a=Ah.MUC_ROLE_CHANGES_LIST.reduce(s,{});this.notifications.set(Object.assign(i,o,a)),window.setTimeout((()=>this.removeNotification(e,t)),1e4)}handleMetadataFastening(e){if(e.ogp_for_id){if(e.from!==this.get("jid"))return!1;const t=this.messages.findWhere({origin_id:e.ogp_for_id});if(t){const n=t.get("ogp_metadata")||[];if(n.filter((t=>t["og:url"]===e["og:url"])).length)return!1;const r=[...n,ii(e,zg)];return t.save("ogp_metadata",r),!0}}return!1}handleMEPNotification(e){return!(e.from!==this.get("jid")||!e.activities)&&(e.activities?.forEach((t=>{const n=Object.assign(e,t);this.createMessage(n),xh.trigger("message",{attrs:n,chatbox:this})})),!!e.activities.length)}getDuplicateMessage(e){return e.activities?.length?this.messages.findWhere({type:"mep",msgid:e.msgid}):er.ChatBox.prototype.getDuplicateMessage.call(this,e)}async onMessage(e){if(e=await e,$g.isErrorObject(e))return e.stanza&&Fe.error(e.stanza),Fe.error(e.message);if("error"===e.type&&!await this.shouldShowErrorMessage(e))return;const t=this.getDuplicateMessage(e);if(t)"groupchat"===t.get("type")&&this.updateMessage(t,e);else if(!(e.receipt_id||e.is_marker||this.ignorableCSN(e)))if(this.handleMetadataFastening(e)||this.handleMEPNotification(e)||await this.handleRetraction(e)||await this.handleModeration(e)||await this.handleSubjectChange(e))e.nick&&this.removeNotification(e.nick,["composing","paused"]);else if(this.setEditable(e,e.time),e.chat_state&&this.updateNotifications(e.nick,e.chat_state),function(e){return e.nick&&(Sg.shouldCreateMessage(e)||e.is_tombstone)}(e)){const t=await Nh(this,e)||await this.createMessage(e);this.removeNotification(e.nick,["composing","paused"]),this.handleUnreadMessage(t)}}handleModifyError(e){const t=e.querySelector("error text")?.textContent;if(t)if(this.session.get("connection_status")===ig.CONNECTING)this.setDisconnectionState(t);else{const e={type:"error",message:t,is_ephemeral:!0};this.createMessage(e)}}handleDisconnection(e){const t=null!==e.querySelector("status[code='110']"),n=dr()(`x[xmlns="${ge.NS.MUC_USER}"]`,e).pop();if(!n)return;const r=Object.keys(er.muc.disconnect_messages),s=dr()("status",n).map((e=>e.getAttribute("code"))).filter((e=>r.includes(e)));if(!(t&&s.length>0))return;const i=n.querySelector("item"),o=i?i.querySelector("reason")?.textContent:void 0,a=i?i.querySelector("actor")?.getAttribute("nick"):void 0,c=er.muc.disconnect_messages[s[0]],u=s.includes("301")?ig.BANNED:ig.DISCONNECTED;this.setDisconnectionState(c,o,a,u)}getActionInfoMessage(e,t,n){const r=er.__;return"301"===e?n?r("%1$s has been banned by %2$s",t,n):r("%1$s has been banned",t):"303"===e?r("%1$s's nickname has changed",t):"307"===e?n?r("%1$s has been kicked out by %2$s",t,n):r("%1$s has been kicked out",t):"321"===e?r("%1$s has been removed because of an affiliation change",t):"322"===e?r("%1$s has been removed for not being a member",t):void 0}createAffiliationChangeMessage(e){const t=er.__,n=e._previousAttributes.affiliation;if(!n)return;const r=e.get("affiliation");"admin"===n&&er.isInfoVisible(Ah.AFFILIATION_CHANGES.EXADMIN)?this.createMessage({type:"info",message:t("%1$s is no longer an admin of this groupchat",e.get("nick"))}):"owner"===n&&er.isInfoVisible(Ah.AFFILIATION_CHANGES.EXOWNER)?this.createMessage({type:"info",message:t("%1$s is no longer an owner of this groupchat",e.get("nick"))}):"outcast"===n&&er.isInfoVisible(Ah.AFFILIATION_CHANGES.EXOUTCAST)&&this.createMessage({type:"info",message:t("%1$s is no longer banned from this groupchat",e.get("nick"))}),"none"===r&&"member"===n&&er.isInfoVisible(Ah.AFFILIATION_CHANGES.EXMEMBER)&&this.createMessage({type:"info",message:t("%1$s is no longer a member of this groupchat",e.get("nick"))}),"member"===r&&er.isInfoVisible(Ah.AFFILIATION_CHANGES.MEMBER)?this.createMessage({type:"info",message:t("%1$s is now a member of this groupchat",e.get("nick"))}):("admin"===r&&er.isInfoVisible(Ah.AFFILIATION_CHANGES.ADMIN)||"owner"==r&&er.isInfoVisible(Ah.AFFILIATION_CHANGES.OWNER))&&this.createMessage({type:"info",message:t("%1$s is now an %2$s of this groupchat",e.get("nick"),r)})}createRoleChangeMessage(e,t){if("none"===t||e.changed.affiliation)return;const n=e._previousAttributes.role;"moderator"===n&&er.isInfoVisible(Ah.MUC_ROLE_CHANGES.DEOP)?this.updateNotifications(e.get("nick"),Ah.MUC_ROLE_CHANGES.DEOP):"visitor"===n&&er.isInfoVisible(Ah.MUC_ROLE_CHANGES.VOICE)&&this.updateNotifications(e.get("nick"),Ah.MUC_ROLE_CHANGES.VOICE),"visitor"===e.get("role")&&er.isInfoVisible(Ah.MUC_ROLE_CHANGES.MUTE)?this.updateNotifications(e.get("nick"),Ah.MUC_ROLE_CHANGES.MUTE):"moderator"===e.get("role")&&!["owner","admin"].includes(e.get("affiliation"))&&er.isInfoVisible(Ah.MUC_ROLE_CHANGES.OP)&&this.updateNotifications(e.get("nick"),Ah.MUC_ROLE_CHANGES.OP)}createInfoMessage(e,t,n){const r=er.__,s={type:"info",is_ephemeral:!0};if(er.isInfoVisible(e)&&"110"!==e&&("100"!==e||n)){if(e in er.muc.info_messages)s.message=er.muc.info_messages[e];else if(!n&&Ug.includes(e)){const n=ge.getResourceFromJid(t.getAttribute("from")),r=dr()(`x[xmlns="${ge.NS.MUC_USER}"] item`,t).pop();s.actor=r?r.querySelector("actor")?.getAttribute("nick"):void 0,s.reason=r?r.querySelector("reason")?.textContent:void 0,s.message=this.getActionInfoMessage(e,n,s.actor)}else if(n&&e in er.muc.new_nickname_messages){let n;"210"===e?n=ge.getResourceFromJid(t.getAttribute("from")):"303"===e&&(n=dr()(`x[xmlns="${ge.NS.MUC_USER}"] item`,t).pop().getAttribute("nick")),this.save("nick",n),s.message=r(er.muc.new_nickname_messages[e],n)}if(s.message){if("201"===e&&this.messages.findWhere(s))return;this.createMessage(s)}}}createInfoMessages(e){const t=dr()(`x[xmlns="${ge.NS.MUC_USER}"] status`,e).map((e=>e.getAttribute("code")));t.includes("333")&&t.includes("307")&&t.splice(t.indexOf("307"),1);const n=t.includes("110");t.forEach((t=>this.createInfoMessage(t,e,n)))}setDisconnectionState(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ig.DISCONNECTED;this.session.save({connection_status:r,disconnection_actor:n,disconnection_message:e,disconnection_reason:t})}onNicknameClash(e){const t=er.__;if(xh.settings.get("muc_nickname_from_jid")){const t=e.getAttribute("from").split("/")[1];if(t===er.getDefaultMUCNickname())this.join(t+"-2");else{const e=t.lastIndexOf("-"),n=t.substring(e+1,t.length);this.join(t.substring(0,e+1)+String(Number(n)+1))}}else this.save({nickname_validation_message:t("The nickname you chose is reserved or currently in use, please choose a different one.")}),this.session.save({connection_status:ig.NICKNAME_REQUIRED})}onErrorPresence(e){const t=er.__,n=e.querySelector("error"),r=n.getAttribute("type"),s=dr()(`text[xmlns="${ge.NS.STANZAS}"]`,n).pop()?.textContent;if("modify"===r)this.handleModifyError(e);else if("auth"===r)if(dr()(`not-authorized[xmlns="${ge.NS.STANZAS}"]`,n).length&&(this.save({password_validation_message:s||t("Password incorrect")}),this.session.save({connection_status:ig.PASSWORD_REQUIRED})),n.querySelector("registration-required")){const e=t("You are not on the member list of this groupchat.");this.setDisconnectionState(e,s)}else n.querySelector("forbidden")&&this.setDisconnectionState(er.muc.disconnect_messages[301],s,null,ig.BANNED);else if("cancel"===r)if(n.querySelector("not-allowed")){const e=t("You are not allowed to create new groupchats.");this.setDisconnectionState(e,s)}else if(n.querySelector("not-acceptable")){const e=t("Your nickname doesn't conform to this groupchat's policies.");this.setDisconnectionState(e,s)}else if(dr()(`gone[xmlns="${ge.NS.STANZAS}"]`,n).length){const e=dr()(`gone[xmlns="${ge.NS.STANZAS}"]`,n).pop()?.textContent.replace(/^xmpp:/,"").replace(/\?join$/,"");this.save({moved_jid:e,destroyed_reason:s}),this.session.save({connection_status:ig.DESTROYED})}else if(n.querySelector("conflict"))this.onNicknameClash(e);else if(n.querySelector("item-not-found")){const e=t("This groupchat does not (yet) exist.");this.setDisconnectionState(e,s)}else if(n.querySelector("service-unavailable")){const e=t("This groupchat has reached its maximum number of participants.");this.setDisconnectionState(e,s)}else if(n.querySelector("remote-server-not-found")){const e=t("Remote server not found");this.setDisconnectionState(e,s)}else if(n.querySelector("forbidden")){const e=t("You're not allowed to enter this groupchat");this.setDisconnectionState(e,s)}else{const e=t("An error happened while trying to enter this groupchat");this.setDisconnectionState(e,s)}}onPresenceFromMUCHost(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error");"wait"===t?.getAttribute("type")&&t?.querySelector("resource-constraint")&&this.session.get("connection_status")===ig.DISCONNECTED&&this.rejoin()}}onPresence(e){if("error"===e.getAttribute("type"))return this.onErrorPresence(e);this.createInfoMessages(e),e.querySelector("status[code='110']")?(this.onOwnPresence(e),"none"!==this.getOwnRole()&&this.session.get("connection_status")===ig.CONNECTING&&this.session.save("connection_status",ig.CONNECTED)):this.updateOccupantsOnPresence(e)}async onOwnPresence(e){if(await this.occupants.fetched,"unavailable"===e.getAttribute("type"))return void this.handleDisconnection(e);const t=this.session.get("connection_status");t!==ig.ENTERED&&t!==ig.CLOSING?(this.session.save("connection_status",ig.ENTERED,{silent:!0}),this.updateOccupantsOnPresence(e),this.session.trigger("change:connection_status",this.session,t)):this.updateOccupantsOnPresence(e);e.querySelector("status[code='201']")&&(this.get("auto_configure")?await this.autoConfigureChatRoom().then((()=>this.refreshDiscoInfo())):xh.settings.get("muc_instant_rooms")?await this.sendConfiguration().then((()=>this.refreshDiscoInfo())):this.session.save({view:Ah.MUC.VIEWS.CONFIG}))}isUserMentioned(e){const t=this.get("nick");if(e.get("references").length){return e.get("references").filter((e=>"mention"===e.type)).map((e=>e.value)).includes(t)}return new RegExp(`\\b${t}\\b`).test(e.get("body"))}incrementUnreadMsgsCounter(e){const t={num_unread_general:this.get("num_unread_general")+1};0===this.get("num_unread_general")&&(t.first_unread_id=e.get("id")),this.isUserMentioned(e)&&(t.num_unread=this.get("num_unread")+1),this.save(t)}clearUnreadMsgCounter(){(this.get("num_unread_general")>0||this.get("num_unread")>0||this.get("has_activity"))&&this.sendMarkerForMessage(this.messages.last()),fd(this,{has_activity:!1,num_unread:0,num_unread_general:0})}};const Hg=class extends ua{defaults(){return{hats:[],show:"offline",states:[]}}save(e,t,n){let r;return null==e?super.save(e,t,n):("object"==typeof e?(r=e,n=t):(r={})[e]=t,r.occupant_id&&(r.id=r.occupant_id),super.save(r,n))}getDisplayName(){return this.get("nick")||this.get("jid")}isMember(){return["admin","owner","member"].includes(this.get("affiliation"))}isModerator(){return["admin","owner"].includes(this.get("affiliation"))||"moderator"===this.get("role")}isSelf(){return this.get("states").includes("110")}};function Gg(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{u:Jg}=Ah.env;const Wg=class extends zd{constructor(){super(...arguments),Gg(this,"model",Hg)}comparator(e,t){const n=e.get("role")||"none",r=t.get("role")||"none";if(Yf[n]===Yf[r]){const n=e.getDisplayName().toLowerCase(),r=t.getDisplayName().toLowerCase();return n<r?-1:n>r?1:0}return Yf[n]<Yf[r]?-1:1}create(e,t){return e.id||e instanceof ua||(e.id=e.occupant_id||pd()),super.create(e,t)}async fetchMembers(){if(!["member","admin","owner"].includes(this.getOwnOccupant()?.get("affiliation")))return;const e=function(){const e=xh.settings.get("muc_fetch_members");return Array.isArray(e)?e:e?["member","admin","owner"]:[]}();if(0===e.length)return;const t=this.chatroom.get("jid"),n=await Promise.all(e.map((e=>vg(e,t)))),r=n.reduce(((e,t)=>Jg.isErrorObject(t)?e:[...t,...e]),[]),s=e.filter((t=>!Jg.isErrorObject(n[e.indexOf(t)]))),i=r.map((e=>e.jid)).filter((e=>void 0!==e)),o=r.map((e=>!e.jid&&e.nick||void 0)).filter((e=>void 0!==e)),a=this.filter((e=>s.includes(e.get("affiliation"))&&!o.includes(e.get("nick"))&&!i.includes(e.get("jid"))));a.forEach((e=>{e.get("jid")!==er.bare_jid&&("offline"===e.get("show")?e.destroy():e.save("affiliation",null))})),r.forEach((e=>{const t=this.findOccupant(e);t?t.save(e):this.create(e)})),xh.trigger("membersFetched")}findOccupant(e){if(e.occupant_id)return this.get(e.occupant_id);const t=e.jid&&ge.getBareJidFromJid(e.jid);return t&&this.findWhere({jid:t})||e.nick&&this.findWhere({nick:e.nick})}getOwnOccupant(){return this.findOccupant({jid:er.bare_jid,occupant_id:this.chatroom.get("occupant_id")})}},Qg={affiliations:{set:(e,t)=>(t=Array.isArray(t)?t:[t],_g(e=Array.isArray(e)?e:[e],t))}},Kg={rooms:{create(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t="string"==typeof t?{nick:t}:t||{},!t.nick&&xh.settings.get("muc_nickname_from_jid")&&(t.nick=ge.getNodeFromJid(er.bare_jid)),void 0===e)throw new TypeError("rooms.create: You need to provide at least one JID");return"string"==typeof e?xh.rooms.get(bu(e),t,!0):e.map((e=>xh.rooms.get(bu(e),t,!0)))},async open(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(await xh.waitUntil("chatBoxesFetched"),void 0===e){const e="rooms.open: You need to provide at least one JID";throw Fe.error(e),new TypeError(e)}if("string"==typeof e){const r=await xh.rooms.get(e,t,!0);return!t.hidden&&r?.maybeShow(n),r}{const r=await Promise.all(e.map((e=>xh.rooms.get(e,t,!0))));return r.forEach((e=>!t.hidden&&e.maybeShow(n))),r}},async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];async function r(e){e=bu(e);let r=await xh.chatboxes.get(e);return!r&&n?r=await xh.chatboxes.create(e,t,er.ChatRoom):(r=r&&r.get("type")===er.CHATROOMS_TYPE?r:null,r&&Object.keys(t).length&&r.save(t)),r}if(await xh.waitUntil("chatBoxesFetched"),void 0===e){return(await xh.chatboxes.get()).filter((e=>e.get("type")===er.CHATROOMS_TYPE))}return"string"==typeof e?r(e):Promise.all(e.map((e=>r(e))))}}};Ah.AFFILIATION_CHANGES=Xf,Ah.AFFILIATION_CHANGES_LIST=Zf,Ah.MUC_TRAFFIC_STATES=eg,Ah.MUC_TRAFFIC_STATES_LIST=tg,Ah.MUC_ROLE_CHANGES=ng,Ah.MUC_ROLE_CHANGES_LIST=rg,Ah.MUC={INFO_CODES:sg},Ah.MUC_NICK_CHANGED_CODE="303",Ah.ROOM_FEATURES=["passwordprotected","unsecured","hidden","publicroom","membersonly","open","persistent","temporary","nonanonymous","semianonymous","moderated","unmoderated","mam_enabled"],Ah.ROOMSTATUS=ig;const{Strophe:Vg}=Ah.env;Vg.addNamespace("MUC_ADMIN",Vg.NS.MUC+"#admin"),Vg.addNamespace("MUC_OWNER",Vg.NS.MUC+"#owner"),Vg.addNamespace("MUC_REGISTER","jabber:iq:register"),Vg.addNamespace("MUC_ROOMCONF",Vg.NS.MUC+"#roomconfig"),Vg.addNamespace("MUC_USER",Vg.NS.MUC+"#user"),Vg.addNamespace("MUC_HATS","xmpp:prosody.im/protocol/hats:1"),Vg.addNamespace("CONFINFO","urn:ietf:params:xml:ns:conference-info"),Ah.plugins.add("converse-muc",{dependencies:["converse-chatboxes","converse-chat","converse-disco"],initialize(){const{__:e,___:t}=er;if(xh.settings.extend({allow_muc_invitations:!0,auto_join_on_invite:!1,auto_join_rooms:[],auto_register_muc_nickname:!1,hide_muc_participants:!1,locked_muc_domain:!1,modtools_disable_assign:!1,muc_clear_messages_on_leave:!0,muc_domain:void 0,muc_fetch_members:!0,muc_history_max_stanzas:void 0,muc_instant_rooms:!0,muc_nickname_from_jid:!1,muc_send_probes:!1,muc_show_info_messages:[...Ah.MUC.INFO_CODES.visibility_changes,...Ah.MUC.INFO_CODES.self,...Ah.MUC.INFO_CODES.non_privacy_changes,...Ah.MUC.INFO_CODES.muc_logging_changes,...Ah.MUC.INFO_CODES.nickname_changes,...Ah.MUC.INFO_CODES.disconnected,...Ah.MUC.INFO_CODES.affiliation_changes,...Ah.MUC.INFO_CODES.join_leave_events,...Ah.MUC.INFO_CODES.role_changes],muc_show_logs_before_join:!1,muc_subscribe_to_rai:!1}),xh.promises.add(["roomsAutoJoined"]),xh.settings.get("locked_muc_domain")&&"string"!=typeof xh.settings.get("muc_domain"))throw new Error("Config Error: it makes no sense to set locked_muc_domain to true when muc_domain is not set");Ah.env.muc_utils={computeAffiliationsDelta:yg},Object.assign(xh,Kg),Object.assign(xh.rooms,Qg),er.muc={info_messages:{100:e("This groupchat is not anonymous"),102:e("This groupchat now shows unavailable members"),103:e("This groupchat does not show unavailable members"),104:e("The groupchat configuration has changed"),170:e("Groupchat logging is now enabled"),171:e("Groupchat logging is now disabled"),172:e("This groupchat is now no longer anonymous"),173:e("This groupchat is now semi-anonymous"),174:e("This groupchat is now fully-anonymous"),201:e("A new groupchat has been created")},new_nickname_messages:{210:t("Your nickname has been automatically set to %1$s"),303:t("Your nickname has been changed to %1$s")},disconnect_messages:{301:e("You have been banned from this groupchat"),333:e("You have exited this groupchat due to a technical problem"),307:e("You have been kicked from this groupchat"),321:e("You have been removed from this groupchat because of an affiliation change"),322:e("You have been removed from this groupchat because the groupchat has changed to members-only and you're not a member"),332:e("You have been removed from this groupchat because the service hosting it is being shut down")}},jg(),addEventListener("hashchange",jg),er.ChatRoom=qg,er.ChatRoomMessage=qf,er.ChatRoomOccupants=Wg,er.ChatRoomOccupant=Hg,xh.chatboxes.registry.add(er.CHATROOMS_TYPE,qg),Object.assign(er,{getDefaultMUCNickname:Ig,isInfoVisible:Ng,onDirectMUCInvitation:Cg,ChatRoomMessages:Hf}),xh.settings.get("allow_muc_invitations")&&(xh.listen.on("connected",Eg),xh.listen.on("reconnected",Eg)),xh.listen.on("addClientFeatures",(()=>xh.disco.own.features.add(`${Vg.NS.CONFINFO}+notify`))),xh.listen.on("addClientFeatures",kg),xh.listen.on("beforeResourceBinding",Rg),xh.listen.on("beforeTearDown",Tg),xh.listen.on("chatBoxesFetched",Og),xh.listen.on("disconnected",Ag),xh.listen.on("statusInitialized",Mg),xh.listen.on("windowStateChanged",xg)}});const{Strophe:Yg}=Ah.env;const Xg=class extends ua{get idAttribute(){return"jid"}getDisplayName(){return Yg.xmlunescape(this.get("name"))}},{Strophe:Zg,$iq:ep,sizzle:tp}=Ah.env;const np=class extends zd{constructor(){super(),this.model=Xg}comparator(e){return e.get("name").toLowerCase()}async initialize(){this.on("add",(e=>this.openBookmarkedRoom(e).then((e=>this.markRoomAsBookmarked(e))).catch((e=>Fe.fatal(e))))),this.on("remove",this.markRoomAsUnbookmarked,this),this.on("remove",this.sendBookmarkStanza,this);const e=`converse.room-bookmarks${er.bare_jid}`;this.fetched_flag=e+"fetched",eu(this,e),await this.fetchBookmarks(),xh.trigger("bookmarksInitialized",this)}async openBookmarkedRoom(e){if(xh.settings.get("muc_respect_autojoin")&&e.get("autojoin")){(await xh.rooms.create(e.get("jid"),{nick:e.get("nick")})).maybeShow()}return e}fetchBookmarks(){const e=Xn();return window.sessionStorage.getItem(this.fetched_flag)?this.fetch({success:()=>e.resolve(),error:()=>e.resolve()}):this.fetchBookmarksFromServer(e),e}createBookmark(e){this.create(e),this.sendBookmarkStanza().catch((t=>this.onBookmarkError(t,e)))}sendBookmarkStanza(){const e=ep({type:"set",from:xh.connection.get().jid}).c("pubsub",{xmlns:Zg.NS.PUBSUB}).c("publish",{node:Zg.NS.BOOKMARKS}).c("item",{id:"current"}).c("storage",{xmlns:Zg.NS.BOOKMARKS});return this.forEach((t=>{e.c("conference",{name:t.get("name"),autojoin:t.get("autojoin"),jid:t.get("jid")}).c("nick").t(t.get("nick")).up().up()})),e.up().up().up(),e.c("publish-options").c("x",{xmlns:Zg.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("http://jabber.org/protocol/pubsub#publish-options").up().up().c("field",{var:"pubsub#persist_items"}).c("value").t("true").up().up().c("field",{var:"pubsub#access_model"}).c("value").t("whitelist"),xh.sendIQ(e)}onBookmarkError(e,t){const{__:n}=er;Fe.error("Error while trying to add bookmark"),Fe.error(e),xh.alert("error",n("Error"),[n("Sorry, something went wrong while trying to save your bookmark.")]),this.get(t.jid)?.destroy()}fetchBookmarksFromServer(e){const t=ep({from:xh.connection.get().jid,type:"get"}).c("pubsub",{xmlns:Zg.NS.PUBSUB}).c("items",{node:Zg.NS.BOOKMARKS});xh.sendIQ(t).then((t=>this.onBookmarksReceived(e,t))).catch((t=>this.onBookmarksReceivedError(e,t)))}markRoomAsBookmarked(e){const t=er.chatboxes.get(e.get("jid"));t?.save("bookmarked",!0)}markRoomAsUnbookmarked(e){const t=er.chatboxes.get(e.get("jid"));t?.save("bookmarked",!1)}createBookmarksFromStanza(e){const t=Zg.NS.BOOKMARKS;tp(`items[node="${t}"] item storage[xmlns="${t}"] conference`,e).forEach((e=>{const t=e.getAttribute("jid"),n=this.get(t),r={jid:t,name:e.getAttribute("name")||t,autojoin:"true"===e.getAttribute("autojoin"),nick:e.querySelector("nick")?.textContent||""};n?n.save(r):this.create(r)}))}onBookmarksReceived(e,t){if(this.createBookmarksFromStanza(t),window.sessionStorage.setItem(this.fetched_flag,!0),void 0!==e)return e.resolve()}onBookmarksReceivedError(e,t){const{__:n}=er;if(null===t)Fe.error("Error: timeout while fetching bookmarks"),xh.alert("error",n("Timeout Error"),[n("The server did not return your bookmarks within the allowed time. You can reload the page to request them again.")]);else{if(e)return t.querySelector('error[type="cancel"] item-not-found')?(window.sessionStorage.setItem(this.fetched_flag,!0),e.resolve()):(Fe.error("Error while fetching bookmarks"),Fe.error(t),e.reject(new Error("Could not fetch bookmarks")));Fe.error("Error while fetching bookmarks"),Fe.error(t)}}async getUnopenedBookmarks(){return await xh.waitUntil("bookmarksInitialized"),await xh.waitUntil("chatBoxesFetched"),this.filter((e=>!er.chatboxes.get(e.get("jid"))))}},{Strophe:rp,sizzle:sp}=Ah.env;async function ip(){xh.settings.get("allow_bookmarks")&&await async function(){const e=await xh.disco.getIdentity("pubsub","pep",er.bare_jid);return xh.settings.get("allow_public_bookmarks")?!!e:xh.disco.supports(rp.NS.PUBSUB+"#publish-options",er.bare_jid)}()&&(er.bookmarks=new er.Bookmarks)}function op(e){return sp(`event[xmlns="${rp.NS.PUBSUB}#event"] items[node="${rp.NS.BOOKMARKS}"]`,e).length&&xh.waitUntil("bookmarksInitialized").then((()=>er.bookmarks.createBookmarksFromStanza(e))).catch((e=>Fe.fatal(e))),!0}const{Strophe:ap}=Ah.env;ap.addNamespace("BOOKMARKS","storage:bookmarks"),Ah.plugins.add("converse-bookmarks",{dependencies:["converse-chatboxes","converse-muc"],overrides:{ChatRoom:{getDisplayName(){const{_converse:e,getDisplayName:t}=this.__super__,n=this.get("bookmarked")?e.bookmarks?.get(this.get("jid")):null;return n?.get("name")||t.apply(this,arguments)},getAndPersistNickname(e){var t;return e=e||(t=this.get("jid"),xh.settings.get("allow_bookmarks")?er.bookmarks?.get(t)?.get("nick"):null),this.__super__.getAndPersistNickname.call(this,e)}}},initialize(){xh.settings.extend({allow_bookmarks:!0,allow_public_bookmarks:!1,muc_respect_autojoin:!0}),xh.promises.add("bookmarksInitialized"),er.Bookmark=Xg,er.Bookmarks=np,xh.listen.on("addClientFeatures",(()=>{xh.settings.get("allow_bookmarks")&&xh.disco.own.features.add(ap.NS.BOOKMARKS+"+notify")})),xh.listen.on("clearSession",(()=>{er.bookmarks&&(er.bookmarks.clearStore({silent:!0}),window.sessionStorage.removeItem(er.bookmarks.fetched_flag),delete er.bookmarks)})),xh.listen.on("connected",(async()=>{xh.connection.get().addHandler(op,null,"message","headline",null,er.bare_jid),await Promise.all([xh.waitUntil("chatBoxesFetched")]),ip()}))}});const{Strophe:cp}=Ah.env,up="converse.bosh-session";Ah.plugins.add("converse-bosh",{enabled:()=>!er.api.settings.get("blacklisted_plugins").includes("converse-bosh"),initialize(){xh.settings.extend({bosh_service_url:void 0,prebind_url:null}),er.startNewPreboundBOSHSession=function(){if(!xh.settings.get("prebind_url"))throw new Error("startNewPreboundBOSHSession: If you use prebind then you MUST supply a prebind_url");const e=xh.connection.get(),t=new XMLHttpRequest;t.open("GET",xh.settings.get("prebind_url"),!0),t.setRequestHeader("Accept","application/json, text/javascript"),t.onload=async function(){if(t.status>=200&&t.status<400){const n=JSON.parse(t.responseText),r=await Su(n.jid);e.attach(r,n.sid,n.rid,e.onConnectStatusChanged,59)}else t.onerror()},t.onerror=function(){xh.connection.destroy(),xh.trigger("noResumeableBOSHSession",er)},t.send()},er.restoreBOSHSession=async function(){const e=(await async function(){const e=up;if(er.bosh_session||(er.bosh_session=new ua({id:e}),er.bosh_session.browserStorage=Zc(e,"session"),await new Promise((e=>er.bosh_session.fetch({success:e,error:e})))),er.jid){if(er.bosh_session.get("jid")!==er.jid){const e=await Su(er.jid);er.bosh_session.clear({silent:!0}),er.bosh_session.save({jid:e})}}else{const e=er.bosh_session.get("jid");e&&await Su(e)}return er.bosh_session}()).get("jid"),t=xh.connection.get();if(e&&t._proto instanceof cp.Bosh)try{return t.restore(e,t.onConnectStatusChanged),!0}catch(t){return!du()&&Fe.warn("Could not restore session for jid: "+e+" Error message: "+t.message),!1}return!1},xh.listen.on("clearSession",(()=>{if(void 0===er.bosh_session){const e=up;sessionStorage.removeItem(e),sessionStorage.removeItem(`${e}-${e}`)}else er.bosh_session.destroy(),delete er.bosh_session})),xh.listen.on("setUserJID",(()=>{void 0!==er.bosh_session&&er.bosh_session.save({jid:er.jid})})),xh.listen.on("addClientFeatures",(()=>xh.disco.own.features.add(cp.NS.BOSH))),Object.assign(xh,{tokens:{get(e){const t=xh.connection.get();return t?"rid"===e.toLowerCase()?t.rid||t._proto.rid:"sid"===e.toLowerCase()?t.sid||t._proto.sid:void 0:null}}})}});const{Strophe:dp,$build:lp}=Ah.env;function hp(e,t){return e.sort(((e,n)=>e[t]>n[t]?-1:1))}async function fp(){const e=er.api.disco.own.identities.get(),t=er.api.disco.own.features.get();e.length>1&&(hp(e,"category"),hp(e,"type"),hp(e,"lang"));let n=e.reduce(((e,t)=>`${e}${t.category}/${t.type}/${t?.lang??""}/${t.name}<`),"");t.sort(),n=t.reduce(((e,t)=>`${e}${t}<`),n);return Zu(await crypto.subtle.digest("SHA-1",Xu(n)))}async function gp(e){const t=await async function(){return lp("c",{xmlns:dp.NS.CAPS,hash:"sha-1",node:"https://conversejs.org",ver:await fp()}).tree()}();return e.root().cnode(t).up(),e}const{Strophe:pp}=Ah.env;pp.addNamespace("CAPS","http://jabber.org/protocol/caps"),Ah.plugins.add("converse-caps",{dependencies:["converse-status"],initialize(){xh.listen.on("constructedPresence",((e,t)=>gp(t))),xh.listen.on("constructedMUCPresence",((e,t)=>gp(t)))}});const mp=class extends zd{get comparator(){return"time_opened"}onChatBoxesFetched(e){e.filter((e=>!e.isValid())).forEach((e=>e.destroy())),xh.trigger("chatBoxesFetched")}onConnected(e){e||(eu(this,`converse.chatboxes-${er.bare_jid}`),this.fetch({add:!0,success:e=>this.onChatBoxesFetched(e)}))}createModel(e,t){if(!e.type)throw new Error("You need to specify a type of chatbox to be created");return new(xh.chatboxes.registry.get(e.type))(e,t)}},{Strophe:vp}=Ah.env;async function _p(e,t,n){let r;e=vp.getBareJidFromJid(e.toLowerCase()),Object.assign(t,{jid:e,id:e});try{r=new n(t,{collection:er.chatboxes})}catch(e){return Fe.error(e),null}return await r.initialized,r.isValid()?(er.chatboxes.add(r),r):(r.destroy(),null)}const yp={},bp={async create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return await xh.waitUntil("chatBoxesFetched"),"string"==typeof e?_p(e,t,n):Promise.all(e.map((e=>_p(e,t,n))))},get:async e=>(await xh.waitUntil("chatBoxesFetched"),void 0===e?er.chatboxes.models:"string"==typeof e?er.chatboxes.get(e.toLowerCase()):(e=e.map((e=>e.toLowerCase())),er.chatboxes.models.filter((t=>e.includes(t.get("jid")))))),registry:{add(e,t){yp[e]=t},get:e=>yp[e]}},{Strophe:wp}=Ah.env;Ah.plugins.add("converse-chatboxes",{dependencies:["converse-emoji","converse-roster","converse-vcard"],initialize(){xh.promises.add(["chatBoxesFetched","chatBoxesInitialized","privateChatsAutoJoined"]),Object.assign(xh,{chatboxes:bp}),er.ChatBoxes=mp,xh.listen.on("addClientFeatures",(()=>{xh.disco.own.features.add(wp.NS.MESSAGE_CORRECT),xh.disco.own.features.add(wp.NS.HTTPUPLOAD),xh.disco.own.features.add(wp.NS.OUTOFBAND)})),xh.listen.on("pluginsInitialized",(()=>{er.chatboxes=new er.ChatBoxes,xh.trigger("chatBoxesInitialized")})),xh.listen.on("presencesInitialized",(e=>er.chatboxes.onConnected(e))),xh.listen.on("reconnected",(()=>er.chatboxes.forEach((e=>e.onReconnection()))))}});const{Strophe:Sp,u:Ep}=Ah.env;function Ap(e,t){const n=dr()(`command[xmlns="${Sp.NS.ADHOC}"]`,e).pop(),r={sessionid:n.getAttribute("sessionid"),instructions:dr()('x[type="form"][xmlns="jabber:x:data"] instructions',n).pop()?.textContent,fields:dr()('x[type="form"][xmlns="jabber:x:data"] field',n).map((e=>Ep.xForm2TemplateResult(e,n,{domain:t}))),actions:Array.from(n.querySelector("actions")?.children).map((e=>e.nodeName.toLowerCase()))??[]};return r}const{Strophe:xp,$iq:jp,u:Cp,stx:Ip}=Ah.env,Np={adhoc:{async getCommands(e){try{return t=await xh.disco.items(e,xp.NS.ADHOC),dr()(`query[xmlns="${Sp.NS.DISCO_ITEMS}"][node="${Sp.NS.ADHOC}"] item`,t).map(Xh)}catch(t){return null===t?Fe.error(`Error: timeout while fetching ad-hoc commands for ${e}`):(Fe.error(`Error while fetching ad-hoc commands for ${e}`),Fe.error(t)),[]}var t},async fetchCommandForm(e){const t=e.node,n=e.jid,r=jp({type:"set",to:n}).c("command",{xmlns:xp.NS.ADHOC,node:t,action:"execute"});try{return Ap(await xh.sendIQ(r),n)}catch(e){null===e?Fe.error(`Error: timeout while trying to execute command for ${n}`):(Fe.error(`Error while trying to execute command for ${n}`),Fe.error(e));const{__:t}=er;return{instructions:t("An error occurred while trying to fetch the command form"),fields:[]}}},async runCommand(e,t,n,r,s){const i=Ip`<iq type="set" to="${e}" xmlns="jabber:client">
                    <command sessionid="${t}" node="${n}" action="${r}" xmlns="${xp.NS.ADHOC}">
                        ${["cancel","prev"].includes(r)?"":Ip`
                            <x xmlns="${xp.NS.XFORM}" type="submit">
                                ${s.reduce(((e,t)=>{let{name:n,value:r}=t;return e+`<field var="${n}"><value>${r}</value></field>`}),"")}
                            </x>`}
                    </command>
                </iq>`,o=await xh.sendIQ(i,null,!1);if(null===o){Fe.warn("A timeout occurred while trying to run an ad-hoc command");const{__:e}=er;return{status:"error",note:e("A timeout occurred")}}Cp.isErrorStanza(o)&&(Fe.error("Error while trying to execute an ad-hoc command"),Fe.error(o));const a=o.querySelector("command"),c=a?.getAttribute("status");return{status:c,..."executing"===c?Ap(o):{},note:o.querySelector("note")?.textContent}}}},{Strophe:Op}=Ah.env;Op.addNamespace("ADHOC","http://jabber.org/protocol/commands"),Ah.plugins.add("converse-adhoc",{dependencies:["converse-disco"],initialize(){Object.assign(this._converse.api,Np)}});class kp extends gf{defaults(){return{bookmarked:!1,hidden:["mobile","fullscreen"].includes(xh.settings.get("view_mode")),message_type:"headline",num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),type:er.HEADLINES_TYPE}}async initialize(){super.initialize(),this.set({box_id:`box-${this.get("jid")}`}),this.initUI(),this.initMessages(),await this.fetchMessages(),xh.trigger("headlinesFeedInitialized",this)}}const Tp={headlines:{async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];async function r(e){let r=await xh.chatboxes.get(e);return!r&&n?r=await xh.chatboxes.create(e,t,er.HeadlinesFeed):(r=r&&r.get("type")===er.HEADLINES_TYPE?r:null,r&&Object.keys(t).length&&r.save(t)),r}if(void 0===e){return(await xh.chatboxes.get()).filter((e=>e.get("type")===er.HEADLINES_TYPE))}return"string"==typeof e?r(e):Promise.all(e.map((e=>r(e))))}}};Ah.plugins.add("converse-headlines",{dependencies:["converse-chat"],initialize(){function e(){xh.connection.get()?.addHandler((e=>(async function(e){if(Kh(e)||Vh(e)){const t=e.getAttribute("from");if(await xh.waitUntil("rosterInitialized"),t.includes("@")&&er.roster&&!er.roster.get(t)&&!xh.settings.get("allow_non_roster_messaging"))return;if(null===e.querySelector("body"))return;const n=await xh.chatboxes.create(t,{id:t,jid:t,type:xe,from:t},kp),r=await tf(e);await n.createMessage(r),xh.trigger("message",{chatbox:n,stanza:e,attrs:r})}}(e),!0)),null,"message")}er.HeadlinesFeed=kp,xh.listen.on("connected",e),xh.listen.on("reconnected",e),Object.assign(xh,Tp),xh.chatboxes.registry.add(er.HEADLINES_TYPE,kp)}});class Mp extends ua{defaults(){return{msgid:pd(),is_ephemeral:!1}}}const{Strophe:Rp,$build:$p}=Ah.env;Rp.addNamespace("RSM","http://jabber.org/protocol/rsm");const Dp=["after","before","index","max"],Pp=e=>Number(e),Fp=e=>e.toString(),Lp={after:Fp,before:Fp,count:Pp,first:Fp,index:Pp,last:Fp,max:Pp},zp=e=>void 0===e,Up=Object.keys(Lp);class Bp{static getQueryParameters(){return ii(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Dp)}static parseXMLResult(e){const t={};for(var n=0;n<Up.length;n++){const r=Up[n],s=e.getElementsByTagName(r)[0];zp(s)||null===s||(t[r]=Lp[r](Rp.getText(s)),"first"==r&&(t.index=Lp.index(s.getAttribute("index"))))}return t}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.query=Bp.getQueryParameters(e),this.result=e.xml?Bp.parseXMLResult(e.xml):{}}toXML(){const e=$p("set",{xmlns:Rp.NS.RSM});return Dp.reduce(((e,t)=>zp(this.query[t])?e:e.c(t).t((this.query[t]||"").toString()).up()),e).tree()}next(e,t){const n=Object.assign({},this.query,{after:this.result.last,before:t,max:e});return new Bp(n)}previous(e,t){const n=Object.assign({},this.query,{after:t,before:this.result.first,max:e});return new Bp(n)}}er.RSM_ATTRIBUTES=Up,er.RSM=Bp;const{NS:qp}=ge,Hp=Ah.env.utils,Gp={archive:{async query(e){if(!xh.connection.connected())throw new Error("Can't call `api.archive.query` before having established an XMPP session");const t={type:"set"};if(e&&e.groupchat){if(!e.with)throw new Error('You need to specify a "with" value containing the chat room JID, when querying groupchat messages.');t.to=e.with}const n=t.to||er.bare_jid;if(!await xh.disco.supports(qp.MAM,n))return Fe.warn(`Did not fetch MAM archive for ${n} because it doesn't support ${qp.MAM}`),{messages:[]};const r=Hp.getUniqueId(),s=f(t).c("query",{xmlns:qp.MAM,queryid:r});if(e){s.c("x",{xmlns:qp.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(qp.MAM).up().up(),e.with&&!e.groupchat&&s.c("field",{var:"with"}).c("value").t(e.with).up().up(),["start","end"].forEach((t=>{if(e[t]){const n=Gu()(e[t]);if(!n.isValid())throw new TypeError(`archive.query: invalid date provided for: ${t}`);s.c("field",{var:t}).c("value").t(n.toISOString()).up().up()}})),s.up();const t=new Bp(e);Object.keys(t.query).length&&s.cnode(t.toXML())}const i=xh.connection.get(),o=[],a=i.addHandler((t=>{const n=dr()(`message > result[xmlns="${qp.MAM}"]`,t).pop();if(void 0===n||n.getAttribute("queryid")!==r)return!0;const s=t.getAttribute("from")||er.bare_jid;if(e.groupchat){if(s!==e.with)return Fe.warn(`Ignoring alleged groupchat MAM message from ${t.getAttribute("from")}`),!0}else if(s!==er.bare_jid)return Fe.warn(`Ignoring alleged MAM message from ${t.getAttribute("from")}`),!0;return o.push(t),!0}),qp.MAM);let c;const u=xh.settings.get("message_archiving_timeout"),d=await xh.sendIQ(s,u,!1);if(null===d){const{__:e}=er,t=e("Timeout while trying to fetch archived messages.");return Fe.error(t),c=new Pu(t),{messages:o,error:c}}if(Hp.isErrorStanza(d)){const{__:e}=er,t=e("An error occurred while querying for archived messages.");return Fe.error(t),Fe.error(d),c=new Error(t),{messages:o,error:c}}let l;i.deleteHandler(a);const h=d&&dr()(`fin[xmlns="${qp.MAM}"]`,d).pop(),g="true"===h?.getAttribute("complete"),p=dr()(`set[xmlns="${qp.RSM}"]`,h).pop();return p&&(l=new Bp({...e,xml:p})),{messages:o,rsm:l,complete:g}}}},{NS:Jp}=ge,Wp=Ah.env.utils;function Qp(e){e?.querySelectorAll("feature-not-implemented").length?Fe.warn(`Message Archive Management (XEP-0313) not supported by ${e.getAttribute("from")}`):(Fe.error(`Error while trying to set archiving preferences for ${e.getAttribute("from")}.`),Fe.error(e))}function Kp(e,t){const n=dr()(`prefs[xmlns="${Jp.MAM}"]`,e).pop();if(n.getAttribute("default")!==xh.settings.get("message_archiving")){const e=f({type:"set"}).c("prefs",{xmlns:Jp.MAM,default:xh.settings.get("message_archiving")});Array.from(n.children).forEach((t=>e.cnode(t).up())),xh.sendIQ(e).then((()=>t.save({preferences:{default:xh.settings.get("message_archiving")}}))).catch(er.onMAMError)}else t.save({preferences:{default:xh.settings.get("message_archiving")}})}function Vp(e){const t=e.get("preferences")||{};e.get("var")===Jp.MAM&&void 0!==xh.settings.get("message_archiving")&&t.default!==xh.settings.get("message_archiving")&&xh.sendIQ(f({type:"get"}).c("prefs",{xmlns:Jp.MAM})).then((t=>er.onMAMPreferences(t,e))).catch(er.onMAMError)}function Yp(e){xh.settings.get("muc_show_logs_before_join")&&e.features.get("mam_enabled")&&!e.get("prejoin_mam_fetched")&&(em(e),e.save({prejoin_mam_fetched:!0}))}async function Xp(e,t,n,r,s){await xh.emojis.initialize();const i=e.get("type")===er.CHATROOMS_TYPE,o=await Promise.all(t.messages.map((t=>i?fg(t,e):tf(t))));t.messages=o;const a={query:n,chatbox:e,messages:o};if(await xh.trigger("MAMResult",a,{synchronous:!0}),o.forEach((t=>e.queueMessage(t))),t.error){const n=t.error.retry_event_id=Wp.getUniqueId();xh.listen.once(n,(()=>Zp(e,r,s))),e.createMessageFromError(t.error)}}async function Zp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e.disable_mam)return;const r=e.get("type")===er.CHATROOMS_TYPE,s=r?e.get("jid"):er.bare_jid;if(!await xh.disco.supports(Jp.MAM,s))return;const i=xh.settings.get("archived_messages_page_size"),o=Object.assign({groupchat:r,max:i,with:e.get("jid")},t),a=await xh.archive.query(o);if(await Xp(e,a,o,t,n),a.rsm&&!a.complete){if(n)return"forwards"===n?t=a.rsm.next(i,t.before).query:"backwards"===n&&(t=a.rsm.previous(i,t.after).query),Zp(e,t,n);!async function(e,t,n){if(""==t.before&&(0===e.messages.length||!t.start))return;if(t.before&&!t.start)return;if(null==t.before)return;const r=await Promise.all(n.messages),{rsm:s}=n,i=`stanza_id ${e.get("jid")}`,o=r.find((e=>e[i]===s.result.first)),a={template_hook:"getMessageTemplate",time:new Date(new Date(o.time)-1).toISOString(),before:s.result.first,start:t.start};e.messages.add(new Mp(a))}(e,t,a)}}function em(e){if(e.disable_mam)return;const t=e.getMostRecentMessage();if(t&&!xh.settings.get("clear_messages_on_reconnection")){if(xh.settings.get("mam_request_all_pages")){const n=t.get(`stanza_id ${e.get("jid")}`);Zp(e,n?{after:n}:{start:t.get("time")},"forwards")}else Zp(e,{before:"",start:t.get("time")})}else Zp(e,{before:""})}const{NS:tm}=ge;Ah.plugins.add("converse-mam",{dependencies:["converse-disco","converse-muc"],initialize(){xh.settings.extend({archived_messages_page_size:"50",mam_request_all_pages:!0,message_archiving:void 0,message_archiving_timeout:2e4}),Object.assign(xh,Gp),Object.assign(er,{onMAMError:Qp,onMAMPreferences:Kp,handleMAMResult:Xp,MAMPlaceholderMessage:Mp}),xh.listen.on("addClientFeatures",(()=>xh.disco.own.features.add(tm.MAM))),xh.listen.on("serviceDiscovered",Vp),xh.listen.on("chatRoomViewInitialized",(e=>{xh.settings.get("muc_show_logs_before_join")&&(Yp(e.model),e.model.features.on("change:mam_enabled",(()=>Yp(e.model))))})),xh.listen.on("enteredNewRoom",(e=>e.features.get("mam_enabled")&&em(e))),xh.listen.on("chatReconnected",(e=>{e.get("type")===er.PRIVATE_CHAT_TYPE&&em(e)})),xh.listen.on("afterMessagesFetched",(e=>{e.get("type")===er.PRIVATE_CHAT_TYPE&&em(e)}))}});const{Strophe:nm,$iq:rm}=Ah.env;let sm,im;function om(e){"visible"===e.state&&xh.ping(null,5e3)}function am(e){sm=new Date;const t=e.getAttribute("from"),n=e.getAttribute("id"),r=rm({type:"result",to:t,id:n});return xh.sendIQ(r),!0}function cm(){!function(){const e=xh.connection.get();e.disco&&xh.disco.own.features.add(nm.NS.PING),e.addHandler(am,nm.NS.PING,"iq","get")}(),xh.connection.get()?.addHandler((()=>{if(xh.settings.get("ping_interval")>0)return sm=new Date,!0})),clearInterval(im),im=setInterval(dm,1e3)}function um(){clearInterval(im)}function dm(){if(du()||!xh.connection.authenticated())return;const e=xh.settings.get("ping_interval");if(e>0){const t=new Date;sm=sm??t,(t-sm)/1e3>e&&xh.ping()}}const{Strophe:lm,$iq:hm,u:fm}=Ah.env,gm={async ping(e,t){if(!xh.connection.authenticated())return Fe.warn("Not pinging when we know we're not authenticated"),null;var n;n=new Date,sm=n,e=e||lm.getDomainFromJid(er.bare_jid);const r=hm({type:"get",to:e,id:fm.getUniqueId("ping")}).c("ping",{xmlns:lm.NS.PING}),s=await xh.sendIQ(r,t||1e4,!1);return null===s?(Fe.warn(`Timeout while pinging ${e}`),e===lm.getDomainFromJid(er.bare_jid)&&xh.connection.reconnect(),!1):!fm.isErrorStanza(s)||(Fe.error(`Error while pinging ${e}`),Fe.error(s),!1)}},{Strophe:pm}=Ah.env;pm.addNamespace("PING","urn:xmpp:ping"),Ah.plugins.add("converse-ping",{initialize(){xh.settings.extend({ping_interval:60}),Object.assign(xh,gm),xh.listen.on("connected",cm),xh.listen.on("reconnected",cm),xh.listen.on("disconnected",um),xh.listen.on("windowStateChanged",om)}});const{Strophe:mm,$iq:vm}=Ah.env;mm.addNamespace("PUBSUB_ERROR",mm.NS.PUBSUB+"#errors"),Ah.plugins.add("converse-pubsub",{dependencies:["converse-disco"],initialize(){Object.assign(er.api,{pubsub:{async publish(e,t,n,r){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const i=vm({from:er.bare_jid,type:"set",to:e}).c("pubsub",{xmlns:mm.NS.PUBSUB}).c("publish",{node:t}).cnode(n.tree()).up().up();r&&(e=e||er.bare_jid,await xh.disco.supports(mm.NS.PUBSUB+"#publish-options",e)?(i.c("publish-options").c("x",{xmlns:mm.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(`${mm.NS.PUBSUB}#publish-options`).up().up(),Object.keys(r).forEach((e=>i.c("field",{var:e}).c("value").t(r[e]).up().up()))):Fe.warn(`_converse.api.publish: ${e} does not support #publish-options, so we didn't set them even though they were provided.`));try{await xh.sendIQ(i)}catch(e){if(!(e instanceof Element&&s&&e.querySelector(`precondition-not-met[xmlns="${mm.NS.PUBSUB_ERROR}"]`)))throw e;{const e=i.tree();e.querySelector("publish-options").outerHTML="",Fe.warn(`PubSub: Republishing without publish options. ${e.outerHTML}`),await xh.sendIQ(e)}}}}})}});const{Strophe:_m,$pres:ym}=Ah.env;class bm extends ua{defaults(){return{status:xh.settings.get("default_state")}}initialize(){this.on("change",(e=>{e.changed instanceof Object&&("status"in e.changed||"status_message"in e.changed)&&xh.user.presence.send(this.get("status"),null,this.get("status_message"))}))}getDisplayName(){return this.getFullname()||this.getNickname()||er.bare_jid}getNickname(){return xh.settings.get("nickname")}getFullname(){return""}async constructPresence(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0;if(e="string"==typeof e?e:this.get("status")||xh.settings.get("default_state"),r="string"==typeof r?r:this.get("status_message"),"subscribe"===e){t=ym({to:n,type:e});const{xmppstatus:r}=er,s=r.getNickname();s&&t.c("nick",{xmlns:_m.NS.NICK}).t(s).up()}else t="unavailable"===e||"probe"===e||"error"===e||"unsubscribe"===e||"unsubscribed"===e||"subscribed"===e?ym({to:n,type:e}):"offline"===e?ym({to:n,type:"unavailable"}):"online"===e?ym({to:n}):ym({to:n}).c("show").t(e).up();r&&t.c("status").t(r).up();const s=xh.settings.get("priority");t.c("priority").t(Number.isNaN(Number(s))?0:s).up();const{idle:i,idle_seconds:o}=er;if(i){const e=new Date;e.setSeconds(e.getSeconds()-o),t.c("idle",{xmlns:_m.NS.IDLE,since:e.toISOString()})}return t=await xh.hook("constructedPresence",null,t),t}}const wm={status:{get:async()=>(await xh.waitUntil("statusInitialized"),er.xmppstatus.get("status")),async set(e,t){const n={status:e};if(!Object.keys(ye).includes(e))throw new Error("Invalid availability value. See https://xmpp.org/rfcs/rfc3921.html#rfc.section.2.2.2.1");"string"==typeof t&&(n.status_message=t),await xh.waitUntil("statusInitialized"),er.xmppstatus.save(n)},message:{get:async()=>(await xh.waitUntil("statusInitialized"),er.xmppstatus.get("status_message")),async set(e){await xh.waitUntil("statusInitialized"),er.xmppstatus.save({status_message:e})}}}},{Strophe:Sm,$build:Em}=Ah.env;function Am(e){xh.trigger("statusInitialized",e)}function xm(e){if(e=void 0!==er.xmppstatus&&e)Am(e);else{const t=`converse.xmppstatus-${er.bare_jid}`;er.xmppstatus=new er.XMPPStatus({id:t}),eu(er.xmppstatus,t,"session"),er.xmppstatus.fetch({success:()=>Am(e),error:()=>Am(e),silent:!0})}}function jm(){er.idle_seconds>0&&(er.idle_seconds=0),xh.connection.get()?.authenticated&&(er.inactive&&er.sendCSI(er.ACTIVE),er.idle&&(er.idle=!1,xh.user.presence.send()),!0===er.auto_changed_status&&(er.auto_changed_status=!1,er.xmppstatus.set("status",xh.settings.get("default_state"))))}function Cm(){if(!xh.connection.get()?.authenticated)return;const e=er.xmppstatus.get("status");er.idle_seconds++,xh.settings.get("csi_waiting_time")>0&&er.idle_seconds>xh.settings.get("csi_waiting_time")&&!er.inactive&&er.sendCSI(er.INACTIVE),xh.settings.get("idle_presence_timeout")>0&&er.idle_seconds>xh.settings.get("idle_presence_timeout")&&!er.idle&&(er.idle=!0,xh.user.presence.send()),xh.settings.get("auto_away")>0&&er.idle_seconds>xh.settings.get("auto_away")&&"away"!==e&&"xa"!==e&&"dnd"!==e?(er.auto_changed_status=!0,er.xmppstatus.set("status","away")):xh.settings.get("auto_xa")>0&&er.idle_seconds>xh.settings.get("auto_xa")&&"xa"!==e&&"dnd"!==e&&(er.auto_changed_status=!0,er.xmppstatus.set("status","xa"))}function Im(e){xh.send(Em(e,{xmlns:Sm.NS.CSI})),er.inactive=e===er.INACTIVE}function Nm(){if(xh.settings.get("auto_away")<1&&xh.settings.get("auto_xa")<1&&xh.settings.get("csi_waiting_time")<1&&xh.settings.get("idle_presence_timeout")<1)return;er.idle_seconds=0,er.auto_changed_status=!1;const{unloadevent:e}=er;window.addEventListener("click",er.onUserActivity),window.addEventListener("focus",er.onUserActivity),window.addEventListener("keypress",er.onUserActivity),window.addEventListener("mousemove",er.onUserActivity),window.addEventListener(e,er.onUserActivity,{once:!0,passive:!0}),er.everySecondTrigger=window.setInterval(er.onEverySecond,1e3)}function Om(e,t){const{xmppstatus:n}=er,r=n.get("status");["away","chat","dnd","xa"].includes(r)&&t.c("show").t(r).up();const s=n.get("status_message");return s&&t.c("status").t(s).up(),t}const{Strophe:km}=Ah.env;km.addNamespace("IDLE","urn:xmpp:idle:1"),Ah.plugins.add("converse-status",{initialize(){xh.settings.extend({auto_away:0,auto_xa:0,csi_waiting_time:0,default_state:"online",idle_presence_timeout:300,priority:0}),xh.promises.add(["statusInitialized"]),er.XMPPStatus=bm,er.onUserActivity=jm,er.onEverySecond=Cm,er.sendCSI=Im,er.registerIntervalHandler=Nm,Object.assign(er.api.user,wm),xh.settings.get("idle_presence_timeout")>0&&xh.listen.on("addClientFeatures",(()=>xh.disco.own.features.add(km.NS.IDLE))),xh.listen.on("presencesInitialized",(e=>{e||er.registerIntervalHandler()})),xh.listen.on("clearSession",(()=>{fu()&&er.xmppstatus&&(er.xmppstatus.destroy(),delete er.xmppstatus,xh.promises.add(["statusInitialized"]))})),xh.listen.on("connected",(()=>xm(!1))),xh.listen.on("reconnected",(()=>xm(!0))),xh.listen.on("constructedMUCPresence",Om)}});class Tm extends ua{initialize(){super.initialize(),this.set({filter_text:"",filter_type:"contacts",chat_state:"online"})}}const{$pres:Mm}=Ah.env;function Rm(e){const t=er.roster?.get(e.get("jid"));t?.save({num_unread:e.get("num_unread")})}function $m(){if(void 0!==er.presence_ref){xh.connection.get().deleteHandler(er.presence_ref),delete er.presence_ref}}async function Dm(){await(er.presences?.clearStore())}async function Pm(){await Dm(),fu()&&(er.rostergroups&&(await er.rostergroups.clearStore(),delete er.rostergroups),er.roster&&(er.roster.data?.destroy(),await er.roster.clearStore(),delete er.roster))}function Fm(e){e?xh.trigger("rosterReadyAfterReconnection"):function(){const e=er.roster=new er.RosterContacts;let t=`converse.contacts-${er.bare_jid}`;eu(e,t);const n=er.roster_filter=new Tm;n.id=`_converse.rosterfilter-${er.bare_jid}`,eu(n,n.id),n.fetch(),t=`converse-roster-model-${er.bare_jid}`,e.data=new ua,e.data.id=t,eu(e.data,t),e.data.fetch(),xh.trigger("rosterInitialized")}(),er.roster.onConnected(),function(){$m();const e=xh.connection.get();er.presence_ref=e.addHandler((e=>(er.roster.presenceHandler(e),!0)),null,"presence",null)}(),async function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(er.send_initial_presence=!0);try{await er.roster.fetchRosterContacts(),xh.trigger("rosterContactsFetched")}catch(e){Fe.error(e)}finally{er.send_initial_presence&&xh.user.presence.send()}}(!xh.connection.get().restored)}async function Lm(e){if(e)!xh.connection.get().hasResumed()&&await Dm();else{er.presences=new er.Presences;const e=`converse.presences-${er.bare_jid}`;eu(er.presences,e,"session"),er.presences.fetch()}xh.trigger("presencesInitialized",e)}function zm(){er.chatboxes.on("change:num_unread",Rm),er.chatboxes.on("add",(e=>{e.get("type")===er.PRIVATE_CHAT_TYPE&&e.setRosterContact(e.get("jid"))}))}function Um(){er.roster.on("add",(e=>{const t=er.chatboxes.findWhere({jid:e.get("jid")});t?.setRosterContact(e.get("jid"))}))}function Bm(e,t){const n=Mm({to:e,type:"unsubscribed"});t&&""!==t&&n.c("status").t(t),xh.send(n)}const{Strophe:qm,$iq:Hm,$pres:Gm}=Ah.env;const Jm=class extends ua{get idAttribute(){return"jid"}defaults(){return{chat_state:void 0,groups:[],image:er.DEFAULT_IMAGE,image_type:er.DEFAULT_IMAGE_TYPE,num_unread:0,status:void 0}}async initialize(e){super.initialize(e),this.initialized=Xn(),this.setPresence();const{jid:t}=e;this.set({...e,jid:qm.getBareJidFromJid(t).toLowerCase(),user_id:qm.getNodeFromJid(t)}),this.listenTo(this.presence,"change:show",(()=>xh.trigger("contactPresenceChanged",this))),this.listenTo(this.presence,"change:show",(()=>this.trigger("presenceChanged"))),await xh.trigger("rosterContactInitialized",this,{Synchronous:!0}),this.initialized.resolve()}setPresence(){const e=this.get("jid");this.presence=er.presences.findWhere(e)||er.presences.create({jid:e})}openChat(){const e=this.attributes;xh.chats.open(e.jid,e,!0)}getFilterCriteria(){const e=this.get("nickname"),t=this.get("jid");let n=this.getDisplayName();return n=n.includes(t)?n:n.concat(`   ${t}`),n=n.includes(e)?n:n.concat(`   ${e}`),n.toLowerCase()}getDisplayName(){return this.get("nickname")?this.get("nickname"):this.get("jid")}getFullname(){return this.get("jid")}subscribe(e){return xh.user.presence.send("subscribe",this.get("jid"),e),this.save("ask","subscribe"),this}ackSubscribe(){xh.send(Gm({type:"subscribe",to:this.get("jid")}))}ackUnsubscribe(){xh.send(Gm({type:"unsubscribe",to:this.get("jid")})),this.removeFromRoster(),this.destroy()}unauthorize(e){return Bm(this.get("jid"),e),this}authorize(e){const t=Gm({to:this.get("jid"),type:"subscribed"});return e&&""!==e&&t.c("status").t(e),xh.send(t),this}removeFromRoster(){const e=Hm({type:"set"}).c("query",{xmlns:qm.NS.ROSTER}).c("item",{jid:this.get("jid"),subscription:"remove"});return xh.sendIQ(e)}},{Strophe:Wm,$iq:Qm,sizzle:Km,u:Vm}=Ah.env;const Ym=class extends zd{constructor(){super(),this.model=Jm}initialize(){const e=`roster.state-${er.bare_jid}-${this.get("jid")}`;this.state=new ua({id:e,collapsed_groups:[]}),eu(this.state,e),this.state.fetch()}onConnected(){this.registerRosterHandler(),this.registerRosterXHandler()}registerRosterHandler(){xh.connection.get().addHandler((e=>(er.roster.onRosterPush(e),!0)),Wm.NS.ROSTER,"iq","set")}registerRosterXHandler(){let e=0;xh.connection.get().addHandler((function(t){return window.setTimeout((function(){er.connection.flush(),er.roster.subscribeToSuggestedItems.bind(er.roster)(t)}),e),e+=250*t.querySelectorAll("item").length,!0}),Wm.NS.ROSTERX,"message",null)}async fetchRosterContacts(){const e=await new Promise(((e,t)=>{this.fetch({add:!0,silent:!0,success:e,error:(e,n)=>t(n)})}));if(Vm.isErrorObject(e)&&(Fe.error(e),er.session.save("roster_cached",!1),this.data.save("version",void 0)),!er.session.get("roster_cached"))return er.send_initial_presence=!0,er.roster.fetchFromServer();xh.trigger("cachedRoster",e)}subscribeToSuggestedItems(e){return Array.from(e.querySelectorAll("item")).forEach((e=>{"add"===e.getAttribute("action")&&er.roster.addAndSubscribe(e.getAttribute("jid"),er.xmppstatus.getNickname()||er.xmppstatus.getFullname())})),!0}isSelf(e){return Vm.isSameBareJID(e,xh.connection.get().jid)}async addAndSubscribe(e,t,n,r,s){const i=await this.addContactToRoster(e,t,n,s);i instanceof er.RosterContact&&i.subscribe(r)}sendContactAddIQ(e,t,n){t=t||null;const r=Qm({type:"set"}).c("query",{xmlns:Wm.NS.ROSTER}).c("item",{jid:e,name:t});return n.forEach((e=>r.c("group").t(e).up())),xh.sendIQ(r)}async addContactToRoster(e,t,n,r){await xh.waitUntil("rosterContactsFetched"),n=n||[];try{await this.sendContactAddIQ(e,t,n)}catch(n){const{__:r}=er;return Fe.error(n),alert(r("Sorry, there was an error while trying to add %1$s as a contact.",t||e)),n}return this.create(Object.assign({ask:void 0,nickname:t,groups:n,jid:e,requesting:!1,subscription:"none"},r),{sort:!1})}async subscribeBack(e,t){const n=this.get(e);if(n instanceof er.RosterContact)n.authorize().subscribe();else{const n=Km(`nick[xmlns="${Wm.NS.NICK}"]`,t).pop()?.textContent||null,r=await this.addContactToRoster(e,n,[],{subscription:"from"});r instanceof er.RosterContact&&r.authorize().subscribe()}}onRosterPush(e){const t=e.getAttribute("id"),n=e.getAttribute("from");if(n&&n!==er.bare_jid)return void Fe.warn(`Ignoring roster illegitimate roster push message from ${e.getAttribute("from")}`);xh.send(Qm({type:"result",id:t,from:xh.connection.get().jid}));const r=Km(`query[xmlns="${Wm.NS.ROSTER}"]`,e).pop();this.data.save("version",r.getAttribute("ver"));const s=Km("item",r);if(s.length>1)throw Fe.error(e),new Error('Roster push query may not contain more than one "item" element.');if(0===s.length)return Fe.warn(e),void Fe.warn('Received a roster push stanza without an "item" element.');this.updateContact(s.pop()),xh.trigger("rosterPush",e)}rosterVersioningSupported(){return xh.disco.stream.getFeature("ver","urn:xmpp:features:rosterver")&&this.data.get("version")}async fetchFromServer(){const e=Qm({type:"get",id:Vm.getUniqueId("roster")}).c("query",{xmlns:Wm.NS.ROSTER});this.rosterVersioningSupported()&&e.attrs({ver:this.data.get("version")});const t=await xh.sendIQ(e,null,!1);if("result"===t.getAttribute("type")){const e=Km(`query[xmlns="${Wm.NS.ROSTER}"]`,t).pop();if(e){const t=Km("item",e);if(!this.data.get("version")&&this.models.length){const e=t.map((e=>e.getAttribute("jid")));this.forEach((t=>!t.get("requesting")&&!e.includes(t.get("jid"))&&t.destroy()))}t.forEach((e=>this.updateContact(e))),this.data.save("version",e.getAttribute("ver"))}}else if(!Vm.isServiceUnavailableError(t))return Fe.error(t),void Fe.error("Error while trying to fetch roster from the server");er.session.save("roster_cached",!0),xh.trigger("roster",t)}updateContact(e){const t=e.getAttribute("jid"),n=this.get(t),r=e.getAttribute("subscription");if("remove"===r)return n?.destroy();const s=e.getAttribute("ask"),i=e.getAttribute("name"),o=[...new Set(Km("group",e).map((e=>e.textContent)))];n?n.save({subscription:r,ask:s,nickname:i,groups:o,requesting:null}):this.create({nickname:i,ask:s,groups:o,jid:t,subscription:r},{sort:!1})}createRequestingContact(e){const t={jid:Wm.getBareJidFromJid(e.getAttribute("from")),subscription:"none",ask:null,requesting:!0,nickname:Km(`nick[xmlns="${Wm.NS.NICK}"]`,e).pop()?.textContent||null};xh.trigger("contactRequest",this.create(t))}handleIncomingSubscription(e){}handleOwnPresence(e){const t=e.getAttribute("from"),n=Wm.getResourceFromJid(t),r=e.getAttribute("type");if(xh.connection.get().jid!==t&&"unavailable"!==r&&(!0===xh.settings.get("synchronize_availability")||xh.settings.get("synchronize_availability")===n)){const t=e.querySelector("show")?.textContent||"online";er.xmppstatus.save({status:t},{silent:!0});const n=e.querySelector("status")?.textContent;n&&er.xmppstatus.save({status_message:n})}er.jid===t&&"unavailable"===r&&xh.user.presence.send()}presenceHandler(e){const t=e.getAttribute("type");if("error"===t)return!0;const n=e.getAttribute("from"),r=Wm.getBareJidFromJid(n);if(this.isSelf(r))return this.handleOwnPresence(e);if(Km(`query[xmlns="${Wm.NS.MUC}"]`,e).length)return;const s=this.get(r);if(s){const t=e.querySelector("status")?.textContent;s.get("status")!==t&&s.save({status:t})}if("subscribed"===t&&s)s.ackSubscribe();else if("unsubscribed"===t&&s)s.ackUnsubscribe();else{if("unsubscribe"===t)return;if("subscribe"===t)this.handleIncomingSubscription(e);else if("unavailable"===t&&s){const e=Wm.getResourceFromJid(n);s.presence.removeResource(e)}else s&&s.presence.addResource(e)}}},{Strophe:Xm}=Ah.env,Zm={contacts:{async get(e){await xh.waitUntil("rosterContactsFetched");const t=e=>er.roster.get(Xm.getBareJidFromJid(e));if(void 0===e)e=er.roster.pluck("jid");else if("string"==typeof e)return t(e);return e.map(t)},async add(e,t){if(await xh.waitUntil("rosterContactsFetched"),"string"!=typeof e||!e.includes("@"))throw new TypeError("contacts.add: invalid jid");return er.roster.addAndSubscribe(e,t)}}};const ev=class extends ua{get idAttribute(){return"name"}};const tv=class extends zd{constructor(){super(),this.model=ev}},{Strophe:nv,dayjs:rv,sizzle:sv}=Ah.env;const iv=class extends ua{get idAttribute(){return"jid"}defaults(){return{show:"offline"}}initialize(){super.initialize(),this.resources=new tv;const e=`converse.identities-${this.get("jid")}`;eu(this.resources,e,"session"),this.listenTo(this.resources,"update",this.onResourcesChanged),this.listenTo(this.resources,"change",this.onResourcesChanged)}onResourcesChanged(){const e=this.getHighestPriorityResource(),t=e?.attributes?.show||"offline";this.get("show")!==t&&this.save({show:t})}getHighestPriorityResource(){return this.resources.sortBy((e=>`${e.get("priority")}-${e.get("timestamp")}`)).reverse()[0]}addResource(e){const t=e.getAttribute("from"),n=nv.getResourceFromJid(t),r=sv(`delay[xmlns="${nv.NS.DELAY}"]`,e).pop(),s=e.querySelector("priority")?.textContent,i=this.resources.get(n),o={name:n,priority:Number.isNaN(parseInt(s,10))?0:parseInt(s,10),show:e.querySelector("show")?.textContent??"online",timestamp:r?rv(r.getAttribute("stamp")).toISOString():(new Date).toISOString()};i?i.save(o):this.resources.create(o)}removeResource(e){const t=this.resources.get(e);t?.destroy()}};const ov=class extends zd{constructor(){super(),this.model=iv}};Ah.plugins.add("converse-roster",{dependencies:["converse-status"],initialize(){xh.settings.extend({allow_contact_requests:!0,auto_subscribe:!1,synchronize_availability:!0}),xh.promises.add(["cachedRoster","roster","rosterContactsFetched","rosterInitialized"]),Object.assign(er.api,Zm);const{__:e}=er;er.HEADER_CURRENT_CONTACTS=e("My contacts"),er.HEADER_PENDING_CONTACTS=e("Pending contacts"),er.HEADER_REQUESTING_CONTACTS=e("Contact requests"),er.HEADER_UNGROUPED=e("Ungrouped"),er.HEADER_UNREAD=e("New messages"),er.Presence=iv,er.Presences=ov,er.RosterContact=Jm,er.RosterContacts=Ym,xh.listen.on("beforeTearDown",(()=>$m())),xh.listen.on("chatBoxesInitialized",zm),xh.listen.on("clearSession",Pm),xh.listen.on("presencesInitialized",Fm),xh.listen.on("statusInitialized",Lm),xh.listen.on("streamResumptionFailed",(()=>er.session.set("roster_cached",!1))),xh.waitUntil("rosterContactsFetched").then(Um)}});const{Strophe:av}=Ah.env,cv=Ah.env.utils;function uv(){return!(xh.connection.isType("bosh")&&!du())&&xh.disco.stream.getFeature("sm",av.NS.SM)}function dv(e){if(!er.session.get("smacks_enabled"))return!0;const t=parseInt(e.getAttribute("h"),10),n=er.session.get("num_stanzas_handled_by_server"),r=t-n;if(r<0){const e=`New reported stanza count lower than previous. New: ${t} - Previous: ${n}`;Fe.error(e)}const s=er.session.get("unacked_stanzas");if(r>s.length){const e=`Higher reported acknowledge count than unacknowledged stanzas. Reported Acknowledged Count: ${r} -Unacknowledged Stanza Count: ${s.length} -New: ${t} - Previous: ${n}`;Fe.error(e)}return er.session.save({num_stanzas_handled_by_server:t,num_stanzas_since_last_ack:0,unacked_stanzas:s.slice(r)}),!0}function lv(){if(er.session.get("smacks_enabled")){const e=er.session.get("num_stanzas_handled"),t=cv.toStanza(`<a xmlns="${av.NS.SM}" h="${e}"/>`);xh.send(t)}return!0}function hv(e){if(er.session.get("smacks_enabled")&&(cv.isTagEqual(e,"iq")||cv.isTagEqual(e,"presence")||cv.isTagEqual(e,"message"))){const e=er.session.get("num_stanzas_handled");er.session.save("num_stanzas_handled",e+1)}return!0}function fv(){er.session.save({smacks_enabled:er.session.get("smacks_enabled")||!1,num_stanzas_handled:er.session.get("num_stanzas_handled")||0,num_stanzas_handled_by_server:er.session.get("num_stanzas_handled_by_server")||0,num_stanzas_since_last_ack:er.session.get("num_stanzas_since_last_ack")||0,unacked_stanzas:er.session.get("unacked_stanzas")||[]})}function gv(){er.session?.save({smacks_enabled:!1,num_stanzas_handled:0,num_stanzas_handled_by_server:0,num_stanzas_since_last_ack:0,unacked_stanzas:[]})}function pv(e){const t={smacks_enabled:!0};return["1","true"].includes(e.getAttribute("resume"))&&(t.smacks_stream_id=e.getAttribute("id")),er.session.save(t),!0}function mv(e){return e.querySelector("item-not-found")?Fe.warn("Could not resume previous SMACKS session, session id not found. A new session will be established."):(Fe.error("Failed to enable stream management"),Fe.error(e.outerHTML)),gv(),xh.trigger("streamResumptionFailed"),!0}function vv(e){pv(e),dv(e),function(){const e=er.session.get("unacked_stanzas");er.session.save("unacked_stanzas",[]),e.forEach((e=>xh.send(e)))}();const t=xh.connection.get();t.do_bind=!1,t.authenticated=!0,t.restored=!0,t._changeConnectStatus(av.Status.CONNECTED,null)}async function _v(){if(xh.settings.get("enable_smacks")&&!er.session.get("smacks_enabled")&&await uv()){const e=Xn(),t=xh.connection.get();t._addSysHandler((t=>e.resolve(pv(t))),av.NS.SM,"enabled"),t._addSysHandler((t=>e.resolve(mv(t))),av.NS.SM,"failed");const n=xh.connection.isType("websocket")||du(),r=cv.toStanza(`<enable xmlns="${av.NS.SM}" resume="${n}"/>`);xh.send(r),t.flush(),await e}}const yv=[];async function bv(){if(!xh.settings.get("enable_smacks"))return;if(!await uv())return;const e=xh.connection.get();for(;yv.length;)e.deleteHandler(yv.pop());yv.push(e.addHandler(hv)),yv.push(e.addHandler(lv,av.NS.SM,"r")),yv.push(e.addHandler(dv,av.NS.SM,"a")),er.session?.get("smacks_stream_id")?await async function(){const e=Xn(),t=xh.connection.get();t._addSysHandler((t=>e.resolve(vv(t))),av.NS.SM,"resumed"),t._addSysHandler((t=>e.resolve(mv(t))),av.NS.SM,"failed");const n=er.session.get("smacks_stream_id"),r=er.session.get("num_stanzas_handled"),s=cv.toStanza(`<resume xmlns="${av.NS.SM}" h="${r}" previd="${n}"/>`);xh.send(s),t.flush(),await e}():gv()}function wv(e){if(er.session){if(er.session.get("smacks_enabled")&&(cv.isTagEqual(e,"iq")||cv.isTagEqual(e,"presence")||cv.isTagEqual(e,"message"))){const t=av.serialize(e);er.session.save("unacked_stanzas",(er.session.get("unacked_stanzas")||[]).concat([t]));const n=xh.settings.get("smacks_max_unacked_stanzas");if(n>0){const e=er.session.get("num_stanzas_since_last_ack")+1;e%n==0&&xh.send(cv.toStanza(`<r xmlns="${av.NS.SM}"/>`)),er.session.save({num_stanzas_since_last_ack:e})}}}else Fe.warn("No _converse.session!")}const{Strophe:Sv}=Ah.env;Sv.addNamespace("SM","urn:xmpp:sm:3"),Ah.plugins.add("converse-smacks",{initialize(){xh.settings.extend({enable_smacks:!0,smacks_max_unacked_stanzas:5}),xh.listen.on("afterResourceBinding",_v),xh.listen.on("beforeResourceBinding",bv),xh.listen.on("send",wv),xh.listen.on("userSessionInitialized",fv)}});const Ev=class extends ua{get idAttribute(){return"jid"}defaults(){return{image:er.DEFAULT_IMAGE,image_type:er.DEFAULT_IMAGE_TYPE}}set(e,t,n){let r;return"object"==typeof e?(r=e,n=t):(r={})[e]=t,"image"in r&&!r.image?(r.image=er.DEFAULT_IMAGE,r.image_type=er.DEFAULT_IMAGE_TYPE,ua.prototype.set.call(this,r,n)):ua.prototype.set.apply(this,arguments)}getDisplayName(){return this.get("nickname")||this.get("fullname")||this.get("jid")}},{Strophe:Av,$iq:xv,u:jv}=Ah.env;function Cv(e,t,n){const r=xv(t?{type:e,to:t}:{type:e});return n?r.cnode(n):r.c("vCard",{xmlns:Av.NS.VCARD}),r}async function Iv(e){let t;if(e instanceof er.Message){if(["error","info"].includes(e.get("type")))return;t=e.get("from")}else t=e.get("jid");t?(await xh.waitUntil("VCardsInitialized"),e.vcard=er.vcards.get(t)||er.vcards.create({jid:t}),e.vcard.on("change",(()=>e.trigger("vcard:change"))),e.trigger("vcard:add")):Fe.warn("Could not set VCard on model because no JID found!")}async function Nv(e){await xh.waitUntil("VCardsInitialized"),e.vcard=function(e){const t=e?.collection?.chatroom,n=e.get("nick");if(n&&t?.get("nick")===n)return er.xmppstatus.vcard;{const t=e.get("jid")||e.get("from");return t?er.vcards.get(t)||er.vcards.create({jid:t}):void Fe.warn("Could not get VCard for occupant because no JID found!")}}(e),e.vcard&&(e.vcard.on("change",(()=>e.trigger("vcard:change"))),e.trigger("vcard:add"))}async function Ov(e){["error","info"].includes(e.get("type"))||(await xh.waitUntil("VCardsInitialized"),e.vcard=function(e){const t=e?.collection?.chatbox,n=Av.getResourceFromJid(e.get("from"));if(n&&t?.get("nick")===n)return er.xmppstatus.vcard;{const t=e.occupant?.get("jid")||e.get("from");return t?er.vcards.get(t)||er.vcards.create({jid:t}):void Fe.warn(`Could not get VCard for message because no JID found! msgid: ${e.get("msgid")}`)}}(e),e.vcard&&(e.vcard.on("change",(()=>e.trigger("vcard:change"))),e.trigger("vcard:add")))}async function kv(){er.vcards=new er.VCards;const e=`${er.bare_jid}-converse.vcards`;eu(er.vcards,e),await new Promise((e=>{er.vcards.fetch({success:e,error:e},{silent:!0})}));const t=er.vcards;if(er.session){const e=er.session.get("bare_jid"),n=er.xmppstatus;n.vcard=t.get(e)||t.create({jid:e}),n.vcard&&(n.vcard.on("change",(()=>n.trigger("vcard:change"))),n.trigger("vcard:add"))}xh.trigger("VCardsInitialized")}async function Tv(e){const t=Av.getBareJidFromJid(e)===er.bare_jid?null:e;let n;try{n=await xh.sendIQ(Cv("get",t))}catch(n){return{jid:e,stanza:n,vcard_error:(new Date).toISOString()}}return async function(e,t){const n=t.querySelector("vCard");let r={};if(null!==n&&(r={stanza:t,fullname:n.querySelector("FN")?.textContent,nickname:n.querySelector("NICKNAME")?.textContent,image:n.querySelector("PHOTO BINVAL")?.textContent,image_type:n.querySelector("PHOTO TYPE")?.textContent,url:n.querySelector("URL")?.textContent,role:n.querySelector("ROLE")?.textContent,email:n.querySelector("EMAIL USERID")?.textContent,vcard_updated:(new Date).toISOString(),vcard_error:void 0}),r.image){const e=jv.base64ToArrayBuffer(r.image),t=await crypto.subtle.digest("SHA-1",e);r.image_hash=jv.arrayBufferToHex(t)}return r}(0,n)}const{dayjs:Mv,u:Rv}=Ah.env,$v={vcard:{async set(e,t){},get(e,t){if("string"==typeof e)return Tv(e);const n=e.get("vcard_error"),r=n&&Mv(n).isSame(new Date,"day");if(t||!e.get("vcard_updated")&&!r){const t=e.get("jid");return t||Fe.error("No JID to get vcard for"),Tv(t)}return Promise.resolve({})},async update(e,t){const n=await this.get(e,t);(e="string"==typeof e?er.vcards.get(e):e)?Object.keys(n).length&&(delete n.stanza,e.save(n)):Fe.error(`Could not find a VCard model for ${e}`)}}};const Dv=class extends zd{constructor(){super(),this.model=Ev}initialize(){this.on("add",(e=>e.get("jid")&&xh.vcard.update(e)))}},{Strophe:Pv}=Ah.env;Ah.plugins.add("converse-vcard",{dependencies:["converse-status","converse-roster"],overrides:{XMPPStatus:{getNickname(){const{_converse:e}=this.__super__,t=this.__super__.getNickname.apply(this);return!t&&e.xmppstatus.vcard?e.xmppstatus.vcard.get("nickname"):t},getFullname(){const{_converse:e}=this.__super__,t=this.__super__.getFullname.apply(this);return!t&&e.xmppstatus.vcard?e.xmppstatus.vcard.get("fullname"):t}},RosterContact:{getDisplayName(){return!this.get("nickname")&&this.vcard?this.vcard.getDisplayName():this.__super__.getDisplayName.apply(this)},getFullname(){return this.vcard?this.vcard.get("fullname"):this.__super__.getFullname.apply(this)}}},initialize(){xh.promises.add("VCardsInitialized"),er.VCard=Ev,er.VCards=Dv,xh.listen.on("chatRoomInitialized",(e=>{Iv(e),e.occupants.forEach(Nv),e.listenTo(e.occupants,"add",Nv),e.listenTo(e.occupants,"change:image_hash",(e=>function(e){const t=e.get("image_hash"),n=[];e.get("jid")&&n.push(er.vcards.get(e.get("jid"))),n.push(er.vcards.get(e.get("from"))),n.forEach((e=>t&&e?.get("image_hash")!==t&&xh.vcard.update(e,!0)))}(e)))})),xh.listen.on("chatBoxInitialized",(e=>Iv(e))),xh.listen.on("chatRoomMessageInitialized",(e=>Ov(e))),xh.listen.on("addClientFeatures",(()=>xh.disco.own.features.add(Pv.NS.VCARD))),xh.listen.on("clearSession",(()=>{fu()&&(xh.promises.add("VCardsInitialized"),er.vcards&&(er.vcards.clearStore(),delete er.vcards))})),xh.listen.on("messageInitialized",(e=>Iv(e))),xh.listen.on("rosterContactInitialized",(e=>Iv(e))),xh.listen.on("statusInitialized",kv),Object.assign(er.api,$v)}});var Fv=o(2353),Lv=o.n(Fv);const{dayjs:zv}=Ah.env;let Uv;function Bv(e,t){return"string"==typeof e&&t.includes(e)}function qv(e,t){if("en"===e||t(e))return e;const{languages:n}=window.navigator;let r;for(let e=0;e<n.length&&!r;e++)r=Hv(n[e],t);return r||"en"}function Hv(e,t){if(t(e))return e;var n=e.split("-")[0];return n!==e&&t(n)?n:void 0}Object.assign(Te,{getLocale:(e,t)=>qv(e,(e=>Bv(e,t))),translate(e){if(!Uv)return Lv().sprintf.apply(Lv(),arguments);const t=Uv.translate(e);return arguments.length>1?t.fetch.apply(t,[].slice.call(arguments,1)):t.fetch()},async initialize(){if(du())er.locale="en";else try{const e=xh.settings.get("i18n");er.locale=Te.getLocale(e,xh.settings.get("locales")),Uv=await async function(){const{api:e,locale:t}=er,n=function(e){const t=e.toLowerCase().replace("_","-");return"ug"===t?"ug-cn":t}(t);if(!Bv(t,e.settings.get("locales"))||"en"===t)return;const{default:r}=await o(6404)(`./${t}/LC_MESSAGES/converse.po`);return await o(9434)(`./${n}.js`),zv.locale(qv(n,(e=>zv.locale(e)))),new(Lv())(r)}()}catch(e){Fe.fatal(e.message),er.locale="en"}},__(){return Te.translate(...arguments)}});const Gv=Te.__,Jv=(e,t)=>eh`<audio controls src="${e}"></audio>${t?"":eh`<a target="_blank" rel="noopener" href="${e}">${e}</a>`}`,Wv=(e,t)=>{const n=Gv('Download file "%1$s"',t);return eh`<a target="_blank" rel="noopener" href="${e}">${n}</a>`},{I:Qv}=vh,Kv=2,Vv=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return{_$litDirective$:e,values:n}};class Yv{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,n){this._$Ct=e,this._$AM=t,this._$Ci=n}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}const Xv=(e,t)=>{var n,r;const s=e._$AN;if(void 0===s)return!1;for(const e of s)null===(r=(n=e)._$AO)||void 0===r||r.call(n,t,!1),Xv(e,t);return!0},Zv=e=>{let t,n;do{if(void 0===(t=e._$AM))break;n=t._$AN,n.delete(e),e=t}while(0===(null==n?void 0:n.size))},e_=e=>{for(let t;t=e._$AM;e=t){let n=t._$AN;if(void 0===n)t._$AN=n=new Set;else if(n.has(e))break;n.add(e),r_(t)}};function t_(e){void 0!==this._$AN?(Zv(this),this._$AM=e,e_(this)):this._$AM=e}function n_(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=this._$AH,s=this._$AN;if(void 0!==s&&0!==s.size)if(t)if(Array.isArray(r))for(let e=n;e<r.length;e++)Xv(r[e],!1),Zv(r[e]);else null!=r&&(Xv(r,!1),Zv(r));else Xv(this,e)}const r_=e=>{var t,n,r,s;e.type==Kv&&(null!==(t=(r=e)._$AP)&&void 0!==t||(r._$AP=n_),null!==(n=(s=e)._$AQ)&&void 0!==n||(s._$AQ=t_))};class s_ extends Yv{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,n){super._$AT(e,t,n),e_(this),this.isConnected=e._$AU}_$AO(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var n,r;e!==this.isConnected&&(this.isConnected=e,e?null===(n=this.reconnected)||void 0===n||n.call(this):null===(r=this.disconnected)||void 0===r||r.call(this)),t&&(Xv(this,e),Zv(this))}setValue(e){if((e=>void 0===e.strings)(this._$Ct))this._$Ct._$AI(e,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=e,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}}const i_=e=>eh`
    <div class="form-group">
        ${"hidden"!==e.type?eh`<label for="${e.id}">${e.label}</label>`:""}

        <!-- This is a hack to prevent Chrome from auto-filling the username in
             any of the other input fields in the MUC configuration form. -->
        ${"password"===e.type&&e.fixed_username?eh`
            <input class="hidden-username" type="text" autocomplete="username" value="${e.fixed_username}"></input>
        `:""}

        <input
            autocomplete="${e.autocomplete||""}"
            class="form-control"
            id="${e.id}"
            name="${e.name}"
            placeholder="${e.placeholder||""}"
            type="${e.type}"
            value="${e.value||""}"
            ?required=${e.required} />
    </div>`,o_=e=>eh`
    <div class="form-group">
        <label for="${e.id}">${e.label}</label>
        <select class="form-control" id="${e.id}" name="${e.name}" ?multiple="${e.multiple}">
            ${e.options?.map((e=>(e=>eh`<option value="${e.value}" ?selected="${e.selected}">${e.label}</option>`)(e)))}
        </select>
    </div>`;function a_(e){e.preventDefault(),xh.rooms.open(e.target.href)}const c_=(e,t)=>{let n=e.normalizePath().toString();return e._parts.protocol||t.startsWith("http://")||t.startsWith("https://")||(n="http://"+n),"xmpp"===e._parts.protocol&&"join"===e._parts.query?eh`
            <a target="_blank"
               rel="noopener"
               @click=${a_}
               href="${n}">${t}</a>`:eh`<a target="_blank" rel="noopener" href="${n}">${t}</a>`},u_=(e,t)=>eh`<video controls preload="metadata" src="${e}"></video>${t?"":eh`<a target="_blank" rel="noopener" href="${e}">${e}</a>`}`,{sizzle:d_,Strophe:l_}=Ah.env,h_=["http","https","xmpp","mailto"];function f_(e,t){return{"muc#roomconfig_lang":"language","muc#roomconfig_roomsecret":t?.new_password?"new-password":"current-password"}[e]}const g_={"text-private":"password","text-single":"text",fixed:"label",boolean:"checkbox",hidden:"hidden","jid-multi":"textarea","list-single":"dropdown","list-multi":"dropdown"},p_={"xs:anyURI":"url","xs:byte":"number","xs:date":"date","xs:dateTime":"datetime","xs:int":"number","xs:integer":"number","xs:time":"time"},m_=/\s*\n\s*/;function v_(e){let t;e=e.tree?.()??e;const n=[],r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,(e=>"body"===e.parentElement.nodeName.toLowerCase()?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT));for(;t=r.nextNode();)n.push(t);return n.forEach((e=>m_.test(e.data)&&e.parentElement.removeChild(e))),e}const __=new XMLSerializer;function y_(e){const t=g_[e.getAttribute("type")];if("text"==t){const n=e.getElementsByTagNameNS("http://jabber.org/protocol/xdata-validate","validate");if(1===n.length){const e=n[0].getAttribute("datatype");return p_[e]||t}}return t}function b_(e){const t=rd(e);try{return decodeURI(t.filename())}catch(e){return Fe.debug(e),t.filename()}}function w_(e,t){return t instanceof Element&&t.classList.add(e),t}function S_(e,t){return t instanceof Element&&t.classList.remove(e),t}function E_(e){const t=RegExp("^w{3}.","ig").test(e)?`http://${e}`:e,n=rd(e);return null===n||!function(e){try{return!!new URL(e)}catch(e){return!1}}(t)||!function(e){return!!(arguments.length>1&&void 0!==arguments[1]?arguments[1]:h_).includes(e)}(n._parts.protocol)&&n._parts.protocol?e:c_(n,e)}function A_(e,t){e.classList.remove("visible"),t?.()}md.calculateElementHeight=function(e){return Array.from(e.children).reduce(((e,t)=>e+t.offsetHeight),0)},md.getNextElement=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"*",n=e.nextElementSibling;for(;null!==n&&!d_.matchesSelector(n,t);)n=n.nextElementSibling;return n},md.getPreviousElement=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"*",n=e.previousElementSibling;for(;null!==n&&!d_.matchesSelector(n,t);)n=n.previousElementSibling;return n},md.getFirstChildElement=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"*",n=e.firstElementChild;for(;null!==n&&!d_.matchesSelector(n,t);)n=n.nextElementSibling;return n},md.getLastChildElement=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"*",n=e.lastElementChild;for(;null!==n&&!d_.matchesSelector(n,t);)n=n.previousElementSibling;return n},md.toggleClass=function(e,t){md.hasClass(e,t)?S_(e,t):w_(e,t)},md.getElementFromTemplateResult=function(e){const t=document.createElement("div");return yh(e,t),t.firstElementChild},md.showElement=e=>{S_("collapsed",e),S_("hidden",e)},md.hideElement=function(e){return e instanceof Element&&e.classList.add("hidden"),e},md.nextUntil=function(e,t){const n=[];let r=e.nextElementSibling;for(;null!==r&&!r.matches(t);)n.push(r),r=r.nextElementSibling;return n},md.unescapeHTML=function(e){var t=document.createElement("div");return t.innerHTML=e,t.innerText},md.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},md.slideInAllElements=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return Promise.all(Array.from(e).map((e=>md.slideIn(e,t))))},md.slideToggleElement=function(e,t){return md.hasClass("collapsed",e)||md.hasClass("hidden",e)?md.slideOut(e,t):md.slideIn(e,t)},md.isInDOM=function(e){return document.querySelector("body").contains(e)},md.isVisible=function(e){return null!==e&&(!md.hasClass("hidden",e)&&(e.offsetWidth>0||e.offsetHeight>0||e.getClientRects().length>0))},md.fadeIn=function(e,t){if(e||Fe.warn("An element needs to be passed in to fadeIn"),window.converse_disable_effects)return e.classList.remove("hidden"),A_(e,t);md.hasClass("hidden",e)?(e.classList.add("visible"),e.classList.remove("hidden"),e.addEventListener("webkitAnimationEnd",(()=>A_(e,t))),e.addEventListener("animationend",(()=>A_(e,t))),e.addEventListener("oanimationend",(()=>A_(e,t)))):A_(e,t)},md.xForm2TemplateResult=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("list-single"===e.getAttribute("type")||"list-multi"===e.getAttribute("type")){const t=md.queryChildren(e,"value").map((e=>e?.textContent)),n=md.queryChildren(e,"option").map((n=>{const r=n.querySelector("value")?.textContent;return{value:r,label:n.getAttribute("label"),selected:t.includes(r),required:!!e.querySelector("required")}}));return o_({options:n,id:md.getUniqueId(),label:e.getAttribute("label"),multiple:"list-multi"===e.getAttribute("type"),name:e.getAttribute("var"),required:!!e.querySelector("required")})}if("fixed"===e.getAttribute("type")){const t=e.querySelector("value")?.textContent;return(e=>eh`<p class="form-help">${e.text}</p>`)({text:t})}if("jid-multi"===e.getAttribute("type"))return(e=>{const t=md.getUniqueId();return eh`
        <div class="form-group">
            <label class="label-ta" for="${t}">${e.label}</label>
            <textarea name="${e.name}" id="${t}" class="form-control">${e.value}</textarea>
        </div>
    `})({name:e.getAttribute("var"),label:e.getAttribute("label")||"",value:e.querySelector("value")?.textContent,required:!!e.querySelector("required")});if("boolean"===e.getAttribute("type")){const t=e.querySelector("value")?.textContent;return(e=>eh`
    <fieldset class="form-group">
        <input id="${e.id}" name="${e.name}" type="checkbox" ?checked=${e.checked} ?required=${e.required} />
        <label class="form-check-label" for="${e.id}">${e.label}</label>
    </fieldset>`)({id:md.getUniqueId(),name:e.getAttribute("var"),label:e.getAttribute("label")||"",checked:"1"===t||"true"===t?'checked="1"':""})}if("url"===e.getAttribute("var"))return(e=>eh`
    <label>${e.label}
        <a class="form-url" target="_blank" rel="noopener" href="${e.value}">${e.value}</a>
    </label>`)({label:e.getAttribute("label")||"",value:e.querySelector("value")?.textContent});if("username"===e.getAttribute("var"))return(e=>eh`
    <div class="form-group">
        ${e.label?eh`<label>${e.label}</label>`:""}
        <div class="input-group">
                <input name="${e.name}"
                       class="form-control"
                       type="${e.type}"
                       value="${e.value||""}"
                       ?required="${e.required}" />
            <div class="input-group-append">
                <div class="input-group-text" title="${e.domain}">${e.domain}</div>
            </div>
        </div>
    </div>`)({domain:" @"+n.domain,name:e.getAttribute("var"),type:y_(e),label:e.getAttribute("label")||"",value:e.querySelector("value")?.textContent,required:!!e.querySelector("required")});if("password"===e.getAttribute("var"))return i_({name:e.getAttribute("var"),type:"password",label:e.getAttribute("label")||"",value:e.querySelector("value")?.textContent,required:!!e.querySelector("required")});if("ocr"===e.getAttribute("var")){const n=e.querySelector("uri"),r=d_('data[cid="'+n.textContent.replace(/^cid:/,"")+'"]',t)[0];return(e=>eh`
    <fieldset class="form-group">
        ${e.label?eh`<label>${e.label}</label>`:""}
        <img src="data:${e.type};base64,${e.data}">
        <input name="${e.name}" type="text" ?required="${e.required}" />
    </fieldset>
`)({label:e.getAttribute("label"),name:e.getAttribute("var"),data:r?.textContent,type:n.getAttribute("type"),required:!!e.querySelector("required")})}{const t=e.getAttribute("var");return i_({id:md.getUniqueId(),label:e.getAttribute("label")||"",name:t,fixed_username:n?.fixed_username,autocomplete:f_(t,n),placeholder:null,required:!!e.querySelector("required"),type:y_(e),value:e.querySelector("value")?.textContent})}},Object.assign(md,{hasClass:function(e,t){return t instanceof Element&&t.classList.contains(e)},addClass:w_,ancestor:function(e,t){let n=e;for(;null!==n&&!d_.matchesSelector(n,t);)n=n.parentElement;return n},getOOBURLMarkup:function(e){const t=rd(e);return null===t?e:ud(t)?u_(e):cd(t)?Jv(e):(dd(t),Wv(t.toString(),b_(t)))},isEqualNode:function(e,t){if(!md.isElement(e))throw new Error("Element being compared must be an Element!");e=v_(e),t=v_(t);let n=e.isEqualNode(t);if(!n){const{xmlHtmlNode:r}=l_,s=__.serializeToString(e),i=__.serializeToString(t);n=s===i||r(s).isEqualNode(r(i))}return n},removeClass:S_,removeElement:function(e){return e instanceof Element&&e.parentNode&&e.parentNode.removeChild(e),e},slideIn:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return new Promise(((n,r)=>{if(!e){const e="An element needs to be passed in to slideIn";return Fe.warn(e),r(new Error(e))}if(md.hasClass("collapsed",e))return n(e);if(window.converse_disable_effects)return e.classList.add("collapsed"),e.style.height="",n(e);const s=e.getAttribute("data-slider-marker");s&&(e.removeAttribute("data-slider-marker"),cancelAnimationFrame(s));const i=e.offsetHeight,o=t/17;let a=i;e.style.overflow="hidden",e.setAttribute("data-slider-marker",requestAnimationFrame((function t(){a-=i/o,a>0?(e.style.height=a+"px",e.setAttribute("data-slider-marker",requestAnimationFrame(t).toString())):(e.removeAttribute("data-slider-marker"),e.classList.add("collapsed"),e.style.height="",n(e))})).toString())}))},slideOut:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return new Promise(((n,r)=>{if(!e){const e="An element needs to be passed in to slideOut";return Fe.warn(e),void r(new Error(e))}const s=e.getAttribute("data-slider-marker");s&&(e.removeAttribute("data-slider-marker"),cancelAnimationFrame(s));const i=md.calculateElementHeight(e);if(window.converse_disable_effects)return e.style.height=i+"px",function(e){e.removeAttribute("data-slider-marker"),e.classList.remove("collapsed"),e.style.overflow="",e.style.height=""}(e),void n();if(!md.hasClass("collapsed",e)&&!md.hasClass("hidden",e))return void n();const o=t/17;let a=0;e.style.height="0",e.style.overflow="hidden",e.classList.remove("hidden"),e.classList.remove("collapsed"),e.setAttribute("data-slider-marker",requestAnimationFrame((function t(){a+=i/o,a<i?(e.style.height=a+"px",e.setAttribute("data-slider-marker",requestAnimationFrame(t).toString())):(e.removeAttribute("data-slider-marker"),e.style.height=md.calculateElementHeight(e)+"px",e.style.overflow="",e.style.height="",n())})).toString())}))}});const{URI:x_}=Ah.env;const j_=Vv(class extends s_{render(e,t,n,r){return t?eh`<a href="${t}" class="chat-image__link" target="_blank" rel="noopener">${this.renderImage(e,t,n,r)}</a>`:this.renderImage(e,t,n,r)}renderImage(e,t,n,r){return eh`<img class="chat-image img-thumbnail"
                loading="lazy"
                src="${e}"
                @click=${r}
                @error=${()=>this.onError(e,t,n,r)}
                @load=${n}/></a>`}onError(e,t,n,r){if(ad(e))t&&this.setValue(E_(t));else{const s=new x_(e),i=s.filename();s.filename(`${i}.png`),this.setValue(j_(s.toString(),t,n,r))}}}),C_=e=>eh`${j_(e.src||e.url,e.href,e.onLoad,e.onClick)}`,I_={name:"AES-GCM",length:128},N_={aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",cda:"application/x-cdf",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",m4a:"audio/mp4",mid:"audio/midi",midi:"audio/midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"text/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"};class O_{constructor(e){this.G=e}disconnect(){this.G=void 0}reconnect(e){this.G=e}deref(){return this.G}}class k_{constructor(){this.Y=void 0,this.Z=void 0}get(){return this.Y}pause(){var e;null!==(e=this.Y)&&void 0!==e||(this.Y=new Promise((e=>this.Z=e)))}resume(){var e;null===(e=this.Z)||void 0===e||e.call(this),this.Y=this.Z=void 0}}const T_=e=>!(e=>null===e||"object"!=typeof e&&"function"!=typeof e)(e)&&"function"==typeof e.then,M_=1073741823;const R_=Vv(class extends s_{constructor(){super(...arguments),this._$C_t=M_,this._$Cwt=[],this._$Cq=new O_(this),this._$CK=new k_}render(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return null!==(e=n.find((e=>!T_(e))))&&void 0!==e?e:th}update(e,t){const n=this._$Cwt;let r=n.length;this._$Cwt=t;const s=this._$Cq,i=this._$CK;this.isConnected||this.disconnected();for(let e=0;e<t.length&&!(e>this._$C_t);e++){const o=t[e];if(!T_(o))return this._$C_t=e,o;e<r&&o===n[e]||(this._$C_t=M_,r=0,Promise.resolve(o).then((async e=>{for(;i.get();)await i.get();const t=s.deref();if(void 0!==t){const n=t._$Cwt.indexOf(o);n>-1&&n<t._$C_t&&(t._$C_t=n,t.setValue(e))}})))}return th}disconnected(){this._$Cq.disconnect(),this._$CK.pause()}reconnected(){this._$Cq.reconnect(this),this._$CK.resume()}}),{Strophe:$_,URI:D_,sizzle:P_,u:F_}=Ah.env;function L_(e){e=e.replace(/^05/,"");for(let t=1;t<8;t++){const n=8*t+t-1;e=e.slice(0,n)+" "+e.slice(n)}return e}function z_(e,t){return e.get("omemo_active")&&t.body&&(t.is_encrypted=!0,t.plaintext=t.body,t.body=Gv("This is an OMEMO encrypted message which your client doesn’t seem to support. Find more information on https://conversations.im/omemo")),t}async function U_(e){const t="localhost"===window.location.hostname&&"localhost"===e.domain()?"http":"https",n=e.toString().replace(/^aesgcm/,t),r=await async function(e){let t;try{t=await fetch(e)}catch(t){return Fe.error(`${t.name}: Failed to download encrypted media: ${e}`),Fe.error(t),null}if(t.status>=200&&t.status<400)return t.arrayBuffer()}(n);if(null===r)return Fe.error(`Could not decrypt a received encrypted file ${e.toString()} since it could not be downloaded`),new Error(Gv("Error: could not decrypt a received encrypted file, because it could not be downloaded"));const s=e.hash().slice(1),i=s.substring(s.length-64),o=s.replace(i,"");let a;try{a=await async function(e,t,n){const r=await crypto.subtle.importKey("raw",td(t),"AES-GCM",!1,["decrypt"]),s={name:"AES-GCM",iv:td(e)};return crypto.subtle.decrypt(s,r,n)}(o,i,r)}catch(t){return Fe.error(`Could not decrypt file ${e.toString()}`),Fe.error(t),null}const[c,u]=e.filename().split("."),d=N_[u];try{const e=new File([a],c,{type:d});return URL.createObjectURL(e)}catch(t){return Fe.error(`Could not decrypt file ${e.toString()}`),Fe.error(t),null}}function B_(e,t,n){const r=[];try{const t={start:/\b(aesgcm:\/\/)/gi};D_.withinString(e,((e,t,n)=>(r.push({url:e,start:t,end:n}),e)),t)}catch(e){return void Fe.debug(e)}r.forEach((r=>{const s=rd(e.slice(r.start,r.end)),i=U_(s).then((e=>function(e,t,n){if(nr(t))return eh`<p class="error">${t.message}</p>`;const r=e.toString();return dd(r)?C_({src:t,onClick:n.onImgClick,onLoad:n.onImgLoad}):cd(r)?Jv(t):ud(r)?u_(t):Wv(t,e.filename())}(s,e,n))),o=eh`${R_(i,"")}`;n.addTemplateResult(r.start+t,r.end+t,o)}))}function q_(e){er.config.get("trusted")&&e.addAnnotations(((t,n)=>B_(t,n,e)))}async function H_(e,t){if(xh.settings.get("clear_cache_on_logout")||!t.is_encrypted||t.encryption_namespace!==$_.NS.OMEMO)return t;const n=P_(`encrypted[xmlns="${$_.NS.OMEMO}"]`,e).pop(),r=n.querySelector("header");t.encrypted={device_id:r.getAttribute("sid")};const s=await(xh.omemo?.getDeviceID()),i=s&&P_(`key[rid="${s}"]`,n).pop();return i?(Object.assign(t.encrypted,{iv:r.querySelector("iv").textContent,key:i.textContent,payload:n.querySelector("payload")?.textContent||null,prekey:["true","1"].includes(i.getAttribute("prekey"))}),!0===t.encrypted.prekey?async function(e){const t=Q_(e),n=W_(t,parseInt(e.encrypted.device_id,10)),r=ed(e.encrypted.key);let s;try{s=await n.decryptPreKeyWhisperMessage(r,"binary")}catch(t){return Fe.error(`${t.name} ${t.message}`),Object.assign(e,V_(t))}try{const t=await K_(e,s);return await er.omemo_store.generateMissingPreKeys(),await er.omemo_store.publishBundle(),t?Object.assign(e,{plaintext:t}):Object.assign(e,{is_only_key:!0})}catch(t){return Fe.error(`${t.name} ${t.message}`),Object.assign(e,V_(t))}}(t):async function(e){const t=Q_(e),n=W_(t,parseInt(e.encrypted.device_id,10)),r=ed(e.encrypted.key);try{const t=await n.decryptWhisperMessage(r,"binary"),s=await K_(e,t);return Object.assign(e,{plaintext:s})}catch(t){return Fe.error(`${t.name} ${t.message}`),Object.assign(e,V_(t))}}(t)):Object.assign(t,{error_condition:"not-encrypted-for-this-device",error_type:"Decryption",is_ephemeral:!0,is_error:!0,type:"error"})}function G_(){er.chatboxes.on("add",(e=>{sy(e),e.get("type")===er.CHATROOMS_TYPE&&(e.occupants.on("add",(t=>async function(e,t){if(t.isSelf()||!e.features.get("nonanonymous")||!e.features.get("membersonly"))return;if(e.get("omemo_active")){await er.contactHasOMEMOSupport(t.get("jid"))||(e.createMessage({message:Gv("%1$s doesn't appear to have a client that supports OMEMO. Encrypted chat will no longer be possible in this grouchat.",t.get("nick")),type:"error"}),e.save({omemo_active:!1,omemo_supported:!1}))}}(e,t))),e.features.on("change",(()=>sy(e))))}))}function J_(e){e.listenTo(e.model.messages,"add",(t=>{t.get("is_encrypted")&&!t.get("is_error")&&e.model.save("omemo_supported",!0)})),e.listenTo(e.model,"change:omemo_supported",(()=>{!e.model.get("omemo_supported")&&e.model.get("omemo_active")?e.model.set("omemo_active",!1):e.querySelector("converse-chat-toolbar")?.requestUpdate()})),e.listenTo(e.model,"change:omemo_active",(()=>{e.querySelector("converse-chat-toolbar").requestUpdate()}))}function W_(e,t){const n=new libsignal.SignalProtocolAddress(e,t);return new window.libsignal.SessionCipher(er.omemo_store,n)}function Q_(e){const t=e.from_muc?e.from_real_jid:e.from;if(!t)throw Object.assign(e,{error_text:Gv("Sorry, could not decrypt a received OMEMO message because we don't have the XMPP address for that user."),error_type:"Decryption",is_ephemeral:!0,is_error:!0,type:"error"}),new Error("Could not find JID to decrypt OMEMO message for");return t}async function K_(e,t){const n=Q_(e),r=await xh.omemo.devicelists.get(n,!0),s=e.encrypted;let i=r.devices.get(s.device_id);if(i||(i=await r.devices.create({id:s.device_id,jid:n},{promise:!0})),s.payload){const e=t.slice(0,16),n=t.slice(16),r=await cy.decryptMessage(Object.assign(s,{key:e,tag:n}));return i.save("active",!0),r}}function V_(e){return{error_text:Gv("Sorry, could not decrypt a received OMEMO message due to an error.")+` ${e.name} ${e.message}`,error_condition:e.name,error_message:e.message,error_type:"Decryption",is_ephemeral:!0,is_error:!0,type:"error"}}function Y_(e){const t=e.querySelector("signedPreKeyPublic"),n=e.querySelector("signedPreKeySignature"),r=P_("prekeys > preKeyPublic",e).map((e=>({id:parseInt(e.getAttribute("preKeyId"),10),key:e.textContent})));return{identity_key:e.querySelector("identityKey").textContent.trim(),signed_prekey:{id:parseInt(t.getAttribute("signedPreKeyId"),10),public_key:t.textContent,signature:n.textContent},prekeys:r}}async function X_(e){if(e.get("bundle")?.fingerprint)return;const t=await e.getBundle();t.fingerprint=Vu(ed(t.identity_key)),e.save("bundle",t),e.trigger("change:bundle")}async function Z_(e){await xh.waitUntil("OMEMOInitialized");const t=await xh.omemo.devicelists.get(e,!0);return await t.fetchDevices(),t.devices}async function ey(e){if(!e.get("bundle"))return Fe.error(`Could not build an OMEMO session for device ${e.get("id")} because we don't have its bundle`),null;const t=new libsignal.SignalProtocolAddress(e.get("jid"),e.get("id")),n=await er.omemo_store.loadSession(t.toString());if(n)return n;try{const t=await async function(e){const t=new libsignal.SignalProtocolAddress(e.get("jid"),e.get("id")),n=new libsignal.SessionBuilder(er.omemo_store,t),r=e.getRandomPreKey(),s=await e.getBundle();return n.processPreKey({registrationId:parseInt(e.get("id"),10),identityKey:ed(s.identity_key),signedPreKey:{keyId:s.signed_prekey.id,publicKey:ed(s.signed_prekey.public_key),signature:ed(s.signed_prekey.signature)},preKey:{keyId:r.id,publicKey:ed(r.key)}})}(e);return t}catch(t){return Fe.error(`Could not build an OMEMO session for device ${e.get("id")}`),Fe.error(t),null}}function ty(){xh.connection.get().addHandler((async e=>{try{P_(`event[xmlns="${$_.NS.PUBSUB}#event"]`,e).length&&(await xh.waitUntil("OMEMOInitialized"),await async function(e){const t=P_(`items[node="${$_.NS.OMEMO_DEVICELIST}"]`,e).pop();if(!t)return;const n=`item list[xmlns="${$_.NS.OMEMO}"] device`,r=P_(n,t).map((e=>e.getAttribute("id"))),s=e.getAttribute("from"),i=await xh.omemo.devicelists.get(s,!0),o=i.devices;o.pluck("id").filter((e=>!r.includes(e))).forEach((e=>{s===er.bare_jid&&e===er.omemo_store.get("device_id")||o.get(e).save("active",!1)})),r.forEach((e=>{const t=o.get(e);t?t.save("active",!0):o.create({id:e,jid:s})})),F_.isSameBareJID(s,er.bare_jid)&&i.publishCurrentDevice(r)}(e),await async function(e){const t=P_("items",e).pop();if(!t||!t.getAttribute("node").startsWith($_.NS.OMEMO_BUNDLES))return;const n=t.getAttribute("node").split(":")[1],r=e.getAttribute("from"),s=P_("item > bundle",t).pop(),i=await xh.omemo.devicelists.get(r,!0);(i.devices.get(n)||i.devices.create({id:n,jid:r})).save({bundle:Y_(s)})}(e))}catch(e){Fe.error(e.message)}return!0}),null,"message","headline")}async function ny(){if(void 0===er.omemo_store){const e=`converse.omemosession-${er.bare_jid}`;er.omemo_store=new er.OMEMOStore({id:e}),eu(er.omemo_store,e)}await er.omemo_store.fetchSession()}async function ry(e){if(!e)if(er.config.get("trusted")&&!xh.settings.get("clear_cache_on_logout")){try{await async function(){er.devicelists=new er.DeviceLists;const e=`converse.devicelists-${er.bare_jid}`;eu(er.devicelists,e),await new Promise((e=>{er.devicelists.fetch({success:e,error:(t,n)=>{Fe.error(n),e()}})})),await xh.omemo.devicelists.get(er.bare_jid,!0)}(),await ny(),await er.omemo_store.publishBundle()}catch(e){return Fe.error("Could not initialize OMEMO support"),void Fe.error(e)}xh.trigger("OMEMOInitialized")}else Fe.warn("Not initializing OMEMO, since this browser is not trusted or clear_cache_on_logout is set to true")}async function sy(e){let t;e.get("type")===er.CHATROOMS_TYPE?(await xh.waitUntil("OMEMOInitialized"),t=e.features.get("nonanonymous")&&e.features.get("membersonly")):e.get("type")===er.PRIVATE_CHAT_TYPE&&(t=await er.contactHasOMEMOSupport(e.get("jid"))),e.set("omemo_supported",t),t&&xh.settings.get("omemo_default")&&e.set("omemo_active",!0)}function iy(e){e.stopPropagation(),e.preventDefault();const t=F_.ancestor(e.target,"converse-chat-toolbar");if(!t.model.get("omemo_supported")){let e;return e=t.model.get("type")===er.CHATROOMS_TYPE?[Gv("Cannot use end-to-end encryption in this groupchat, either the groupchat has some anonymity or not all participants support OMEMO.")]:[Gv("Cannot use end-to-end encryption because %1$s uses a client that doesn't support OMEMO.",t.model.contact.getDisplayName())],xh.alert("error",Gv("Error"),e)}t.model.save({omemo_active:!t.model.get("omemo_active")})}function oy(e,t){const n=e.model,r=n.get("type")===er.CHATROOMS_TYPE;let s,i;if(n.get("omemo_supported")){const e=Gv("Messages are being sent in plaintext"),t=Gv("Messages are sent encrypted");s=n.get("omemo_active")?t:e}else s=Gv(r?"This groupchat needs to be members-only and non-anonymous in order to support OMEMO encrypted messages":"OMEMO encryption is not supported");return i=n.get("omemo_supported")?n.get("omemo_active")?r?"var(--muc-color)":"var(--chat-toolbar-btn-color)":"var(--error-color)":"var(--muc-toolbar-btn-disabled-color)",t.push(eh`
        <button class="toggle-omemo" title="${s}" data-disabled=${!n.get("omemo_supported")} @click=${iy}>
            <converse-icon
                class="fa ${n.get("omemo_active")?"fa-lock":"fa-unlock"}"
                path-prefix="${xh.settings.get("assets_path")}"
                size="1em"
                color="${i}"
            ></converse-icon>
        </button>
    `),t}async function ay(e,t){let{stanza:n}=t;const{message:r}=t;if(!r.get("is_encrypted"))return t;if(!r.get("body"))throw new Error("No message body to encrypt!");const s=await async function(e){const t=Gv("Sorry, no devices found to which we can send an OMEMO encrypted message.");let n;if(e.get("type")===er.CHATROOMS_TYPE){const t=await Promise.all(e.occupants.map((e=>Z_(e.get("jid")))));n=t.reduce(((e,t)=>e.concat(t.models)),[])}else if(e.get("type")===er.PRIVATE_CHAT_TYPE){const r=await Z_(e.get("jid"));if(0===r.length){const e=new Error(t);throw e.user_facing=!0,e}const s=(await xh.omemo.devicelists.get(er.bare_jid)).devices;n=[...s.models,...r.models]}const r=er.omemo_store.get("device_id");n=n.filter((e=>e.get("id")!==r)),await Promise.all(n.map((e=>e.getBundle())));const s=n.filter((e=>e)).map((e=>ey(e)));if(await Promise.all(s),s.includes(null)&&(n=n.filter((e=>s[n.indexOf(e)])),0===n.length)){const e=new Error(t);throw e.user_facing=!0,e}return n}(e);n.c("encrypted",{xmlns:$_.NS.OMEMO}).c("header",{sid:er.omemo_store.get("device_id")});const{key_and_tag:i,iv:o,payload:a}=await cy.encryptMessage(r.get("plaintext")),c=await Promise.all(s.filter((e=>-1!=e.get("trusted")&&e.get("active"))).map((e=>function(e,t){return W_(t.get("jid"),t.get("id")).encrypt(e).then((e=>({payload:e,device:t})))}(i,e))));return n=await function(e,t,n){for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const s=t[r].payload,i=t[r].device,o=3==parseInt(s.type,10);e.c("key",{rid:i.get("id")}).t(btoa(s.body)),o&&e.attrs({prekey:o}),e.up(),r==t.length-1&&e.c("iv").t(n).up().up()}return Promise.resolve(e)}(n,c,o),n.c("payload").t(a).up().up(),n.c("store",{xmlns:$_.NS.HINTS}).up(),n.c("encryption",{xmlns:$_.NS.EME,namespace:$_.NS.OMEMO}),{message:r,stanza:n}}const cy={decryptMessage:async function(e){const t=await crypto.subtle.importKey("raw",e.key,I_,!0,["encrypt","decrypt"]),n=Ku(ed(e.payload),e.tag),r={name:"AES-GCM",iv:ed(e.iv),tagLength:128};return Yu(await crypto.subtle.decrypt(r,t,n))},encryptMessage:async function(e){const t=crypto.getRandomValues(new window.Uint8Array(12)),n=await crypto.subtle.generateKey(I_,!0,["encrypt","decrypt"]),r={name:"AES-GCM",iv:t,tagLength:128},s=await crypto.subtle.encrypt(r,n,Xu(e)),i=s.byteLength-16,o=s.slice(0,i),a=s.slice(i),c=await crypto.subtle.exportKey("raw",n);return{key:c,tag:a,key_and_tag:Ku(c,a),payload:Zu(o),iv:Zu(t)}},formatFingerprint:L_},uy=e=>{const t=Gv("OMEMO Fingerprints"),n=Gv("No OMEMO-enabled devices found"),r=e.devicelist.devices;return eh`
        <hr/>
        <ul class="list-group fingerprints">
            <li class="list-group-item active">${t}</li>
            ${r.length?r.map((t=>((e,t)=>{const n=Gv("Trusted"),r=Gv("Untrusted");return t.get("bundle")&&t.get("bundle").fingerprint?eh`
            <li class="list-group-item">
                <form class="fingerprint-trust">
                    <div class="btn-group btn-group-toggle">
                        <label class="btn btn--small ${1===t.get("trusted")?"btn-primary active":"btn-secondary"}"
                                @click=${e.toggleDeviceTrust}>
                            <input type="radio" name="${t.get("id")}" value="1"
                                ?checked=${-1!==t.get("trusted")}>${n}
                        </label>
                        <label class="btn btn--small ${-1===t.get("trusted")?"btn-primary active":"btn-secondary"}"
                                @click=${e.toggleDeviceTrust}>
                            <input type="radio" name="${t.get("id")}" value="-1"
                                ?checked=${-1===t.get("trusted")}>${r}
                        </label>
                    </div>
                    <code class="fingerprint">${L_(t.get("bundle").fingerprint)}</code>
                </form>
            </li>
        `:""})(e,t))):eh`<li class="list-group-item"> ${n} </li>`}
        </ul>
    `};class dy extends Sh{createRenderRoot(){return this}initialize(){return null}connectedCallback(){return super.connectedCallback(),this.initialize()}disconnectedCallback(){super.disconnectedCallback(),this.stopListening()}}Object.assign(dy.prototype,Un);xh.elements?.define("converse-omemo-fingerprints",class extends dy{static get properties(){return{jid:{type:String}}}async initialize(){this.devicelist=await xh.omemo.devicelists.get(this.jid,!0),this.listenTo(this.devicelist.devices,"change:bundle",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"change:trusted",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"remove",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"add",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"reset",(()=>this.requestUpdate())),this.requestUpdate()}render(){return this.devicelist?uy(this):""}toggleDeviceTrust(e){const t=e.target;this.devicelist.devices.get(t.getAttribute("name")).save("trusted",parseInt(t.value,10))}});const ly=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.classes?.includes("hor_centered")?eh`<div class="spinner__container"><converse-icon size="1em" class="fa fa-spinner spinner centered ${e.classes||""}"></converse-icon></div>`:eh`<converse-icon size="1em" class="fa fa-spinner spinner centered ${e.classes||""}"></converse-icon>`},hy=e=>eh`
    ${e.device.get("bundle")&&e.device.get("bundle").fingerprint?(e=>{const t=Gv("Checkbox for selecting the following fingerprint");return eh`
        <li class="fingerprint-removal-item list-group-item">
            <label>
            <input type="checkbox" value="${e.device.get("id")}"
                aria-label="${t}"/>
            <span class="fingerprint">${L_(e.device.get("bundle").fingerprint)}</span>
            </label>
        </li>
    `})(e):(e=>{const t=Gv("Device without a fingerprint"),n=Gv("Checkbox for selecting the following device");return eh`
        <li class="fingerprint-removal-item list-group-item">
            <label>
            <input type="checkbox" value="${e.device.get("id")}"
                aria-label="${n}"/>
            <span>${t}</span>
            </label>
        </li>
    `})(e)}
`,fy=e=>{const t=Gv("This device's OMEMO fingerprint"),n=Gv("Generate new keys and fingerprint");return eh`
        <form class="converse-form fingerprint-removal" @submit=${e.removeSelectedFingerprints}>
            <ul class="list-group fingerprints">
                <li class="list-group-item active">${t}</li>
                <li class="list-group-item">
                    ${e.current_device&&e.current_device.get("bundle")&&e.current_device.get("bundle").fingerprint?(e=>eh`
    <span class="fingerprint">${L_(e.current_device.get("bundle").fingerprint)}</span>`)(e):ly()}
                </li>
            </ul>
            <div class="form-group">
                <button type="button" class="generate-bundle btn btn-danger" @click=${e.generateOMEMODeviceBundle}>${n}</button>
            </div>
            ${e.other_devices?.length?(e=>{const t=Gv("Other OMEMO-enabled devices"),n=Gv("Checkbox to select fingerprints of all other OMEMO devices"),r=Gv("Remove checked devices and close"),s=Gv("Select all");return eh`
        <ul class="list-group fingerprints">
            <li class="list-group-item active">
                <label>
                    <input type="checkbox" class="select-all" @change=${e.selectAll} title="${s}" aria-label="${n}"/>
                    ${t}
                </label>
            </li>
            ${e.other_devices?.map((t=>hy(Object.assign({device:t},e))))}
        </ul>
        <div class="form-group"><button type="submit" class="save-form btn btn-primary">${r}</button></div>
    `})(e):""}
        </form>`},{Strophe:gy,sizzle:py,u:my}=Ah.env;xh.elements?.define("converse-omemo-profile",class extends dy{async initialize(){this.devicelist=await xh.omemo.devicelists.get(er.bare_jid,!0),await this.setAttributes(),this.listenTo(this.devicelist.devices,"change:bundle",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"reset",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"reset",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"remove",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"add",(()=>this.requestUpdate())),this.requestUpdate()}async setAttributes(){this.device_id=await xh.omemo.getDeviceID(),this.current_device=this.devicelist.devices.get(this.device_id),this.other_devices=this.devicelist.devices.filter((e=>e.get("id")!==this.device_id))}render(){return this.devicelist?fy(this):ly()}selectAll(e){let t=my.ancestor(e.target,"li");for(;t;)t.querySelector('input[type="checkbox"]').checked=e.target.checked,t=t.nextElementSibling}async removeSelectedFingerprints(e){e.preventDefault(),e.stopPropagation(),e.target.querySelector(".select-all").checked=!1;const t=py('.fingerprint-removal-item input[type="checkbox"]:checked',e.target).map((e=>e.value));try{await this.devicelist.removeOwnDevices(t)}catch(e){Fe.error(e),er.api.alert(gy.LogLevel.ERROR,Gv("Error"),[Gv("Sorry, an error occurred while trying to remove the devices.")])}await this.setAttributes(),this.requestUpdate()}async generateOMEMODeviceBundle(e){e.preventDefault();await xh.confirm(Gv("Are you sure you want to generate new OMEMO keys? This will remove your old keys and all previously encrypted messages will no longer be decryptable on this device."))&&(await xh.omemo.bundle.generate(),await this.setAttributes(),this.requestUpdate())}});const vy={async generateFingerprints(e){const t=await Z_(e);return Promise.all(t.map((e=>X_(e))))},getDeviceForContact:(e,t)=>Z_(e).then((e=>e.get(t))),contactHasOMEMOSupport:async e=>(await Z_(e)).length>0},_y=vy;class yy extends Error{constructor(e,t){super(e,t),this.name="IQError",this.iq=t}}const{Strophe:by,sizzle:wy,$iq:Sy}=Ah.env;const Ey=class extends ua{defaults(){return{trusted:0,active:!0}}getRandomPreKey(){const e=this.get("bundle");return e.prekeys[gd(e.prekeys.length)]}async fetchBundleFromServer(){const e=Sy({type:"get",from:er.bare_jid,to:this.get("jid")}).c("pubsub",{xmlns:by.NS.PUBSUB}).c("items",{node:`${by.NS.OMEMO_BUNDLES}:${this.get("id")}`});let t;try{t=await xh.sendIQ(e)}catch(t){return Fe.error(`Could not fetch bundle for device ${this.get("id")} from ${this.get("jid")}`),Fe.error(t),null}if(t.querySelector("error"))throw new yy("Could not fetch bundle",t);const n=wy(`items[node="${by.NS.OMEMO_BUNDLES}:${this.get("id")}"]`,t).pop(),r=Y_(wy(`bundle[xmlns="${by.NS.OMEMO}"]`,n).pop());return this.save("bundle",r),r}getBundle(){return this.get("bundle")?Promise.resolve(this.get("bundle"),this):this.fetchBundleFromServer()}},{Strophe:Ay,$build:xy,$iq:jy,sizzle:Cy}=Ah.env;const Iy=class extends ua{get idAttribute(){return"jid"}async initialize(){super.initialize(),this.initialized=Xn(),await this.initDevices(),this.initialized.resolve()}initDevices(){this.devices=new er.Devices;const e=`converse.devicelist-${er.bare_jid}-${this.get("jid")}`;return eu(this.devices,e),this.fetchDevices()}async onDevicesFound(e){if(0===e.length){let e=[];try{e=await this.fetchDevicesFromServer()}catch(e){null===e?Fe.error(`Timeout error while fetching devices for ${this.get("jid")}`):(Fe.error(`Could not fetch devices for ${this.get("jid")}`),Fe.error(e)),this.destroy()}this.get("jid")===er.bare_jid&&this.publishCurrentDevice(e)}}fetchDevices(){return void 0===this._devices_promise&&(this._devices_promise=new Promise((e=>{this.devices.fetch({success:t=>e(this.onDevicesFound(t)),error:(t,n)=>{Fe.error(n),e()}})}))),this._devices_promise}async getOwnDeviceId(){let e=er.omemo_store.get("device_id");return this.devices.get(e)||(await er.omemo_store.generateBundle(),e=er.omemo_store.get("device_id")),e}async publishCurrentDevice(e){if(this.get("jid")===er.bare_jid){if(await ny(),er.omemo_store)return e.includes(await this.getOwnDeviceId())?void 0:this.publishDevices();Fe.warn("publishCurrentDevice: omemo_store is not defined, likely a timing issue")}}async fetchDevicesFromServer(){const e=jy({type:"get",from:er.bare_jid,to:this.get("jid")}).c("pubsub",{xmlns:Ay.NS.PUBSUB}).c("items",{node:Ay.NS.OMEMO_DEVICELIST}),t=await xh.sendIQ(e),n=`list[xmlns="${Ay.NS.OMEMO}"] device`,r=Cy(n,t).map((e=>e.getAttribute("id"))),s=this.get("jid");return Promise.all(r.map((e=>this.devices.create({id:e,jid:s},{promise:!0}))))}publishDevices(){const e=xy("item",{id:"current"}).c("list",{xmlns:Ay.NS.OMEMO});this.devices.filter((e=>e.get("active"))).forEach((t=>e.c("device",{id:t.get("id")}).up()));return xh.pubsub.publish(null,Ay.NS.OMEMO_DEVICELIST,e,{"pubsub#access_model":"open"},!1)}async removeOwnDevices(e){if(this.get("jid")!==er.bare_jid)throw new Error("Cannot remove devices from someone else's device list");return await Promise.all(e.map((e=>this.devices.get(e))).map((e=>new Promise((t=>e.destroy({success:t,error:(e,n)=>{Fe.error(n),t()}})))))),this.publishDevices()}};const Ny=class extends zd{constructor(){super(),this.model=Iy}};const Oy=class extends zd{constructor(){super(),this.model=Ey}};var ky=Math.ceil,Ty=Math.max;const My=function(e,t,n,r){for(var s=-1,i=Ty(ky((t-e)/(n||1)),0),o=Array(i);i--;)o[r?i:++s]=e,e+=n;return o};const Ry=function(e){return function(t,n,r){return r&&"number"!=typeof r&&uo(t,n,r)&&(n=r=void 0),t=On(t),void 0===n?(n=t,t=0):n=On(n),r=void 0===r?t<n?1:-1:On(r),My(t,n,r,e)}}(),{Strophe:$y,$build:Dy,u:Py}=Ah.env;const Fy=class extends ua{get Direction(){return{SENDING:1,RECEIVING:2}}getIdentityKeyPair(){const e=this.get("identity_keypair");return Promise.resolve({privKey:Py.base64ToArrayBuffer(e.privKey),pubKey:Py.base64ToArrayBuffer(e.pubKey)})}getLocalRegistrationId(){return Promise.resolve(parseInt(this.get("device_id"),10))}isTrustedIdentity(e,t,n){if(null==e)throw new Error("Can't check identity key for invalid key");if(!(t instanceof ArrayBuffer))throw new Error("Expected identity_key to be an ArrayBuffer");const r=this.get("identity_key"+e);return void 0===r?Promise.resolve(!0):Promise.resolve(Py.arrayBufferToBase64(t)===r)}loadIdentityKey(e){if(null==e)throw new Error("Can't load identity_key for invalid identifier");return Promise.resolve(Py.base64ToArrayBuffer(this.get("identity_key"+e)))}saveIdentity(e,t){if(null==e)throw new Error("Can't save identity_key for invalid identifier");const n=new libsignal.SignalProtocolAddress.fromString(e),r=this.get("identity_key"+n.getName()),s=Py.arrayBufferToBase64(t);return this.save("identity_key"+n.getName(),s),r&&s!==r?Promise.resolve(!0):Promise.resolve(!1)}getPreKeys(){return this.get("prekeys")||{}}loadPreKey(e){const t=this.getPreKeys()[e];return t?Promise.resolve({privKey:Py.base64ToArrayBuffer(t.privKey),pubKey:Py.base64ToArrayBuffer(t.pubKey)}):Promise.resolve()}storePreKey(e,t){const n={};return n[e]={pubKey:Py.arrayBufferToBase64(t.pubKey),privKey:Py.arrayBufferToBase64(t.privKey)},this.save("prekeys",Object.assign(this.getPreKeys(),n)),Promise.resolve()}removePreKey(e){const t={...this.getPreKeys()};return delete t[e],this.save("prekeys",t),Promise.resolve()}loadSignedPreKey(e){const t=this.get("signed_prekey");return t?Promise.resolve({privKey:Py.base64ToArrayBuffer(t.privKey),pubKey:Py.base64ToArrayBuffer(t.pubKey)}):Promise.resolve()}storeSignedPreKey(e){if("object"!=typeof e)throw new Error("storeSignedPreKey: expected an object");return this.save("signed_prekey",{id:e.keyId,privKey:Py.arrayBufferToBase64(e.keyPair.privKey),pubKey:Py.arrayBufferToBase64(e.keyPair.pubKey),signature:Py.arrayBufferToBase64(e.signature)}),Promise.resolve()}removeSignedPreKey(e){return this.get("signed_prekey").id===e&&(this.unset("signed_prekey"),this.save()),Promise.resolve()}loadSession(e){return Promise.resolve(this.get("session"+e))}storeSession(e,t){return Promise.resolve(this.save("session"+e,t))}removeSession(e){return Promise.resolve(this.unset("session"+e))}removeAllSessions(e){const t=Object.keys(this.attributes).filter((t=>!!t.startsWith("session"+e)&&t)),n={};return t.forEach((e=>{n[e]=void 0})),this.save(n),Promise.resolve()}publishBundle(){const e=this.get("signed_prekey"),t=`${$y.NS.OMEMO_BUNDLES}:${this.get("device_id")}`,n=Dy("item").c("bundle",{xmlns:$y.NS.OMEMO}).c("signedPreKeyPublic",{signedPreKeyId:e.id}).t(e.pubKey).up().c("signedPreKeySignature").t(e.signature).up().c("identityKey").t(this.get("identity_keypair").pubKey).up().c("prekeys");Object.values(this.get("prekeys")).forEach(((e,t)=>n.c("preKeyPublic",{preKeyId:t}).t(e.pubKey).up()));return xh.pubsub.publish(null,t,n,{"pubsub#access_model":"open"},!1)}async generateMissingPreKeys(){const e=Object.keys(this.getPreKeys()),t=Ry(0,er.NUM_PREKEYS).map((e=>e.toString())).filter((t=>!e.includes(t)));if(t.length<1)return Fe.warn("No missing prekeys to generate for our own device"),Promise.resolve();(await Promise.all(t.map((e=>libsignal.KeyHelper.generatePreKey(parseInt(e,10)))))).forEach((e=>this.storePreKey(e.keyId,e.keyPair)));const n=Object.keys(this.getPreKeys()).map((e=>({id:e.keyId,key:Py.arrayBufferToBase64(e.pubKey)}))),r=(await xh.omemo.devicelists.get(er.bare_jid)).devices.get(this.get("device_id")),s=await r.getBundle();r.save("bundle",Object.assign(s,{prekeys:n}))}async generatePreKeys(){const e=er.NUM_PREKEYS,{KeyHelper:t}=libsignal,n=await Promise.all(Ry(0,e).map((e=>t.generatePreKey(e))));return n.forEach((e=>this.storePreKey(e.keyId,e.keyPair))),n.map((e=>({id:e.keyId,key:Py.arrayBufferToBase64(e.keyPair.pubKey)})))}async generateBundle(){const e=await libsignal.KeyHelper.generateIdentityKeyPair(),t=Py.arrayBufferToBase64(e.pubKey),n=await async function(){const e=(await xh.omemo.devicelists.get(er.bare_jid,!0)).devices.pluck("id");let t=libsignal.KeyHelper.generateRegistrationId(),n=0;for(;e.includes(t);)if(t=libsignal.KeyHelper.generateRegistrationId(),n++,10===n)throw new Error("Unable to generate a unique device ID");return t.toString()}();this.save({device_id:n,identity_keypair:{privKey:Py.arrayBufferToBase64(e.privKey),pubKey:t},identity_key:t});const r=await libsignal.KeyHelper.generateSignedPreKey(e,0);this.storeSignedPreKey(r);const s={identity_key:t,device_id:n,prekeys:await this.generatePreKeys()};s.signed_prekey={id:r.keyId,public_key:Py.arrayBufferToBase64(r.keyPair.pubKey),signature:Py.arrayBufferToBase64(r.signature)};const i=await xh.omemo.devicelists.get(er.bare_jid);(await i.devices.create({id:s.device_id,jid:er.bare_jid},{promise:!0})).save("bundle",s)}fetchSession(){return void 0===this._setup_promise&&(this._setup_promise=new Promise(((e,t)=>{this.fetch({success:()=>{this.get("device_id")?e():this.generateBundle().then(e).catch(t)},error:(n,r)=>{Fe.warn("Could not fetch OMEMO session from cache, we'll generate a new one."),Fe.warn(r),this.generateBundle().then(e).catch(t)}})}))),this._setup_promise}},Ly={omemo:{getDeviceID:async()=>(await xh.waitUntil("OMEMOInitialized"),er.omemo_store.get("device_id")),devicelists:{async get(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=er.devicelists.get(e)||(t?er.devicelists.create({jid:e}):null);return await(n?.initialized),n}},bundle:{generate:async()=>{await xh.waitUntil("OMEMOInitialized");const e=await xh.omemo.devicelists.get(er.bare_jid),t=er.omemo_store.get("device_id");if(t){const n=e.devices.get(t);er.omemo_store.unset(t),n&&await new Promise((e=>n.destroy({success:e,error:e}))),e.devices.trigger("remove")}await er.omemo_store.generateBundle(),await e.publishDevices();const n=X_(e.devices.get(er.omemo_store.get("device_id")));return await er.omemo_store.publishBundle(),n}}}},{Strophe:zy}=Ah.env;Ah.env.omemo=cy,zy.addNamespace("OMEMO_DEVICELIST",zy.NS.OMEMO+".devicelist"),zy.addNamespace("OMEMO_VERIFICATION",zy.NS.OMEMO+".verification"),zy.addNamespace("OMEMO_WHITELISTED",zy.NS.OMEMO+".whitelisted"),zy.addNamespace("OMEMO_BUNDLES",zy.NS.OMEMO+".bundles"),Ah.plugins.add("converse-omemo",{enabled:e=>window.libsignal&&e.config.get("trusted")&&!xh.settings.get("clear_cache_on_logout")&&!e.api.settings.get("blacklisted_plugins").includes("converse-omemo"),dependencies:["converse-chatview","converse-pubsub","converse-profile"],initialize(){console.log("converse-omemo initialize"),xh.settings.extend({omemo_default:!1}),xh.promises.add(["OMEMOInitialized"]),er.NUM_PREKEYS=100,Object.assign(er,_y),Object.assign(er.api,Ly),er.OMEMOStore=Fy,er.Device=Ey,er.Devices=Oy,er.DeviceList=Iy,er.DeviceLists=Ny,xh.waitUntil("chatBoxesInitialized").then(G_),xh.listen.on("getOutgoingMessageAttributes",z_),xh.listen.on("createMessageStanza",(async(e,t)=>{console.log("CREATE OMEMO MESSAGE STANZA CAUGHT IN OMEMO PLUGIN");try{t=await ay(e,t),console.log("SUCCESSFULLY CREATED OMEMO MESSAGE STANZA")}catch(t){console.log("FAILED TO CREATE OMEMO MESSAGE STANZA"),function(e,t){if("IQError"===e.name){t.save("omemo_supported",!1);const n=[];P_(`presence-subscription-required[xmlns="${$_.NS.PUBSUB_ERROR}"]`,e.iq).length?n.push(Gv("Sorry, we're unable to send an encrypted message because %1$s requires you to be subscribed to their presence in order to see their OMEMO information",e.iq.getAttribute("from"))):P_('remote-server-not-found[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]',e.iq).length?n.push(Gv("Sorry, we're unable to send an encrypted message because the remote server for %1$s could not be found",e.iq.getAttribute("from"))):(n.push(Gv("Unable to send an encrypted message due to an unexpected error.")),n.push(e.iq.outerHTML)),xh.alert("error",Gv("Error"),n)}else e.user_facing&&xh.alert("error",Gv("Error"),[e.message]);throw e}(t,e)}return t})),xh.listen.on("afterFileUploaded",((e,t)=>e.file.xep454_ivkey?function(e,t){const n=t.oob_url.replace(/^https?:/,"aesgcm:")+"#"+e.file.xep454_ivkey;return Object.assign(t,{oob_url:null,message:n,body:n})}(e,t):t)),xh.listen.on("beforeFileUpload",((e,t)=>e.get("omemo_active")?async function(e){const t=crypto.getRandomValues(new Uint8Array(12)),n=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),r=await crypto.subtle.encrypt({name:"AES-GCM",iv:t},n,await e.arrayBuffer()),s=await window.crypto.subtle.exportKey("raw",n),i=new File([r],e.name,{type:e.type,lastModified:e.lastModified});return i.xep454_ivkey=Vu(t)+Vu(s),i}(t):t)),xh.listen.on("parseMessage",H_),xh.listen.on("parseMUCMessage",H_),xh.listen.on("chatBoxViewInitialized",J_),xh.listen.on("chatRoomViewInitialized",J_),xh.listen.on("connected",ty),xh.listen.on("getToolbarButtons",oy),xh.listen.on("statusInitialized",ry),xh.listen.on("addClientFeatures",(()=>xh.disco.own.features.add(`${zy.NS.OMEMO_DEVICELIST}+notify`))),xh.listen.on("afterMessageBodyTransformed",q_),xh.listen.on("userDetailsModalInitialized",(e=>{const t=e.get("jid");er.generateFingerprints(t).catch((e=>Fe.error(e)))})),xh.listen.on("profileModalInitialized",(()=>{er.generateFingerprints(er.bare_jid).catch((e=>Fe.error(e)))})),xh.listen.on("clearSession",(()=>{delete er.omemo_store,fu()&&er.devicelists&&(er.devicelists.clearStore(),delete er.devicelists)}))}}),er.api=xh,Gu().extend(Oe());const Uy=Ah})(),a})()));
//# sourceMappingURL=converse-headless.min.js.map